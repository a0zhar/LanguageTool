(()=>{"use strict";
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class e{static _contructor(){if(this._isInitialized)return;e._isChromium=navigator.userAgent.includes("Chrome/")||navigator.userAgent.includes("Chromium/"),e._isFirefox=navigator.userAgent.includes("Firefox/"),e._isThunderbird=navigator.userAgent.includes("Thunderbird/"),e._isOpera=navigator.userAgent.includes("OPR/"),e._isEdge=navigator.userAgent.includes("Edg/"),e._isOldEdge=navigator.userAgent.includes("Edge/"),e._isSafari=(navigator.userAgent.includes("Safari/")||navigator.userAgent.includes("AppleWebKit"))&&!e._isChromium&&!e._isEdge&&!e._isOpera,e._isYaBrowser=navigator.userAgent.includes("YaBrowser/"),e._isChrome=e._isChromium&&!e._isOpera&&!e._isEdge&&!e._isOldEdge&&!e._isYaBrowser;const t=navigator.userAgent.match(/Chrome\/(\d+)/);t&&(e._isUnsupportedChrome=parseInt(t[1])<67&&!navigator.userAgent.includes("Edge/"));const n=navigator.userAgent.match(/Firefox\/(\d+)/);n&&(e._isUnsupportedFirefox=parseInt(n[1])<60),this._isInitialized=!0}static getOS(){return navigator.userAgent.includes("Macintosh")?"Mac":navigator.userAgent.includes("Windows")?"Windows":navigator.userAgent.includes("CrOS")?"CrOS":navigator.userAgent.includes("Linux")?"Linux":"Other"}static isChromium(){return e._isChromium}static isChrome(){return e._isChrome}static isThunderbird(){return e._isThunderbird}static isFirefox(){return e._isFirefox}static isOpera(){return e._isOpera}static isEdge(){return e._isEdge}static isSafari(){return e._isSafari}static isYaBrowser(){return e._isYaBrowser}static isUnsupportedChrome(){return e._isUnsupportedChrome}static isUnsupportedFirefox(){return e._isUnsupportedFirefox}static isUnsupportedBrowser(){return e.isUnsupportedChrome()||e.isUnsupportedFirefox()}static getBrowserName(){return e.isChrome()?"Chrome":e.isFirefox()?"Firefox":e.isOpera()?"Opera":e.isEdge()?"Edge":e.isSafari()?"Safari":e.isYaBrowser()?"Yandex":"Unknown Browser"}static getUserAgentIdentifier(){let e="webextension";return this.isChrome()?e+="-chrome":this.isFirefox()?e+="-firefox":this.isOpera()?e+="-opera":this.isEdge()?e+="-edge":this.isYaBrowser()?e+="-chrome":this.isSafari()?e+="-safari":e+="-unknown",e+"-ng"}static isTouchDevice(){if(!("ontouchstart"in window))return!1;const e=navigator.userAgent.includes("Android");return this.isIOS()||e}static isIOS(){const e=navigator.userAgent.includes("iPhone OS"),t=navigator.userAgent.includes("Macintosh")&&Boolean(navigator.maxTouchPoints&&navigator.maxTouchPoints>2);return e||t}static isIOSTouchDevice(){return"ontouchstart"in window&&this.isIOS()}}e._isChromium=!1,e._isChrome=!1,e._isFirefox=!1,e._isThunderbird=!1,e._isOpera=!1,e._isOldEdge=!1,e._isEdge=!1,e._isSafari=!1,e._isYaBrowser=!1,e._isUnsupportedChrome=!1,e._isUnsupportedFirefox=!1,e._isInitialized=!1,e._contructor();const t=class{static init(e){this._instance=e}static isProductionEnvironment(){return this._instance.isProductionEnvironment()}static isRuntimeConnected(){return this._instance.isRuntimeConnected()}static getVersion(){return this._instance.getVersion()}static getTrackingId(){return this._instance.getTrackingId()}static shouldTrack(){return this._instance.shouldTrack()}static getType(){return this._instance.getType()}static getURL(e){return this._instance.getURL(e)}static getUILanguageCode(){return this._instance.getUILanguageCode()}static openWindow(e){return this._instance.openWindow(e)}static loadContentScripts(e,t){return this._instance.loadContentScripts(e,t)}static initializeLTAssistant(e,t={}){return this._instance.initializeLTAssistant(e,t)}static getPreferredLanguages(){return this._instance.getPreferredLanguages()}static startDictionarySync(){return this._instance.startDictionarySync()}static addWordToDictionary(e){return this._instance.addWordToDictionary(e)}static addWordsToDictionary(e){return this._instance.addWordsToDictionary(e)}static removeWordFromDictionary(e){return this._instance.removeWordFromDictionary(e)}static clearDictionary(){return this._instance.clearDictionary()}static updateDictionary(){return this._instance.updateDictionary()}static loadSynonyms(e,t,n){return this._instance.loadSynonyms(e,t,n)}static loadPhrases(e,t,n,s){return this._instance.loadPhrases(e,t,n,s)}static reportPhrase(e,t){return this._instance.reportPhrase(e,t)}static trackEvent(e,t){return this._instance.trackEvent(e,t)}static trackTextLength(e){return this._instance.trackTextLength(e)}static pageLoaded(e,t,n,s,i){return this._instance.pageLoaded(e,t,n,s,i)}static ltAssistantStatusChanged(e,t){return"number"==typeof e?this._instance.ltAssistantStatusChanged(e,t):this._instance.ltAssistantStatusChanged(e)}static check(e,t,n,s,i,o){return this._instance.check(e,t,n,s,i,o)}static isOptionsPageSupported(){return this._instance.isOptionsPageSupported()}static openOptionsPage(e,t){return this._instance.openOptionsPage(e,t)}static isFeedbackFormSupported(){return this._instance.isFeedbackFormSupported()}static openFeedbackForm(e,t,n){return this._instance.openFeedbackForm(e,t,n)}static openPremiumPage(e,t=0,n=0,s=0,i="",o){return this._instance.openPremiumPage(e,t,n,s,i,o)}};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class n{}n.eventNames={localeChanged:"lt-i18nManager.localeChanged"};const s=class{static init(e){this._instance=e}static addEventListener(e,t){this._instance.addEventListener(e,t)}static setLocale(e){this._instance.setLocale(e)}static getMessage(e,t){return this._instance.getMessage(e,t)}};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
const i={EXTENSION_HEALTH_RECHECK_INTERVAL:3e3,UI_MODE_RECHECK_INTERVAL:6e4,ACCOUNT_STATUS_RECHECK_INTERVAL:36e5,EXTERNAL_CONFIG_RELOAD_INTERVAL:144e5,PING_INTERVAL:864e5,SYNC_USER_DATA_INTERVAL:864e5,IFRAME_INITILIZATION_RECHECK_INTERVAL:1500,DICTIONARY_SYNC_INTERVAL:72e5,RENDER_INTERVAL:300,TOOLBAR_DECREASE_SIZE_INTERVAL:900,CHECK_REQUEST_TIMEOUT:5e4,CHECK_THROTTLING_LIMIT:30,INSTALL_URL:"https://languagetool.org/webextension/welcome",UNINSTALL_URL:"https://languagetool.org/webextension/uninstall",USER_DATA_URL:"https://languagetool.org/webextension/user",BASE_SERVER_URL:"https://api.languagetool.org",get MAIN_SERVER_URL(){return`${this.BASE_SERVER_URL}/v2`},MAIN_FALLBACK_SERVER_URL:"https://api-fallback.languagetool.org/v2",PREMIUM_SERVER_URL:"https://api.languagetoolplus.com/v2",PREMIUM_FALLBACK_SERVER_URL:"https://languagetoolplus.com/api/v2",LOCAL_SERVER_URL:"http://localhost:8081/v2",FEEDBACK_SERVER_URL:"https://languagetool.org/send-feedback/",EXTERNAL_CONFIG_URL:"https://languagetool.org/webextension_config.json",CLIENT_LOGIN_URL:"https://languagetool.org/client-login",PING_URL:"https://languagetool.org/ping",WEBAPI_URL:"https://languagetool.org/webapi",SWITCH_TO_FALLBACK_SERVER_ERRORS:[502,503,504],MAIN_SERVER_RECHECK_INTERVAL:18e4,MIN_TEXT_LENGTH:4,SHORT_TEXT_MAX_LENGTH:50,MAX_TEXT_LENGTH:1e4,TEXT_LEVEL_MAX_LENGTH_PER_REQUEST:2e4,MAX_TEXT_LENGTH_PERFORMANCE_DEGRADATION:4e4,MAX_TEXT_LENGTH_PREMIUM:1e5,MAX_TEXT_LENGTH_CUSTOM_SERVER:Number.MAX_SAFE_INTEGER,PARAGRAPH_LEVEL_CHUNK_LENGTH:5e3,CHECK_DELAY:1400,CHECK_MAX_DELAY:3500,STOPPED_TYPING_TIMEOUT:2250,COLORS:{GRAMMAR:{UNDERLINE:"#f2b24c",BACKGROUND:"rgba(242,179,77,0.3)",EMPHASIZE:"rgba(241,179,76,0.1)"},STYLE:{UNDERLINE:"#8F7FFF",BACKGROUND:"rgba(142,128,255,0.2)",EMPHASIZE:"rgba(138,128,255,0.1)",TITLE:"#5C4CFF"},LONG_SENTENCE:{UNDERLINE:"#D2CBFF",BACKGROUND:"rgba(210,203,255,0.2)",EMPHASIZE:"rgba(210,203,255,0.1)"},HIDDEN_MATCH:{UNDERLINE:"#F37B23",BACKGROUND:"rgba(253,177,55,0.2)",EMPHASIZE:"rgba(253,177,55,0.1)"},IGNORED_RANGE:{UNDERLINE:"#00bbe6",BACKGROUND:"rgb(92, 222, 251, 0.2)",EMPHASIZE:"rgb(154, 232, 250, 0.1)"},SPELLING:{UNDERLINE:"#EB5757",BACKGROUND:"rgba(235,88,88,0.2)",EMPHASIZE:"rgba(239,88,88,0.1)"},SYNONYMS:{UNDERLINE:"#0042d7"},NEW_SENTENCE:{BACKGROUND:"rgba(30, 225, 151, 0.2)"}},MAX_FIXES_COUNT:5,MAX_EXCEPTION_COUNT:6,MAX_USAGE_COUNT_ONBOARDING:5,SUPPORTED_SYNONYM_LANGUAGES:["de","de-CH","ru","sv","pt","el","en","eo","it","fr","es","uk","sk","sl","pl","da","ro","nl","ca"],COUNTRY_COUPON_MAPPING:{UKRAINE:{countries:["UA","BY"],percent:50},"ITALY-DISCOUNT":{countries:["IT"],percent:20},"SPAIN-DISCOUNT":{countries:["ES"],percent:20},SOUTH_EUROPE:{countries:["RO","AL","GR","ME","EE","LT","LV","BG","CY","MT","SK","SI","RS","HR","XK","HU","MD","TR","PT"],percent:20},AFRICA:{countries:["NG","ET","EG","CD","CG","TZ","KE","UG","DZ","SD","MA","AO","MZ","TN","CI","DJ","SZ","MU","GQ","GA","BW","SO","CD","ER","MG"],percent:50},ASIA:{countries:["ID","PK","BD","VN","MM","PH","UZ","MY","NP","KZ","KH","UZ","TH","YE","SY","JO"],percent:50},LATIN_AMERICA:{countries:["PE","VE","EC","SV","DO","BO","SR","AR","HN","BZ","CR","PA","GT","NI","GY","UY","HT","JM","TT","CU"],percent:50},BRAZIL:{countries:["BR"],percent:50}},COUPON_INTERVAL:5184e6,PACKAGE:{BASIC:"Basic",PREMIUM:"Premium"},PICKY_RULES_THAT_ARE_CONSIDERED_ANNOYING:["EN_QUOTES","PASSIVE_VOICE","DASH_RULE","SENTENCE_FRAGMENT","TOO_LONG_SENTENCE","FALSCHE_VERWENDUNG_DES_BINDESTRICHS","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_CH","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_2","PUNCTUATION_PARAGRAPH_END","FINAL_STOPS","FINAL_PUNCTUATION","SMART_QUOTES","DASH_SPACE_RULES","HIPHEN_SPACE_RULES","BRAK_KROPKI","DYWIZ","CUDZYSLOW_DRUKARSKI","EINDE_ZIN_ONVERWACHT","BACKTICK","GEDACHTESTREEPJE","OPTIONAL_HYPHEN"],ERRORS_THAT_CAN_BE_CORRECTED_ALL_AT_ONCE:[{ruleId:"FALSCHES_ANFUEHRUNGSZEICHEN",suggestions:[{match:/[„“]/,message:"Alle <lt-em>“</lt-em>…<lt-em>”</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN",suggestions:[{match:/[„“]/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"},{match:/(^»)|(«$)/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>»</lt-em>…<lt-em>«</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_CH",suggestions:[{match:/[„“]/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"},{match:/(^«)|(»$)/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>«</lt-em>…<lt-em>»</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_2",suggestions:[{match:/[‚‘]/,message:"Alle <lt-em>'</lt-em>…<lt-em>'</lt-em> zu <lt-em>‚</lt-em>…<lt-em>‘</lt-em> ändern"},{match:/[„“]/,message:"Alle <lt-em>'</lt-em>…<lt-em>'</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_APOSTROPHE",suggestions:[{match:/’/,message:"Alle Apostrophe zu <lt-em>’</lt-em> ändern"}]},{ruleId:"EN_QUOTES",suggestions:[{match:/[“”]/,message:"Change all <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> to <lt-em>“</lt-em>…<lt-em>”</lt-em>"}]},{ruleId:"WRONG_APOSTROPHE",suggestions:[{match:/'/,message:"Use <lt-em>'</lt-em> for all bad apostrophes"},{match:/’/,message:"Use <lt-em>’</lt-em> for all bad apostrophes"}]},{ruleId:"PARAGRAF_LEERZEICHEN",suggestions:[{match:/§\u00A0/,message:"Alle Leerzeichen nach <lt-em>§</lt-em> ändern"}]}]};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
function o(e,t){if("function"==typeof e.matchAll)return Array.from(e.matchAll(t));const n=[];let s=t.exec(e);for(;s;)n.push(s),s=t.exec(e);return n}function r(e){return e.length>0&&" "===e[e.length-1]}let a,l,c,d,h,_;function u(e){return/\s/.test(e)}function g(e){return e.substring(0,1).toUpperCase()+e.substring(1)}!function(){let e;try{e=new RegExp("\\p{L}","u")}catch(t){e=/[a-zäöüß]/i}a=function(t){return e.test(t)}}(),function(){const e=new RegExp("^[\b\t          ‏　]$"),t=new RegExp("[\b\t          ‏　]","g");l=function(t){return e.test(t)},c=function(e){return e.replace(t," ")}}(),function(){const e="​‌‍­⁠‪‫‬‭",t=new RegExp("^["+e+"]$"),n=new RegExp("["+e+"]"),s=new RegExp("["+e+"]","g");d=function(e){return t.test(e)},h=function(e){const t=e.match(n);return t?t.index:-1},_=function(e){return e.replace(s,"")}}();!function(){const e=/^[A-ZÈÉÊÁÀÂÓÒÔÚÙÛÍÌÎÄÜÖ]+[A-ZÈÉÊÁÀÂÓÒÔÚÙÛÍÌÎÄÜÖ\-!?#@=%().:;<>'’´`"”“*+,\s]+[A-ZÈÉÊÁÀÂÓÒÔÍÌÎÄÜÖ]$/}();let m,p;function E(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/`/g,"&#x60;").replace(/\//g,"&#x2F;")}function f(e,t){return e===t||JSON.stringify(e)===JSON.stringify(t)}function S(e){return null===e||"object"!=typeof e?e:e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e):Array.isArray(e)?Array.from(e):Object.assign({},e)}function C(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e);if(e instanceof RegExp)return new RegExp(e);const t=Array.isArray(e)?[]:{};for(const n in e)t[n]=C(e[n]);return t}function T(e){const t=e.toString();return 1===t.length?"0"+t:t}function b(){if("about:blank"===location.href||"about:srcdoc"===location.href)try{return(window.opener||window.parent).location.href}catch(e){}return location.href}function A(e,t=e){if(e.startsWith("about:blank"))return"blank";if(e.startsWith("about:srcdoc"))return"srcdoc";if(e.startsWith("file:"))return"file";e&&!/^([a-z\-]+:\/\/)/i.test(e)&&(e="http://"+e);try{return new URL(e).hostname}catch(e){return t}}function N(){const e=document.location||document.defaultView.location;if(e&&e.hostname)return e.hostname.replace(/^www\./,"");try{if(window.parent!==window)return window.parent.location.hostname.replace(/^www\./,"")}catch(e){}return e.href.startsWith("about:blank")?"blank":e.href.startsWith("about:srcdoc")?"srcdoc":e.href.startsWith("file:")?"file":""}function L(e,t){return e.toLocaleString(t)}function I(e){const t=[e];for(;e.split(".").length>2;){const n=e.indexOf(".");e=e.substr(n+1),t.push(e)}return t}!function(){let e,t;const n=/(?:\S+\s+){0,4}\S+$/,s=/^\S+(?:\s+\S+){0,4}/;try{e=new RegExp("^\\s*(-?\\p{L}+)*-?\\s*$","u"),t=new RegExp("^\\s*\\p{L}+(-\\p{L}+)*\\s*$","u")}catch(n){e=/^\s*(-?[a-zäöüß]+)*-?\s*$/i,t=/^\s*[a-zäöüß]+(-[a-zäöüß]+)*\s*$/i}m=(n,s,i=s)=>{const o=n.substring(s,i);if(!e.test(o))return null;let r=0===o.length||a(o[0]),l="-"===o[0],c=s;if(r||l)for(;c>0;){const e=n[c-1],t=a(e),s="-"===e;if(!t&&!s)break;if(s&&l)return null;c--,r=t,l=s}r=a(o[o.length-1]),l=o.endsWith("-");let d=i;if(r||l)for(;d<n.length;){const e=n[d],t=a(e),s="-"===e;if(!t&&!s)break;if(s&&l)return null;d++,r=t,l=s}const h=o.match(/\s+$/);h&&(d-=h[0].length);const _=n.substring(c,d);return t.test(_)?{start:c,end:d}:null},p=(e,t,i)=>{const o=m(e,t,i);if(!o)return null;const r=n.exec(e.substring(0,o.start).trim()),a=r?r[0]:"",l=s.exec(e.substring(o.end).trim()),c=l?l[0]:"";return{word:e.substring(o.start,o.end),position:o,beforeText:a,afterText:c}}}();!function(){const e=/^\w+\.$/}();!function(){const e=/[\u0300-\u036f]/g,t=/\u0142/g,n=/\u00F8/g}();
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class v{constructor(){this._eventHandlers=new Map}subscribe(e,t){this._eventHandlers.has(e)||this._eventHandlers.set(e,[]),this._eventHandlers.get(e).push(t)}fire(e,t){const n=this._eventHandlers.get(e);n&&n.forEach((e=>{try{e(t)}catch(e){console.error(e)}}))}destroy(){this._eventHandlers.clear()}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class x{static get LANGUAGES(){return this._languages||(this._languages=[{code:"ar",name:s.getMessage("ar")},{code:"ast-es",name:s.getMessage("ast")},{code:"be-by",name:s.getMessage("be")},{code:"br-fr",name:s.getMessage("br")},{code:"ca-es",name:s.getMessage("ca")},{code:"ca-es-valencia",name:s.getMessage("ca_ES_valencia")},{code:"da-dk",name:s.getMessage("da_DK")},{code:"de-at",name:s.getMessage("de_AT")},{code:"de-ch",name:s.getMessage("de_CH")},{code:"de-de",name:s.getMessage("de_DE")},{code:"el-gr",name:s.getMessage("el")},{code:"en-au",name:s.getMessage("en_AU")},{code:"en-ca",name:s.getMessage("en_CA")},{code:"en-gb",name:s.getMessage("en_GB")},{code:"en-nz",name:s.getMessage("en_NZ")},{code:"en-us",name:s.getMessage("en_US")},{code:"en-za",name:s.getMessage("en_ZA")},{code:"eo",name:s.getMessage("eo")},{code:"es",name:s.getMessage("es")},{code:"fa",name:s.getMessage("fa")},{code:"ga-ie",name:s.getMessage("ga")},{code:"fr",name:s.getMessage("fr")},{code:"gl-es",name:s.getMessage("gl")},{code:"it",name:s.getMessage("it")},{code:"ja-jp",name:s.getMessage("ja")},{code:"km-kh",name:s.getMessage("km")},{code:"nl",name:s.getMessage("nl")},{code:"no",name:s.getMessage("no")},{code:"pl-pl",name:s.getMessage("pl")},{code:"pt-ao",name:s.getMessage("pt_AO")},{code:"pt-br",name:s.getMessage("pt_BR")},{code:"pt-mz",name:s.getMessage("pt_MZ")},{code:"pt-pt",name:s.getMessage("pt_PT")},{code:"ro-ro",name:s.getMessage("ro")},{code:"ru-ru",name:s.getMessage("ru")},{code:"sk-sk",name:s.getMessage("sk")},{code:"sl-si",name:s.getMessage("sl")},{code:"sv",name:s.getMessage("sv")},{code:"ta-in",name:s.getMessage("ta")},{code:"tl-ph",name:s.getMessage("tl")},{code:"uk-ua",name:s.getMessage("uk")},{code:"zh-cn",name:s.getMessage("zh")}],this._languages.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),this._isSubscribed||(s.addEventListener(n.eventNames.localeChanged,(()=>this._languages=null)),this._isSubscribed=!0)),this._languages}static isLanguageVariant(e){return e.code.includes("-")}static getPrimaryLanguageCode(e){return e.split("-")[0]}static formatLanguageCode(e){const t=e.split("-");return 1===t.length?t[0]:2===t.length?t[0]+"-"+t[1].toUpperCase():t[0]+"-"+t[1].toUpperCase()+"-"+t[2]}static getUserLanguageCode(){for(const e of navigator.languages){if(e.includes("-")&&e.startsWith(navigator.language))return e}return navigator.language}static getUserLanguageCodes(){const e=Array.from(navigator.languages,(e=>this.getPrimaryLanguageCode(e).toLowerCase()));try{e.push(this.getPrimaryLanguageCode(t.getUILanguageCode()).toLowerCase())}catch(e){}return function(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}(e)}static getPreferredLanguageVariant(e){const t={"en-in":"en-us","en-ie":"en-gb"},n=navigator.languages||[];for(let s of n){s=s.toLowerCase(),s=t[s]||s;for(const t of e){const e=t.toLowerCase();if(s.length>2&&s===e)return t}}return null}static getLanguagesForGeoIPCountry(){return new Promise((function(e,t){let n=!1;const s=window.setTimeout((()=>{n=!0,t(new Error("geoip timeout"))}),15e3);fetch("https://languagetool.org/webextension/init",{method:"GET",mode:"cors"}).then((e=>e.json())).then((t=>{if(!n){const n=(t.geoIpCountry||"").toUpperCase();e({geoIpLanguages:t.geoIpLanguages||[],geoIpCountry:n}),clearTimeout(s)}})).catch((e=>{console.error(e),n||(t(e),clearTimeout(s))}))}))}}x._languages=null,x._isSubscribed=!1,x.ALL_LANGUAGES=[{code:"ak",name:"Akan"},{code:"am",name:"አማርኛ"},{code:"an",name:"aragonés"},{code:"ar",name:"عربي"},{code:"as",name:"অসমীয়া"},{code:"ast",name:"Asturianu"},{code:"be",name:"Беларуская"},{code:"bg",name:"Български"},{code:"bm",name:"Bamanankan"},{code:"bn",name:"বাংলা"},{code:"br",name:"Brezhoneg"},{code:"bs",name:"босански"},{code:"ca",name:"Català"},{code:"cs",name:"čeština"},{code:"cy",name:"Cymraeg"},{code:"da",name:"Dansk"},{code:"de",name:"Deutsch"},{code:"el",name:"Ελληνικά"},{code:"en",name:"English"},{code:"eo",name:"Esperanto"},{code:"es",name:"Español"},{code:"et",name:"Eesti keel"},{code:"eu",name:"Euskara"},{code:"fa",name:"فارسی"},{code:"fi",name:"suomi"},{code:"fj",name:"Vosa vaka-Viti"},{code:"fr",name:"Français"},{code:"ga",name:"Gaeilge"},{code:"gd",name:"Gàidhlig"},{code:"gl",name:"Galego"},{code:"gn",name:"Avañe'ẽ"},{code:"gu",name:"ગુજરાતી"},{code:"ha",name:"هَرْشَن هَوْسَ‎"},{code:"he",name:"עברית"},{code:"hi",name:"हिन्दी"},{code:"hr",name:"hrvatski"},{code:"hu",name:"magyar"},{code:"hy",name:"Հայերեն"},{code:"ia",name:"Interlingua"},{code:"id",name:"Bahasa Indonesia"},{code:"ig",name:"Ásụ̀sụ̀ Ìgbò"},{code:"is",name:"íslenska"},{code:"it",name:"Italiano"},{code:"ja",name:"日本語"},{code:"kk",name:"Қазақ"},{code:"km",name:"ខ្មែរ"},{code:"kn",name:"ಕನ್ನಡ"},{code:"ko",name:"한국어"},{code:"ku",name:"Kurdî"},{code:"ks",name:"كشمیری"},{code:"la",name:"Latina"},{code:"lg",name:"Luganda"},{code:"lo",name:"ພາສາລາວ"},{code:"lt",name:"Lietuvių"},{code:"lv",name:"Latviešu"},{code:"mg",name:"malagasy"},{code:"mi",name:"Māori"},{code:"ml",name:"മലയാളം"},{code:"mk",name:"Македонски"},{code:"mn",name:"Монгол"},{code:"mr",name:"मराठी"},{code:"ms",name:"Melayu"},{code:"my",name:"မြန်မာဘာသာ"},{code:"nb",name:"Norsk bokmål"},{code:"ne",name:"नेपाली"},{code:"nn",name:"Norsk nynorsk"},{code:"no",name:"Norsk"},{code:"nl",name:"Nederlands"},{code:"nr",name:"isiNdebele"},{code:"oc",name:"Occitano"},{code:"or",name:"ଓଡ଼ିଆ"},{code:"pa",name:"ਪੰਜਾਬੀ"},{code:"pl",name:"Polski"},{code:"ps",name:"پښتو"},{code:"pt",name:"Português"},{code:"rm",name:"rumantsch"},{code:"ro",name:"românesc"},{code:"ru",name:"Русский"},{code:"rw",name:"Ikinyarwanda"},{code:"sa",name:"संस्कृत"},{code:"si",name:"සිංහල"},{code:"sk",name:"slovenčina"},{code:"sl",name:"Slovenščina"},{code:"so",name:"Soomaali"},{code:"sr",name:"Српски"},{code:"ss",name:"siSwati"},{code:"st",name:"Sesotho"},{code:"sv",name:"Svenska"},{code:"ta",name:"தமிழ்"},{code:"te",name:"తెలుగు"},{code:"th",name:"ภาษาไทย"},{code:"tl",name:"Tagalog"},{code:"fil",name:"Filipino"},{code:"tr",name:"Türkçe"},{code:"ts",name:"Xitsonga"},{code:"tt",name:"Tatarça"},{code:"uk",name:"Українська"},{code:"ur",name:"اُردو"},{code:"uz",name:"Oʻzbek tili"},{code:"ve",name:"Tshivenḓa"},{code:"vi",name:"Tiếng Việt"},{code:"yo",name:"عِدعِ يوْرُبا"},{code:"zh",name:"中文"},{code:"zu",name:"isiZulu"}],x.POPULAR_LANGUAGES=["de","en","es","fr","nl","pl","pt","ru","uk","zh","it","hi"];
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class R{constructor(){this._eventBus=new v,this._onReadyCallbacks=[]}static get DEFAULT_SETTINGS(){return null===this.DEFAULT_SETTINGS_CACHED&&(this.DEFAULT_SETTINGS_CACHED={apiServerUrl:i.MAIN_SERVER_URL,autoCheck:!0,knownEmail:"",username:"",password:"",token:"",userId:null,dpaLevel:0,motherTongue:"",geoIpLanguages:[],geoIpCountry:"",preferredLanguages:[],enVariant:x.getPreferredLanguageVariant(["en-US","en-GB","en-AU","en-CA","en-NZ","en-ZA"])||"en-US",deVariant:x.getPreferredLanguageVariant(["de-DE","de-AT","de-CH"])||"de-DE",ptVariant:x.getPreferredLanguageVariant(["pt-PT","pt-BR","pt-MZ","pt-AO"])||"pt-BR",caVariant:"ca-ES",dictionary:[],hasSynonymsEnabled:!1,hasPickyModeEnabledGlobally:!1,openCardHotkey:"",isDictionarySynced:!1,ignoredRules:[],disabledDomains:[],disabledEditorGroups:[],disabledDomainsCapitalization:[],ignoreCheckOnDomains:[],autoCheckOnDomains:[],confirmedGPT3:!1}),this.DEFAULT_SETTINGS_CACHED}static _combineObjects(e,t){const n=C(e);for(const e in n)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}static _dec2hex(e){return("0"+e.toString(16)).substr(-2)}static _generateUniqueId(){const e=new Uint8Array(8);return window.crypto.getRandomValues(e),Array.from(e,R._dec2hex).join("")}static _normalizeDomain(e=""){return e.toLowerCase().trim().replace(/^www\./,"")}static _isListContainsDomain(e,t){const n=R._normalizeDomain(t);return(e||[]).some((e=>{const t=R._normalizeDomain(e);return t===n||n.endsWith("."+t)}))}static getDefaultSettings(){return C(R.DEFAULT_SETTINGS)}static getDefaultPrivacySettings(){return S(R.DEFAULT_PRIVACY_SETTINGS)}addEventListener(e,t){this._eventBus.subscribe(e,t)}disableDomain(e){const t=R._normalizeDomain(e),n=this.getSettings(),s="object"==typeof n.disabledDomains?n.disabledDomains:[];return s.push(t),this.updateSettings({disabledDomains:s})}enableDomain(e){const t=R._normalizeDomain(e),n=this.getSettings();let s="object"==typeof n.disabledDomains?n.disabledDomains:[];return s=s.filter((e=>{const n=R._normalizeDomain(e);return n!==t&&!t.endsWith("."+n)})),this.updateSettings({disabledDomains:s})}disableEditorGroup(e,t){const n=R._normalizeDomain(e),s=this.getSettings(),i="object"==typeof s.disabledEditorGroups?s.disabledEditorGroups:[];return i.push({domain:n,editorGroupId:t}),this.updateSettings({disabledEditorGroups:i})}enableEditorGroup(e,t){const n=R._normalizeDomain(e),s=this.getSettings();let i="object"==typeof s.disabledEditorGroups?s.disabledEditorGroups:[];return i=i.filter((e=>!(e.domain===n&&e.editorGroupId===t))),this.updateSettings({disabledEditorGroups:i})}enableDomainAndEditorGroup(e,t){return this.getCheckSettings(e,t).isEditorGroupDisabled&&this.enableEditorGroup(e,t),this.enableDomain(e)}disableCapitalization(e){const t=R._normalizeDomain(e),n=this.getSettings(),s="object"==typeof n.disabledDomainsCapitalization?n.disabledDomainsCapitalization:[];return s.push(t),this.updateSettings({disabledDomainsCapitalization:s})}enableCapitalization(e){const t=R._normalizeDomain(e),n=this.getSettings();let s="object"==typeof n.disabledDomainsCapitalization?n.disabledDomainsCapitalization:[];return s=s.filter((e=>{const n=R._normalizeDomain(e);return n!==t&&!t.endsWith("."+n)})),this.updateSettings({disabledDomainsCapitalization:s})}destroy(){this._eventBus.destroy(),this._onReadyCallbacks=[]}}R.eventNames={settingsChanged:"lt-storageController.settingsChanged",configurationChanged:"lt-storageController.configurationChanged",privacySettingsChanged:"lt-storageController.privacySettingsChanged",uiStateChanged:"lt-storageController.uiStateChanged"},R.DEFAULT_SETTINGS_CACHED=null,R.DEFAULT_MANAGED_SETTINGS={apiServerUrl:"",loginUrl:"",disablePrivacyConfirmation:!1,disablePersonalDictionary:!1,disableIgnoredRules:!1},R.DEFAULT_CONFIGURATION={unsupportedDomains:[]},R.DEFAULT_PRIVACY_SETTINGS={allowRemoteCheck:!1},R.DEFAULT_STATISTICS={usageCount:0,sessionCount:0,appliedSuggestions:0,appliedSynonyms:0,hiddenErrors:[],firstVisit:null,lastActivity:null,ratingValue:null,premiumClicks:0,isOverleafUser:!1,isThunderbirdUser:!1,isNotionUser:!1},R.DEFAULT_UI_STATE={hasSeenPrivacyConfirmationDialog:!1,hasPaidSubscription:!1,hasRated:!1,hasUsedValidator:!1,hasSeenOnboarding:!1,isNewUser:!1,hasSeenNewOverleafTeaser:!1,hasSeenNewGoogleDocsTeaser:!1,hasSeenNewGoogleSlidesTeaser:!1,hasSeenGoogleDocsMenuBarHint:!1,lastChangelogNov2021Seen:null,changelogNov2021CountdownEnd:null,changelogNov2021Coupon:null,showRuleId:!1,dialogPosition:"default",countMode:"characters",hasSeenTurnOnMessagePopup:!1},R.DEFAULT_TEST_FLAGS={};class M{static init(e){this._instanceCtor=e}static create(){return this._instanceCtor()}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class y extends R{constructor(){super(),this._onStoredDataChanged=(e,t)=>{let n=!1,s=!1,i=!1,o=!1,r=!1;for(const a in e)"managed"!==t?(/^dictionary(_\d+)?$/.test(a)&&(n=!0),this._settings&&R.DEFAULT_SETTINGS.hasOwnProperty(a)&&"dictionary"!==a&&(this._settings[a]=e[a].newValue,s=!0),this._configuration&&R.DEFAULT_CONFIGURATION.hasOwnProperty(a)&&(this._configuration[a]=e[a].newValue,i=!0),this._privacySettings&&R.DEFAULT_PRIVACY_SETTINGS.hasOwnProperty(a)&&(this._privacySettings[a]=e[a].newValue,o=!0),this._statistics&&R.DEFAULT_STATISTICS.hasOwnProperty(a)&&(this._statistics[a]=e[a].newValue),this._uiState&&R.DEFAULT_UI_STATE.hasOwnProperty(a)&&(this._uiState[a]=e[a].newValue,r=!0),this._testFlags&&R.DEFAULT_TEST_FLAGS.hasOwnProperty(a)&&(this._testFlags[a]=e[a].newValue),"uniqueId"===a&&(this._uniqueId=e[a].newValue)):this._managedSettings&&R.DEFAULT_MANAGED_SETTINGS.hasOwnProperty(a)&&(this._managedSettings[a]=e[a].newValue);if(s){for(const e of this._settings.ignoredRules)e.turnOffDate&&(e.turnOffDate=new Date(e.turnOffDate));this._eventBus.fire(R.eventNames.settingsChanged,e)}n&&this._storage.get().then((e=>{if(!this._settings)return;const t=this._joinChunks(e,"dictionary"),n={dictionary:{oldValue:this._settings.dictionary,newValue:t}};this._settings.dictionary=t,this._eventBus.fire(R.eventNames.settingsChanged,n)})),i&&this._eventBus.fire(R.eventNames.configurationChanged,e),o&&this._eventBus.fire(R.eventNames.privacySettingsChanged,e),r&&this._eventBus.fire(R.eventNames.uiStateChanged,e)},this._storage=y._getStorage(),this._managedStorage=y._getManagedStorage(),this._isInitialized=!1,this._loadData(),browser.storage.onChanged.addListener(this._onStoredDataChanged)}static _getStringSize(e){let t=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t+=s<128?1:s<2048?2:s<65536?3:s<1<<21?4:s<1<<26?5:s<1<<31?6:Number.NaN}return t}static _getStorage(){return browser.storage.sync&&!e.isFirefox()?browser.storage.sync:browser.storage.local}static _getManagedStorage(){return browser.storage.managed}_splitInChunks(e,t,n=this._storage.QUOTA_BYTES_PER_ITEM){let s=e[t],i=0,o=[],r=y._getStringSize(t)+y._getStringSize("[]");for(;s.length;){const a=s.shift(),l=y._getStringSize(`,"${a}"`);if(r+l>n){e[0===i?t:`${t}_${i}`]=o,i++,o=[a],r=y._getStringSize(`${t}_${n}`)+y._getStringSize(`["${a}"]`)}else o.push(a),r+=l;if(0===s.length){e[0===i?t:`${t}_${i}`]=o}}e[`${t}_${i+1}`]=[]}_joinChunks(e,t,n=this._storage.MAX_ITEMS){let s=e[t]||[];for(let i=1;i<n;i++){const n=e[`${t}_${i}`];if(void 0===n||0===n.length)break;s=s.concat(n)}return s}_loadData(){const e=this._storage.get().then((e=>{const t=R._combineObjects(R.DEFAULT_SETTINGS,e);t.dictionary=this._joinChunks(e,"dictionary");for(const e of t.ignoredRules){if(void 0===e.description){const t=R.DEFAULT_SETTINGS.ignoredRules.find((t=>t.id===e.id&&t.language===e.language));e.description=t?t.description:""}if(void 0===e.turnOffDate){const t=R.DEFAULT_SETTINGS.ignoredRules.some((t=>t.id===e.id&&t.language===e.language));e.turnOffDate=t?null:new Date(2019,9,1)}else null!==e.turnOffDate&&(e.turnOffDate=new Date(e.turnOffDate))}t.disabledDomains=t.disabledDomains.map((e=>A(e,""))).filter((e=>e)),t.ignoreCheckOnDomains=t.ignoreCheckOnDomains.map((e=>A(e,""))).filter((e=>e)),t.autoCheckOnDomains=t.autoCheckOnDomains.map((e=>A(e,""))).filter((e=>e)),this._settings=t,this._configuration=R._combineObjects(R.DEFAULT_CONFIGURATION,e),this._privacySettings=R._combineObjects(R.DEFAULT_PRIVACY_SETTINGS,e),this._statistics=R._combineObjects(R.DEFAULT_STATISTICS,e),this._uiState=R._combineObjects(R.DEFAULT_UI_STATE,e),this._testFlags=R._combineObjects(R.DEFAULT_TEST_FLAGS,e),e.uniqueId?this._uniqueId=e.uniqueId:(this._uniqueId=R._generateUniqueId(),this._storage.set({uniqueId:this._uniqueId})),this._statistics.firstVisit||this.updateStatistics({firstVisit:Math.round(Date.now()/1e3)})})),t=this._managedStorage.get().then((e=>{this._managedSettings=R._combineObjects(R.DEFAULT_MANAGED_SETTINGS,e)})).catch((()=>{this._managedSettings=R._combineObjects(R.DEFAULT_MANAGED_SETTINGS,{})}));Promise.all([e,t]).then((()=>{this._isInitialized=!0,this._onReadyCallbacks.forEach((e=>e(this))),this._onReadyCallbacks=[]}))}isReady(){return this._isInitialized}onReady(e){this._isInitialized?e(this):this._onReadyCallbacks.push(e)}getUniqueId(){return this._uniqueId}getSettings(){return C(this._settings)}updateSettings(t){for(const e in t)if(!R.DEFAULT_SETTINGS.hasOwnProperty(e))throw new Error(`Unknown setting ${e}`);if(Object.assign(this._settings||{},C(t)),void 0===t.dictionary||e.isFirefox()||this._splitInChunks(t,"dictionary"),void 0!==t.ignoredRules)for(const e of t.ignoredRules)null!==e.turnOffDate&&(e.turnOffDate=e.turnOffDate.toISOString());return this._storage.set(t)}getCheckSettings(e,t){if(!this._settings)return{isDomainDisabled:!1,isEditorGroupDisabled:!1,isAutoCheckEnabled:!0,shouldCapitalizationBeChecked:!0};if(e===browser.runtime.id)return{isDomainDisabled:!1,isEditorGroupDisabled:!1,isAutoCheckEnabled:!0,shouldCapitalizationBeChecked:!0};const n=(this._settings.disabledEditorGroups||[]).some((n=>R._normalizeDomain(n.domain)===R._normalizeDomain(e)&&n.editorGroupId===t)),s=R._isListContainsDomain(this._settings.disabledDomains,e),i=!R._isListContainsDomain(this._settings.disabledDomainsCapitalization,e);if(this._settings.autoCheck){return{isDomainDisabled:s,isEditorGroupDisabled:n,isAutoCheckEnabled:!R._isListContainsDomain(this._settings.ignoreCheckOnDomains,e),shouldCapitalizationBeChecked:i}}return{isDomainDisabled:s,isEditorGroupDisabled:n,isAutoCheckEnabled:R._isListContainsDomain(this._settings.autoCheckOnDomains,e),shouldCapitalizationBeChecked:i}}hasLanguageToolAccount(){return Boolean(this._settings&&this._settings.username&&!this.hasCustomServer())}hasCustomServer(){return this._managedSettings&&this._managedSettings.apiServerUrl?this._managedSettings.apiServerUrl!==R.DEFAULT_SETTINGS.apiServerUrl:Boolean(this._settings&&this._settings.apiServerUrl&&this._settings.apiServerUrl.trim()&&this._settings.apiServerUrl!==i.MAIN_SERVER_URL&&this._settings.apiServerUrl!==i.PREMIUM_SERVER_URL)}getCustomServerUrl(){return this.hasCustomServer()?this._managedSettings.apiServerUrl||this._settings.apiServerUrl:null}getManagedSettings(){return S(this._managedSettings)}getConfiguration(){return S(this._configuration)}updateConfiguration(e){for(const t in e)if(!R.DEFAULT_CONFIGURATION.hasOwnProperty(t))throw new Error(`Unknown configuration ${t}`);return Object.assign(this._configuration||{},S(e)),this._storage.set(e)}isDomainSupported(e){return!this._configuration||!this._configuration.unsupportedDomains.includes("*")&&!R._isListContainsDomain(this._configuration.unsupportedDomains,e)}getPrivacySettings(){return S(this._privacySettings)}updatePrivacySettings(e){for(const t in e)if(!R.DEFAULT_PRIVACY_SETTINGS.hasOwnProperty(t))throw new Error(`Unknown privacy setting ${t}`);return Object.assign(this._privacySettings||{},e),this._storage.set(e)}getStatistics(){return C(this._statistics)}updateStatistics(e){for(const t in e)if(!R.DEFAULT_STATISTICS.hasOwnProperty(t))throw new Error(`Unknown privacy setting ${t}`);return Object.assign(this._statistics||{},e),this._storage.set(e)}getUIState(){return C(this._uiState)}updateUIState(e){for(const t in e)if(!R.DEFAULT_UI_STATE.hasOwnProperty(t))throw new Error(`Unknown UI state ${t}`);return Object.assign(this._uiState||{},e),this._storage.set(e)}checkForPaidSubscription(){return new Promise(((e,t)=>{this.onReady((()=>{const{username:n,password:s,token:i}=this.getSettings();let o=null;if("function"==typeof window.LTAssistantChecker){const e=this.hasCustomServer()?this.getCustomServerUrl():void 0;o=window.LTAssistantChecker.checkForPaidSubscription(n,s,i,e)}else{const e={command:"CHECK_FOR_PAID_SUBSCRIPTION",username:n,password:s,token:i};o=browser.runtime.sendMessage(e).then((e=>{if("CHECK_FOR_PAID_SUBSCRIPTION"===(t=e).initialCommand&&t.isSuccessful)return e.hasPaidSubscription;if(function(e){return"CHECK_FOR_PAID_SUBSCRIPTION"===e.initialCommand&&!e.isSuccessful}(e))throw e.error;var t;return!1}))}o.then((t=>{t?this.enablePaidSubscription():this.disablePaidSubscription(),e(t)})).catch(t)}))}))}enablePaidSubscription(){return!this._uiState||this._uiState.hasPaidSubscription?Promise.resolve():this.updateUIState({hasPaidSubscription:!0})}disablePaidSubscription(){return this._uiState&&this._uiState.hasPaidSubscription?this.updateUIState({hasPaidSubscription:!1}):Promise.resolve()}getTestFlags(){return S(this._testFlags)}updateTestFlags(e){for(const t in e)if(!R.DEFAULT_TEST_FLAGS.hasOwnProperty(t))throw new Error(`Unknown test flag ${t}`);return Object.assign(this._testFlags||{},e),this._storage.set(e)}getActiveCoupon(){const{changelogNov2021CountdownEnd:e,changelogNov2021Coupon:t,hasPaidSubscription:n}=this.getUIState();if(n)return null;if(e&&t&&Date.now()<e){const n=20,{geoIpCountry:s}=this.getSettings(),i=this._getDefaultCoupon(s);return i&&i.percent>n?Object.assign(Object.assign({},i),{expires:e}):{code:t,expires:e,percent:n}}return null}_getDefaultCoupon(e){for(const t in i.COUNTRY_COUPON_MAPPING)if(i.COUNTRY_COUPON_MAPPING.hasOwnProperty(t)&&i.COUNTRY_COUPON_MAPPING[t].countries.includes(e))return{code:t,percent:i.COUNTRY_COUPON_MAPPING[t].percent};return null}isRelevantForChangelogCoupon(){if(this.hasCustomServer())return{status:!1,reason:1};const{hasPaidSubscription:e}=this.getUIState();if(e)return{status:!1,reason:2};let{firstVisit:t,appliedSuggestions:n}=this.getStatistics();if(!t)return{status:!1,reason:3};t*=1e3;return Date.now()-t<6048e5?{status:!1,reason:4}:n<8?{status:!1,reason:5}:{status:!0}}startChangelogCoupon(){if(!this.canStartChangelogCoupon())return;const e=Date.now();var t,n;this.updateUIState({changelogNov2021Coupon:"2021-NOV-CHANGELOG",changelogNov2021CountdownEnd:e+1656e5+(t=0,n=72e5,t=Math.ceil(t),n=Math.floor(n),Math.floor(Math.random()*(n-t+1))+t)})}isChangelogCouponRunning(){if(!this.isRelevantForChangelogCoupon().status)return!1;const{changelogNov2021CountdownEnd:e}=this.getUIState();return Boolean(e&&e>Date.now())}canStartChangelogCoupon(){if(!this.isRelevantForChangelogCoupon().status)return!1;const e=Date.now(),{changelogNov2021CountdownEnd:t}=this.getUIState();return!t||e-t>i.COUPON_INTERVAL}destroy(){this._isInitialized=!1,super.destroy();try{browser.storage.onChanged.removeListener(this._onStoredDataChanged)}catch(e){}}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class w{static init(){if(w._isInitialized)return;this.TRACKING_SITE_ID=t.getTrackingId(),this.VERSION=t.getVersion(),this._storageController=M.create();const e=t.getURL("/");window.addEventListener("error",(t=>{const n=t.message,s=t.filename,i=t.lineno,o=t.error;if(!s||!s.startsWith(e))return;if("string"!=typeof n)return;if(n.includes("ResizeObserver"))return;const r=o&&function(e){if(!e.stack)return;let t=[];if(e.stack.split(/\n/).forEach((e=>{const n=e.match(/([\w_<>]+)\s+\(.+?([\w_\-]+\.(js|html))/);n&&t.push(`${n[2]}:${n[1]}`)})),!t.length){const n=e.stack.match(/([\w_\-]+\.(js|html))/);n&&t.push(n[1])}return t.join(",").substr(0,140)}(o);r?w.trackError("js",n,r):w.trackError("js",n,`${s}:${i}`)})),w._isInitialized=!0}static getCustomDimensions(){const e=w._storageController.getSettings(),t=w._storageController.getUIState();return{dimension2:this.VERSION,dimension3:t.hasPaidSubscription,dimension4:e.username&&(e.password||e.token),dimension5:e.preferredLanguages.join(","),dimension6:e.hasPickyModeEnabledGlobally}}static _getTrackingUrlForPageView(e){return e=(e=e.replace(/^(chrome|moz|safari|edge)-extension:\/\/.+?\//i,"")).replace(/^[a-z0-9]{8}\//i,"/"),e=`${w.TRACKING_BASE_PAGE_URL}${e}`,new Promise(((t,n)=>{w._storageController.onReady((()=>{const{firstVisit:n,sessionCount:s}=w._storageController.getStatistics(),i=w._storageController.getUniqueId(),o=Object.assign({idsite:w.TRACKING_SITE_ID,rec:"1",url:e,rand:Date.now(),apiv:"1",res:`${screen.width}x${screen.height}`,_id:i,_idts:n,_idvc:s},this.getCustomDimensions());let r="";for(const e in o)o.hasOwnProperty(e)&&(r+=`${e}=${encodeURIComponent(o[e])}&`);t(`${w.TRACKING_BASE_URL}?${r}`)}))}))}static _getTrackingUrlForEvent(e,t,n="",s){return s=s||w.TRACKING_BASE_PAGE_URL,new Promise(((i,o)=>{w._storageController.onReady((()=>{const{firstVisit:o,sessionCount:r}=w._storageController.getStatistics(),a=w._storageController.getUniqueId(),l=Object.assign({idsite:w.TRACKING_SITE_ID,rec:"1",url:s,action_name:t,rand:Date.now(),apiv:"1",res:`${screen.width}x${screen.height}`,_id:a,_idts:o,_idvc:r,e_c:e,e_a:t,e_n:n},this.getCustomDimensions());let c="";for(const e in l)l.hasOwnProperty(e)&&(c+=`${e}=${encodeURIComponent(l[e])}&`);i(`${w.TRACKING_BASE_URL}?${c}`)}))}))}static _sendRequest(e){if(t.shouldTrack()&&!w._storageController.hasCustomServer()&&!navigator.webdriver){const t=new Image;t.referrerPolicy="no-referrer",t.src=e}}static trackPageView(e){e=e||b(),w._getTrackingUrlForPageView(e).then((n=>{t.isProductionEnvironment()?w._sendRequest(n):console.log("LT Page view tracking disabled in dev mode",{pageUrl:e,trackingUrl:n})})).catch((e=>{console.log("LT could not track because:",e&&e.message)}))}static trackDisabledRule(e,n,s,o){if(!e.match(/^de|en|nl|es|fr|ca|pt/i))return;const r=o?i.PACKAGE.PREMIUM:i.PACKAGE.BASIC,a=e+":"+n,l=s;let c=w.TRACKING_BASE_URL;c+=`?idsite=18&rec=1&url=${encodeURIComponent(w.TRACKING_BASE_PAGE_URL)}`,c+=`&action_name=${r}&rand=${Date.now()}&apiv=1&_id=${this._storageController.getUniqueId()}`,c+=`&e_c=${r}&e_a=${encodeURIComponent(a)}&e_n=${encodeURIComponent(s)}`,t.isProductionEnvironment()?this._sendRequest(c):console.log("LT Event tracking disabled in dev mode",{actionCategory:r,action:a,actionName:l,trackingUrl:c})}static trackDictionaryEvent(e,n,s=!1){if(!e.match(/^de|en|nl|es|fr|it|pt|ru|ca|pl/i))return;const i=s?"TemporaryIgnored":"PersistentlyIgnored",o=`${e}:add_word`,r=n;let a=w.TRACKING_BASE_URL;a+=`?idsite=19&rec=1&url=${encodeURIComponent(w.TRACKING_BASE_PAGE_URL)}`,a+=`&action_name=${i}&rand=${Date.now()}&apiv=1&_id=${this._storageController.getUniqueId()}`,a+=`&e_c=${i}&e_a=${encodeURIComponent(o)}&e_n=${encodeURIComponent(n)}`,t.isProductionEnvironment()?this._sendRequest(a):console.log("LT Event tracking disabled in dev mode",{actionCategory:i,action:o,actionName:r,trackingUrl:a})}static trackEvent(e,n,s,i){this._getTrackingUrlForEvent(e,n,s,i).then((i=>{t.isProductionEnvironment()?this._sendRequest(i):console.log("LT Event tracking disabled in dev mode",{actionCategory:e,action:n,actionName:s,trackingUrl:i})})).catch((e=>{console.log("LT could not track because:",e&&e.message)}))}static trackInstall(){w.trackEvent("Action","install",x.getPrimaryLanguageCode(navigator.language)),this._storageController.updateUIState({isNewUser:!0})}static trackActivity(){const e=Date.now(),{sessionCount:t,firstVisit:n,lastActivity:s}=this._storageController.getStatistics(),{isNewUser:i}=this._storageController.getUIState();if((!s||e-s>w.ACTIVITY_TRACK_INTERVAL)&&(this._storageController.updateStatistics({sessionCount:t+1,lastActivity:e}),this.trackEvent("Action","ping",x.getPrimaryLanguageCode(navigator.language))),i&&n){const t=6048e5,s=8*t,i=e-1e3*n;i>t&&i<s&&this._storageController.updateUIState({isNewUser:!1}).then((()=>{this.trackEvent("Action","active_after_one_week",x.getPrimaryLanguageCode(navigator.language))})).catch((e=>{const t=String(e&&e.message?e.message:e);this.trackEvent("JS-Error",`activity error: ${t}`)}))}}static trackError(t,n,s=""){try{if(e.isUnsupportedBrowser())return;if(w._errorCount++,w._errorCount>i.MAX_EXCEPTION_COUNT)return;if("string"!=typeof n)return;if(w._loggedErrors)if(w._loggedErrors.length<w.THROTTLE_REQUESTS)w._loggedErrors.push(Date.now());else{const e=Date.now();if(!(e-w._loggedErrors[0]>=w.MAX_TIME))return;w._loggedErrors.push(e),w._loggedErrors.splice(0,1)}else w._loggedErrors=[Date.now()];let o="JS-Error";"message"===t?o="Message-Error":"http"===t?o="HTTP-Error":"other"===t&&(o="Other-Error");let r=b();r=r.replace(/^moz-extension:\/\/[a-z0-9\-]+\//,"moz-extension://xxxx-xxxx-xxxx-xxxx/"),r.match(/(chrome|moz|safari)\-extension:/)||(r=void 0),this.trackEvent(o,n,s||r,r)}catch(e){console.error("Error while logging error from language tool",e)}}static trackStat(e,t){0===Math.floor(10*Math.random())&&w.trackEvent("Stat",e,t)}static trackTextLength(e){if(0===e)return;let t="";t=e<=100?"1-100":e<=1e3?"101-1000":e<=2500?"1001-2500":e<=5e3?"2501-5000":e<=7500?"5001-7500":e<=1e4?"7501-10000":e<=15e3?"10001-15000":e<=2e4?"15001-20000":e<=4e4?"20001-40000":e<=6e4?"40001-60000":e<=8e4?"60001-80000":e<=1e5?"80001-100000":">100000",this.trackStat("text_length",t)}}w.TRACKING_BASE_URL="https://analytics.languagetoolplus.com/matomo/piwik.php",w.TRACKING_BASE_PAGE_URL="https://fake/",w.ACTIVITY_TRACK_INTERVAL=864e5,w.MAX_TIME=6e4,w.THROTTLE_REQUESTS=10,w._isInitialized=!1,w._loggedErrors=null,w._errorCount=0;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class k{constructor(e=document){this._window=e.defaultView,this._document=e,this.clearCache()}_getElementCache(e){let t=this._elementCache.get(e);return t||(t={},this._elementCache.set(e,t)),t}clearCache(){this._documentVisibleBox=null,this._documentGap=null,this._documentScroll=null,this._elementCache=new WeakMap}_contains(e,t){return e&&e!==t&&e.contains(t)}_getComputedStyle(e,t,n){let s,i;return"object"==typeof t?(s=t,i=""):(s=n,i=t),s.computedStyle||(s.computedStyle=new Map),s.computedStyle.has(i)||s.computedStyle.set(i,this._window.getComputedStyle(e,i||null)),s.computedStyle.get(i)}getComputedStyle(e,t=""){return this._getComputedStyle(e,t,this._getElementCache(e))}_getComputedStyleMap(e,t){return e.computedStyleMap?(t.computedStyleMap||(t.computedStyleMap=e.computedStyleMap()),t.computedStyleMap):null}getComputedStyleMap(e){return this._getComputedStyleMap(e,this._getElementCache(e))}getInlineStyle(e,t){return e.style.getPropertyValue(t)}getStyle(e,t,n=""){return this.getStyles(e,[t],n)[t]}getStyles(e,t,n=""){let s=null,i={};const o=this._getElementCache(e);for(const r of t)if(s=s||this._getComputedStyle(e,n,o),"line-height"===r||"lineHeight"===r)i[r]=this.getInlineStyle(e,r)||s[r]||"";else if("font"!==r||s[r])i[r]="zoom"===r?s[r]||"1":s[r]||"";else{const t=s["font-style"],n=s["font-variant"],o=s["font-weight"],a=s["font-size"],l=this.getInlineStyle(e,"line-height")||s["line-height"]||"",c=s["font-family"];i[r]=`${t} ${n} ${o} ${a} ${l?"/ "+l:""} ${c}`}return i}getExactStyle(e,t){return this.getExactStyles(e,[t])[t]}getExactStyles(e,t){const n=this._getElementCache(e),s=this._getComputedStyleMap(e,n);if(s){const e={};for(const n of t){const t=s.get(n);t?"number"==typeof(i=t).value&&"string"==typeof i.unit?"number"===t.unit?e[n]=t.value.toString():e[n]=t.value+t.unit:e[n]=t.toString():e[n]=""}return e}return this.getStyles(e,t);var i}setStyles(e,t,n=!1){Array.isArray(e)||(e=[e]);for(const s of e)for(const e in t){let i=t[e].trim();const o=n||k.IMPORTANT_REG_EXP.test(i);i=i.replace(k.IMPORTANT_REG_EXP,""),s.style.setProperty(e,i,o?"important":"")}}copyStyles(e,t,n,s=!1){const i=this.getStyles(e,n);this.setStyles(t,i,s)}resetStyles(e,t,n=!1){Array.isArray(e)||(e=[e]);let s="";for(const e in t){let i=t[e].trim();n&&!k.IMPORTANT_REG_EXP.test(i)&&(i+=" !important"),s+=`${e}: ${i};`}for(const t of e)t.style.cssText=s}removeStyle(e,t){Array.isArray(e)||(e=[e]),this.removeStyles(e,[t])}removeStyles(e,t){Array.isArray(e)||(e=[e]);for(const n of e)for(const e of t)n.style.removeProperty(e)}_getBoundingClientRect(e,t){return t.boundingClientRect||(t.boundingClientRect=C(e.getBoundingClientRect())),t.boundingClientRect}_getBorderBox(e,t,n,s){const i="borderBox"+(t?"WithScroll":"")+(n?"WithScale":"");if(!s[i]){const o=this._getBoundingClientRect(e,s);let{top:r,left:a,width:l,height:c}=o;if(n){const t=this.getZoom(e);r*=t,a*=t,l*=t,c*=t}else{const t=this._getScaleFactor(e,s);l/=t.x,c/=t.y}if(t){const t=this.getDocumentScroll();if(r+=t.top,a+=t.left,this._document.body&&this._contains(this._document.body,e)){const e=this.getDocumentGap();r-=e.top,a-=e.left}}s[i]={top:r,right:a+l,bottom:r+c,left:a,width:l,height:c}}return s[i]}getBorderBox(e,t=!0,n=!0){return this._getBorderBox(e,t,n,this._getElementCache(e))}_getPaddingBox(e,t,n,s){const i="paddingBox"+(t?"WithScroll":"")+(n?"WithScale":"");if(!s[i]){let{top:o,left:r,width:a,height:l}=this._getBorderBox(e,t,n,s),c={x:1,y:1};n&&(c=this._getScaleFactor(e,s));const d=n?this._getZoom(e,s):1,h=this._getComputedStyle(e,s),_=(parseFloat(h["border-top-width"])||0)*c.y*d,u=(parseFloat(h["border-right-width"])||0)*c.x*d,g=(parseFloat(h["border-bottom-width"])||0)*c.y*d,m=(parseFloat(h["border-left-width"])||0)*c.x*d;let p=0,E=0;if("BackCompat"!==this._document.compatMode||e!==this._document.body||e!==this._document.scrollingElement){const t=e.clientWidth*c.x*d,n=e.clientHeight*c.y*d;p=a-m-t-u,E=l-_-n-g,p<1&&(p=0),E<1&&(E=0)}o+=_,r+=m,a=a-m-p-u,l=l-_-E-g,this._isRTL(e,s)&&(r+=p),s[i]={top:o,right:r+a,bottom:o+l,left:r,width:a,height:l,border:{top:_,right:u,bottom:g,left:m}}}return s[i]}getPaddingBox(e,t=!0,n=!0){return this._getPaddingBox(e,t,n,this._getElementCache(e))}_getContentBox(e,t,n,s){const i="contentBox"+(t?"WithScroll":"")+(n?"WithScale":"");if(!s[i]){let{top:o,left:r,width:a,height:l,border:c}=this._getPaddingBox(e,t,n,s),d={x:1,y:1};n&&(d=this._getScaleFactor(e,s));const h=n?this._getZoom(e,s):1,_=this._getComputedStyle(e,s),u=(parseFloat(_["padding-top"])||0)*d.y*h,g=(parseFloat(_["padding-right"])||0)*d.x*h,m=(parseFloat(_["padding-bottom"])||0)*d.y*h,p=(parseFloat(_["padding-left"])||0)*d.x*h;o+=u,r+=p,a=a-p-g,l=l-u-m,s[i]={top:o,right:r+a,bottom:o+l,left:r,width:a,height:l,border:c,padding:{top:u,right:g,bottom:m,left:p}}}return s[i]}getContentBox(e,t=!0,n=!0){return this._getContentBox(e,t,n,this._getElementCache(e))}_getScrollDimensions(e,t,n){const s="scrollDimensions"+(t?"WithScale":"");if(!n[s]){let i=e.scrollWidth,o=e.scrollHeight;if(t){const t=this._getScaleFactor(e,n),s=this._getZoom(e,n);i=i*t.x*s,o=o*t.y*s}n[s]={width:i,height:o}}return n[s]}getScrollDimensions(e,t=!0){return this._getScrollDimensions(e,t,this._getElementCache(e))}_getScrollPosition(e,t,n,s){const i="scrollPosition"+(t?"WithScale":"")+(n?"WithZoom":"");if(!s[i]){let o={x:1,y:1};t&&(o=this._getScaleFactor(e,s));const r=n?this._getZoom(e,s):1,a=e===this._document.body&&"BackCompat"===this._document.compatMode,l=a?0:e.scrollTop*o.y*r,c=a?0:e.scrollLeft*o.x*r;s[i]={top:l,left:c}}return s[i]}getScrollPosition(e,t=!0,n=t){return this._getScrollPosition(e,t,n,this._getElementCache(e))}getScaleFactor(e){return this._getScaleFactor(e,this._getElementCache(e))}_getScaleFactor(t,n){if(void 0===n.scaleFactor){if(t instanceof SVGElement){if(e.isFirefox()||e.isThunderbird())return{x:1,y:1};let n=1;const s=t.getAttribute("transform")||"",i=/scale\((\d+(\.\d+)?)\)/.exec(s);return i&&(n=+i[1]),{x:n,y:n}}{const e=this._getBoundingClientRect(t,n),s=t.offsetWidth,i=t.offsetHeight;n.scaleFactor={x:1,y:1},e.width>0&&s>0&&Math.abs(e.width-s)>1&&(n.scaleFactor.x=e.width/s),e.height>0&&i>0&&Math.abs(e.height-i)>1&&(n.scaleFactor.y=e.height/i)}}return n.scaleFactor}_getZoom(t,n){if(e.isFirefox()||e.isThunderbird())return 1;if("number"!=typeof n.zoom){let e=1,s=t;for(;s&&s!==this._document.documentElement;){e*=+this.getStyle(s,"zoom"),s=s.parentElement}n.zoom=e}return n.zoom}getZoom(e){return this._getZoom(e,this._getElementCache(e))}_getStackingContextWithZIndex(e){const t=this.getComputedStyle(e),n=parseInt(t.zIndex||"");if(isNaN(n))return null;if(t.position&&k.NON_STATIC_POSITIONS.indexOf(t.position)>-1)return{zIndex:n};if(e.parentElement){const t=this.getComputedStyle(e.parentElement);if("flex"===t.display||"grid"===t.display)return{zIndex:n}}return null}getZIndex(e,t=this._document.documentElement){let n="auto",s=e;if(!s.ownerDocument)return"auto";const i=s.ownerDocument.defaultView.Element,o=s.ownerDocument.defaultView.ShadowRoot;for(;s&&s!==this._document&&s!==t&&s instanceof i;){const e=this._getStackingContextWithZIndex(s);e&&(n=e.zIndex),s=s.parentNode instanceof o?s.parentNode.host:s.parentElement}return n}_isRTL(e,t){return"boolean"!=typeof t.isRTL&&(t.isRTL="rtl"===this.getStyle(e,"direction")),t.isRTL}isRTL(e){return this._isRTL(e,this._getElementCache(e))}isStackingContext(e){const t=this.getComputedStyle(e);return!!(t.position&&k.NON_STATIC_POSITIONS.indexOf(t.position)>-1)||("none"!==t.transform||"none"!==t.filter||"none"!==t.clipPath||"none"!==t.perspective||Number(t.opacity)<1)}_getTextClientRects(e){const t=this._document.createRange();return t.setStart(e.node,e.start),t.setEnd(e.node,e.end),Array.from(t.getClientRects())}getTextBoundingBoxes(e,t,n=!0){Array.isArray(e)||(e=[e]);let s=[],i=0,o=0;if(n){const e=this.getDocumentScroll();if(i+=e.top,o+=e.left,this._document.body&&this._contains(this._document.body,t)){const e=this.getDocumentGap();i-=e.top,o-=e.left}}for(const t of e)try{const e=this._getTextClientRects(t);for(const t of e){if(t.width<k.MIN_TEXT_BOX_WIDTH)continue;const e=s[s.length-1],n=t.top+i,r=t.right+o,a=t.bottom+i,l=t.left+o,c=t.width,d=t.height;e&&e.right===l&&e.top===n&&e.bottom===a&&e.height===d?(e.right=r,e.width=e.width+c):s.push({top:n,right:r,bottom:a,left:l,width:c,height:d})}}catch(e){}return s}getRelativeTextBoundingBoxes(e,t,n=this.getScrollPosition(t)){Array.isArray(e)||(e=[e]);let s=[];const i=this.getPaddingBox(t,!1,!1),o=i.left-n.left,r=i.top-n.top;for(const t of e)try{const e=this._getTextClientRects(t);for(const t of e){if(t.width<k.MIN_TEXT_BOX_WIDTH)continue;const e=s[s.length-1],n=t.top-r,i=t.right-o,a=t.bottom-r,l=t.left-o,c=t.width,d=t.height;e&&e.right===l&&e.top===n&&e.bottom===a&&e.height===d?(e.right=i,e.width=e.width+c):s.push({top:n,right:i,bottom:a,left:l,width:c,height:d})}}catch(e){console.error("LT range error",e)}const a=this.getScaleFactor(t);for(const e of s)e.top=Math.round(e.top/a.y),e.right=Math.round(e.right/a.x),e.bottom=Math.round(e.bottom/a.y),e.left=Math.round(e.left/a.x),e.width=e.right-e.left,e.height=e.bottom-e.top;return s}getRelativeTextBoundingBox(e,t){const n=this.getRelativeTextBoundingBoxes(e,t),s=Math.min(...n.map((e=>e.top))),i=Math.max(...n.map((e=>e.right))),o=Math.max(...n.map((e=>e.bottom))),r=Math.min(...n.map((e=>e.left)));return{top:s,right:i,bottom:o,left:r,width:i-r,height:o-s}}_hasRelativePosition(e,t){const n=this._getComputedStyle(e,t).position||"static";return k.NON_STATIC_POSITIONS.indexOf(n)>-1}getDocumentGap(){if(!this._documentGap&&(this._documentGap={top:0,left:0},this._document.body&&this._hasRelativePosition(this._document.body,this._getElementCache(this._document.body)))){const t=this.getBorderBox(this._document.documentElement),n=this.getBorderBox(this._document.body);let s=this._document.documentElement.offsetTop,i=this._document.documentElement.offsetLeft;if(e.isFirefox()||e.isThunderbird()){let e=null;0===s&&(e=this.getComputedStyle(this._document.documentElement),s=parseInt(e["margin-top"])||0),0===i&&(e=e||this.getComputedStyle(this._document.documentElement),i=parseInt(e["margin-left"])||0)}const o=n.top-t.top+s,r=n.left-t.left+i,a=this.getComputedStyle(this._document.body),l=parseFloat(a["border-top-width"])||0,c=parseFloat(a["border-left-width"])||0;this._documentGap={top:o+l,left:r+c}}return this._documentGap}getDocumentVisibleBox(){if(!this._documentVisibleBox){const t=this.getDocumentScroll();let n=this._document.documentElement.clientHeight,s=this._document.documentElement.clientWidth;e.isThunderbird()&&(n=window.innerHeight,s=window.innerWidth),this._documentVisibleBox={top:t.top,right:t.left+s,bottom:t.top+n,left:t.left,width:s,height:n}}return this._documentVisibleBox}getDocumentScroll(){if(!this._documentScroll){const e=this._document.documentElement&&this._document.documentElement.scrollTop||this._document.body&&this._document.body.scrollTop||0,t=this._document.documentElement&&this._document.documentElement.scrollLeft||this._document.body&&this._document.body.scrollLeft||0;this._documentScroll={top:e,left:t}}return this._documentScroll}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
function O(e=25,t=null){return new Promise((n=>setTimeout((()=>n(t)),e)))}function P(e,t){let n=null,s=!1;const i=()=>{n=function(e,t){let n=null,s=!1;const i=window.setTimeout((()=>{s||(n=window.requestAnimationFrame((()=>e())))}),t);return{destroy:()=>{s=!0,window.clearTimeout(i),n&&window.cancelAnimationFrame(n)}}}((()=>{s||(e(),i())}),t)};return i(),{destroy:()=>{s=!0,n&&(n.destroy(),n=null)}}}function D(e,t){"string"==typeof e&&(e=document.querySelector(e)),"string"==typeof t&&(t={key:t}),t.isHTML?e.innerHTML=s.getMessage(t.key,t.interpolations):t.attr?e[t.attr]=s.getMessage(t.key,t.interpolations):e.textContent=s.getMessage(t.key,t.interpolations)}function U(e,t,n=0){return"object"==typeof t&&(n=t.y,t=t.x),e.left<=t&&t<=e.right&&e.top<=n&&n<=e.bottom}function G(t,n){const s=t.createElement(n);return s.setAttribute("contenteditable","false"),navigator.userAgent.includes("Mac OS")&&s.classList.add("lt--mac-os"),e.isThunderbird()&&s.classList.add("lt--thunderbird"),s}function B(e,t){return"object"==typeof t?e!==t&&e.contains(t):e instanceof Element&&!!e.querySelector(t)}function H(e){const t=window.getComputedStyle(e);return"auto"===t.overflowY||"scroll"===t.overflowY}function F(e){return Boolean(e.ownerDocument&&"on"===e.ownerDocument.designMode&&"read-write"===e.ownerDocument.defaultView.getComputedStyle(e)["-moz-user-modify"])}k.IMPORTANT_REG_EXP=/!important$/,k.TRANSFORM_MATRIX_REG_EXP=/(?:matrix|scale)\(([\d\.]+),/,k.NON_STATIC_POSITIONS=["relative","fixed","absolute","sticky"],k.MIN_TEXT_BOX_WIDTH=.1;const W=(()=>{const e=(e,t,n,s)=>{const i=e.ownerDocument;let o=i.elementFromPoint(n,s);if(!o)return!1;if(e===o||e.contains(o))return!0;if(!t.length)return!1;const r=t.find((e=>e.contains(o)));return r&&(o=i.elementsFromPoint(n,s).find((e=>!r.contains(e)))||null),Boolean(o&&(e===o||e.contains(o)))};return(t,n,s,i)=>{const o=n.getPaddingBox(t,!1),r=t.ownerDocument.contains(t);if(o.bottom<0||o.top>s||!r)return{top:0,bottom:o.height};let a=[];i&&(a=Array.from(t.ownerDocument.querySelectorAll(i)));let l=o.left+Math.round(o.width/100*33);const c=Math.max(o.top,0);let d=c;for(;;){if(e(t,a,l,d)){if(d===c)break;for(;d--;)if(!e(t,a,l,d)){d++;break}break}if(d===o.bottom)break;d=Math.min(o.bottom,d+6)}const h=Math.min(o.bottom,s);let _=h;for(;;){if(e(t,a,l,_-1)){if(_===h)break;for(;_++<h;)if(!e(t,a,l,_-1)){_--;break}break}if(_===d)break;_=Math.max(d,_-6)}return{top:Math.round(Math.max(0,d-o.top)),bottom:Math.round(Math.max(0,_-o.top))}}})();function K(e,t,n={}){const s=new CustomEvent(t,{detail:n,cancelable:!0});return e.dispatchEvent(s)}function V(e,t,n){const s=e.nodeType===Node.DOCUMENT_NODE?e:e.ownerDocument;const i=t=>{const s=function(e){if("function"==typeof e.composedPath){const t=e.composedPath();if(t[0])return t[0]}return e.target}(t);(ee(s)||te(s))&&e.contains(s)&&n(t)};return s.defaultView.addEventListener(t,i,!0),{destroy(){s.defaultView.removeEventListener(t,i,!0)}}}const $=(()=>{let e;const t=[];return(n,s)=>{t.push({element:n,callback:s}),e=e||window.setInterval((()=>{const n=[];t.forEach((e=>{(e.element.readOnly||e.element.disabled||!function(e){return(e.offsetWidth>0||e.offsetHeight>0)&&"hidden"!==new k(document).getStyle(e,"visibility")}(e.element))&&(n.push(e),e.callback(e.element))})),n.forEach((e=>{t.splice(t.indexOf(e),1)})),t.length||(clearInterval(e),e=null)}),600)}})(),z=(()=>{let e;const t=[];return(n,s)=>{t.push({element:n,callback:s}),e||(e=new MutationObserver((n=>{if(!n.some((e=>e.removedNodes.length>0)))return;const s=[];for(const e of t)j(e.element)||(e.callback(e.element),s.push(e));s.forEach((e=>{t.splice(t.indexOf(e),1)})),t.length||(e.disconnect(),e=null)})),e.observe(document.documentElement,{childList:!0,subtree:!0}))}})();function X(){const e=Y(),t=e?e.tagName.toLowerCase():null;return"textarea"===t||"input"===t&&/^(?:text|search|password|tel|url)$/i.test(e.type)&&"number"==typeof e.selectionStart?e.value.slice(e.selectionStart,e.selectionEnd):window.getSelection&&window.getSelection()?window.getSelection().toString():""}function Y(){let e=document.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function j(e){if(e.ownerDocument&&e.ownerDocument.contains(e))return!0;for(var t=e;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof DocumentFragment?t.parentNode.host:t.parentNode}return!1}function q(e){let t=e.isCollapsed;return e.anchorNode===e.focusNode&&e.anchorOffset!==e.focusOffset&&(t=!1),e.toString().length>0&&(t=!1),t}function Z(e){return Q(e)||J(e)}function Q(e){return e instanceof HTMLTextAreaElement}function J(e){return e instanceof HTMLInputElement&&("text"===e.type||"search"===e.type)}function ee(e){return e.nodeType===Node.ELEMENT_NODE}function te(e){return e.nodeType===Node.TEXT_NODE}function ne(e,t,n,s=Date.now().toString()){const i=void 0!==window.screenLeft?window.screenLeft:window.screenX,o=void 0!==window.screenTop?window.screenTop:window.screenY,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,l=r/window.screen.availWidth,c=(r-t)/2/l+i,d=(a-n)/2/l+o;return window.open(e,s,`\n      scrollbars=yes,\n\t  resizable=yes,\n      width=${t/l},\n      height=${n/l},\n      top=${d},\n      left=${c}\n      `)}(function(){let e,t=null;const n=t=>{t.origin.match(/^chrome|moz|safari/)&&e(t.data)}})(),function(){let e,t=null;const n=t=>{e(t.data)}}();let se,ie;function oe(e){const t=300;let n=0;const s=Date.now();let i=0;for(const o of e.hiddenErrors){const e=+new Date(o.day);if(s-e>864e6)break;if(i=e,n+=o.count,n>t){n=t;break}}let o=String(n);n>=t&&(o="300+");return{hiddenErrorsCount:n,hiddenErrorsCountStr:o,dayCount:Math.ceil((s-i)/1e3/60/60/24)}}!function(){const e=/ /g,t=/^#(?:[0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{8})$/i,n=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,s=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,i=/^rgba?\(/i,o=/^rgba?\((\d+),(\d+),(\d+)(?:,(\d*(?:\.\d+)?))?\)/i,r=/^hsla?\(/i,a=/^hsla?\(\d+,\d+%,(\d+)%(?:,(\d*(?:\.\d+)?))?\)/i;function l(e,t,n){const s=Math.max(e,t,n)/255,i=Math.min(e,t,n)/255;return Math.round((s+i)/2*100)}se=function(l){if("string"!=typeof l)return 3===l.length?1:l[3];if(l=l.replace(e,""),t.test(l)){const e=n.exec(l)||s.exec(l);if(e&&e[4])return parseInt(2===e[4].length?e[4]:e[4]+e[4],16)/255}else if(i.test(l)){const e=o.exec(l);if(e&&e[4])return+e[4]}else if(r.test(l)){const e=a.exec(l);if(e&&e[2])return+e[2]}return 1},ie=function(c){if("string"!=typeof c)return l(c[0],c[1],c[2]);if(c=c.replace(e,""),t.test(c)){const e=n.exec(c)||s.exec(c);if(e){return l(parseInt(2===e[1].length?e[1]:e[1]+e[1],16),parseInt(2===e[2].length?e[2]:e[2]+e[2],16),parseInt(2===e[3].length?e[3]:e[3]+e[3],16))}}else if(i.test(c)){const e=o.exec(c);if(e){return l(+e[1],+e[2],+e[3])}}else if(r.test(c)){const e=a.exec(c);if(e)return+e[1]}return 100}}();Array.from({length:16},((e,t)=>t.toString(16)));function re(e){return Boolean(e.closest(".DraftEditor-editorContainer"))||/(facebook|messenger)\.com/.test(location.host)&&(e.hasAttribute("aria-describedBy")||["textfield","textbox"].includes(e.getAttribute("role")||""))&&e.hasAttribute("contenteditable")||!!e.querySelector("div[data-contents=true]")&&e.classList.contains("notranslate")}function ae(e){return e.classList.contains("mce-content-body")||e.classList.contains("mceContentBody")}function le(e){return e.hasAttribute("data-slate-editor")}function ce(e){return!!e.closest("[data-app-name='io.ox/office/text']")}function de(e){return"trix-editor"===e.nodeName.toLowerCase()}function he(e){return e.classList.contains("CodeMirror-code")}function _e(e){return window!==window.parent&&e.ownerDocument&&e===e.ownerDocument.body&&e.ownerDocument.documentElement.isContentEditable&&e.classList.contains("cke_show_borders")}function ue(e,t){for(const n of i.ERRORS_THAT_CAN_BE_CORRECTED_ALL_AT_ONCE){if(n.ruleId!==e.rule.id)continue;if(e.originalPhrase.length!==t.length)continue;const s=n.suggestions.find((e=>e.match.test(t)));if(s)return{suggestion:s,ruleId:e.rule.id}}}function ge(e,t){return e.some((e=>e.rule.id===t.rule.id&&e.start!==t.start))}function me(e){let t=E(e);return["<lt-strong>","</lt-strong>","<lt-em>","</lt-em>"].forEach((e=>{t=t.split(E(e)).join(e)})),t}function pe(e,t){return t.length<5?`<lt-strong>${t}</lt-strong>`:Ee(e,t)||`<lt-strong>${t}</lt-strong>`}function Ee(e,t){if(t.length>2&&t.startsWith(e))return`${e}<lt-strong>${t.substring(e.length)}</lt-strong>`;if(t.length>2&&t.endsWith(e))return`<lt-strong>${t.substring(0,t.lastIndexOf(e))}</lt-strong>${e}`;if(g(e)===t)return`<lt-strong>${t.charAt(0)}</lt-strong>${t.substring(1)}`;if(e+","===t)return e+"<lt-strong>,</lt-strong>";if(", "+e===t)return"<lt-strong>, </lt-strong>"+e;if(t.length>2&&e.length>2)for(let n=0;n<t.length;n++)if(t[n]!==e[n]){if(t.substring(n+1)&&t.substring(n+1)===e.substring(n+1))return`${t.substring(0,n)}<lt-strong>${t[n]}</lt-strong>${t.substring(n+1)}`;if(t[n+1]&&t[n+1]!==e[n+1]&&t.substring(n+2)&&t.substring(n+2)===e.substring(n+2)&&t.length>3)return`${t.substring(0,n)}<lt-strong>${t[n]}${t[n+1]}</lt-strong>${t.substring(n+2)}`;if(t.substring(n+1)&&t.substring(n+1)===e.substring(n))return`${t.substring(0,n)}<lt-strong>${t[n]}</lt-strong>${t.substring(n+1)}`;break}if(e.length>=2&&t.length>2&&t.startsWith(e.substring(0,2))){let n=2;for(;n<=t.length&&t[n]===e[n];n++);if(n<t.length)return t.substring(n)===e.substring(n+1)&&t.substring(n).length>2?`${t.substring(0,n-1)}<lt-strong>${t.substring(n-1,n+1)}</lt-strong>${t.substring(n+1)}`:`${t.substring(0,n)}<lt-strong>${t.substring(n)}</lt-strong>`}return null}const fe=/[ \u00A0]+/;function Se(e,t){const n=e.split(fe),s=t.split(fe);if(n.join(" ")===s.join(" "))return`<lt-em>${t}</lt-em>`;if(1===n.length&&2===s.length&&s[0]===n[0])return`${s[0]} <lt-strong>${s[1]}</lt-strong>`;if(1===n.length&&2===s.length&&s[1]===n[0])return`<lt-strong>${s[0]}</lt-strong> ${s[1]}`;if(1===n.length&&2===s.length&&g(s[1])===n[0])return`<lt-strong>${s[0]}</lt-strong> <lt-strong>${s[1].substring(0,1)}</lt-strong>${s[1].substring(1)}`;if(s.length>2&&n.length+1===s.length&&n[0]===s[0]&&n[1]!==s[1]&&n.slice(1).join(" ")===s.slice(2).join(" "))return`${s[0]} ${pe(n[1],s[1])} ${s.slice(2).join(" ")}`;if(3===s.length&&2===n.length&&n[0]!==s[0]&&n[1]!==s[1]&&n[1]===s[2])return`<lt-strong>${s[0]} ${s[1]}</lt-strong> ${s[2]}`;if(s.length>2&&n.length+1===s.length&&n[0]!==s[0]&&n.slice(0).join(" ")===s.slice(1).join(" "))return`${pe(n[0],s[0])} ${s.slice(1).join(" ")}`;if(2===n.length&&s.length>2&&n[0]===s[0]&&n[1]===s[1])return`${s[0]} ${s[1]} <lt-strong>${s.slice(2).join(" ")}</lt-strong>`;if(n.length>=2&&s.length>=2&&n[0]===s[0]&&n[1]!==s[1]&&n.slice(2).join(" ")===s.slice(2).join(" "))return`${s[0]} ${pe(n[1],s[1])} ${s.slice(2).join(" ")}`.trim();if(2===n.length&&s.length>2&&n[0]===s[0]&&n[1]!==s[1])return`${s[0]} <lt-strong>${s.slice(1).join(" ")}</lt-strong>`;if(n.length===s.length&&s.length>1){let e=0;const t=s.map(((t,s)=>{if(t===n[s])return t;let i=Ee(n[s],t);return i||(e++,i=`<lt-strong>${t}</lt-strong>`),i})).join(" ");return e===s.length?`<lt-em>${s.join(" ")}</lt-em>`:t}return 1===n.length&&1===s.length?Ee(n[0],s[0])||`<lt-em>${s[0]}</lt-em>`:`<lt-em>${t}</lt-em>`}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Ce{static create(e,t=e){return e===t?new Ce.TreeWalkerWrapper(e):new Ce.CustomWalker(e,t)}}Ce.TreeWalkerWrapper=class extends Ce{constructor(e){super(),this._treeWalker=document.createTreeWalker(e),this._currentNode=e}get currentNode(){return this._currentNode}next(e=!1){if(e){for(;!this._treeWalker.nextSibling();)if(!this._treeWalker.parentNode())return null;this._currentNode=this._treeWalker.currentNode}else try{const e=this._treeWalker.nextNode();if(!e)return null;this._currentNode=e}catch(e){return null}return this._currentNode}},Ce.CustomWalker=class extends Ce{constructor(e,t){super(),this._rootNode=e,this._currentNode=t}get currentNode(){return this._currentNode}next(e=!1){if(!e&&this._currentNode.firstChild)this._currentNode=this._currentNode.firstChild;else{if(this._currentNode===this._rootNode)return null;if(this._currentNode.nextSibling)this._currentNode=this._currentNode.nextSibling;else{let e=this._currentNode;for(;!e.nextSibling;){if(!e.parentNode||e.parentNode===this._rootNode)return null;e=e.parentNode}this._currentNode=e.nextSibling}}return this._currentNode}};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Te{constructor(e,t,n){if(this._ceElement=e,this._parsingDetector=t,this._cacheInvalidationRules=n||{},this._enableCache=!!n,this._enableCache){this._nodePropertiesCache={isTextNode:{propertyName:"isTextNode",map:new WeakMap},isElementNode:{propertyName:"isElementNode",map:new WeakMap},computedStyle:{propertyName:"computedStyle",map:new WeakMap},isSkippingElement:{propertyName:"isSkippingElement",map:new WeakMap},replacementText:{propertyName:"replacementText",map:new WeakMap},isBr:{propertyName:"isBr",map:new WeakMap},isBlock:{propertyName:"isBlock",map:new WeakMap},parsingOptions:{propertyName:"parsingOptions",map:new WeakMap},parsedText:{propertyName:"parsedText",map:new WeakMap},blockParent:{propertyName:"blockParent",map:new WeakMap},paragraphLastValuableNode:{propertyName:"paragraphLastValuableNode",map:new WeakMap},isBRElementRelevant:{propertyName:"isBRElementRelevant",map:new WeakMap},isBlockElementRelevant:{propertyName:"isBlockElementRelevant",map:new WeakMap},isTextEndsWithLineBreak:{propertyName:"isTextEndsWithLineBreak",map:new WeakMap},isParagraphNonEmpty:{propertyName:"isParagraphNonEmpty",map:new WeakMap}},this.isTextNode=this.createCachedMethod(this.isTextNode,"isTextNode"),this.isElementNode=this.createCachedMethod(this.isElementNode,"isElementNode"),this.getComputedStyle=this.createCachedMethod(this.getComputedStyle,"computedStyle"),this.isSkippingElement=this.createCachedMethod(this.isSkippingElement,"isSkippingElement"),this.getReplacementText=this.createCachedMethod(this.getReplacementText,"replacementText"),this.isBr=this.createCachedMethod(this.isBr,"isBr"),this.isBlock=this.createCachedMethod(this.isBlock,"isBlock"),this.getParsingOptions=this.createCachedMethod(this.getParsingOptions,"parsingOptions"),this.getParsedText=this.createCachedMethod(this.getParsedText,"parsedText"),this.getBlockParent=this.createCachedMethod(this.getBlockParent,"blockParent"),this.getParagraphLastValuableNode=this.createCachedMethod(this.getParagraphLastValuableNode,"paragraphLastValuableNode"),this.isBRElementRelevant=this.createCachedMethod(this.isBRElementRelevant,"isBRElementRelevant"),this.isBlockElementRelevant=this.createCachedMethod(this.isBlockElementRelevant,"isBlockElementRelevant"),this.isTextEndsWithLineBreak=this.createCachedMethod(this.isTextEndsWithLineBreak,"isTextEndsWithLineBreak"),this.isParagraphNonEmpty=this.createCachedMethod(this.isParagraphNonEmpty,"isParagraphNonEmpty"),this._onCEElementChange=this._onCEElementChange.bind(this),this._ceElementObserver=this._parsingDetector.createMutationObserver(this._onCEElementChange);const e={attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0};this._ceElementObserver.observe(this._ceElement,e)}}static _replaceLineBreaks(e){return e.replace(Te.LINE_BREAKS_REGEXP," ")}static _joinWhitespaces(e){return e.replace(Te.WHITESPACE_REGEXP," ")}static _isBlankString(e){return!e.trim()}createCachedMethod(e,t){const n=this._nodePropertiesCache[t];return t=>{let s=n.map.get(t);return void 0===s&&(s=e.call(this,t),n.map.set(t,s)),s}}_deleteCacheForNode(e){const t=Object.values(this._nodePropertiesCache);if(t.forEach((t=>t.map.delete(e))),!this.isTextNode(e)){const n=Ce.create(e);for(;n.next();)t.forEach((e=>e.map.delete(n.currentNode)))}}_normalizeMutations(e){const t={};e.forEach((e=>{"attributes"===e.type&&e.attributeName&&(t[e.attributeName]=t[e.attributeName]||[],t[e.attributeName].push(e))}));for(const n in t)if(t.hasOwnProperty(n)){const s=t[n];if(s.length<2)continue;const i=s[0];i.oldValue===i.target.getAttribute(n)&&s.forEach((t=>{e.splice(e.indexOf(t),1)}))}}_checkRuleConditions(e,t){if(!e)return!1;switch(t.type){case"attributes":return!!e.attributes&&(0===e.attributes.length||e.attributes.includes(t.attributeName));case"characterData":return!!e.characterData;case"childList":return!!e.childList}return!1}_onCEElementChange(e){this._normalizeMutations(e);for(const t of e){const e=t.target;if(!this._ceElement.contains(e)){this._deleteCacheForNode(e);continue}"childList"===t.type&&t.removedNodes.forEach((e=>this._deleteCacheForNode(e)));const n=this.getBlockParent(e);for(const[s,i]of Object.entries(this._cacheInvalidationRules)){const o=this._nodePropertiesCache[s];if(this._checkRuleConditions(i.any,t))o.map=new WeakMap;else{if(this._checkRuleConditions(i.self,t)&&o.map.delete(e),this._checkRuleConditions(i.parent,t))for(let t=0;t<e.childNodes.length;t++)o.map.delete(e.childNodes[t]);if(this._checkRuleConditions(i.ancestor,t)){const t=Ce.create(e);for(;t.next();)o.map.delete(t.currentNode)}if(this._checkRuleConditions(i.descendant,t)){let t=e.parentElement;for(;t&&t!==this._ceElement;)o.map.delete(t),t=t.parentElement}if(this._checkRuleConditions(i.sibling,t)){const t=e.parentElement;if(t)for(let e=0;e<t.childNodes.length;e++)o.map.delete(t.childNodes[e])}if(this._checkRuleConditions(i.blockSibling,t)){const e=Ce.create(n);for(;e.next();)o.map.delete(e.currentNode)}}}}}isWhiteSpace(e){return this._parsingDetector.isWhiteSpace(e)}isTextNode(e){return te(e)}isElementNode(e){return ee(e)}getComputedStyle(e){return window.getComputedStyle(e)}isSkippingElement(e){return this._ceElement!==e&&(this._parsingDetector.isIgnored(e,this.getComputedStyle(e))||this._parsingDetector.isSignature(e)||this._parsingDetector.isQuote(e))}getReplacementText(e){const t=this.getComputedStyle(e),n=this._parsingDetector.isIgnored(e,t);return this._parsingDetector.getReplacementText(e,n,t)}isBr(e){return"BR"===e.tagName}isBlock(e){return this._parsingDetector.isBlock(e,this.getComputedStyle(e))}getParsingOptions(e){const t=this.isElementNode(e)?e:e.parentNode;if(this._parsingDetector.getParsingOptions)return this._parsingDetector.getParsingOptions(t);const n=this.getComputedStyle(t).whiteSpace||"";return{element:t,preserveLineBreaks:Te.PRESERVE_LINEBREAKS_VALUES.includes(n),preserveWhitespaces:Te.PRESERVE_WHITESPACES_VALUES.includes(n)}}getParsedText(e){const t=this.getParsingOptions(e);let n=e.nodeValue;return t.preserveLineBreaks||(n=Te._replaceLineBreaks(n)),n=this._parsingDetector.replaceText(n,e,t.element),t.preserveWhitespaces||(n=Te._joinWhitespaces(n)),n}getBlockParent(e){let t=this.isElementNode(e)?e:e.parentElement;for(;t!==this._ceElement&&!this.isBlock(t);)t=t.parentElement;return t}getParagraphLastValuableNode(e){const t=this.getBlockParent(e),n=Ce.create(t,e);let s=!1,i=null;do{const e=n.currentNode;if(s=!1,this.isElementNode(e))if(this.getReplacementText(e)&&(i=e),this.isSkippingElement(e))s=!0;else{if(this.isBlock(e))return i;if(this.isBr(e))return i}else if(this.isTextNode(e)){const t=this.getParsingOptions(e),n=this.getParsedText(e);(t.preserveWhitespaces&&n||!Te.BLANK_STRING_REGEXP.test(n))&&(i=e)}}while(n.next(s));return i}isBRElementRelevant(e){const t=this.getBlockParent(e);let n=Ce.create(t),s=!1,i=!1;for(;n.next(s);){const t=n.currentNode;if(s=!1,this.isElementNode(t)){if(t===e)break;this.getReplacementText(t)&&(i=!0),this.isSkippingElement(t)?s=!0:this.isBlock(t)&&(i=!1,s=!0)}else if(this.isTextNode(t)){const e=this.getParsingOptions(t),n=this.getParsedText(t);(e.preserveWhitespaces&&n||!Te._isBlankString(n))&&(i=!0)}}for(n=Ce.create(t,e),s=!1;n.next(s);){const e=n.currentNode;if(s=!1,this.isElementNode(e)){if(this.getReplacementText(e))return!0;if(this.isSkippingElement(e))s=!0;else{if(this.isBr(e))return!0;if(i&&this.isBlock(e))return!1}}else if(this.isTextNode(e)){const t=this.getParsingOptions(e),n=this.getParsedText(e);if(t.preserveWhitespaces&&n||!Te._isBlankString(n))return!0}}return!i}isBlockElementRelevant(e){return!!this._parsingDetector.isBlockElementRelevant&&this._parsingDetector.isBlockElementRelevant(e)}isTextEndsWithLineBreak(e){const t=Ce.create(this._ceElement,e);let n=!!ee(e)&&this.isSkippingElement(e),s=!1;for(;t.next(n);){const i=t.currentNode;if(n=!1,this.isElementNode(i)){if(this.getReplacementText(i)){return!B(this.getBlockParent(e),i)}if(this.isSkippingElement(i))n=!0;else if(this.isBlock(i)){if(this.isParagraphNonEmpty(i))return!0;s=!0}}else if(this.isTextNode(i)){const t=this.getParsingOptions(i),n=this.getParsedText(i);if(t.preserveWhitespaces&&n||!Te._isBlankString(n)){if(s)return!0;return!B(this.getBlockParent(e),i)}}}return!1}isParagraphNonEmpty(e){const t=Ce.create(e);let n=!1;for(;t.next(n);){const e=t.currentNode;if(n=!1,this.isElementNode(e)){if(this.getReplacementText(e))return!0;if(this.isSkippingElement(e))n=!0;else if(this.isBlock(e))return!1}else if(this.isTextNode(e)){const t=this.getParsingOptions(e),n=this.getParsedText(e);if(t.preserveWhitespaces&&n||!Te._isBlankString(n))return!0}}return!1}destroy(){this._ceElementObserver&&this._ceElementObserver.disconnect()}}Te.DISPLAY_BLOCK_VALUES=["block","list-item","table","table-caption","table-row","table-cell","flex","grid"],Te.SKIPPING_TAGS=["CODE","NOSCRIPT","OBJECT","SCRIPT","STYLE","TEMPLATE","VAR","CANVAS","IMG","SVG","SELECT"],Te.PRESERVE_LINEBREAKS_VALUES=["pre","pre-wrap","pre-line"],Te.PRESERVE_WHITESPACES_VALUES=["pre","pre-wrap"],Te.LINE_BREAKS_REGEXP=/\n/g,Te.WHITESPACE_REGEXP=/  +/g,Te.BLANK_STRING_REGEXP=/^[ \uFEFF]*$/,Te.SUP_REGEXP=/^[\[\(]?\d+[\]\)]?/;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class be{constructor(e,t,n=Number.MAX_SAFE_INTEGER){this._inputArea=e,this._tweaks=t,this._textLengthThreshold=n,this._keyboardEventTarget=this._tweaks.getKeyboardEventTarget(),this._lastPressInfo={key:"",timeStamp:0},this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._inputArea.addEventListener("blur",this._onBlur),this._keyboardEventTarget.addEventListener("keyup",this._onKeyUp),this._inputArea.addEventListener("paste",this._onPaste)}_onBlur(){const e={inputAreaWrapper:this};K(document,be.eventNames.blur,e)}_onKeyUp(e){const t=Date.now();if(e.key&&e.isTrusted)if(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)this._lastPressInfo={key:"",timeStamp:0};else if(this._lastPressInfo.key===e.key){if(t-this._lastPressInfo.timeStamp<be.MAX_DOUBLE_PRESS_DELAY){const t={inputAreaWrapper:this,key:e.key};K(document,be.eventNames.dblPress,t),this._lastPressInfo={key:"",timeStamp:0}}else this._lastPressInfo={key:e.key,timeStamp:t}}else this._lastPressInfo={key:e.key,timeStamp:t}}_onPaste(e){const t=e.clipboardData,n={inputAreaWrapper:this,isSignificantTextChange:(t?t.getData("Text"):"").length>200};K(document,be.eventNames.paste,n)}_onInput(){const e=this._text;if(!this._updateText())return;const t={inputAreaWrapper:this,previousText:e,text:this._text};K(document,be.eventNames.textChanged,t)}_getTextChunkIndex(e){let t=0,n=this._textChunks.length,s=0;for(;t<n;){s=t+Math.floor((n-t)/2);const i=this._textChunks[t];if(i.parsedTextOffset<=e&&e<=i.parsedTextOffset+i.parsedText.length)return t;const o=this._textChunks[s];o.parsedTextOffset+o.parsedText.length>=e?n=s:t=s+1}return t<this._textChunks.length?t:-1}simulateKeyUp(){try{const e=new window.KeyboardEvent("keyup",{bubbles:!0,cancelable:!0,keyCode:17,which:17,charCode:0,location:1,key:"Control",code:"ControlLeft"});this._inputArea.dispatchEvent(e)}catch(e){}}simulateInput(e=""){const t=new window.InputEvent("input",{bubbles:!0,cancelable:!1,inputType:"insertText",data:e});this._inputArea.dispatchEvent(t)}simulateChange(){const e=new Event("change",{bubbles:!0,cancelable:!1});this._inputArea.dispatchEvent(e)}getText(){return this._text}getTextChunks(){return this._textChunks}getTextRanges(e,t,n=!0){if(e<0)return[];const s=this._getTextChunkIndex(e);if(-1===s)return[];const i=[];for(let o=s;o<this._textChunks.length;o++){const{node:s,isTextNode:r,rawText:a,parsedText:l,parsedTextOffset:c}=this._textChunks[o],d=Math.max(e-c,0);if(!r){t-=l.length-d;continue}const h=this._offsetInRawText(a,l,d),_=this._offsetInRawText(a,l,d+t);if((!n||h!==_)&&(i.push({node:s,text:a,start:h,end:_}),(t-=l.length-d)<=0))break}return i}destroy(){this._inputArea.removeEventListener("blur",this._onBlur),this._keyboardEventTarget.removeEventListener("keyup",this._onKeyUp),this._inputArea.removeEventListener("paste",this._onPaste)}}be.MAX_DOUBLE_PRESS_DELAY=400,be.eventNames={blur:"lt-inputAreaWrapper.blur",scroll:"lt-inputAreaWrapper.scroll",paste:"lt-inputAreaWrapper.paste",textChanged:"lt-inputAreaWrapper.textChanged",dblclick:"lt-inputAreaWrapper.dblclick",dblPress:"lt-inputAreaWrapper.dblPress"};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Ae extends be{constructor(e,t,n=Number.MAX_SAFE_INTEGER){super(e,t,n),this._ceElementInspector=new Te(this._inputArea,this._tweaks.getParsingDetector(),this._tweaks.getCacheInvalidationRules()),this._domMeasurement=new k(this._inputArea.ownerDocument),this._scrollTop=this._inputArea.scrollTop,this._scrollLeft=this._inputArea.scrollLeft,this._updateText(),this._onDblClick=this._onDblClick.bind(this),this._onScroll=this._onScroll.bind(this),this._inputArea.addEventListener("dblclick",this._onDblClick),this._inputArea.addEventListener("scroll",this._onScroll),"BODY"===this._inputArea.nodeName&&window.addEventListener("scroll",this._onScroll),this._inputAreaObserver=this._tweaks.createMutationObserver(this._onInput),this._inputAreaObserver.observe(this._inputArea,Ae.INPUT_AREA_OBSERVER_CONFIG)}static _selectText(e,t=0,n=e.nodeValue.length){t=Math.max(t,0),n=Math.min(n,e.nodeValue.length);const s=window.getSelection();s.removeAllRanges();const i=new Range;i.setStart(e,t),i.setEnd(e,n),s.addRange(i)}static _simulateMouseDown(e,t){const n=new MouseEvent("mousedown",{bubbles:!0,cancelable:!1,clientX:t.x,clientY:t.y+t.height/2});return e.dispatchEvent(n)}static _simulateMouseUp(e,t){const n=new MouseEvent("mouseup",{bubbles:!0,cancelable:!1,clientX:t.x+t.width,clientY:t.y+t.height/2});return e.dispatchEvent(n)}static _simulateMouseMove(e,t){const n=new MouseEvent("mousemove",{bubbles:!0,cancelable:!1,clientX:t.x+t.width,clientY:t.y+t.height/2});return e.dispatchEvent(n)}static _simulateBackspaceDown(e){const t=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:8,which:8,location:0,key:"Backspace"});return e.dispatchEvent(t)}static _simulateBackspaceUp(e){const t=new KeyboardEvent("keyup",{bubbles:!0,cancelable:!0,keyCode:8,which:8,location:0,key:"Backspace"});return e.dispatchEvent(t)}static _simulateSelection(e){const t=e.ownerDocument.createRange();t.setStart(e,0),t.collapse(!1);const n=t.getBoundingClientRect();this._simulateMouseDown(e,n);const s=window.getSelection();s.removeAllRanges(),s.addRange(t),this._simulateMouseMove(e,n),this._simulateMouseUp(e,n)}_onDblClick(e){const t=_(this._tweaks.getSelectedText()),n=this.getSelection();if(!t||!n)return;const s=n.end||n.start,i=this.getTextRanges(n.start,s-n.start);if(!i.length)return;this._domMeasurement.clearCache();const o=this._domMeasurement.getTextBoundingBoxes(i,this._inputArea),r=this._domMeasurement.getTextBoundingBoxes(i,this._inputArea,!1);if(!o.length)return;if(!r.some((t=>U(t,e.clientX,e.clientY))))return;const a={inputAreaWrapper:this,selectedText:t,selection:n,clickedRectangles:o};K(document,be.eventNames.dblclick,a)}_onScroll(){let e=0,t=0;if("BODY"===this._inputArea.nodeName?(e=document.body&&document.body.scrollTop||document.documentElement&&document.documentElement.scrollTop||0,t=document.body&&document.body.scrollLeft||document.documentElement&&document.documentElement.scrollLeft||0):(e=this._inputArea.scrollTop,t=this._inputArea.scrollLeft),this._scrollTop===e&&this._scrollLeft===t)return;this._scrollTop=e,this._scrollLeft=t;const n={inputAreaWrapper:this};K(document,be.eventNames.scroll,n)}_hasSpaceBefore(e){if(e<=0)return!1;const t=this.getTextRanges(e-1,1)[0];return Boolean(t&&t.node.nodeValue&&Ae.VISIBLE_WHITE_SPACE_REGEXP.test(t.node.nodeValue.substring(t.start,t.end)))}_hasSpaceAfter(e){const t=this.getTextRanges(e,1)[0];return Boolean(t&&t.node.nodeValue&&Ae.VISIBLE_WHITE_SPACE_REGEXP.test(t.node.nodeValue.substring(t.start,t.end)))}_offsetInRawText(e,t,n){n=Math.min(e.length,n);let s=0,i=0;do{const o=e[s],r=t[i];if(o===r)i++;else if(this._ceElementInspector.isWhiteSpace(o)||"\n"===o)" "===r&&i++;else if(!d(o))break;if(i>n)break;s++}while(s<e.length);return s}_offsetInParsedText(e,t,n){let s=0,i=0;for(;s<n;){const n=e[s],o=t[i];if(n===o)i++;else if(this._ceElementInspector.isWhiteSpace(n)||"\n"===n)" "===o&&i++;else if(!d(n))break;s++}return i}_updateText(){const e=[];let t=0,n=0,s=null,i=!0,o=!1;const a=Ce.create(this._inputArea);let l=!1;do{const c=a.currentNode;null===s&&(s=this._ceElementInspector.getParagraphLastValuableNode(c)),l=!1;let d=!1,h="";if(ee(c))if(h=this._ceElementInspector.getReplacementText(c),i=i&&""===h,o=r(h),c===s&&(s=null,this._ceElementInspector.isTextEndsWithLineBreak(c)&&(i=!0,o=!1,h+="\n\n")),this._ceElementInspector.isSkippingElement(c)){if(l=!0,s=null,!h)continue}else this._ceElementInspector.isBlock(c)?(s=null,i=!0,o=!1,!h&&this._ceElementInspector.isBlockElementRelevant(c)&&(h="\n\n")):this._ceElementInspector.isBr(c)&&(s=null,i=!0,o=!1,!h&&this._ceElementInspector.isBRElementRelevant(c)&&(h="\n"));else if(te(c)&&(d=!0,h=this._ceElementInspector.getParsedText(c),h)){const e=null===s||s===c;this._ceElementInspector.getParsingOptions(c).preserveWhitespaces||((i||o)&&(h=h.replace(Ae.LEADING_WHITESPACES_REGEXP,"")),e&&(h=h.replace(Ae.TRAILING_WHITESPACES_REGEXP,""))),i=i&&""===h,o=r(h),c===s&&(s=null,this._ceElementInspector.isTextEndsWithLineBreak(c)&&(i=!0,o=!1,h+="\n\n"))}const _=d?c.nodeValue:"";if(e.push({node:c,isTextNode:d,rawText:_,rawTextOffset:t,parsedText:h,parsedTextOffset:n}),d&&(t+=_.length),n+=h.length,n>this._textLengthThreshold)break}while(a.next(l));let c="";for(const t of e)c+=t.parsedText;const d=this._text!==c;return this._text=c,this._textChunks=e,d}_getTextPosition(e){const t=this._getTextChunkIndex(e);if(-1===t)return null;const n=this._textChunks[t];return e-=n.parsedTextOffset,{textNode:n.node,offset:this._offsetInRawText(n.rawText,n.parsedText,e)}}_getTextOffset(e,t){let n=null,s=0;if(ee(e)){const i=Ce.create(this._inputArea);do{const s=i.currentNode;if(s===e.childNodes[t])break;te(s)&&s.textContent&&(n=s)}while(i.next());if(!n)return-1;s=n.textContent.length}else te(e)&&(n=e,s=t);const i=this._textChunks.find((e=>e.node===n));return i?i.parsedTextOffset+this._offsetInParsedText(i.rawText,i.parsedText,s):-1}_applyReplacement(t){let n=Promise.resolve();console.log("_applyReplacement",JSON.stringify({currentText:t.textNode.textContent,replacementText:t.replacementText,from:t.from,to:t.to},null,2));const s=t.textNode.parentElement||this._inputArea,i=t.textNode.ownerDocument.createRange();i.setStart(t.textNode,t.from),i.setEnd(t.textNode,t.to);const o=i.getBoundingClientRect();n=n.then((()=>(Ae._simulateMouseDown(s,o),O(he(this._inputArea)?21:0)))).then((()=>(Ae._simulateMouseMove(s,o),Ae._selectText(t.textNode,t.from,t.to),O(he(this._inputArea)?21:0)))).then((()=>(Ae._simulateMouseUp(s,o),le(this._inputArea)||ce(this._inputArea)||de(this._inputArea)?O(201):re(this._inputArea)?O(0):he(this._inputArea)?O(21):void 0))).then((()=>{if(!de(this._inputArea)||!e.isFirefox()&&!e.isThunderbird()){if(re(this._inputArea)&&""===t.replacementText&&t.from!==t.to){if(Ae._simulateBackspaceDown(this._inputArea)){const e=new window.InputEvent("beforeinput",{bubbles:!0,cancelable:!0,inputType:"deleteContent"});let t=!0;"deleteContent"===e.inputType&&(t=this._inputArea.dispatchEvent(e)),t&&document.execCommand("delete",!1)}return O().then((()=>{Ae._simulateBackspaceUp(this._inputArea)}))}if(ce(this._inputArea)||le(this._inputArea)||this._inputArea.classList.contains("odoo-editor-editable"))!function(t,n,s){var i,o;let r;e.isFirefox()||e.isThunderbird()?r=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,data:n,dataType:"text/plain"}):(r=new ClipboardEvent("paste",{clipboardData:new DataTransfer,cancelable:!0,bubbles:!0}),r.clipboardData.setData("text/plain",n),s&&r.clipboardData.setData("text/html",s));let a=t.dispatchEvent(r);if(a){const e=new InputEvent("beforeinput",{data:n,inputType:"insertFromPaste",cancelable:!0,bubbles:!0});null===(i=e.dataTransfer)||void 0===i||i.setData("text/plain",n),s&&(null===(o=e.dataTransfer)||void 0===o||o.setData("text/html",s)),"insertFromPaste"===e.inputType&&(a=t.dispatchEvent(e))}}(this._inputArea,t.replacementText);else{const e=new window.InputEvent("beforeinput",{bubbles:!0,cancelable:!0,inputType:"insertText",data:t.replacementText});let n=!0;"insertText"===e.inputType&&(n=this._inputArea.dispatchEvent(e)),n&&document.execCommand("insertText",!1,t.replacementText)}}}));return(e.isFirefox()||e.isThunderbird())&&(t.replacementText.includes(Ae.NBSP)||de(this._inputArea))&&(n=n.then((()=>{const e=new window.InputEvent("beforeinput",{bubbles:!0,cancelable:!1,inputType:"insertText",data:t.replacementText});this._inputArea.dispatchEvent(e),t.textNode.nodeValue=t.newText,this.simulateInput(t.replacementText)}))),n}getTextBoxes(e,t){const n=this.getTextRanges(e,t);return n.length?(this._domMeasurement.clearCache(),this._domMeasurement.getTextBoundingBoxes(n,this._inputArea)):[]}resetText(){this._inputAreaObserver.disconnect();const e=Ce.create(this._inputArea);do{const t=e.currentNode;te(t)&&(t.textContent=t.textContent)}while(e.next());this._inputAreaObserver.observe(this._inputArea,Ae.INPUT_AREA_OBSERVER_CONFIG)}replaceText(e,t,n){if(e<0)return Promise.resolve();const s=e+n.length;return""===n&&(this._hasSpaceBefore(e)||0===e)&&this._hasSpaceAfter(e+t)&&(e=Math.max(e-1,0),t+=1),O(50).then((()=>{const i=[],o=this._getTextChunkIndex(e);if(-1===o)return Promise.resolve();e-=this._textChunks[o].parsedTextOffset;for(let s=o;s<this._textChunks.length;s++){const{node:o,isTextNode:r,rawText:a,parsedText:l}=this._textChunks[s];if(r&&e<l.length){const s=l.substr(0,e)+n+l.substr(e+t);if(a!==s){const r=this._offsetInRawText(a,l,e),c=this._offsetInRawText(a,l,e+t);i.push({textNode:o,from:r,to:c,replacementText:n,newText:s})}t=Math.max(t-(l.length-e),0),e=0,n=""}else e-=l.length;if(0===t&&""===n)break}i.reverse().reduce(((e,t)=>e.then((()=>this._applyReplacement(t)))),Promise.resolve()).then((()=>{this.setSelection({start:s})})).then((()=>{this.simulateChange(),this.simulateKeyUp()}))}))}getSelection(){const e=this._tweaks.getSelection();if(!e||!e.startNode)return null;if(!this._inputArea.contains(e.startNode))return null;const t=this._getTextOffset(e.startNode,e.startOffset);return{start:t,end:e.isCollapsed||!e.endNode?t:this._getTextOffset(e.endNode,e.endOffset)}}setSelection(e){const t=e.start,n=void 0===e.end?t:e.end;this._inputArea.focus();const s=this._getTextPosition(t);if(!s)return;const i=window.getSelection();i.removeAllRanges();const o=new Range;if(o.setStart(s.textNode,s.offset),t!==n){const e=this._getTextPosition(n);if(!e)return;o.setEnd(e.textNode,e.offset)}else o.collapse(!1);i.addRange(o)}scrollToText(e,t,n="smooth",s="nearest",i){if(e<0)return;const o=()=>{i&&setTimeout((()=>i()),50)},r=this.getTextRanges(e,t);if(r.length)try{const e=new Range;e.setStart(r[0].node,r[0].start),e.setEnd(r[r.length-1].node,r[r.length-1].end),window.scrollRangeIntoView(e,{behavior:n,block:s},o)}catch(e){}}destroy(){super.destroy(),this._inputArea.removeEventListener("dblclick",this._onDblClick),this._inputArea.removeEventListener("scroll",this._onScroll),window.removeEventListener("scroll",this._onScroll),this._ceElementInspector.destroy(),this._inputAreaObserver&&this._inputAreaObserver.disconnect()}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
var Ne;Ae.NBSP=String.fromCharCode(160),Ae.VISIBLE_WHITE_SPACE_REGEXP=/\u00A0|\u0020|\u2009|\u202F/,Ae.LEADING_WHITESPACES_REGEXP=new RegExp(/^ /),Ae.TRAILING_WHITESPACES_REGEXP=new RegExp(/ $/),Ae.INPUT_AREA_OBSERVER_CONFIG={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0,attributeFilter:["id","class","style"]},function(e){e.PERMISSION_REQUIRED="PERMISSION_REQUIRED",e.DISABLED="DISABLED",e.DISCONNECTED="DISCONNECTED",e.TEXT_TOO_SHORT="TEXT_TOO_SHORT",e.TEXT_TOO_LONG="TEXT_TOO_LONG",e.IN_PROGRESS="IN_PROGRESS",e.COMPLETED="COMPLETED",e.UNSUPPORTED_LANGUAGE="UNSUPPORTED_LANGUAGE",e.NEEDS_LANGUAGE_HINT="NEEDS_LANGUAGE_HINT",e.FAILED="FAILED"}(Ne||(Ne={}));class Le{constructor(e,t,n,s,i=!0){this._className=e,this._label=t,this._parentElement=s,this._toolTip=n,this._document=s.ownerDocument,this._render(i)}_render(e){if(this._element=this._document.createElement("lt-div"),this._element.classList.add("lt-icon","lt-icon--"+this._className),this._element.classList.toggle("lt-icon--clickable",e),this._element.setAttribute("data-lt-prevent-focus",""),this._parentElement.appendChild(this._element),this._icon=this._document.createElement("lt-span"),this._icon.classList.add("lt-icon__icon","lt-icon__"+this._className),this._element.appendChild(this._icon),this._toolTip){const e=this._document.createElement("lt-div");e.classList.add("lt-icon__tooltip","lt-icon__tooltip--"+this._toolTip.position,"lt-icon__tooltip--"+this._className),e.textContent=this._toolTip.label,this._element.appendChild(e)}if(this._label){const e=this._document.createElement("lt-span");e.classList.add("lt-icon__label"),e.textContent=this._label,this._element.appendChild(e)}}setIcon(e){this._icon.className="",this._icon.classList.add("lt-icon__icon","lt-icon__"+e)}getElement(){return this._element}}class Ie{constructor(e,t,n,s,i,o,r=null){this._className=e,this._parentElement=n,this._dialog=s,this._appendElement=r,this._optionElements=[],this._options=t,this._document=n.ownerDocument,this._position=i,this._isSelectable=o,this._render()}_render(){this._overlay=this._document.createElement("lt-div"),this._overlay.setAttribute("data-lt-prevent-focus",""),this._overlay.classList.add("lt-menu-overlay","lt-menu-overlay--"+this._className),this._dialog.appendChild(this._overlay),this._element=this._document.createElement("lt-div"),this._element.setAttribute("data-lt-prevent-focus",""),this._element.classList.add("lt-menu","lt-menu--"+this._className,"lt-menu--position-"+this._position),this._parentElement.appendChild(this._element),this._options.forEach((e=>{const t=this._document.createElement("lt-div");t.classList.add("lt-menu__item","lt-menu__item--"+e.className,"lt-icon__"+e.className),e.isClickable&&t.classList.add("lt-menu__item--clickable"),this._isSelectable&&t.classList.add("lt-menu__item--selectable"),this._element.appendChild(t);const n=this._document.createElement("lt-span");if(n.classList.add("lt-menu__item__label","lt-menu__item__label--"+e.className),n.textContent=e.label,t.appendChild(n),e.info){const n=this._document.createElement("lt-span");n.classList.add("lt-menu__item__info","lt-menu__item__info--"+e.className),n.textContent=e.info,t.appendChild(n)}if(e.tag){const n=this._document.createElement("lt-span");n.classList.add("lt-menu__item__tag","lt-menu__item__tag--"+e.className),n.textContent=e.tag,t.appendChild(n)}this._optionElements.push(t)})),this._appendElement&&this._element.appendChild(this._appendElement)}show(){this._parentElement.classList.add("lt-menu-visible"),this._element.classList.add("lt-menu--show"),this._overlay.classList.add("lt-menu--show")}hide(){this._parentElement.classList.remove("lt-menu-visible"),this._element.classList.remove("lt-menu--show"),this._overlay.classList.remove("lt-menu--show")}getElement(){return this._element}getAllOptions(){return this._optionElements}getActiveOptions(){return this._optionElements}getOverlay(){return this._overlay}setInfo(e,t){if(e>=0&&e<this._optionElements.length){const n=this._optionElements[e].querySelector(".lt-menu__item__info");n&&(n.textContent=t)}}toggleActive(e,t,n){n&&this.getAllOptions().forEach((e=>{e.classList.remove("lt-menu__item--active")})),e>=0&&e<this._optionElements.length&&(t?this._optionElements[e].classList.add("lt-menu__item--active"):this._optionElements[e].classList.remove("lt-menu__item--active"))}toogleVisibility(e,t){e>=0&&e<this._optionElements.length&&(t?this._optionElements[e].classList.remove("lt-menu__item--hidden"):this._optionElements[e].classList.add("lt-menu__item--hidden"))}}class ve{constructor(e,t,n,s){this._className=e,this._type=t,this._size=n,this._parentElement=s,this._document=s.ownerDocument,this._render()}_render(){this._element=this._document.createElement("lt-div"),this._element.classList.add("lt-package-badge","lt-package-badge--"+this._type,"lt-package-badge--"+this._size),this._element.textContent=this._type,this._parentElement.appendChild(this._element)}getElement(){return this._element}}class xe{constructor(e,t,n=null,s=null,i=null,o){this._parentElement=e,this._headline=n,this._text=s,this._buttonText=i,this._trackingEvent=t,this._linkParameters=o,this._document=e.ownerDocument,this._storageController=M.create(),this._element=this._document.createElement("lt-div"),this._element.addEventListener("click",(e=>{const t=Object.assign({command:"OPEN_PREMIUM_PAGE"},this._linkParameters);browser.runtime.sendMessage(t),e.preventDefault(),e.stopImmediatePropagation()}),!0),this._element.className="lt-premium-errors-teaser",this._parentElement.appendChild(this._element),this._renderPremiumErrorsTeaser()}_observe(){this._element.addEventListener("click",(()=>{w.trackEvent("Action",`${this._trackingEvent}:click`)}))}_renderPremiumErrorsTeaser(){w.trackEvent("Action",this._trackingEvent),this._observe(),this._storageController.onReady((()=>{this._storageController.startChangelogCoupon();const e=this._storageController.getActiveCoupon();if(e&&(this._linkParameters.campaign=this._linkParameters.campaign.replace(/addon2-(dialog|popup|validator)/,"addon2-changelog"),this._renderCoupon(e)),!this._headline&&!this._text&&!this._buttonText)return;const t=this._document.createElement("lt-div");if(t.className="lt-premium-errors-teaser__content",this._element.appendChild(t),this._headline&&!e){const e=this._document.createElement("lt-span");e.className="lt-premium-errors-teaser__content__headline",e.textContent=this._headline,t.appendChild(e)}if(this._text){const e=this._document.createElement("lt-span");e.className="lt-premium-errors-teaser__content__text",e.innerHTML=this._text,t.appendChild(e)}if(this._buttonText){const e=this._document.createElement("lt-span");e.className="lt-premium-errors-teaser__content__button",e.textContent=this._buttonText,t.appendChild(e)}}))}_renderCoupon(e){const t=this._document.createElement("lt-div");t.className="lt-premium-errors-teaser__coupon";const n=this._document.createElement("lt-span");n.textContent=s.getMessage("upgradeTeaserDiscountHeadline"),n.className="lt-premium-errors-teaser__coupon__title__headline";const i=this._document.createElement("lt-span");i.textContent=s.getMessage("upgradeTeaserDiscount",[e.percent]),i.className="lt-premium-errors-teaser__coupon__title__subline";const o=this._document.createElement("lt-div");o.className="lt-premium-errors-teaser__coupon__title",o.appendChild(n),o.appendChild(i),t.appendChild(o);const r=this._document.createElement("lt-div");r.className="lt-premium-errors-teaser__coupon__timer",t.appendChild(r),this._element.prepend(t),window.clearInterval(this._interval),this._renderTimer(t,r,e),this._interval=window.setInterval((()=>this._renderTimer(t,r,e)),1e3)}_renderTimer(e,t,n){const s=Date.now();let i=(n.expires||0)-s;if(i<0)return i=0,void e.remove();const o=Math.floor(i/1e3%60),r=Math.floor(i/1e3/60%60),a=`${T(Math.floor(i/1e3/60/60))}:${T(r)}:${T(o)}`.split(/:|/),l=this._document.createElement("lt-div");a.forEach(((e,t)=>{const n=this._document.createElement("lt-span");if(n.className="lt-premium-timer__timer__diget",n.textContent=e,l.appendChild(n),t%2==1&&t<a.length-1){const e=this._document.createElement("lt-span");e.className="lt-premium-timer__timer__divider",e.textContent=":",l.appendChild(e)}})),t.innerHTML=l.innerHTML}destroy(){window.clearInterval(this._interval)}}class Re{constructor(e,t,n){this._parentElement=e,this._componentName=t,this._url=n,this._document=e.ownerDocument,this._storageController=M.create(),this._element=this._document.createElement("lt-div"),this._element.className="lt-rating-teaser",this._parentElement.appendChild(this._element),this.render()}_sendRating(t){w.trackEvent("Stat",`rating:${x.getPrimaryLanguageCode(navigator.language)}`,t),this._storageController.updateStatistics({ratingValue:t}),this._storageController.updateUIState({hasRated:!0}),"like"===t?e.isChrome()||e.isFirefox()||e.isOpera()||e.isEdge()||e.isSafari()?this._showReviewContainer():this._showThanksContainer():"dislike"===t&&(this._showThanksContainer(),this._openFeedbackForm(s.getMessage("ratingUnhappyQuestion")),w.trackEvent("Stat","dislike_host",N()))}_showReviewContainer(){this._element.classList.remove("lt-rating-teaser--thanks-visible"),this._element.classList.add("lt-rating-teaser--review-visible")}_showThanksContainer(){this._element.classList.remove("lt-rating-teaser--review-visible"),this._element.classList.add("lt-rating-teaser--thanks-visible")}_openFeedbackForm(e){t.openFeedbackForm(this._url,e)}render(){if(e.isSafari())return;const t=this._document.createElement("lt-div");t.className="lt-rating-teaser__intro",this._element.appendChild(t);const n=this._document.createElement("lt-div");n.className="lt-rating-teaser__intro__question";const s=this._document.createElement("lt-div");s.className="lt-rating-teaser__intro__headline",s.innerText=browser.i18n.getMessage("ratingHeadline"),n.appendChild(s);const i=this._document.createElement("lt-div");i.innerText=browser.i18n.getMessage("ratingText"),n.appendChild(i),t.appendChild(n);const o=this._document.createElement("lt-div");o.className="lt-rating-teaser__intro__options";const r=this._document.createElement("lt-div");r.className="lt-rating-teaser__intro__option",r.setAttribute("data-lt-emotion","like"),o.appendChild(r);const a=this._document.createElement("lt-div");a.className="lt-rating-teaser__intro__option",a.setAttribute("data-lt-emotion","dislike"),o.appendChild(a),t.appendChild(o);const l=this._document.createElement("a");l.target="_blank",l.rel="noreferrer noopener",l.className="lt-rating-teaser__review",this._element.appendChild(l);const c=this._document.createElement("lt-div");c.className="lt-rating-teaser__review__text",l.appendChild(c),e.isFirefox()?D(c,"reviewFirefoxHeadline"):e.isOpera()?D(c,"reviewOperaHeadline"):e.isEdge()?D(c,"reviewEdgeHeadline"):e.isSafari()?D(c,"reviewSafariHeadline"):D(c,"reviewChromeHeadline");const d=this._document.createElement("lt-a");d.className="lt-rating-teaser__review__link",d.innerText=browser.i18n.getMessage("reviewLink"),l.appendChild(d);const h=this._document.createElement("lt-div");h.className="lt-rating-teaser__thanks",h.innerText=browser.i18n.getMessage("ratingThankYou"),this._element.appendChild(h),r.addEventListener("click",(()=>this._sendRating("like"))),a.addEventListener("click",(()=>this._sendRating("dislike"))),l.addEventListener("click",(()=>{w.trackEvent("Action","dialog:rating_teaser:click")})),e.isChrome()?(this._element.classList.add("lt-rating-teaser--chrome"),l.href="https://chrome.google.com/webstore/detail/grammar-and-spell-checker/oldceeleldhonbafppcapldpdifcinji/reviews"):e.isFirefox()?(this._element.classList.add("lt-rating-teaser--firefox"),l.href="https://addons.mozilla.org/firefox/addon/languagetool/"):e.isOpera()?(this._element.classList.add("lt-rating-teaser--opera"),l.href="https://addons.opera.com/extensions/details/grammar-and-spell-checker-languagetool/"):e.isEdge()?(this._element.classList.add("lt-rating-teaser--edge"),l.href="https://microsoftedge.microsoft.com/addons/detail/hfjadhjooeceemgojogkhlppanjkbobc"):e.isSafari()&&(this._element.classList.add("lt-rating-teaser--safari"),l.href="https://appstoreconnect.apple.com/apps/1534275760/appstore"),w.trackEvent("Action",`${this._componentName}:rating_teaser`)}}class Me{constructor(e,t,n){this._className=e,this._parentElement=t,this._toolTip=n,this._document=t.ownerDocument,this._render()}_render(){this._element=this._document.createElement("lt-div"),this._element.classList.add("lt-score","lt-score--"+this._className),this._element.setAttribute("data-lt-prevent-focus",""),this._parentElement.appendChild(this._element),this._progressLabel=this._document.createElement("lt-span"),this._progressLabel.classList.add("lt-score__label"),this._progressLabel.setAttribute("data-lt-prevent-focus",""),this._progressLabel.textContent="0";const e=this._document.createElement("lt-div");e.classList.add("lt-icon__tooltip","lt-icon__tooltip--"+this._toolTip.position,"lt-icon__tooltip--"+this._className),e.textContent=this._toolTip.label,this._element.appendChild(e),this._element.appendChild(this._progressLabel)}setScore(e){Math.PI;e>0?(this._progressLabel.textContent=e.toString(),this._updateProgress(e),this._element.classList.remove("lt-score--hidden")):this._element.classList.add("lt-score--hidden")}_updateProgress(e){let t="",n="";if(e<50){t="linear-gradient(90deg, #DEE3ED 50%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0))",n="linear-gradient("+(90+3.6*e)+"deg, #1976F0 50%, #DEE3ED 50%, #DEE3ED)"}else{t="linear-gradient("+(3.6*(e-50)-90)+"deg, #1976F0 50%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0))",n="linear-gradient(270deg, #1976F0 50%, #DEE3ED 50%, #DEE3ED)"}this._element.setAttribute("style","background-image: "+t+", "+n+" !important")}}class ye{constructor(e,t,n){this._className=e,this._parentElement=t,this._select=n,this._document=t.ownerDocument,this._currentSelection=this._document.createElement("lt-span"),this._render()}_render(){this._selectorWrapper=this._document.createElement("lt-div"),this._selectorWrapper.classList.add("lt-dialog__selector-wrapper","lt-dialog__selector-wrapper--"+this._className,"lt-icon__chevron_down"),this._parentElement.appendChild(this._selectorWrapper),this._currentSelection.classList.add("lt-dialog__current-selection","lt-dialog__current-selection--"+this._className),this._selectorWrapper.appendChild(this._currentSelection),this._select.classList.add("lt-dialog__selector","lt-dialog__selector--"+this._className),this._selectorWrapper.appendChild(this._select)}setActive(e,t,n){this._currentSelection.textContent=e||"",this._select.value=t,new k(this._document).setStyles(this._currentSelection,n)}addOption(e){this._select.prepend(e)}updateOptionLable(e,t){this._select.querySelectorAll("option[value="+e+"]")[0].textContent=t}getSelect(){return this._select}getValue(){return this._select.value}toggleHighlight(e){this._selectorWrapper.classList.toggle("lt-dialog__selector-wrapper--highlight",e)}}class we{constructor(e,t,n,s){this._className=e,this._label=t,this._info=n,this._parentElement=s,this._document=s.ownerDocument,this._render()}_render(){this._element=this._document.createElement("lt-div"),this._element.setAttribute("data-lt-prevent-focus",""),this._element.classList.add("lt-toggle-item","lt-toggle--"+this._className,"lt-icon__"+this._className),this._parentElement.appendChild(this._element);const e=this._document.createElement("lt-div");e.classList.add("lt-toggle-item__title","lt-toggle-item__title--"+this._className);const t=this._document.createElement("lt-span");t.classList.add("lt-toggle-item__title__label"),t.textContent=this._label,e.appendChild(t),this._info&&(this._infoElement=this._document.createElement("lt-span"),this._infoElement.classList.add("lt-toggle-item__title__info"),this._infoElement.textContent=this._info,e.appendChild(this._infoElement)),this._element.appendChild(e);const n=this._document.createElement("lt-div");n.classList.add("lt-toggle-item__toggle","lt-toggle-item__toggle--"+this._className),this._element.appendChild(n);const s=this._document.createElement("lt-div");s.classList.add("lt-toggle-item__toggle__dot"),n.appendChild(s)}set(e){e?this._element.classList.add("lt-toggle-item---checked"):this._element.classList.remove("lt-toggle-item---checked")}setInfo(e){this._infoElement.textContent=e}getElement(){return this._element}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
var ke=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{l(s.next(e))}catch(e){o(e)}}function a(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((s=s.apply(e,t||[])).next())}))};class Oe{constructor(e,n,s,i,o){this._menus=[],this._allDisplyedErrorsCount=0,this._toolbarContainer=e,this._appearance=n,this._uiOptions=o,this._document=this._toolbarContainer.ownerDocument,this._languageCode=s,this._onCloseClick=this._onCloseClick.bind(this),this._onUnload=this._onUnload.bind(this),window.addEventListener("pagehide",this._onUnload,!0),this._controls={},this._eventListeners=[],this._render().then((()=>{this.setCurrentLanguage(s||x.getUserLanguageCode()),this.setCountOptions({mode:"words",counts:{words:0,characters:0,sentences:0}}),this.updateState(i)})),this._eventListeners.push(V(document,"keydown",this._onKeydown.bind(this))),this._inApplyFixMode=!1,this._inInsignificantChangeMode=!0,this._shouldShowRatingTeaser=!i.displayedPremiumErrors.length&&!this._controls.teaserElement&&!this._uiOptions.disableRatingTeaser&&t.isRuntimeConnected()&&0===Math.floor(2*Math.random())}static _cacheMessages(){Oe.MESSAGES={EXTENSION_UPDATED_HEADLINE:s.getMessage("extensionUpdatedHeadline"),EXTENSION_UPDATED_TEXT:s.getMessage("extensionUpdatedText",["<lt-span class='lt-dialog__icon'></lt-span>"]),INCOMPLETE_RESULT:s.getMessage("incompleteResult"),POWERED_BY:s.getMessage("poweredBy"),FEEDBACK:s.getMessage("sendFeedback"),DELETE:s.getMessage("deleteWord"),ENABLE_HEADLINE:s.getMessage("dialogEnableInDialogHeadline"),ENABLE_TEXT:s.getMessage("dialogEnableInDialogText"),ENABLE_EVERYWHERE_BUTTON:s.getMessage("enableEverywhereButton"),ENABLE_HERE_BUTTON:s.getMessage("enableHereButton"),OPTIONS_TITLE:s.getMessage("settingsHeadline"),NO_ERRORS:s.getMessage("noErrorsFound2"),NO_ERRORS_TEXT:s.getMessage("noErrorsFoundText"),TEXT_TOO_LONG_HEADLINE:s.getMessage("dialogTextTooLongHeadline"),TEXT_TOO_LONG_TEXT:s.getMessage("dialogTextTooLongText"),SCROLL_HINT_HEADLINE:s.getMessage("dialogScrollHintHeadline"),SCROLL_HINT_TEXT:s.getMessage("dialogScrollHintText"),TEXT_TOO_LONG_BUTTON:s.getMessage("dialogTextTooLongButton"),TEXT_TOO_SHORT_TEXT:s.getMessage("dialogTextTooShortText"),TEXT_TOO_SHORT_HEADLINE:s.getMessage("dialogTextTooShortHeadline"),TEXT_SCORE_MENU_ITEM:s.getMessage("dialogMainMenuTextScore"),REGULAR_MISTAKE_MENU_ITEM:s.getMessage("dialogMainMenuRegularMistake"),PREMIUM_MISTAKE_MENU_ITEM:s.getMessage("dialogMainMenuPremiumMistake"),PICKY_MODE_MENU_ITEM:s.getMessage("dialogMainMenuPickyMode"),PICKY_MODE_MENU_ITEM_INFO:s.getMessage("dialogMainMenuPickyModeInfo"),COUNTER_CHARACTERS_OPTION:s.getMessage("dialogCounterCharactersOption"),COUNTER_WORDS_OPTION:s.getMessage("dialogCounterWordsOption"),COUNTER_SENTENCES_OPTION:s.getMessage("dialogCounterSentencesOption"),POSITION_DEFAULT_MENU_ITEM:s.getMessage("dialogPositionMenuDefault"),POSITION_RIGHT_MENU_ITEM:s.getMessage("dialogPositionMenuRight"),POSITION_LEFT_MENU_ITEM:s.getMessage("dialogPositionMenuLeft"),Fail_STATE_HEADLINE:s.getMessage("dialogFailStateHeadline"),Fail_STATE_TEXT:s.getMessage("dialogFailStateText"),HEADLINE_SPELLING_ERROR:s.getMessage("spellingError"),HEADLINE_CUSTOM_SUGGESTION_ERROR:s.getMessage("customSuggestionError"),HEADLINE_SUGGESTION_ERROR:s.getMessage("suggestionError"),HEADLINE_PUNCTUATION_ERROR:s.getMessage("punctuationError"),HEADLINE_GRAMMAR_ERROR:s.getMessage("grammarError"),SELECT_LANGUAGE_LABEL:s.getMessage("dialogSelectLanguageLabel"),UNSUPPORTED_LANGUAGE_LABEL:s.getMessage("dialogUnsupportedLanguageLabel"),UNSUPPORTED_LANGUAGE_HEADLINE:s.getMessage("dialogUnsupportedLanguageHeadline"),UNSUPPORTED_LANGUAGE_TEXT:s.getMessage("dialogUnsupportedLanguageText"),ALL_LANGUAGES:s.getMessage("dialogAllLanguages"),RECOMMENDED_LANGUAGES:s.getMessage("dialogRecommendedLanguages"),SCROLL_TO_LINK:s.getMessage("dialogScrollToLink"),SEND_FEEDBACK_TOOLTIP:s.getMessage("dialogTooltipSendFeedback"),HELP_TOOLTIP:s.getMessage("dialogTooltipHelp"),HELP_CENTER_TOOLTIP:s.getMessage("dialogTooltipHelpCenter"),IGNORE_RULE_TOOLTIP:s.getMessage("ignoreHere"),DISABLE_CHECKING_TOOLTIP:s.getMessage("dialogTooltipDisableChecking"),DISABLE_CHECKING_MENU_ITEM:s.getMessage("dialogDisableMenuDisableChecking"),PAUSE_CHECKING_MENU_ITEM:s.getMessage("dialogDisableMenuPauseChecking"),DIALOG_POSITION_TOOLTIP:s.getMessage("dialogTooltipPosition"),SETTINGS_TOOLTIP:s.getMessage("dialogTooltipSettings"),SAVE_TEXT_TOOLTIP:s.getMessage("dialogTooltipSaveText"),NEEDS_LANGUAGE_HINT_HEADLINE:s.getMessage("dialogNeedsLanguageHintHeadline"),NEEDS_LANGUAGE_HINT_TEXT:s.getMessage("dialogNeedsLanguageHintText"),NEEDS_LANGUAGE_HINT_IGNORE:s.getMessage("dialogNeedsLanguageHintIgnore"),LANGUAGES:x.LANGUAGES}}static init(){Oe._isInitialized||(Oe._cacheMessages(),Oe._isInitialized=!0)}_render(){return ke(this,void 0,void 0,(function*(){if(this._controls.container)return;this._controls.container=G(this._document,Oe.CONTAINER_ELEMENT_NAME);const n=e=>{e.stopImmediatePropagation()};this._eventListeners.push(V(this._controls.container,"mousedown",(e=>{if(e.target===this._controls.languageSelector.getSelect()){const e=e=>{e.stopImmediatePropagation()};document.addEventListener("blur",e,!0),setTimeout((()=>{document.removeEventListener("blur",e,!0)}),10)}if(e.target===this._controls.countSelector.getSelect()){const e=e=>{e.stopImmediatePropagation()};document.addEventListener("blur",e,!0),setTimeout((()=>{document.removeEventListener("blur",e,!0)}),10)}e.target instanceof HTMLElement&&e.target.closest("[data-lt-prevent-focus]")&&e.preventDefault(),n(e)})),V(this._controls.container,"mouseup",n),V(this._controls.container,"pointerdown",n),V(this._controls.container,"pointerup",n),V(this._controls.container,"focusin",n),V(this._controls.container,"focusout",n)),this._controls.container.addEventListener("click",n),this._controls.innerContainer=this._document.createElement("lt-div"),this._controls.innerContainer.classList.add("lt-dialog__container","notranslate"),e.isSafari()&&this._controls.innerContainer.classList.add("lt-dialog__container--safari"),this._appearance.canDisplayAllSuggestions()||this._controls.innerContainer.classList.add("lt-dialog__container--small"),this._controls.container.appendChild(this._controls.innerContainer),this._controls.header=this._document.createElement("lt-div"),this._controls.header.className="lt-dialog__header",this._controls.innerContainer.appendChild(this._controls.header);const s=this._document.createElement("lt-div");s.className="lt-dialog__header__logo-wrapper",this._controls.logo=this._document.createElement("lt-div"),this._controls.logo.classList.add("lt-dialog__logo","lt-icon__lt"),s.appendChild(this._controls.logo),this._uiOptions.isPremiumAccount||(this._controls.packageBadge=new ve(null,"basic","default",s),this._eventListeners.push(V(this._controls.packageBadge.getElement(),"click",this._onBadgeClicked.bind(this)))),this._controls.header.appendChild(s),this._controls.headerScoreProgress=this._document.createElement("lt-div"),this._controls.headerScoreProgress.className="lt-dialog__header__progress-score",this._controls.header.appendChild(this._controls.headerScoreProgress),this._controls.headerScoreProgressBar=this._document.createElement("lt-div"),this._controls.headerScoreProgressBar.className="lt-dialog__header__progress-score__bar",this._controls.headerScoreProgress.appendChild(this._controls.headerScoreProgressBar),this._controls.headerControlsWrapper=this._document.createElement("lt-div"),this._controls.headerControlsWrapper.className="lt-dialog__header__controls-wrapper";const i=this._document.createElement("select");if(Oe.MESSAGES.LANGUAGES.forEach((e=>{const t=this._document.createElement("option");t.value=e.code,t.textContent=e.name,i.appendChild(t)})),t.isRuntimeConnected()){const e=yield t.getPreferredLanguages();if(!i||!e.length)return;const n=i.value,s=this._document.createElement("optgroup");s.label=Oe.MESSAGES.ALL_LANGUAGES,Array.from(i.children).forEach((e=>{s.append(e)}));const o=this._document.createElement("optgroup");o.label=Oe.MESSAGES.RECOMMENDED_LANGUAGES,e.forEach((e=>{const t=x.LANGUAGES.find((t=>t.code.startsWith(e.toLowerCase())));if(t){const e=this._document.createElement("option");e.value=t.code,e.textContent=t.name,o.appendChild(e)}})),i.append(o),i.append(s),i.value=n}if(this._controls.languageSelector=new ye("language-select",this._controls.headerControlsWrapper,i),this._eventListeners.push(V(this._controls.languageSelector.getSelect(),"change",this._onLanguageChange.bind(this))),!this._uiOptions.disableSaveDocument){const e={label:Oe.MESSAGES.SAVE_TEXT_TOOLTIP,position:"top-center"};this._controls.saveIcon=new Le("save",null,e,this._controls.headerControlsWrapper),this._eventListeners.push(V(this._controls.saveIcon.getElement(),"click",this._onSaveTextClick.bind(this)))}if(this._appearance.isPositionVisible()&&t.isRuntimeConnected()){const e=this._document.createElement("lt-div");e.className="lt-icon-group",this._controls.headerControlsWrapper.appendChild(e);const t={label:Oe.MESSAGES.DIALOG_POSITION_TOOLTIP,position:"bottom-right"};this._controls.positionIcon=new Le(this._uiOptions.dialogPosition,null,t,e);const n=[{className:"default",label:Oe.MESSAGES.POSITION_DEFAULT_MENU_ITEM,info:null,tag:null,isClickable:!0},{className:"right",label:Oe.MESSAGES.POSITION_RIGHT_MENU_ITEM,info:null,tag:null,isClickable:!0},{className:"left",label:Oe.MESSAGES.POSITION_LEFT_MENU_ITEM,info:null,tag:null,isClickable:!0}];this._controls.positionMenu=new Ie("position",n,this._controls.positionIcon.getElement(),this._controls.innerContainer,"bottom",!0),this._menus.push(this._controls.positionMenu);const s=this._controls.positionMenu.getAllOptions();this._eventListeners.push(V(s[0],"click",this._onPositionDialogClick.bind(this)),V(s[1],"click",this._onPositionRightClick.bind(this)),V(s[2],"click",this._onPositionLeftClick.bind(this)),V(this._controls.positionMenu.getOverlay(),"click",this._onPositionOverlayClick.bind(this)),V(this._controls.positionIcon.getElement(),"click",this._onPositionIconClick.bind(this)))}this._controls.closeIcon=new Le("close_filled",null,null,this._controls.headerControlsWrapper),this._eventListeners.push(V(this._controls.logo,"click",this._gotoLanguageTool.bind(this)),V(this._controls.closeIcon.getElement(),"click",this._onCloseClick)),this._controls.content=this._document.createElement("lt-div"),this._controls.content.className="lt-dialog__content",this._controls.innerContainer.appendChild(this._controls.content),this._eventListeners.push(V(this._controls.content,"scroll",this._onContentScroll.bind(this))),this._controls.contentTop=this._document.createElement("lt-div"),this._controls.contentTop.className="lt-dialog__content__top",this._controls.content.appendChild(this._controls.contentTop),this._controls.contentMain=this._document.createElement("lt-div"),this._controls.contentMain.className="lt-dialog__content__main",this._controls.content.appendChild(this._controls.contentMain),this._controls.contentBottom=this._document.createElement("lt-div"),this._controls.contentBottom.className="lt-dialog__content__bottom",this._controls.content.appendChild(this._controls.contentBottom),this._controls.footer=this._document.createElement("lt-div"),this._controls.footer.className="lt-dialog__footer",this._controls.loadingBar=this._document.createElement("lt-div"),this._controls.loadingBar.className="lt-dialog__footer__loading-bar-container";const o=this._document.createElement("lt-div");o.classList.add("lt-dialog__footer__loading-bar-container__loading-bar","lt-dialog__footer__loading-bar-container__loading-bar--loading-bar-1");const r=this._document.createElement("lt-div");r.classList.add("lt-dialog__footer__loading-bar-container__loading-bar","lt-dialog__footer__loading-bar-container__loading-bar--loading-bar-2");const a=this._document.createElement("lt-div");a.classList.add("lt-dialog__footer__loading-bar-container__loading-bar","lt-dialog__footer__loading-bar-container__loading-bar--loading-bar-3"),this._controls.loadingBar.appendChild(o),this._controls.loadingBar.appendChild(r),this._controls.loadingBar.appendChild(a),this._controls.footer.appendChild(this._controls.loadingBar);const l=[{label:Oe.MESSAGES.COUNTER_CHARACTERS_OPTION,value:"characters"},{label:Oe.MESSAGES.COUNTER_WORDS_OPTION,value:"words"},{label:Oe.MESSAGES.COUNTER_SENTENCES_OPTION,value:"sentences"}],c=this._document.createElement("select");if(l.forEach((e=>{const t=this._document.createElement("option");t.value=e.value,t.textContent=e.label,c.appendChild(t)})),this._controls.countSelector=new ye("countSelect",this._controls.footer,c),this._controls.footerControlsWrapper=this._document.createElement("lt-div"),this._controls.footerControlsWrapper.className="lt-dialog__footer__controls-wrapper",this._controls.footer.appendChild(this._controls.footerControlsWrapper),this._eventListeners.push(V(this._controls.countSelector.getSelect(),"change",this._onCountChange.bind(this))),this._uiOptions.disableHelpCenter||this._uiOptions.disableFeedbackForm)if(this._uiOptions.disableFeedbackForm){if(!this._uiOptions.disableHelpCenter){const e={label:Oe.MESSAGES.HELP_CENTER_TOOLTIP,position:"top-right"};this._controls.sendFeedback=new Le("help",null,e,this._controls.footerControlsWrapper),this._controls.footerControlsWrapper.appendChild(this._controls.sendFeedback.getElement()),this._eventListeners.push(V(this._controls.sendFeedback.getElement(),"click",this._gotoHelpCenter.bind(this)))}}else{const e={label:Oe.MESSAGES.SEND_FEEDBACK_TOOLTIP,position:"top-right"};this._controls.sendFeedback=new Le("feedback",null,e,this._controls.footerControlsWrapper),this._controls.footerControlsWrapper.appendChild(this._controls.sendFeedback.getElement()),this._eventListeners.push(V(this._controls.sendFeedback.getElement(),"click",this._showFeedbackForm.bind(this)))}else{const e={label:Oe.MESSAGES.HELP_TOOLTIP,position:"top-right"};this._controls.sendFeedback=new Le("help",null,e,this._controls.footerControlsWrapper),this._controls.footerControlsWrapper.appendChild(this._controls.sendFeedback.getElement());const t=[{className:"help",label:Oe.MESSAGES.HELP_CENTER_TOOLTIP,info:null,tag:null,isClickable:!0,isSelectable:!1},{className:"feedback",label:Oe.MESSAGES.SEND_FEEDBACK_TOOLTIP,info:null,tag:null,isClickable:!0}];this._controls.helpMenu=new Ie("help",t,this._controls.sendFeedback.getElement(),this._controls.innerContainer,"top",!1,null),this._menus.push(this._controls.helpMenu);const n=this._controls.helpMenu.getAllOptions();this._eventListeners.push(V(n[0],"click",this._gotoHelpCenter.bind(this)),V(n[1],"click",this._showFeedbackForm.bind(this)),V(this._controls.helpMenu.getOverlay(),"click",this._onHelpOverlayClick.bind(this)),V(this._controls.sendFeedback.getElement(),"click",this._onHelpIconClick.bind(this)))}if(!this._uiOptions.disableTurnOff){const e={label:Oe.MESSAGES.DISABLE_CHECKING_TOOLTIP,position:"top-right"};this._controls.disableIcon=new Le("disable",null,e,this._controls.footerControlsWrapper);const t=[{className:"pause",label:Oe.MESSAGES.PAUSE_CHECKING_MENU_ITEM,info:null,tag:null,isClickable:!0},{className:"disable",label:Oe.MESSAGES.DISABLE_CHECKING_MENU_ITEM,info:null,tag:null,isClickable:!0}];this._controls.disableMenu=new Ie("disable",t,this._controls.disableIcon.getElement(),this._controls.innerContainer,"top",!1),this._menus.push(this._controls.disableMenu);const n=this._controls.disableMenu.getAllOptions();this._eventListeners.push(V(n[0],"click",this._onPauseCheckingClick.bind(this)),V(n[1],"click",this._onTurnOffClick.bind(this)),V(this._controls.disableMenu.getOverlay(),"click",this._onDisableOverlayClick.bind(this)),V(this._controls.disableIcon.getElement(),"click",this._onDisableIconClicked.bind(this)))}if(!this._uiOptions.disableOptionsPage){const e={label:Oe.MESSAGES.SETTINGS_TOOLTIP,position:"top-right"};this._controls.optionsIcon=new Le("options",null,e,this._controls.footerControlsWrapper),this._eventListeners.push(V(this._controls.optionsIcon.getElement(),"click",this._onOptionsClick.bind(this)))}this._controls.incompleteResult=this._document.createElement("lt-div"),this._controls.incompleteResult.className="lt-dialog__incomplete-result",this._controls.incompleteResult.textContent=Oe.MESSAGES.INCOMPLETE_RESULT,this._controls.footer.appendChild(this._controls.incompleteResult),this._controls.pointer=this._document.createElement("lt-span"),this._controls.pointer.className="lt-dialog__pointer",this._controls.innerContainer.appendChild(this._controls.pointer),this._toolbarContainer.appendChild(this._controls.container),this._toolbarContainer.classList.add("lt-toolbar--dialog-opened"),t.isRuntimeConnected()&&(this._controls.innerContainer.appendChild(this._controls.footer),this._controls.header.appendChild(this._controls.headerControlsWrapper));const d=this._toolbarContainer.querySelector(".lt-toolbar__status-icon-has-notification");d&&d.classList.remove("lt-toolbar__status-icon-has-notification")}))}_position(e=null){const n=this._controls.container.ownerDocument.body.offsetWidth,s=t.isRuntimeConnected()&&this._appearance.isPositionVisible()&&n>400?e||this._uiOptions.dialogPosition:"default";if(this._uiOptions.dialogPosition=s,this._controls.innerContainer.classList.remove("lt-dialog__container--fixed-right"),this._controls.innerContainer.classList.remove("lt-dialog__container--fixed-left"),"default"===s){!this._controls.positionMenu||this._controls.positionMenu.toggleActive(0,!0,!0);let e=this._controls.innerContainer.getBoundingClientRect();const t=document.doctype?this._document.documentElement.clientWidth:Math.min(this._document.documentElement.clientWidth,document.body.clientWidth);e.right>=t-Oe.SPACE_TO_SCREEN_EDGE&&this._alignToBottom(),e=this._controls.innerContainer.getBoundingClientRect();const n=document.doctype?this._document.documentElement.clientHeight:Math.min(this._document.documentElement.clientHeight,document.body.clientHeight);e.bottom>=n&&this._alignToTop(),e=this._controls.innerContainer.getBoundingClientRect(),e.top<=Oe.SPACE_TO_SCREEN_EDGE&&this._alignToBottom(),e.top<0&&!H(document.body)&&!H(document.documentElement)&&this._alignToBottom()}else"right"===s?(!this._controls.positionMenu||this._controls.positionMenu.toggleActive(1,!0,!0),this._controls.innerContainer.style.removeProperty("right"),this._controls.innerContainer.style.removeProperty("left"),this._controls.innerContainer.classList.remove("lt-dialog__container-top"),this._controls.innerContainer.classList.remove("lt-dialog__container-bottom"),this._controls.innerContainer.classList.add("lt-dialog__container--fixed-right")):"left"===s&&(!this._controls.positionMenu||this._controls.positionMenu.toggleActive(2,!0,!0),this._controls.innerContainer.style.removeProperty("right"),this._controls.innerContainer.style.removeProperty("left"),this._controls.innerContainer.classList.remove("lt-dialog__container-top"),this._controls.innerContainer.classList.remove("lt-dialog__container-bottom"),this._controls.innerContainer.classList.add("lt-dialog__container--fixed-left"))}_alignToBottom(){const e=new k(this._document);this._controls.innerContainer.classList.remove("lt-dialog__container-top"),this._controls.innerContainer.classList.add("lt-dialog__container-bottom");const t=this._controls.innerContainer.getBoundingClientRect();if(t.left<=Oe.SPACE_TO_SCREEN_EDGE){const n=parseInt(e.getStyle(this._controls.innerContainer,"right"),10)+t.left-Oe.SPACE_TO_SCREEN_EDGE,s=parseInt(e.getStyle(this._controls.pointer,"right"),10)-t.left+Oe.SPACE_TO_SCREEN_EDGE;e.setStyles(this._controls.innerContainer,{right:n+"px !important",left:"auto !important"}),e.setStyles(this._controls.pointer,{right:s+"px !important",left:"auto !important"})}if(t.right>this._document.documentElement.clientWidth){e.setStyles(this._controls.innerContainer,{right:"0px !important",left:"auto !important"});const n=parseInt(e.getStyle(this._controls.pointer,"right"),10)+(this._controls.innerContainer.getBoundingClientRect().right-t.right);e.setStyles(this._controls.pointer,{right:n+"px !important",left:"auto !important"})}}_alignToTop(){this._controls.innerContainer.classList.remove("lt-dialog__container-bottom"),this._controls.innerContainer.classList.add("lt-dialog__container-top");const e=this._controls.innerContainer.getBoundingClientRect(),t=new k(this._document);if(this._controls.innerContainer.classList.add("lt-dialog__container-hide"),e.right>=this._document.documentElement.clientWidth-Oe.SPACE_TO_SCREEN_EDGE){const n=parseInt(t.getStyle(this._controls.innerContainer,"left"),10)-(e.right-this._document.documentElement.clientWidth)-Oe.SPACE_TO_SCREEN_EDGE,s=parseInt(t.getStyle(this._controls.pointer,"left"),10)+(e.right-this._document.documentElement.clientWidth)+Oe.SPACE_TO_SCREEN_EDGE;t.setStyles(this._controls.innerContainer,{left:n+"px !important",right:"auto !important"}),t.setStyles(this._controls.pointer,{left:s+"px !important",right:"auto !important"})}this._controls.innerContainer.classList.remove("lt-dialog__container-hide")}_removeTeaser(){this._controls.teaserElement&&(this._controls.teaserElement.remove(),this._controls.teaserElement=void 0)}_updateContent(){if(!this._controls.content)return;this.closeAllMenus();const e=this._state.checkStatus;this._controls.content.classList.remove("lt-dialog__has-errors"),this._controls.content.classList.remove("lt-dialog__is-loading"),this._controls.contentMain.innerHTML="",this._controls.contentTop.innerHTML="",this._controls.contentBottom.innerHTML="",this.setCountOptions(this._state.countOptions);const t=(this._inApplyFixMode||this._inInsignificantChangeMode)&&e===Ne.IN_PROGRESS&&this._allDisplyedErrorsCount>0;this._showLoadingBar(t);const n=e===Ne.NEEDS_LANGUAGE_HINT;if(this._controls.languageSelector.toggleHighlight(n),t?(this._renderHeadline(),this._renderCompletedState()):e===Ne.IN_PROGRESS?(this._renderHeadline(),this._renderInProgressState()):e===Ne.COMPLETED?(this._renderHeadline(),this._renderCompletedState()):e===Ne.DISABLED?this._renderDisabledState():e===Ne.TEXT_TOO_SHORT?(this._renderHeadline(),this._renderTextTooShortState(),this._renderPremiumErrorsTeaser()):e===Ne.TEXT_TOO_LONG?(this._renderHeadline(),this._renderTextTooLongState(),this._renderDiscountTimerTeaser()):e===Ne.UNSUPPORTED_LANGUAGE?(this._renderHeadline(),this._renderLanguageUnsupportedState()):e===Ne.DISCONNECTED?this._renderDisconnectedState():e===Ne.FAILED?this._renderFailedState():n&&this._renderNeedsLanguageHintState(),e===Ne.COMPLETED&&this._controls.mainHeadline){this._controls.headerScoreProgressBar.style.width=this._state.textScore+"%",this._controls.textScore.setScore(this._state.textScore);const e=this._state.displayedErrors.length||0,t=this._state.displayedPremiumErrors.length||0;this._allDisplyedErrorsCount=e+t,this._controls.errorsCounter.textContent=this._allDisplyedErrorsCount.toString()}this._position()}_showLoadingBar(e){e!==this._isLoadingBarShown&&(e?this._controls.loadingBar.classList.remove("lt-dialog__footer__loading-bar-container--hidden"):this._controls.loadingBar.classList.add("lt-dialog__footer__loading-bar-container--hidden"),this._isLoadingBarShown=e)}_getCountString(e,n){if(!t.isRuntimeConnected())return"";const i={words:[Oe.MESSAGES.COUNTER_WORDS_OPTION,s.getMessage("dialogCounterWordsSingular"),s.getMessage("dialogCounterWordsPlural",[L(e.counts.words,t.getUILanguageCode())])],sentences:[Oe.MESSAGES.COUNTER_SENTENCES_OPTION,s.getMessage("dialogCounterSentencesSingular"),s.getMessage("dialogCounterSentencesPlural",[L(e.counts.sentences,t.getUILanguageCode())])],characters:[Oe.MESSAGES.COUNTER_CHARACTERS_OPTION,s.getMessage("dialogCounterCharactersSingular"),s.getMessage("dialogCounterCharactersPlural",[L(e.counts.characters,t.getUILanguageCode())])]},o=e.counts[n];return 0===o?i[n][0]:1===o?i[n][1]:i[n][2]}_renderHeadline(){this._controls.mainHeadline=this._document.createElement("lt-div"),this._controls.mainHeadline.classList.add("lt-dialog__content-top__menu"),this._controls.mainHeadline.setAttribute("data-lt-prevent-focus","");const e=this._document.createElement("lt-span");e.className="lt-dialog__main-headline";const t=this._document.createElement("lt-span");t.className="lt-dialog__main-headline__headline",t.textContent=Oe.MESSAGES.REGULAR_MISTAKE_MENU_ITEM,this._controls.errorsCounter=this._document.createElement("lt-span"),this._controls.errorsCounter.className="lt-dialog__main-headline__counter",this._controls.errorsCounter.textContent=this._allDisplyedErrorsCount.toString(),e.appendChild(t),e.appendChild(this._controls.errorsCounter),this._controls.mainHeadline.appendChild(e);const n={label:Oe.MESSAGES.TEXT_SCORE_MENU_ITEM,position:"bottom-right"};this._controls.textScore=new Me("lt-dialog__main-headline__score",this._controls.mainHeadline,n),this._controls.textScore.setScore(this._state.textScore),this._controls.contentTop.appendChild(this._controls.mainHeadline),this._controls.pickyToggle=new we("picky_mode",Oe.MESSAGES.PICKY_MODE_MENU_ITEM,"",this._controls.contentTop),this._controls.pickyToggle.set(this._state.isPickyModeEnabled),this._eventListeners.push(V(this._controls.pickyToggle.getElement(),"click",this._onTogglePickyMode.bind(this)))}_renderInProgressState(){this._controls.content.classList.add("lt-dialog__is-loading");const e=this._document.createElement("lt-div");e.className="lt-dialog-skeleton lt-dialog-skeleton--error-card";const t=this._document.createElement("lt-div");t.className="lt-dialog-skeleton lt-dialog-skeleton--error-card",this._controls.contentMain.appendChild(e),this._controls.contentMain.appendChild(t)}_renderCompletedState(){this._state.displayedErrors&&this._state.displayedErrors.length?this._appearance.canDisplayAllSuggestions()?(this._renderErrors(),this._renderIgnoredErrorsStats()):this._renderScrollHint():this._state.displayedPremiumErrors&&this._state.displayedPremiumErrors.length?(this._removeTeaser(),this._renderPremiumState()):(this._removeTeaser(),this._renderNoErrorsState(),this._renderIgnoredErrorsStats()),this._controls.incompleteResult.classList.toggle("lt-dialog__incomplete-result-show",!!this._state.isIncompleteResult)}_renderErrors(){this._controls.content.classList.add("lt-dialog__has-errors"),this._state.displayedPremiumErrors&&this._state.displayedPremiumErrors.length&&this._renderPremiumErrorsTeaser(),this._state.displayedErrors.forEach((e=>{const t=this._document.createElement("lt-div");t.className="lt-dialog__error-item";const n={label:Oe.MESSAGES.IGNORE_RULE_TOOLTIP,position:"top-right"},s=new Le("trash",null,n,t);this._eventListeners.push(V(s.getElement(),"click",(n=>{e.isSpellingError?this._onTemporarilyIgnoreWordClick(e,n):this._onTemporarilyIgnoreRuleClick(e,n),t.remove()})));const i=this._document.createElement("lt-div");i.className="lt-dialog__error-headline",e.isPicky&&t.classList.add("lt-dialog__error-item--picky-mistake"),e.isCustomError?(i.textContent=e.shortDescription||Oe.MESSAGES.HEADLINE_SUGGESTION_ERROR,t.classList.add("lt-dialog__error-item--custom-suggestion")):e.isSpellingError?(i.textContent=Oe.MESSAGES.HEADLINE_SPELLING_ERROR,t.classList.add("lt-dialog__error-item--spelling-mistake")):e.isStyleError?(i.textContent=e.shortDescription||Oe.MESSAGES.HEADLINE_SUGGESTION_ERROR,t.classList.add("lt-dialog__error-item--style-suggestion")):e.isPunctuationError?(i.textContent=e.shortDescription||Oe.MESSAGES.HEADLINE_PUNCTUATION_ERROR,t.classList.add("lt-dialog__error-item--punctuation-mistake")):(i.textContent=e.shortDescription||Oe.MESSAGES.HEADLINE_GRAMMAR_ERROR,t.classList.add("lt-dialog__error-item--grammar-mistake")),t.append(i),t.addEventListener("mouseenter",(()=>this._onErrorHighlighted(e.id))),t.addEventListener("mouseleave",(()=>this._onErrorHighlighted(null)));const o=this._document.createElement("lt-div");o.className="lt-dialog__original-phrase",t.appendChild(o);const r=this._document.createElement("lt-div");r.className="lt-dialog__original-phrase__header",o.appendChild(r);const a=this._document.createElement("lt-div");a.className="lt-dialog__original-phrase__header__title",a.textContent=e.originalPhrase,r.appendChild(a);const l=new Le("scroll-to-link",Oe.MESSAGES.SCROLL_TO_LINK,null,r);this._eventListeners.push(V(l.getElement(),"click",(t=>{this._onErrorSelected(e.id)})));const c=this._document.createElement("lt-div");c.className="lt-dialog__original-phrase__long-context-phrase",c.innerHTML=e.longContextPhrase,o.appendChild(c),this._renderFixes(e,t),this._renderDescription(e,t),this._renderActions(e,t),this._controls.contentMain.appendChild(t)}))}_renderFixes(e,t){const n=this._document.createElement("lt-div");n.className="lt-dialog__fix-container",t.appendChild(n);const s=Math.min(e.fixes.length,i.MAX_FIXES_COUNT);for(let i=0;i<s;i++){const o=e.fixes[i],r=this._document.createElement("lt-div");if(r.title=o.shortDescription||"",r.className="lt-dialog__fix",r.setAttribute("data-lt-prevent-focus",""),!o.value.startsWith(" ")&&!o.value.endsWith(" ")||["FALSCHE_VERWENDUNG_DES_BINDESTRICHS"].includes(e.rule.id)){const t=o.value.replace(Oe.NARROW_WHITESPACE_REGEXP," ");s>3&&e.isSpellingError?r.textContent=t:(r.classList.add("lt-dialog__fix--highlighted"),r.innerHTML=me(Se(e.originalPhrase,t)))}else r.textContent=o.value.replace(Oe.TRAILING_WHITESPACE_REGEXP,"·");""===o.value&&e.originalPhrase.match(/[a-z0-9]{2,}/)?(r.classList.add("lt-dialog__fix--strikethrough"),r.classList.remove("lt-dialog__fix--highlighted"),r.textContent=e.originalPhrase):""===o.value&&(r.classList.add("lt-dialog__fix--delete"),r.classList.remove("lt-dialog__fix--highlighted"),r.textContent=Oe.MESSAGES.DELETE),this._eventListeners.push(V(r,"click",(n=>{this._onFixClick(e,i,n),t.remove()}))),n.appendChild(r);const a=ue(e,o.value);if(this._uiOptions.canCorrectMultipleErrorsAtOnce&&ge(this._state.errors,e)&&a){const t=this._document.createElement("lt-span");t.classList.add("lt-dialog__fix--correct-all"),t.innerHTML=a.suggestion.message;const s=this._onCorrectAll.bind(this,e,a);this._eventListeners.push(V(t,"click",s)),n.appendChild(t),n.appendChild(this._document.createElement("br"))}o.value.length>=14&&t.classList.add("lt-dialog__long-fix")}}_renderActions(e,t){if(e.isSpellingError){if(!this._uiOptions.disableAddingWord&&!u(e.originalPhrase)){const n=this._document.createElement("lt-div");n.classList.add("lt-dialog__add-to-dictionary","lt-icon__dictionary"),n.setAttribute("data-lt-prevent-focus",""),n.textContent=s.getMessage("addToDictionaryCaption",e.originalPhrase),this._eventListeners.push(V(n,"click",(n=>{this._onAddToDictionaryClick(e,n),t.remove()}))),t.appendChild(n)}}else if(!this._uiOptions.disableIgnoringRule&&!e.isCustomError){const n=this._document.createElement("lt-div");n.classList.add("lt-dialog__ignore-rule"),n.classList.add("lt-icon__ignore"),n.setAttribute("data-lt-prevent-focus",""),n.classList.add("lt-icon__ignore"),n.textContent=s.getMessage("turnOffRule"),this._eventListeners.push(V(n,"click",(n=>{this._onIgnoreRuleClick(e,n),t.remove()}))),t.appendChild(n)}}_renderDescription(e,t){const n=this._document.createElement("lt-div");if(n.className="lt-dialog__error-text",n.setAttribute("data-lt-prevent-focus",""),n.textContent=e.description,t.append(n),e.rule.urls&&e.rule.urls.length>0){const t=this._document.createElement("lt-span");t.classList.add("lt-dialog__more-details","lt-icon__info"),t.setAttribute("data-lt-prevent-focus",""),t.title=s.getMessage("moreDetails"),this._eventListeners.push(V(t,"click",(t=>{this._onMoreDetailsClick(e.rule.urls[0],t)}))),n.appendChild(t)}}_renderScrollHint(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__scroll-hint__headline",t.textContent=Oe.MESSAGES.SCROLL_HINT_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__scroll-hint__text",n.textContent=Oe.MESSAGES.SCROLL_HINT_TEXT,e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e),this._shouldShowRatingTeaser?this._renderRatingTeaser():this._renderPremiumErrorsTeaser()}_renderTextTooShortState(){this._removeTeaser();const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__text-too-short__headline",t.innerHTML=Oe.MESSAGES.TEXT_TOO_SHORT_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__text-too-short__text",n.innerHTML=Oe.MESSAGES.TEXT_TOO_SHORT_TEXT,e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e)}_renderNoErrorsState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__no-errors__headline",t.textContent=Oe.MESSAGES.NO_ERRORS;const n=this._document.createElement("lt-div");n.className="lt-dialog__no-errors__text",n.textContent=Oe.MESSAGES.NO_ERRORS_TEXT,e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e),this._shouldShowRatingTeaser?this._renderRatingTeaser():this._renderPremiumErrorsTeaser()}_renderIgnoredErrorsStats(){if(!this._state.ignoredErrorsStats)return;if(0===this._state.ignoredErrorsStats.byDictionary&&0===this._state.ignoredErrorsStats.byRules)return;const e=this._document.createElement("lt-div");if(this._state.displayedErrors&&this._state.displayedErrors.length?e.className="lt-dialog__ignored-errors-item":e.className="lt-dialog__ignored-errors-message",this._state.ignoredErrorsStats.byDictionary>0&&!this._uiOptions.disableAddingWord){const t=1===this._state.ignoredErrorsStats.byDictionary?"errorsIgnoredByDictionarySingular":"errorsIgnoredByDictionary",n=s.getMessage(t,[this._state.ignoredErrorsStats.byDictionary]),i=document.createElement("lt-span");i.textContent=n,i.dataset.type="byDictionary",e.appendChild(i)}if(this._state.ignoredErrorsStats.byRules>0&&!this._uiOptions.disableIgnoringRule){if(this._state.ignoredErrorsStats.byDictionary>0){const t=document.createElement("lt-span");t.textContent=", ",e.appendChild(t)}const t=1===this._state.ignoredErrorsStats.byRules?"errorsIgnoredByRulesSingular":"errorsIgnoredByRules",n=s.getMessage(t,[this._state.ignoredErrorsStats.byRules]),i=document.createElement("lt-span");i.textContent=n,i.dataset.type="byRules",e.appendChild(i)}this._controls.contentMain.appendChild(e),this._eventListeners.push(V(e,"click",this._onIgnoredErrorsClick.bind(this)))}_renderRatingTeaser(){new Re(this._controls.contentBottom,"dialog",b().substr(0,150))}_renderPremiumErrorsTeaser(){this._controls.teaserElement||t.isRuntimeConnected()&&M.create().onReady((e=>{if(e.getUIState().hasPaidSubscription)return;const t=oe(e.getStatistics());e.startChangelogCoupon();const n=e.getActiveCoupon();if(this._state.displayedPremiumErrors.length){const e=this._state.displayedPremiumErrors.filter((e=>!e.isStyleError&&!e.isPunctuationError)).length,t=this._state.displayedPremiumErrors.filter((e=>e.isPunctuationError)).length,n=this._state.displayedPremiumErrors.filter((e=>e.isStyleError)).length,i="dialog:premium_teaser",o=1===e+t+n?s.getMessage("premiumErrorsTextSingular"):s.getMessage("premiumErrorsTextPlural",[this._state.displayedPremiumErrors.length]),r=s.getMessage("premiumErrorsButton");this._premiumTeaser=new xe(this._controls.contentTop,i,null,o,r,{campaign:"addon2-dialog-premium-errors",hiddenGrammarMatches:e,hiddenStyleMatches:n,hiddenPunctuationMatches:t,textLanguage:this._languageCode||void 0})}else if(t.hiddenErrorsCount>5){const e="dialog:historic_premium_teaser",n=s.getMessage("historicPremiumErrorsHeadline"),i=s.getMessage("historicPremiumErrorsText2",[t.hiddenErrorsCount,t.dayCount]),o=s.getMessage("historicPremiumErrorsButton");this._premiumTeaser=new xe(this._controls.contentBottom,e,n,i,o,{campaign:"addon2-dialog-historic-premium-errors",historicMatches:t.hiddenErrorsCountStr})}else if(n){const e="dialog:premium_teaser";this._premiumTeaser=new xe(this._controls.contentBottom,e,null,null,null,{campaign:"addon2-dialog"})}e.destroy()}))}_renderDiscountTimerTeaser(){M.create().onReady((e=>{e.startChangelogCoupon();if(e.getActiveCoupon()){const e="dialog:premium_teaser";this._premiumTeaser=new xe(this._controls.contentBottom,e,null,null,null,{campaign:"addon2-dialog-premium"})}e.destroy()}))}_renderPremiumState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__premium__headline",t.textContent=1===this._state.displayedPremiumErrors.length?s.getMessage("dialogPremiumHeadlineSingular"):s.getMessage("dialogPremiumHeadlinePlural",[this._state.displayedPremiumErrors.length]);const n=this._document.createElement("lt-div");n.className="lt-dialog__premium__text",n.textContent=s.getMessage("dialogPremiumText");const i=this._document.createElement("lt-div");i.className="lt-dialog__premium__button lt-icon__new_window",i.textContent=s.getMessage("dialogPremiumButton");let o="addon2-dialog-premium";this._eventListeners.push(V(i,"click",(e=>{e.stopImmediatePropagation();const t={dialog:this,campaign:o};K(document,Oe.eventNames.premiumTeaserClicked,t),w.trackEvent("Action","dialog:premium:click")}))),e.appendChild(t),e.appendChild(n),e.appendChild(i),this._controls.contentMain.appendChild(e),M.create().onReady((e=>{e.startChangelogCoupon();e.getActiveCoupon()&&(o=o.replace("addon2","addon2-changelog"),this._premiumTeaser=new xe(this._controls.contentBottom,"dialog:premium_teaser",null,null,null,{campaign:o})),e.destroy()}))}_renderDisabledState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__enable-text__headline",t.textContent=Oe.MESSAGES.ENABLE_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__enable-text__text",n.textContent=Oe.MESSAGES.ENABLE_TEXT;const s=this._document.createElement("lt-div");s.className="lt-dialog__enable-everywhere",s.innerHTML=Oe.MESSAGES.ENABLE_EVERYWHERE_BUTTON,this._eventListeners.push(V(s,"click",this._enableEverywhere.bind(this)));const i=this._document.createElement("lt-div");i.className="lt-dialog__enable-here",i.innerHTML=Oe.MESSAGES.ENABLE_HERE_BUTTON,this._eventListeners.push(V(i,"click",this._enableHere.bind(this))),e.appendChild(t),e.appendChild(n),e.appendChild(s),e.appendChild(i),this._controls.contentMain.appendChild(e)}_renderTextTooLongState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__premium__headline",t.textContent=Oe.MESSAGES.TEXT_TOO_LONG_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__premium__text",n.textContent=Oe.MESSAGES.TEXT_TOO_LONG_TEXT;const s=this._document.createElement("lt-div");s.className="lt-dialog__premium__button lt-icon__new_window",s.textContent=Oe.MESSAGES.TEXT_TOO_LONG_BUTTON;let i="addon2-dialog-text-too-long";M.create().onReady((e=>{e.getActiveCoupon()&&(i=i.replace("addon2-dialog","addon2-changelog")),e.destroy()})),this._eventListeners.push(V(s,"click",(e=>{e.stopImmediatePropagation();const t={command:"OPEN_PREMIUM_PAGE",campaign:i};browser.runtime.sendMessage(t),w.trackEvent("Action","dialog:text_too_long:click")}))),e.appendChild(t),e.appendChild(n),e.appendChild(s),this._controls.contentMain.appendChild(e)}_renderLanguageUnsupportedState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const n=this._document.createElement("lt-div");n.className="lt-dialog__language-unsupported__headline",n.textContent=Oe.MESSAGES.UNSUPPORTED_LANGUAGE_HEADLINE;const s=this._document.createElement("lt-div");if(s.className="lt-dialog__language-unsupported__text",s.textContent=Oe.MESSAGES.UNSUPPORTED_LANGUAGE_TEXT,e.appendChild(n),e.appendChild(s),this._controls.contentMain.appendChild(e),this._controls.languageSelector){const e=this._document.createElement("option");e.disabled=!0,e.selected=!0,e.textContent=Oe.MESSAGES.UNSUPPORTED_LANGUAGE_LABEL,this._controls.languageSelector.addOption(e);const n=t.getURL("/assets/images/flags/not_found.svg");this._controls.languageSelector.setActive(Oe.MESSAGES.SELECT_LANGUAGE_LABEL,"",{"background-image":`url('${n}') !important`})}}_renderDisconnectedState(){this._controls.footer.remove(),this._controls.headerControlsWrapper.remove();const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.innerHTML=Oe.MESSAGES.EXTENSION_UPDATED_HEADLINE,t.className="lt-dialog__reload-headline",this._controls.contentMain.appendChild(t);const n=this._document.createElement("lt-div");n.innerHTML=Oe.MESSAGES.EXTENSION_UPDATED_TEXT,n.className="lt-dialog__reload__text",this._controls.contentMain.appendChild(n),e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e)}_renderFailedState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__exception-headline",t.textContent=Oe.MESSAGES.Fail_STATE_HEADLINE,e.appendChild(t);const n=this._document.createElement("lt-div");n.className="lt-dialog__exception__text",n.textContent=this._state.checkErrorMessage||Oe.MESSAGES.Fail_STATE_TEXT,e.appendChild(n),this._controls.contentMain.appendChild(e)}_renderNeedsLanguageHintState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__needs-language-hint__headline",t.textContent=Oe.MESSAGES.NEEDS_LANGUAGE_HINT_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__needs-language-hint__text",n.textContent=Oe.MESSAGES.NEEDS_LANGUAGE_HINT_TEXT;const s=this._document.createElement("lt-div");s.className="lt-dialog__needs-language-hint__button",s.textContent=Oe.MESSAGES.NEEDS_LANGUAGE_HINT_IGNORE,e.appendChild(t),e.appendChild(n),e.appendChild(s),this._controls.contentMain.appendChild(e),this._eventListeners.push(V(s,"click",(()=>{const e={dialog:this,language:this._controls.languageSelector.getValue()};w.trackEvent("Action","dialog:ignore_language_hint"),K(document,Oe.eventNames.languageChanged,e)})))}_onUnload(){this.destroy()}_onKeydown(e){"Escape"===e.key&&(this.destroy(),e.stopImmediatePropagation())}_onLanguageChange(e){e.stopImmediatePropagation();const t={dialog:this,language:this._controls.languageSelector.getValue()};this.setCurrentLanguage(this._controls.languageSelector.getValue()),K(document,Oe.eventNames.languageChanged,t)}_onTogglePickyMode(e){e.stopImmediatePropagation(),this._state.isPickyModeEnabled=!this._state.isPickyModeEnabled,this.setInsignificantChangeMode(!1);const t={dialog:this,isEnabled:this._state.isPickyModeEnabled};K(document,Oe.eventNames.togglePickyMode,t)}_onCountChange(e){e.stopImmediatePropagation(),this._state.countOptions.mode=this._controls.countSelector.getValue(),this.setCountOptions(this._state.countOptions);const t={dialog:this,countMode:this._controls.countSelector.getValue()};K(document,Oe.eventNames.countChanged,t)}_onCloseClick(e){e.stopImmediatePropagation(),this._onUnload()}_onHelpIconClick(e){e.stopImmediatePropagation(),this._controls.helpMenu.show()}_onHelpOverlayClick(e){e.stopImmediatePropagation(),this._controls.helpMenu.hide()}_onPositionIconClick(e){e.stopImmediatePropagation(),this._controls.positionMenu.show()}_onPositionOverlayClick(e){e.stopImmediatePropagation(),this._controls.positionMenu.hide()}_onPositionRightClick(e){e.stopImmediatePropagation();const t={dialog:this,newPosition:"right"};this._controls.positionMenu.hide(),this._controls.positionIcon.setIcon("right"),this._position("right"),K(document,Oe.eventNames.positionChangeClicked,t)}_onPositionLeftClick(e){e.stopImmediatePropagation();const t={dialog:this,newPosition:"left"};this._controls.positionMenu.hide(),this._controls.positionIcon.setIcon("left"),this._position("left"),K(document,Oe.eventNames.positionChangeClicked,t)}_onPositionDialogClick(e){e.stopImmediatePropagation();const t={dialog:this,newPosition:"default"};this._controls.positionMenu.hide(),this._controls.positionIcon.setIcon("default"),this._position("default"),K(document,Oe.eventNames.positionChangeClicked,t)}_onSaveTextClick(e){e.stopImmediatePropagation()}_onTurnOffClick(e){e.stopImmediatePropagation();const t={dialog:this};K(document,Oe.eventNames.turnOff,t)}_onPauseCheckingClick(e){e.stopImmediatePropagation();const t={dialog:this};K(document,Oe.eventNames.pauseChecking,t)}_onDisableIconClicked(e){e.stopImmediatePropagation(),this._controls.disableMenu.show()}_onDisableOverlayClick(e){e.stopImmediatePropagation(),this._controls.disableMenu.hide()}_onBadgeClicked(e){e.stopImmediatePropagation();const t={dialog:this};K(document,Oe.eventNames.badgeClicked,t)}_onOptionsClick(e){e.stopImmediatePropagation();const t={dialog:this};K(document,Oe.eventNames.openOptions,t)}_onContentScroll(e){this._controls.content.scrollTop>50?this._controls.headerScoreProgress.classList.add("show"):this._controls.headerScoreProgress.classList.remove("show")}_onIgnoredErrorsClick(e){e.stopImmediatePropagation();let t="personalDictionary";if(e.target){const n=e.target;n.dataset&&"byRules"===n.dataset.type&&(t="ignoredRules")}const n={dialog:this,target:t,ref:"dialog-ignored-errors"};K(document,Oe.eventNames.openOptions,n)}_gotoLanguageTool(n){n.stopImmediatePropagation();let s="https://languagetool.org/?pk_campaign=addon2-dialog";e.isSafari()&&(s+="&hidePremium=true"),t.openWindow(s)}_gotoHelpCenter(e){e.stopImmediatePropagation(),this._controls.helpMenu.hide(),t.openWindow("https://languagetooler.freshdesk.com/support/home")}_showFeedbackForm(e){e.stopImmediatePropagation();const t={dialog:this};this._controls.helpMenu.hide(),K(document,Oe.eventNames.showFeedbackForm,t)}_onErrorHighlighted(e){const t={dialog:this,errorId:e};K(document,Oe.eventNames.errorHighlighted,t)}_onErrorSelected(e){const t={dialog:this,errorId:e};K(document,Oe.eventNames.errorSelected,t)}_onMoreDetailsClick(e,t){t.stopImmediatePropagation();const n={dialog:this,url:e.value};K(document,Oe.eventNames.moreDetailsClicked,n)}_onCorrectAll(e,t,n){n.stopImmediatePropagation();const s={dialog:this,config:t,selectedError:e};K(document,Oe.eventNames.correctAll,s)}_onFixClick(e,t,n){n.stopImmediatePropagation(),this._inApplyFixMode=!0;const s={dialog:this,error:e,fixIndex:t,selectNextError:!1};K(document,Oe.eventNames.fixSelected,s)}_onAddToDictionaryClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e,selectNextError:!1};K(document,Oe.eventNames.addToDictionaryClicked,n)}_onIgnoreRuleClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e,selectNextError:!1};K(document,Oe.eventNames.ignoreRuleClicked,n)}_onTemporarilyIgnoreWordClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e,selectNextError:!1};K(document,Oe.eventNames.temporarilyIgnoreWordClicked,n)}_onTemporarilyIgnoreRuleClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e,selectNextError:!1};K(document,Oe.eventNames.temporarilyIgnoreRuleClicked,n)}_enableEverywhere(e){e.stopImmediatePropagation();const t={dialog:this};K(document,Oe.eventNames.enableEverywhere,t)}_enableHere(e){e.stopImmediatePropagation();const t={dialog:this};K(document,Oe.eventNames.enableHere,t)}getCurrentPosition(){return this._uiOptions.dialogPosition}updateState(e){f(this._state,e)||(this._state=Object.assign(this._state||{},e),this._updateContent())}setCurrentLanguage(e){if(!t.isRuntimeConnected())return;e=e.toLowerCase();const n=x.LANGUAGES.find((t=>t.code===e))||x.LANGUAGES.find((t=>e.startsWith(t.code)))||x.LANGUAGES.find((e=>"en-us"===e.code)),s=t.getURL("/assets/images/flags/"+n.code+".svg");this._controls.languageSelector&&this._controls.languageSelector.setActive(this._shortenLanguageName(n.name),n.code,{"background-image":`url('${s}') !important`})}_shortenLanguageName(e){return e.split(" ",1)[0]}setCountOptions(e){this._controls.countSelector&&(this._controls.countSelector.setActive(this._getCountString(e,e.mode),e.mode,{}),this._controls.countSelector.updateOptionLable("characters",this._getCountString(e,"characters")),this._controls.countSelector.updateOptionLable("sentences",this._getCountString(e,"sentences")),this._controls.countSelector.updateOptionLable("words",this._getCountString(e,"words")))}setInsignificantChangeMode(e){this._inInsignificantChangeMode=e}setApplyFixMode(e){this._inApplyFixMode=e}closeAllMenus(){this._menus.forEach((e=>{e.hide()}))}fadeOut(){this._controls.innerContainer.classList.add("lt-dialog--faded")}fadeIn(){this._controls.innerContainer.classList.remove("lt-dialog--faded")}destroy(){!function(e,t){let n=1;const s=new k(e.ownerDocument),i=P((()=>{if(n-=.08,n<=0)return e.remove(),i.destroy(),void(t&&t());s.setStyles(e,{opacity:n+" !important"})}),16)}(this._controls.container,(()=>{this._toolbarContainer.classList.remove("lt-toolbar--dialog-opened")})),this._controls={},window.removeEventListener("pagehide",this._onUnload,!0),this._eventListeners.forEach((e=>{e.destroy()})),this._eventListeners=[];const e={dialog:this};this._premiumTeaser&&this._premiumTeaser.destroy(),K(document,Oe.eventNames.destroyed,e)}}Oe.CONTAINER_ELEMENT_NAME="lt-dialog",Oe.SPACE_TO_SCREEN_EDGE=5,Oe.TRAILING_WHITESPACE_REGEXP=/^ | $/g,Oe.NARROW_WHITESPACE_REGEXP=/\u202F/g,Oe.eventNames={turnOff:"lt-dialog.turnOff",pauseChecking:"lt-dialog.pauseChecking",enableHere:"lt-dialog.enableHere",enableEverywhere:"lt-dialog.enableEverywhere",languageChanged:"lt-dialog.languageChanged",countChanged:"lt-dialog.countChanged",errorSelected:"lt-dialog.errorSelected",errorHighlighted:"lt-dialog.errorHighlighted",addToDictionaryClicked:"lt-dialog.addToDictionaryClicked",ignoreRuleClicked:"lt-dialog.ignoreRuleClicked",temporarilyIgnoreWordClicked:"lt-dialog.temporarilyIgnoreWordClicked",temporarilyIgnoreRuleClicked:"lt-dialog.temporarilyIgnoreRuleClicked",moreDetailsClicked:"lt-dialog.moreDetailsClicked",fixSelected:"lt-dialog.fixSelected",openOptions:"lt-dialog.openOptions",showFeedbackForm:"lt-dialog.showFeedbackForm",destroyed:"lt-dialog.destroyed",togglePickyMode:"lt-dialog.togglePickyMode",positionChangeClicked:"lt-dialog.positionChangeClicked",badgeClicked:"lt-dialog.badgeClicked",premiumTeaserClicked:"lt-dialog.premiumTeaserClicked",correctAll:"lt-dialog.correctAll"},Oe._isInitialized=!1;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Pe{constructor(e,t,n,s,i){this._renderOutsideIframe=!1,this._inputArea=e,this._error=n,this._tweaks=s,this._uiOptions=i,this._referenceArea=e,this._keyboardEventTarget=this._tweaks.getKeyboardEventTarget(),this._document=this._inputArea.ownerDocument,this._isHiddenMatch="HIDDEN_RULE"===n.rule.id,this._buttons=[];const o=window.frameElement;o&&this._inputArea===this._inputArea.ownerDocument.body&&function(e){try{return e.document.documentElement.hasAttribute("data-lt-installed")}catch(e){}return!1}(window.parent)&&(this._referenceArea=o,this._document=this._referenceArea.ownerDocument,this._renderOutsideIframe=!0,this._onPageHide=this._onPageHide.bind(this),window.addEventListener("pagehide",this._onPageHide,!0)),this._domMeasurement=new k(this._document),this._eventListeners=[],this._render(t),this._uiOptions.enableKeyboard&&this._buttons.length&&(this._focusedButtonIndex=0,this._updateFocus())}static _cacheMessages(){Pe.MESSAGES={HEADLINE_SPELLING_ERROR:s.getMessage("spellingError"),HEADLINE_HIDDEN_MATCH:s.getMessage("hiddenMatchHeadline"),HEADLINE_CUSTOM_SUGGESTION_ERROR:s.getMessage("customSuggestionError"),HEADLINE_SUGGESTION_ERROR:s.getMessage("suggestionError"),HEADLINE_PUNCTUATION_ERROR:s.getMessage("punctuationError"),HEADLINE_GRAMMAR_ERROR:s.getMessage("grammarError"),LINK_MORE_DETAILS:s.getMessage("moreDetails"),LINK_IGNORE_RULE:s.getMessage("turnOffRule"),LINK_IGNORE_RULE_PICKY:s.getMessage("turnOffRulePicky"),LINK_IGNORE_HERE:s.getMessage("ignoreHere"),TURN_OFF_PICKY_MODE:s.getMessage("turnOffPickyMode"),EN_US_LINK:s.getMessage("switchToAmericanEnglish"),EN_CA_LINK:s.getMessage("switchToCanadianEnglish"),EN_AU_LINK:s.getMessage("switchToAustralianEnglish"),EN_NZ_LINK:s.getMessage("switchToNewZealandEnglish"),EN_ZA_LINK:s.getMessage("switchToSouthAfricanEnglish"),EN_GB_LINK:s.getMessage("switchToBritishEnglish"),DELETE:s.getMessage("deleteWord"),REMOVE_EXTRA_WHITESPACE:s.getMessage("removeExtraWhitespace"),PREMIUM_TEXT:s.getMessage("suggestionOnlyVisibleToPremiumText"),PREMIUM_BUTTON:s.getMessage("suggestionOnlyVisibleToPremiumButton"),KEYBOARD_INSTRUCTIONS:s.getMessage("errorCardKeyboardInstructions",["<lt-em>Enter</lt-em>","<lt-em>&#8679;</lt-em> <lt-em>Enter</lt-em>"])}}static init(){Pe._isInitialized||(Pe._cacheMessages(),s.addEventListener(n.eventNames.localeChanged,Pe._cacheMessages.bind(Pe)),Pe._isInitialized=!0)}_render(e){this._container=G(this._document,Pe.CONTAINER_ELEMENT_NAME),this._container.style.display="none",this._container.setAttribute("data-lt-adjust-appearance","true"),this._container.classList.add("lt-error-card"),this._container.addEventListener("click",(e=>e.stopPropagation())),!function(e){let t=20,n=e;for(;--t;){const e=window.getComputedStyle(n);if(e.backgroundImage&&"none"!==e.backgroundImage)return!1;const t=e.backgroundColor;if(t&&"transparent"!==t&&se(t)>=.25)return ie(t)<=35;if(!n.parentElement)return!1;n=n.parentElement}return!1}(this._inputArea)?this._container.setAttribute("data-lt-force-appearance","light"):this._container.setAttribute("data-lt-force-appearance","dark"),this._eventListeners.push(V(this._keyboardEventTarget,"keydown",this._onKeyDown.bind(this)),V(this._container,"mousedown",(e=>{e.stopImmediatePropagation(),e.target&&!e.target.closest(".lt-errorcard__text, .lt-card__headline")&&e.preventDefault()})),V(this._container,"mouseup",(e=>e.stopImmediatePropagation())),V(this._container,"pointerdown",(e=>e.stopImmediatePropagation())),V(this._container,"pointerup",(e=>e.stopImmediatePropagation())));const t=this._document.createElement("lt-div");t.classList.add("lt-card__container"),t.classList.add("lt-card__container--error-card"),t.classList.add("notranslate"),this._renderContent(t);const n=this._document.createElement("lt-span");n.className="lt-card__close-button lt-icon__close_small",this._eventListeners.push(V(n,"click",this._onCloseClicked.bind(this))),t.appendChild(n),this._container.appendChild(t);const s=this._domMeasurement.getDocumentVisibleBox(),i=this._document.elementFromPoint(e.left-s.left+10,e.bottom-s.top+10),o=i&&!this._inputArea.contains(i),r="BODY"===this._referenceArea.nodeName?this._document.documentElement:this._document.body;r.appendChild(this._container),this._domMeasurement.clearCache();const a=this._domMeasurement.getBorderBox(t);if(this._renderOutsideIframe){let t=document.createElement("lt-span");t.style.position="absolute",t.style.left=e.left+"px",t.style.top=e.top+"px",document.documentElement.appendChild(t);const n=t.getBoundingClientRect();t.remove(),t=null;const s=new k(this._document).getContentBox(this._referenceArea);e.left=s.left+n.left,e.top=s.top+n.top,e.bottom=s.top+n.top+e.height,e.right=s.left+n.left+e.width}let l=Math.min(e.left,s.width-a.width),c=e.bottom+5;const d=a.height<e.top;(c+a.height>s.bottom||o&&d)&&(c=Math.max(s.top,e.top-a.height-5));const h=this._domMeasurement.getScaleFactor(r),_=this._domMeasurement.getZoom(r);l/=h.x*_,c/=h.y*_,t.style.left=Math.round(l)+"px",t.style.top=Math.round(c)+"px"}_renderContent(e){const t=this._document.createElement("lt-div");if(t.classList.add("lt-card__headline"),this._isHiddenMatch&&"test2"===this._uiOptions.showHiddenMatchesInplace?(t.textContent=Pe.MESSAGES.HEADLINE_HIDDEN_MATCH,e.classList.add("lt-card__container--hidden-mistake")):this._error.isCustomError?(t.textContent=this._error.shortDescription||Pe.MESSAGES.HEADLINE_CUSTOM_SUGGESTION_ERROR,e.classList.add("lt-card__container--custom-suggestion")):this._error.isSpellingError?(t.textContent=Pe.MESSAGES.HEADLINE_SPELLING_ERROR,e.classList.add("lt-card__container--spelling-mistake")):this._error.isStyleError?(t.textContent=this._error.shortDescription||Pe.MESSAGES.HEADLINE_SUGGESTION_ERROR,e.classList.add("lt-card__container--style-suggestion")):this._error.isPunctuationError?(t.textContent=this._error.shortDescription||Pe.MESSAGES.HEADLINE_PUNCTUATION_ERROR,e.classList.add("lt-card__container--punctuation-mistake")):(t.textContent=this._error.shortDescription||Pe.MESSAGES.HEADLINE_GRAMMAR_ERROR,e.classList.add("lt-card__container--grammar-mistake")),e.appendChild(t),this._error.isPicky&&!this._isHiddenMatch&&e.classList.add("lt-card__container--picky-mistake"),this._isHiddenMatch){const t=this._document.createElement("lt-div");t.textContent=Pe.MESSAGES.PREMIUM_TEXT,t.className="lt-errorcard__premium-text";const n=this._document.createElement("lt-div");n.textContent=Pe.MESSAGES.PREMIUM_BUTTON,n.className="lt-errorcard__premium-button",this._eventListeners.push(V(n,"click",(e=>{e.stopImmediatePropagation();const t={errorCard:this,campaign:"addon2-errorcard-match"};K(document,Pe.eventNames.premiumTeaserClicked,t)}))),e.append(t),e.append(n)}else{const t=this._document.createElement("lt-div");if(t.classList.add("lt-errorcard__text"),t.textContent=this._error.description,e.appendChild(t),this._error.rule.urls&&this._error.rule.urls.length>0){const e=this._document.createElement("lt-span");e.classList.add("lt-errorcard__more-details"),e.classList.add("lt-icon__info"),e.title=Pe.MESSAGES.LINK_MORE_DETAILS,this._eventListeners.push(V(e,"click",this._onMoreDetailsClick.bind(this))),t.appendChild(e)}}this._renderFixes(e),this._renderKeyboardInstructuions(e),this._renderActions(e),this._renderFooter(e)}_renderFixes(e){if(this._error.fixes.length){const t=this._document.createElement("lt-div");t.classList.add("lt-errorcard__suggestion-wrapper");const n=Math.min(this._error.fixes.length,i.MAX_FIXES_COUNT);for(let e=0;e<n;e++){const n=this._error.fixes[e],s=this._document.createElement("lt-span");if(s.classList.add("lt-errorcard__suggestion"),!n.value.startsWith(" ")&&!n.value.endsWith(" ")||["FALSCHE_VERWENDUNG_DES_BINDESTRICHS"].includes(this._error.rule.id)){const e=n.value.replace(Pe.NARROW_WHITESPACE_REGEXP," ");this._error.fixes.length>3&&this._error.isSpellingError?s.textContent=e:(s.classList.add("lt-errorcard__suggestion--highlighted"),s.innerHTML=me(Se(this._error.originalPhrase,e)))}else s.textContent=n.value.replace(Pe.TRAILING_WHITESPACE_REGEXP,"·");if(""===n.value&&this._error.originalPhrase.match(/[a-z0-9]{2,}/)?(s.classList.remove("lt-errorcard__suggestion--highlighted"),s.classList.add("lt-errorcard__suggestion--strikethrough"),s.textContent=this._error.originalPhrase):""===n.value?(s.classList.remove("lt-errorcard__suggestion--highlighted"),s.classList.add("lt-errorcard__suggestion--delete"),s.textContent=Pe.MESSAGES.DELETE):" "===n.value&&/^\s\s+$/.test(this._error.originalPhrase)&&(s.className="lt-errorcard__suggestion--optional",s.textContent=Pe.MESSAGES.REMOVE_EXTRA_WHITESPACE),n.suffix){const e=this._document.createElement("lt-span");e.textContent=n.suffix,e.classList.add("lt-card__hint"),s.append(e)}else if(n.prefix){const e=this._document.createElement("lt-span");e.classList.add("lt-card__hint"),s.prepend(e)}s.title=n.shortDescription||"";const i=this._onFixClick.bind(this,e);this._eventListeners.push(V(s,"click",i)),t.appendChild(s),this._buttons.push({element:s,onSelect:i});const o=ue(this._error,n.value);if(this._uiOptions.canCorrectMultipleAtOnce&&o){const e=this._onCorrectAll.bind(this,o),n=this._document.createElement("lt-span");n.classList.add("lt-errorcard__suggestion--correct-all"),n.innerHTML=o.suggestion.message,this._eventListeners.push(V(n,"click",e)),t.appendChild(n),t.appendChild(this._document.createElement("br")),this._buttons.push({element:n,onSelect:e})}}if(1===this._error.fixes.length&&(this._error.description.match(/i[ns]\s+(chiefly\s)?((North\s)?American|British)\s+English/)||"EN_GB_SIMPLE_REPLACE"===this._error.rule.id)){const e=this._document.createElement("lt-span");e.classList.add("lt-errorcard__suggestion--optional");let n=null;if(this._error.description.match(/is\s+(chiefly\s)?British English/)?"CA"===this._uiOptions.geoIpCountry?(n="en-ca",e.textContent=Pe.MESSAGES.EN_CA_LINK):"AU"===this._uiOptions.geoIpCountry?(n="en-au",e.textContent=Pe.MESSAGES.EN_AU_LINK):"NZ"===this._uiOptions.geoIpCountry?(n="en-nz",e.textContent=Pe.MESSAGES.EN_NZ_LINK):"ZA"===this._uiOptions.geoIpCountry?(n="en-za",e.textContent=Pe.MESSAGES.EN_ZA_LINK):(n="en-gb",e.textContent=Pe.MESSAGES.EN_GB_LINK):(this._error.description.match(/is\s+(chiefly\s)?(North\s)?American English/)||this._error.description.includes("is a common American expression"))&&(n="en-us",e.textContent=Pe.MESSAGES.EN_US_LINK),n){const s=this._onLanguageChange.bind(this,n);this._eventListeners.push(V(e,"click",s)),t.appendChild(e),this._buttons.push({element:e,onSelect:s})}}e.appendChild(t)}}_renderKeyboardInstructuions(e){if(!this._uiOptions.enableKeyboard)return;const t=this._document.createElement("lt-div");t.className="lt-errorcard__keyboard-instructions",e.append(t),t.innerHTML=Pe.MESSAGES.KEYBOARD_INSTRUCTIONS}_renderActions(e){if(this._error.isSpellingError){if(!this._uiOptions.disableAddingWord&&!u(this._error.originalPhrase)){const t=this._document.createElement("lt-div");t.classList.add("lt-errorcard__add-to-dictionary","lt-icon__dictionary"),t.textContent=s.getMessage("addToDictionaryCaption",this._error.originalPhrase);const n=this._onAddToDictionaryClick.bind(this);this._eventListeners.push(V(t,"click",n)),e.appendChild(t),this._buttons.push({element:t,onSelect:n})}const t=this._document.createElement("lt-div");t.classList.add("lt-errorcard__temporarily-ignore-word"),t.classList.add("lt-icon__mute"),t.textContent=Pe.MESSAGES.LINK_IGNORE_HERE;const n=this._onTemporarilyIgnoreWordClick.bind(this);this._eventListeners.push(V(t,"click",n)),e.appendChild(t),this._buttons.push({element:t,onSelect:n})}else{if(!this._uiOptions.disableIgnoringRule&&!this._isHiddenMatch&&!this._error.isCustomError){const t=this._document.createElement("lt-div");t.classList.add("lt-errorcard__ignore-rule"),t.classList.add("lt-icon__ignore"),t.textContent=Pe.MESSAGES.LINK_IGNORE_RULE;const n=this._onIgnoreRuleClick.bind(this);this._eventListeners.push(V(t,"click",n)),e.appendChild(t),this._buttons.push({element:t,onSelect:n})}const t=this._document.createElement("lt-div");t.classList.add("lt-errorcard__temporarily-ignore-rule"),t.classList.add("lt-icon__mute"),t.textContent=Pe.MESSAGES.LINK_IGNORE_HERE;const n=this._onTemporarilyIgnoreRuleClick.bind(this);this._eventListeners.push(V(t,"click",n)),e.appendChild(t),this._buttons.push({element:t,onSelect:n})}if(this._error.isPicky&&"extension"===t.getType()&&!this._isHiddenMatch){const t=this._document.createElement("lt-div");t.classList.add("lt-errorcard__turn-off-picky-mode"),t.classList.add("lt-icon__picky_mode"),t.textContent=Pe.MESSAGES.TURN_OFF_PICKY_MODE;const n=this._onTurnOffPickyMode.bind(this);this._eventListeners.push(V(t,"click",n)),e.appendChild(t),this._buttons.push({element:t,onSelect:n})}}_renderFooter(e){if(this._uiOptions.showFooter){const t=this._document.createElement("lt-div");t.classList.add("lt-card__footer"),e.appendChild(t);const n=this._document.createElement("lt-div");n.classList.add("lt-card__logo","lt-icon__lt"),t.appendChild(n),this._eventListeners.push(V(n,"click",this._onLogoClicked.bind(this)));const s=this._document.createElement("lt-div");s.classList.add("lt-card__badge-container"),t.appendChild(s);const i=this._document.createElement("lt-div");if(i.classList.add("lt-card__name"),i.textContent="LanguageTool",s.appendChild(i),this._uiOptions.isPremiumAccount)new ve(null,"premium","small",s);else{const e=new ve(null,"basic","small",s);this._eventListeners.push(V(e.getElement(),"click",this._onBadgeClicked.bind(this)))}}}_updateFocus(){for(const e of this._buttons)e.element.classList.remove("lt-card__button-focused");void 0!==this._focusedButtonIndex&&this._buttons[this._focusedButtonIndex]&&this._buttons[this._focusedButtonIndex].element.classList.add("lt-card__button-focused")}_onBadgeClicked(e){e.stopImmediatePropagation();const t={errorCard:this};K(document,Pe.eventNames.badgeClicked,t)}_onLogoClicked(e){e.stopImmediatePropagation();const t={errorCard:this};K(document,Pe.eventNames.logoClicked,t)}_onMoreDetailsClick(e){e.stopImmediatePropagation();const t={errorCard:this,url:this._error.rule.urls[0].value};K(document,Pe.eventNames.moreDetailsClicked,t)}_onFixClick(e,t){t.stopImmediatePropagation();const n={errorCard:this,error:this._error,fixIndex:e,selectNextError:!!t.shiftKey};K(document,Pe.eventNames.fixSelected,n)}_onLanguageChange(e,t){t.stopImmediatePropagation();const n={errorCard:this,error:this._error,language:e};K(document,Pe.eventNames.languageChanged,n)}_onCorrectAll(e,t){t.stopImmediatePropagation();const n={errorCard:this,config:e,selectedError:this._error};K(document,Pe.eventNames.correctAll,n)}_onAddToDictionaryClick(e){e.stopImmediatePropagation();const t={errorCard:this,error:this._error,selectNextError:e instanceof KeyboardEvent&&e.shiftKey};K(document,Pe.eventNames.addToDictionaryClicked,t)}_onIgnoreRuleClick(e){e.stopImmediatePropagation();const t={errorCard:this,error:this._error,selectNextError:e instanceof KeyboardEvent&&e.shiftKey};K(document,Pe.eventNames.ignoreRuleClicked,t)}_onTemporarilyIgnoreWordClick(e){e.stopImmediatePropagation();const t={errorCard:this,error:this._error,selectNextError:e instanceof KeyboardEvent&&e.shiftKey};K(document,Pe.eventNames.temporarilyIgnoreWordClicked,t)}_onTemporarilyIgnoreRuleClick(e){e.stopImmediatePropagation();const t={errorCard:this,error:this._error,selectNextError:e instanceof KeyboardEvent&&e.shiftKey};K(document,Pe.eventNames.temporarilyIgnoreRuleClicked,t)}_onTurnOffPickyMode(e){e.stopImmediatePropagation();const t={errorCard:this};K(document,Pe.eventNames.turnOffPickyModeClicked,t)}_onCloseClicked(e){e.stopImmediatePropagation(),this.destroy()}_onKeyDown(e){var t;if("Escape"===e.key)return this.destroy(),null===(t=e.target)||void 0===t||t.addEventListener("keyup",(e=>e.stopImmediatePropagation()),{once:!0,capture:!0}),void e.stopImmediatePropagation();if(!this._uiOptions.enableKeyboard||void 0===this._focusedButtonIndex)return;let n=e.key;switch("Tab"===e.key&&(n=e.shiftKey?"ArrowLeft":"ArrowRight"),n){case"ArrowLeft":this._focusedButtonIndex--,-1===this._focusedButtonIndex&&(this._focusedButtonIndex=this._buttons.length-1),this._updateFocus(),e.stopImmediatePropagation(),e.preventDefault();break;case"ArrowRight":this._focusedButtonIndex++,this._focusedButtonIndex===this._buttons.length&&(this._focusedButtonIndex=0),this._updateFocus(),e.stopImmediatePropagation(),e.preventDefault();break;case"ArrowUp":{const t=this._buttons.map((e=>this._domMeasurement.getBorderBox(e.element))),n=t[this._focusedButtonIndex];let s=null;for(const e of t)if(!(e.bottom>n.top))if(s){(e.bottom>s.bottom||e.bottom===s.bottom&&e.left<s.left)&&(s=e)}else s=e;this._focusedButtonIndex=s?t.indexOf(s):this._buttons.length-1,this._updateFocus(),e.stopImmediatePropagation(),e.preventDefault();break}case"ArrowDown":{const t=this._buttons.map((e=>this._domMeasurement.getBorderBox(e.element))),n=t[this._focusedButtonIndex];let s=null;for(const e of t)if(!(e.top<n.bottom))if(s){(e.top<s.top||e.top===s.top&&e.left<s.left)&&(s=e)}else s=e;this._focusedButtonIndex=s?t.indexOf(s):0,this._updateFocus(),e.stopImmediatePropagation(),e.preventDefault();break}case"Enter":this._buttons[this._focusedButtonIndex]&&this._buttons[this._focusedButtonIndex].onSelect(e),e.stopImmediatePropagation(),e.preventDefault()}}_onPageHide(){this.destroy()}destroy(){if(this._container){this._container.remove(),this._container=null;const e={errorCard:this,error:this._error};K(document,Pe.eventNames.destroyed,e)}window.removeEventListener("pagehide",this._onPageHide,!0),this._eventListeners.forEach((e=>{e.destroy()})),this._eventListeners=[]}}Pe.CONTAINER_ELEMENT_NAME="lt-card",Pe.TRAILING_WHITESPACE_REGEXP=/^ | $/g,Pe.NARROW_WHITESPACE_REGEXP=/\u202F/g,Pe.eventNames={addToDictionaryClicked:"lt-errorCard.addToDictionaryClicked",ignoreRuleClicked:"lt-errorCard.ignoreRuleClicked",temporarilyIgnoreWordClicked:"lt-errorCard.temporarilyIgnoreWordClicked",temporarilyIgnoreRuleClicked:"lt-errorCard.temporarilyIgnoreRuleClicked",turnOffPickyModeClicked:"lt-errorCard.turnOffPickyModeClicked",moreDetailsClicked:"lt-errorCard.moreDetailsClicked",fixSelected:"lt-errorCard.fixSelected",languageChanged:"lt-errorCard.languageSwitched",badgeClicked:"lt-errorCard.badgeClicked",logoClicked:"lt-errorCard.logoClicked",premiumTeaserClicked:"lt-errorCard.premiumTeaserClicked",destroyed:"lt-errorCard.destroyed",correctAll:"lt-errorCard.correctAll"},Pe._isInitialized=!1;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class De{}De.eventNames={input:"lt-mirror.input",click:"lt-mirror.click"};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Ue extends De{constructor(e){super(),this._firefoxHackEnabled=!1,this._mimickedElement=e,this._domMeasurement=new k(this._mimickedElement.ownerDocument),this._isRoamResearchIssue=Boolean(location.hostname.match(/roamresearch/)&&e.closest(".roam-article")),this._isHootsuiteIssue=Boolean(location.hostname.match(/hootsuite/)&&e.closest(".rc-TextArea")),this._isDotSyntaxHighlighterIssue=Boolean(e.previousElementSibling&&"wpTextbox0"===e.previousElementSibling.id),this._render=this._render.bind(this),this._updateText=this._updateText.bind(this),this._onMimickedElementScroll=this._onMimickedElementScroll.bind(this),this._onMimickedElementClick=this._onMimickedElementClick.bind(this),this._render(),this._mimickedElement.addEventListener("scroll",this._onMimickedElementScroll),this._mimickedElement.addEventListener("click",this._onMimickedElementClick),this._mimickedElement.addEventListener("input",this._updateText),window.ResizeObserver&&(this._mimickedElementResizeObserver=new window.ResizeObserver(this._render),this._mimickedElementResizeObserver.observe(this._mimickedElement)),this._renderInterval=P(this._render,i.RENDER_INTERVAL)}_dispatchClick(e){const t=new MouseEvent(De.eventNames.click,{view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,button:e.button,buttons:e.buttons,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,bubbles:!0,cancelable:!0});this._wrapper.dispatchEvent(t)}_dispatchInput(){const e=new Event(De.eventNames.input,{bubbles:!0,cancelable:!0});this._ensureContainerIsBeforeTargetElement(),this._wrapper.dispatchEvent(e)}_ensureContainerIsBeforeTargetElement(){const e=this._getTargetElement();e.previousElementSibling!==this._container&&e.parentElement&&e.parentElement.insertBefore(this._container,e)}_getTargetElement(){return this._isRoamResearchIssue||this._isHootsuiteIssue||this._isDotSyntaxHighlighterIssue?this._mimickedElement.parentNode:this._mimickedElement}_render(){if(!this._mimickedElement.parentElement)return;this._domMeasurement.clearCache();const t=this._domMeasurement.getContentBox(this._mimickedElement,!1,!1),n=this._domMeasurement.getContentBox(this._mimickedElement,!1,!0);if(!this._container){if(this._container=G(document,Ue.CONTAINER_ELEMENT_NAME),this._container.style.display="none",this._wrapper=document.createElement("lt-div"),this._wrapper.setAttribute("spellcheck","false"),this._wrapper.className="lt-mirror__wrapper notranslate",this._canvas=document.createElement("lt-div"),this._canvas.className="lt-mirror__canvas",this._wrapper.appendChild(this._canvas),this._container.appendChild(this._wrapper),e.isFirefox()||e.isThunderbird()){this._elementInlineLineHeight=this._domMeasurement.getInlineStyle(this._mimickedElement,"line-height"),this._elementComputedLineHeight=this._domMeasurement.getStyle(this._mimickedElement,"line-height");this._domMeasurement.getStyle(this._mimickedElement,"transition-property").match(/all|line\-height/)||(this._firefoxHackEnabled=!0)}const t=this._domMeasurement.getStyle(this._mimickedElement.parentElement,"display");"grid"!==t&&"inline-grid"!==t||this._container.classList.add("lt-mirror--grid-item")}this._firefoxHackEnabled&&(this._mimickedElement.style.lineHeight===this._elementComputedLineHeight?this._domMeasurement.setStyles(this._mimickedElement,{"line-height":this._elementInlineLineHeight}):this._elementInlineLineHeight=this._domMeasurement.getInlineStyle(this._mimickedElement,"lineHeight"),this._elementComputedLineHeight=this._domMeasurement.getStyle(this._mimickedElement,"line-height"),this._elementComputedLineHeight.includes("px")&&this._domMeasurement.setStyles(this._mimickedElement,{"line-height":this._elementComputedLineHeight}));const s=this._domMeasurement.getStyles(this._mimickedElement,["border","border-radius","border-top-width","border-right-width","border-left-width","border-bottom-width","border-top-style","border-right-style","border-left-style","border-bottom-style","direction","font","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-weight","hyphens","letter-spacing","line-break","margin","margin-top","margin-left","margin-bottom","margin-right","padding","padding-top","padding-left","padding-right","padding-bottom","text-align","text-decoration","text-indent","text-rendering","text-transform","transform","transform-origin","unicode-bidi","white-space","word-spacing","word-wrap","writing-mode","zoom","-webkit-locale","-webkit-rtl-ordering"]);s["font-size"]=this._getWrapperFontSizeValue(s["font-size"]),s["line-height"]=this._domMeasurement.getExactStyle(this._mimickedElement,"line-height"),s["white-space"]=this._getWrapperWhiteSpaceValue(s["white-space"]),f(s,this._wrapperStyles)||(this._domMeasurement.resetStyles(this._wrapper,s,!0),this._wrapperStyles=s),this._updateText(),this._ensureContainerIsBeforeTargetElement(),this._domMeasurement.setStyles(this._wrapper,{width:t.width+"px",height:t.height+"px"},!0);const i=this._domMeasurement.getContentBox(this._wrapper,!1),o=n.left-i.left;if(Math.abs(o)>.05){let e=parseFloat(this._domMeasurement.getStyle(this._wrapper,"margin-left"));e+=o,this._domMeasurement.setStyles(this._wrapper,{"margin-left":e+"px"},!0)}const r=n.top-i.top;if(Math.abs(r)>.05){let e=parseFloat(this._domMeasurement.getStyle(this._wrapper,"margin-top"));e+=r,this._domMeasurement.setStyles(this._wrapper,{"margin-top":e+"px"},!0)}const a=this._domMeasurement.getScrollDimensions(this._mimickedElement,!1);let l=a.width-t.padding.left-t.padding.right,c=a.height-t.padding.top-t.padding.bottom;l===Math.round(t.width)&&(l=t.width),this._domMeasurement.setStyles(this._canvas,{width:l+"px",height:c+"px"},!0),this._updateScrolling(!1)}_getTextZoom(t=!1){if(t&&this._domMeasurement.clearCache(),!this._container)return 1;if(!e.isFirefox()&&!e.isThunderbird())return 1;this._measurer||(this._measurer=document.createElement("lt-div"),this._measurer.className="lt-mirror__measurer",this._container.appendChild(this._measurer));return(Number.parseInt(this._domMeasurement.getStyle(this._measurer,"font-size"))||0)/100}_getWrapperFontSizeValue(e){const t=this._getTextZoom();if(1===t)return e;return(Number.parseFloat(e)||0)/t+"px"}_getWrapperWhiteSpaceValue(t){if(e.isChromium()){if("normal"===t)return"pre-wrap";if("nowrap"===t)return"pre"}return t}_updateScrolling(e=!0){e&&this._domMeasurement.clearCache();const t=this._domMeasurement.getScrollPosition(this._mimickedElement,!1),n=this._domMeasurement.getScrollPosition(this._mimickedElement,!0,!1),s=this._domMeasurement.getScrollPosition(this._mimickedElement);this._domMeasurement.setStyles(this._canvas,{"margin-top":-t.top+"px","margin-left":-t.left+"px"},!0),this._wrapper.dataset.ltScrollTop=t.top.toString(),this._wrapper.dataset.ltScrollLeft=t.left.toString(),this._wrapper.dataset.ltScrollTopScaled=n.top.toString(),this._wrapper.dataset.ltScrollLeftScaled=n.left.toString(),this._wrapper.dataset.ltScrollTopScaledAndZoomed=s.top.toString(),this._wrapper.dataset.ltScrollLeftScaledAndZoomed=s.left.toString()}_updateText(){const e=this._mimickedElement.value;this._currentText!==e&&(this._currentText=e,this._canvas.textContent=e,this._updateScrolling(),this._dispatchInput())}_onMimickedElementScroll(){window.requestAnimationFrame((()=>{this._updateScrolling()}))}_onMimickedElementClick(e){void 0!==e.clientX&&void 0!==e.clientY&&this._dispatchClick(e)}getCloneElement(){return this._wrapper}getTextElement(){return this._canvas}enableRangeMeasurements(){this._wrapper.classList.add("lt-mirror-enable-range-measurement")}disableRangeMeasurements(){this._wrapper.classList.remove("lt-mirror-enable-range-measurement")}destroy(){this._mimickedElement.removeEventListener("input",this._updateText),this._mimickedElement.removeEventListener("scroll",this._onMimickedElementScroll),this._mimickedElement.removeEventListener("click",this._onMimickedElementClick),this._renderInterval&&this._renderInterval.destroy(),this._container&&this._container.remove(),this._mimickedElementResizeObserver&&this._mimickedElementResizeObserver.disconnect(),this._domMeasurement.clearCache()}}Ue.CONTAINER_ELEMENT_NAME="lt-mirror";
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Ge extends be{constructor(e,t,n,s=Number.MAX_SAFE_INTEGER){super(e,n,s),this._scrollToInterval=null,this._mirror=t,this._mirrorElement=t.getCloneElement(),this._ceElementInspector=new Te(this._mirrorElement,this._tweaks.getParsingDetector()),this._domMeasurement=new k(this._inputArea.ownerDocument),this._scrollTop=this._inputArea.scrollTop,this._scrollLeft=this._inputArea.scrollLeft,this._updateText(),this._onDblClick=this._onDblClick.bind(this),this._onScroll=this._onScroll.bind(this),this._inputArea.addEventListener("dblclick",this._onDblClick),this._inputArea.addEventListener("scroll",this._onScroll),this._mirrorElement.addEventListener(De.eventNames.input,this._onInput)}_onDblClick(e){const t=_(this._tweaks.getSelectedText()),n=this.getSelection();if(!t||!n)return;const s=n.end||n.start,i=this.getTextRanges(n.start,s-n.start);if(!i.length)return;this._domMeasurement.clearCache();const o=this._domMeasurement.getTextBoundingBoxes(i,this._mirrorElement),r=this._domMeasurement.getTextBoundingBoxes(i,this._mirrorElement,!1);if(!o.length)return;if(!r.some((t=>U(t,e.clientX,e.clientY))))return;const a={inputAreaWrapper:this,selectedText:t,selection:n,clickedRectangles:o};K(document,be.eventNames.dblclick,a)}_onScroll(){const e=this._inputArea.scrollTop,t=this._inputArea.scrollLeft;if(this._scrollTop===e&&this._scrollLeft===t)return;this._scrollTop=e,this._scrollLeft=t;const n={inputAreaWrapper:this};K(document,be.eventNames.scroll,n)}_hasSpaceBefore(e){if(e<=0||0===this._textChunks.length)return!1;const t=this._textChunks[0],n=this._offsetInRawText(t.rawText,t.parsedText,e-1),s=this._offsetInRawText(t.rawText,t.parsedText,e);return Ge.VISIBLE_WHITE_SPACE_REGEXP.test(t.rawText.substring(n,s))}_hasSpaceAfter(e){if(0===this._textChunks.length)return!1;const t=this._textChunks[0],n=this._offsetInRawText(t.rawText,t.parsedText,e),s=this._offsetInRawText(t.rawText,t.parsedText,e+1);return Ge.VISIBLE_WHITE_SPACE_REGEXP.test(t.rawText.substring(n,s))}_offsetInRawText(e,t,n){n=Math.min(e.length,n);const s=h(e);if(-1===s||n<s)return n;let i=s,o=s;do{if(d(e[i])||o++,o>n)break;i++}while(i<e.length);return i}_offsetInParsedText(e,t,n){let s=0;for(let t=0;t<Math.min(e.length,n);t++)d(e[t])&&s++;return n-s}_updateText(){const e=[];let t="";const n=this._mirror.getTextElement().firstChild;if(n){const s=n.textContent||"";t=this._ceElementInspector.getParsedText(n),e.push({node:n,isTextNode:!0,rawText:s,rawTextOffset:0,parsedText:t,parsedTextOffset:0})}const s=this._text!==t;return this._text=t,this._textChunks=e,s}getTextBoxes(e,t){const n=this.getTextRanges(e,t);return n.length?(this._domMeasurement.clearCache(),this._domMeasurement.getTextBoundingBoxes(n,this._mirrorElement)):[]}resetText(){const e=this._inputArea.value;this._inputArea.value="",this._inputArea.value=e}replaceText(t,n,s){if(t<0||0===this._textChunks.length)return Promise.resolve();const i=t+s.length;""===s&&(this._hasSpaceBefore(t)||0===t)&&this._hasSpaceAfter(t+n)&&(t=Math.max(t-1,0),n+=1),this.setSelection({start:t,end:t+n});let o=document.execCommand("insertText",!1,s);""===s&&(e.isFirefox()||e.isThunderbird())&&(o=!1);const r=(e.isFirefox()||e.isThunderbird())&&s.includes(Ge.NBSP);if(o){if(r){const e=this._inputArea.value,n=this._textChunks[0],i=this._offsetInRawText(e,n.parsedText,t),o=this._offsetInRawText(e,n.parsedText,t+s.length),r=e.substring(0,i)+s+e.substring(o);this._inputArea.value=r}}else{const e=this._textChunks[0],i=this._offsetInRawText(e.rawText,e.parsedText,t),o=this._offsetInRawText(e.rawText,e.parsedText,t+n),r=e.rawText.substring(0,i)+s+e.rawText.substring(o);this._inputArea.value=r}return this.setSelection({start:i}),o||this.simulateInput(s),Promise.resolve()}getSelection(){if(this._inputArea!==Y())return null;const e=this.getText();return{start:this._offsetInParsedText(this._inputArea.value,e,this._inputArea.selectionStart),end:this._offsetInParsedText(this._inputArea.value,e,this._inputArea.selectionEnd)}}setSelection(e){const t=e.start,n=void 0===e.end?t:e.end;if(this._inputArea.focus(),0===this._textChunks.length)return;const s=this._textChunks[0];this._inputArea.selectionStart=this._offsetInRawText(s.rawText,s.parsedText,t),this._inputArea.selectionEnd=this._offsetInRawText(s.rawText,s.parsedText,n)}scrollToText(e,t,n="smooth",s="nearest",i){const o="smooth"===n?300:0;function r(e,t,n,s){return(e/=s/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}if(e<0)return;this._scrollToInterval&&(this._scrollToInterval.destroy(),this._scrollToInterval=null);const a=this._inputArea.scrollTop,l=this._inputArea.scrollLeft;this._domMeasurement.clearCache();const c=this.getTextRanges(e,t),d=this._domMeasurement.getRelativeTextBoundingBox(c,this._mirrorElement),h=this._inputArea.getBoundingClientRect();let _=this._inputArea.scrollTop+d.top;"center"===s&&(_-=this._inputArea.clientHeight/2,_-=d.height/2),h.top<0&&(_+=h.top);let u=this._inputArea.scrollLeft+d.left;h.left<0&&(u+=h.left);const g=_-a,m=u-l;let p=0;this._scrollToInterval=P((()=>{p+=Ge.SCROLL_TO_FRAME_INTERVAL;const e=r(p,a,g,o),t=r(p,l,m,o);this._inputArea.scrollTop=e,this._inputArea.scrollLeft=t,p>=o&&(this._scrollToInterval&&(this._scrollToInterval.destroy(),this._scrollToInterval=null),i&&setTimeout((()=>i()),50))}),Ge.SCROLL_TO_FRAME_INTERVAL)}destroy(){super.destroy(),this._inputArea.removeEventListener("dblclick",this._onDblClick),this._inputArea.removeEventListener("scroll",this._onScroll),this._mirrorElement.removeEventListener(De.eventNames.input,this._onInput),this._ceElementInspector.destroy(),this._scrollToInterval&&this._scrollToInterval.destroy()}}Ge.SCROLL_TO_FRAME_INTERVAL=20,Ge.NBSP=String.fromCharCode(160),Ge.VISIBLE_WHITE_SPACE_REGEXP=/\u00A0|\u0020|\u2009|\u202F/;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Be{static _splitExcludedPart(e,t,n){const s=[],i=e.substr(t,n);let o=0,r=i.indexOf("\n");for(;-1!==r;)s.push({offset:t+o,length:r-o}),o=r+1,r=i.indexOf("\n",r+1);return s.push({offset:t+o,length:i.length-o}),s}static _getReplacedParts(e,t,n){const s=[];for(const n of t){const t=o(e,n.pattern);for(const i of t){let t=i.index;if(void 0===n.excludedParts){const o=i[0].length;n.preserveNewlineChars?s.push(...Be._splitExcludedPart(e,t,o)):s.push({offset:t,length:o})}else for(let o=0;o<n.excludedParts.length;o++){if(void 0===i[o+1])continue;const r=i[o+1].length,a=n.excludedParts[o];("boolean"==typeof a?a:a.test(i[o+1]))&&(n.preserveNewlineChars?s.push(...Be._splitExcludedPart(e,t,r)):s.push({offset:t,length:r})),t+=r}}}for(const t of n){const n=o(e,t.pattern);for(const e of n)if("replacingText"in t){const n=e.index,i=e[0].length;s.push({offset:n,length:t.replacingText.length,replacingText:t.replacingText}),s.push({offset:n+t.replacingText.length,length:i-t.replacingText.length})}else"getReplacedParts"in t&&s.push(...t.getReplacedParts(e))}return s}static _testString(e,t,n=!1){Array.isArray(t)||(t=[t]);for(const s of t)if("string"==typeof s){if(e===s||n&&e.startsWith(s))return!0}else if(s.test(e))return!0;return!1}static getEmail(e){const t=Be.EMAIL_REGEXP.exec(e);if(!t)return"";return t[0].replace(Be.EMAIL_DOMAIN_REGEXP,"@replaced.domain").trim()}static getFullName(e){return e.replace(Be.EMAIL_REGEXP,"").replace(Be.ADDRESS_SPECIAL_CHARS_REGEXP,"").trim()}static getSiteTweaks(e){const t=A(e,"");if(!t)return Be.DEFAULT_SITE_TWEAKS;const n=I(t);for(const t of Be.SITE_TWEAKS_RULES){let s=!0;if("hostname"in t.precondition){const e=t.precondition.hostname;s=n.some((t=>Be._testString(t,e)))}else"url"in t.precondition&&(s=Be._testString(e,t.precondition.url));if(s&&t.precondition.isMatch&&(s=t.precondition.isMatch(n,e)),s)return Object.assign({},Be.DEFAULT_SITE_TWEAKS,t)}return Be.DEFAULT_SITE_TWEAKS}static getInputAreaTweaks(e,t){const n=Be.DEFAULT_INPUT_AREA_TWEAKS_FACTORY(t),s=A(e,"");if(!s)return n;const i=I(s);for(const s of Be.INPUT_AREA_TWEAKS_RULES){let o=!0;if("hostname"in s.precondition){const e=s.precondition.hostname;o=i.some((t=>Be._testString(t,e)))}else"url"in s.precondition&&(o=Be._testString(e,s.precondition.url));if(o&&s.precondition.isMatch&&(o=s.precondition.isMatch(t)),o)return Object.assign({},n,s.create(t,n))}return n}}Be.EMAIL_REGEXP=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/gi,Be.EMAIL_DOMAIN_REGEXP=/@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/i,Be.ADDRESS_SPECIAL_CHARS_REGEXP=/["'`<>]/g,Be.NON_COMPATIBLE_TAGS=["TR","TH","TD","THEAD","TBODY","TFOOT","CAPTION","IFRAME"],Be.INLINE_DISPLAY_VALUES=["inline","inline-block"],Be.TEXT_IGNORING_DEFAULT_RULES=new Map([["QUOTED_LINE",{pattern:/^[ \t]*>.*$/gm,preserveNewlineChars:!1}],["HTML_CODE_BLOCK",{pattern:/\s?<code\b[^>]*>[^]*?<\/code>/gi,preserveNewlineChars:!0}],["MARKDOWN_BOLD_1",{pattern:/(^|\s|\s\()(_|~~)?(\*\*)([^\s\*](?:.*?\S)?)(\*\*)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]}],["MARKDOWN_BOLD_2",{pattern:/(^|\s|\s\()(\*|~~)?(__)([^\s_](?:.*?\S)?)(__)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]}],["MARKDOWN_ITALIC_1",{pattern:/(^|\s|\s\()(__|~~)?(\*)([^\s\*](?:.*?\S)?)(\*)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]}],["MARKDOWN_ITALIC_2",{pattern:/(^|\s|\s\()(\*\*|~~)?(_)([^\s_](?:.*?\S)?)(_)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]}],["MARKDOWN_BOLD_AND_ITALIC_1",{pattern:/(^|\s|\s\()(\*\*\*)([^\s\*](?:.*?\S)?)(\*\*\*)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!0,!1,!0,!1]}],["MARKDOWN_BOLD_AND_ITALIC_2",{pattern:/(^|\s|\s\()(___)([^\s_](?:.*?\S)?)(___)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!0,!1,!0,!1]}],["MARKDOWN_STRIKETHROUGH",{pattern:/(^|\s|\s\()(\*|\*\*|_|__)?(~~)([^\s~](?:.*?\S)?)(~~)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]}],["MARKDOWN_MULTILINE_CODE_BLOCK",{pattern:/(^|[^`])(```)(?!`)([^]*?[^`])(```)(?=[^`]|$)/gm,preserveNewlineChars:!0,excludedParts:[/^\s$/,!0,!0,!0]}],["MARKDOWN_IMAGE_WITHOUT_TITLE",{pattern:/(!\[(?:(?:Uploading\s)?(?:Screen\sShot\s|Bildschirmfoto\s)?)?)([^\[\]]+)(\]\(\s*[^()"'\s]*\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0]}],["MARKDOWN_IMAGE_WITH_TITLE",{pattern:/(!\[)([^\[\]]+)(\]\(\s*[^()"'\s]+)(\s+)(["'])([^]*?)(\5\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0,!1,!0,!1,!0]}],["MARKDOWN_LINK_WITHOUT_TITLE",{pattern:/(\[)([^\[\]]+)(\]\(\s*[^()"'\s]+\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0]}],["MARKDOWN_LINK_WITH_TITLE",{pattern:/(\[)([^\[\]]+)(\]\(\s*[^()"'\s]+)(\s+)(["'])([^]*?)(\5\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0,!1,!0,!1,!0]}],["BBCODE_CODE_BLOCK",{pattern:/\s?\[code\][^]*?\[\/code\]/gi,preserveNewlineChars:!0}],["JIRA_CODE_BLOCK",{pattern:/\s?{code(:[a-z0-9#]+)?}[^]*?{code}/gi,preserveNewlineChars:!0}],["TEXTILE_STRIKETHROUGH",{pattern:/(^|\s)(~)([^\s~](?:.*?\S)?)(~)([\s.!?,:;]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!0,!1,!0,!1]}],["TEXTILE_BLOCK_TAG",{pattern:/^(h[1-6]|bq|bc|p|pre|###|notextile)\./gim,preserveNewlineChars:!1}],["WIKITEXT_LINK_WITHOUT_TITLE",{pattern:/(\[\[)([a-z:][^|\]\n]*)(\]\])/gi,preserveNewlineChars:!1,excludedParts:[!0,!1,!0]}],["WIKITEXT_LINK_WITH_TITLE",{pattern:/(\[\[[a-z:][^|\]\n]*\|)([^\]\n]+)(]])/gi,preserveNewlineChars:!1,excludedParts:[!0,!1,!0]}],["EMOTICONS_LTR",{pattern:/(^|\s+)([:;|=][-~^]?[()\[\]\\/|@$*#&XxDOoPp])(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["EMOTICONS_LTR_2",{pattern:/(^|\s+)([8B%][-~^][D()\[\]])(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["EMOTICONS_LTR_3",{pattern:/(^|\s+)([:;%|=][-~^]?3)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["EMOTICONS_RTL",{pattern:/(^|\s+)([()[\]\\/|@$*#&XxDOo][-~^]?[:;%|])(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["XD_SMILE",{pattern:/(^|\s+)([xX]D)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["HEART_SMILE",{pattern:/(^|\s+)(<[\\/]?3)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["JIRA_SMILEYS",{pattern:/(^|\s+)\(([-+!?ynxi]|(\*[rgby]?)|on|off|flag|flagoff)\)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}]]),Be.TEXT_IGNORING_DEFAULT_RULES_ARRAY=Array.from(Be.TEXT_IGNORING_DEFAULT_RULES.values()),Be.TEXT_REPLACING_DEFAULT_RULES=new Map([["BR_TAG",{pattern:/<([a-z]+:)?br(\s[^>]*)?\/?>/gi,replacingText:"\n"}],["HTML_OPENING_TAG",{pattern:/<([a-z]+:)?(html|xml|base|head|link|meta|style|title|body|address|article|aside|footer|header|h1|h2|h3|h4|h5|h6|main|nav|section|blockquote|dd|div|dl|dt|figcaption|figure|hr|li|ol|p|pre|ul|a|abbr|b|bdi|bdo|cite|code|data|dfn|em|i|kbd|mark|q|rp|rt|ruby|s|samp|small|span|strong|sub|sup|time|u|var|wbr|area|audio|img|map|track|video|embed|iframe|object|param|picture|portal|source|svg|canvas|noscript|script|del|ins|caption|col|colgroup|table|tbody|td|tfoot|th|thead|tr|button|datalist|fieldset|form|input|label|legend|meter|optgroup|option|output|progress|select|textarea|details|dialog|menu|summary|slot|template|acronym|applet|basefont|bgsound|big|blink|center|content|dir|font|frame|frameset|hgroup|image|keygen|marquee|menuitem|nobr|noembed|noframes|plaintext|rb|rtc|shadow|spacer|strike|tt|xmp)(\s[^>]*)?>/gi,replacingText:"⁣"}],["HTML_CLOSING_TAG",{pattern:/<\/([a-z]+:)?(html|xml|base|head|link|meta|style|title|body|address|article|aside|footer|header|h1|h2|h3|h4|h5|h6|main|nav|section|blockquote|dd|div|dl|dt|figcaption|figure|hr|li|ol|p|pre|ul|a|abbr|b|bdi|bdo|cite|code|data|dfn|em|i|kbd|mark|q|rp|rt|ruby|s|samp|small|span|strong|sub|sup|time|u|var|wbr|area|audio|img|map|track|video|embed|iframe|object|param|picture|portal|source|svg|canvas|noscript|script|del|ins|caption|col|colgroup|table|tbody|td|tfoot|th|thead|tr|button|datalist|fieldset|form|input|label|legend|meter|optgroup|option|output|progress|select|textarea|details|dialog|menu|summary|slot|template|acronym|applet|basefont|bgsound|big|blink|center|content|dir|font|frame|frameset|hgroup|image|keygen|marquee|menuitem|nobr|noembed|noframes|plaintext|rb|rtc|shadow|spacer|strike|tt|xmp)>/gi,replacingText:"⁣"}],["SVG_OPENING_TAG",{pattern:/<([a-z]+:)?(a|altGlyph|altGlyphDef|altGlyphItem|animate|animateColor|animateMotion|animateTransform|circle|clipPath|color-profile|cursor|defs|desc|discard|ellipse|feBlend|feColorMatrix|feComponentTransfer|feComposite|feConvolveMatrix|feDiffuseLighting|feDisplacementMap|feDistantLight|feFlood|feFuncA|feFuncB|feFuncG|feFuncR|feGaussianBlur|feImage|feMerge|feMergeNode|feMorphology|feOffset|fePointLight|feSpecularLighting|feSpotLight|feTile|feTurbulence|filter|font|font-face|font-face-format|font-face-name|font-face-src|font-face-uri|foreignObject|g|glyph|glyphRef|hatch|hatchpath|hkern|image|line|linearGradient|marker|mask|mesh|meshgradient|meshpatch|meshrow|metadata|missing-glyph|mpath|path|pattern|polygon|polyline|radialGradient|rect|script|set|solidcolor|stop|style|svg|switch|symbol|text|textPath|title|tref|tspan|unknown|use|view|vkern)(\s[^>]*)?>/gi,replacingText:"⁣"}],["SVG_CLOSING_TAG",{pattern:/<\/([a-z]+:)?(a|altGlyph|altGlyphDef|altGlyphItem|animate|animateColor|animateMotion|animateTransform|circle|clipPath|color-profile|cursor|defs|desc|discard|ellipse|feBlend|feColorMatrix|feComponentTransfer|feComposite|feConvolveMatrix|feDiffuseLighting|feDisplacementMap|feDistantLight|feFlood|feFuncA|feFuncB|feFuncG|feFuncR|feGaussianBlur|feImage|feMerge|feMergeNode|feMorphology|feOffset|fePointLight|feSpecularLighting|feSpotLight|feTile|feTurbulence|filter|font|font-face|font-face-format|font-face-name|font-face-src|font-face-uri|foreignObject|g|glyph|glyphRef|hatch|hatchpath|hkern|image|line|linearGradient|marker|mask|mesh|meshgradient|meshpatch|meshrow|metadata|missing-glyph|mpath|path|pattern|polygon|polyline|radialGradient|rect|script|set|solidcolor|stop|style|svg|switch|symbol|text|textPath|title|tref|tspan|unknown|use|view|vkern)>/gi,replacingText:"⁣"}],["SELF_CLOSED_TAG",{pattern:/<([a-z]+:)?[a-z][^\/]*\/>/gi,replacingText:"⁣"}],["PAIRED_TAGS",{pattern:/(<)((?:[a-z]+:)?[a-z][^\s>]*)(\s[^>]*)?(>)(?=([^]*?)(<\/\2>))/gi,getReplacedParts:e=>{if("code"===e[2].toLowerCase())return[];const t=e.index,n=e[1].length+e[2].length+(e[3]?e[3].length:0)+e[4].length,s=t+n+e[5].length;return[{offset:t,length:1,replacingText:"⁣"},{offset:t+1,length:n-1},{offset:s,length:1,replacingText:"⁣"},{offset:s+1,length:e[6].length-1}]}}],["BBCODE_OPENING_TAG",{pattern:/\[(img|url|email|post|quote|list|youtube|vimeo|googlemaps|googlewidget|code|modalurl|topic|highlight|left|center|right|font|size|color|s|u|i|b|style|table|tr|td)\b[^\]\n]*\]/gi,replacingText:"⁣"}],["BBCODE_CLOSING_TAG",{pattern:/\[\/(img|url|email|post|quote|list|youtube|vimeo|googlemaps|googlewidget|code|modalurl|topic|highlight|left|center|right|font|size|color|s|u|i|b|style|table|tr|td)\]/gi,replacingText:"⁣"}],["WORDPRESS_TAG",{pattern:/\[[a-z0-9_\-]+\s[a-z0-9_\-]+=.+?\]/gi,replacingText:"⁣"}],["MARKDOWN_INLINE_CODE_BLOCK",{pattern:/(^|\s|\s\()`([^`\n]+)`([\s.!?,:;\)]|$)/g,getReplacedParts:e=>{const t=e.index+e[1].length+1;return[{offset:t,length:1,replacingText:"⁣"},{offset:t+1,length:e[2].length-1}]}}],["JIRA_OPENING_OR_CLOSING_TAG",{pattern:/{(color|code|noformat|quote)(:[a-z0-9#]+)?}/gi,replacingText:"⁣"}],["EMOJI",{pattern:/(^|\s+)(\:\w+\:)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,replacingText:"⁣"}]]),Be.TEXT_REPLACING_DEFAULT_RULES_ARRAY=Array.from(Be.TEXT_REPLACING_DEFAULT_RULES.values()),Be.DEFAULT_SITE_TWEAKS={init(){document.documentElement.setAttribute("data-lt-installed","true")},destroy(){document.documentElement&&document.documentElement.removeAttribute("data-lt-installed")},isSupported:()=>!0,unsupportedMessage:()=>"",isBeta:()=>!1,persistTemporarySettings:()=>!1,onNewElement(e){},getInitElements:e=>[e],shouldDisableOtherSpellCheckers:e=>!0,isElementCompatible(e){if(Be.NON_COMPATIBLE_TAGS.includes(e.tagName))return!1;if(!((Z(e)||function(e){return e instanceof HTMLElement&&(e.isContentEditable||"BODY"===e.nodeName&&F(e))}(e))&&!e.readOnly))return!1;if("true"===e.getAttribute("data-lt-active"))return!0;if("false"===e.getAttribute("data-lt-active"))return!1;if("false"===document.documentElement.getAttribute("data-lt-active"))return!1;if(J(e))return!1;if(e.classList.contains("ck-editor__nested-editable")&&e.parentElement&&e.parentElement.closest(".cke_editable"))return!1;if(_e(e))return!0;if(function(e){try{const t=e.ownerDocument.defaultView.frameElement;return!!t&&t.classList.contains("arx-editor-frame")}catch(e){return!1}}(e))return!1;if(le(e)&&"true"===e.getAttribute("contenteditable"))return!0;if(e.classList.contains("cke_editable"))return!0;if(e.classList.contains("ve-ce-documentNode"))return!0;if(e.classList.contains("fr-element")&&!e.classList.contains("wsc-instance"))return!0;if(e.parentElement&&e.parentElement.classList.contains("wp-block-code"))return!1;const t=e.ownerDocument;if(t.head&&ae(e)){const n=t.createElement("script"),s="_isTinymceSpellcheckerActivated";return n.innerText=`\n                    try {\n                        if (window.parent.tinymce.get(document.body.dataset.id).plugins.tinymcespellchecker) {\n                            document.body.dataset.${s} = true;\n                        }\n                    } catch(e) {}\n                `,t.head.appendChild(n),n.remove(),!Boolean(e.dataset[s])}return!!(window.innerHeight>=20&&window.innerWidth>=100)&&!("false"===e.getAttribute("spellcheck")&&!e.lang)},hasFocus:e=>function(e){return e.matches(":focus")||"BODY"===e.nodeName&&F(e)&&e.ownerDocument.hasFocus()}(e),getEditorId:e=>Math.round(99999*Math.random())+":"+Date.now(),getEditorGroupId(e){try{return new URL(e).pathname}catch(e){return"unknown"}},getClickEvent:()=>"click",isClickEventIgnored:e=>!e.isTrusted,getSelectedText:()=>X(),getSelectedHTML:()=>function(){const e=document.activeElement,t=e?e.tagName.toLowerCase():null;if("textarea"===t||"input"===t&&/^(?:text|search|password|tel|url)$/i.test(e.type)&&"number"==typeof e.selectionStart)return;const n=window.getSelection();if(!n||0===n.rangeCount)return;const s=n.getRangeAt(0).cloneContents(),i=document.createElement("div");return i.appendChild(s),i.innerHTML}()},Be.DEFAULT_INPUT_AREA_WRAPPER_TWEAKS_FACTORY=function(t){return{createMutationObserver:e=>new MutationObserver(e),getParsingDetector(){const e=document.body&&document.body.dataset&&document.body.dataset.id&&document.body.dataset.id.includes("ZmHtmlEditor");let n=location.href.includes("/owa/")||!!document.querySelector(".owa-font-compose");try{n=n||window.parent.location.href.includes("/owa/")||!!window.parent.document.querySelector(".owa-font-compose")}catch(e){}let s=!1;try{s=!!window.parent.document.title.match(/roundcube/i)||!!window.parent.location.href.match(/_action=compose/i)}catch(e){}const i=function(e){return e.classList.contains("ProseMirror")}(t),o=ae(t),r=function(e){const t=e.classList.contains("cke_editable"),n="string"==typeof e.className&&e.className.includes("ck-editor_");return t||n}(t),a=function(e){return e.classList.contains("ql-editor")}(t),d=function(e){return e.classList.contains("lt-textarea__textarea")}(t);return{createMutationObserver:e=>new MutationObserver(e),isIgnored(e,t){const n=e.tagName.toUpperCase();return!!Te.SKIPPING_TAGS.includes(n)||("none"===t.display||("BLOCKQUOTE"===n&&!d||("false"===e.getAttribute("contenteditable")||"false"===e.getAttribute("spellcheck")?(!i||!e.hasAttribute("data-mention-id")&&!e.hasAttribute("usertype"))&&((!a||!e.classList.contains("ql-mention"))&&((!o||!e.classList.contains("user-hover"))&&((!r||!e.classList.contains("cke_widget_mention-box"))&&((!r||!e.classList.contains("ck-user__marker"))&&((!r||!e.classList.contains("ck-user__marker-line"))&&!(e instanceof HTMLElement&&"inline"===t.display&&(!e.firstElementChild||1===e.childElementCount&&e.offsetWidth>0))))))):"SUP"===n&&e.textContent?Te.SUP_REGEXP.test(e.textContent.trim()):!(!a||!e.classList.contains("ql-code-block")&&!e.classList.contains("ql-formula")))))},isSignature:t=>e?!!(t.dataset&&t.dataset.marker&&t.dataset.marker.includes("_SIG_")):n?"signature"===t.id.toLowerCase():!!s&&"_rc_sig"===t.id,isQuote:t=>e?!!(t.dataset&&t.dataset.marker&&t.dataset.marker.includes("_QUOTED_")):!!n&&("divRplyFwdMsg"===t.id||!!t.previousElementSibling&&"divRplyFwdMsg"===t.previousElementSibling.id),isBlock:(e,t)=>Te.DISPLAY_BLOCK_VALUES.includes(t.display||""),getReplacementText(e,t,n){if(!Be.INLINE_DISPLAY_VALUES.includes(n.display))return"";const s=e.tagName.toUpperCase();return"BR"===s?"":t&&("IMG"===s||"CODE"===s||"false"===e.getAttribute("spellcheck")||e instanceof HTMLElement&&"false"===e.contentEditable)?"⁣":""},replaceText:(e,t,n)=>(e=_(e),e=c(e)),isWhiteSpace:e=>l(e)}},getCacheInvalidationRules:()=>({isSkippingElement:{self:{attributes:[],childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},descendant:{attributes:["id","class","style"],characterData:!0,childList:!0},sibling:{attributes:["id"]}},replacementText:{self:{attributes:["id","class","style","contenteditable","spellcheck","data-mention-id","usertype"],childList:!0},ancestor:{attributes:["id","class","style"]},descendant:{attributes:["id","class","style"],characterData:!0,childList:!0}},isBlock:{self:{attributes:["id","class","style"]},ancestor:{attributes:["id","class","style"]}},parsingOptions:{self:{attributes:["id","class","style"]},ancestor:{attributes:["id","class","style"]}},parsedText:{self:{characterData:!0},ancestor:{attributes:["id","class","style"]}},blockParent:{self:{attributes:["id","class","style"]},ancestor:{attributes:["id","class","style"]}},paragraphLastValuableNode:{self:{attributes:[],characterData:!0,childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},sibling:{attributes:["id"]},blockSibling:{attributes:[],characterData:!0,childList:!0}},isBRElementRelevant:{self:{attributes:[],childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},sibling:{attributes:["id"]},blockSibling:{attributes:[],characterData:!0,childList:!0}},isTextEndsWithLineBreak:{any:{attributes:[],characterData:!0,childList:!0}},isParagraphNonEmpty:{self:{attributes:["id","class","style"],childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},descendant:{attributes:[],characterData:!0,childList:!0}}}),getKeyboardEventTarget:()=>t,getSelectedText:()=>X(),getSelection(){const n=function(t){if(e.isFirefox())return t.ownerDocument.getSelection();const n=function(e){for(var t=e&&e.parentNode;t;){if("[object ShadowRoot]"===t.toString())return t;t=t.parentNode}return null}(t);return n&&"getSelection"in n?n.getSelection():window.getSelection()}(t);return n?{startNode:n.anchorNode,startOffset:n.anchorOffset,endNode:n.focusNode,endOffset:n.focusOffset,isCollapsed:q(n)}:null}}},Be.DEFAULT_INPUT_AREA_WRAPPER_FACTORY=function(e,t,n,s){if(Z(e)){if(!t)throw new Error("No mirror instance for FormElementWrapper.");return new Ge(e,t,n,s)}return new Ae(e,n,s)},Be.DEFAULT_INPUT_AREA_TWEAKS_FACTORY=function(e){return{init(){},destroy(){},onDestroy(t){$(e,t),z(e,t)},getMirror:()=>Z(e)?new Ue(e):null,getInputAreaWrapper(t,n){const s=Be.DEFAULT_INPUT_AREA_WRAPPER_TWEAKS_FACTORY(e);return Be.DEFAULT_INPUT_AREA_WRAPPER_FACTORY(e,t,s,n)},getHighlighterTweaks(t,n){const s=Boolean(t.firstElementChild&&t.firstElementChild.hasAttribute("data-contents")),i=t.classList.contains("ms-rtestate-write"),o=Boolean(t.classList.contains("ql-editor")&&t.closest(".ql-editor")),r=Boolean(t.classList.contains("control-contenteditable__area")&&t.closest(".js-control-contenteditable, .js-control-contenteditable-amojo")),a=Boolean(t.closest(".app-Talk, .app-talk")),l=Boolean(t.closest(".ce-redactor .ce-block .ce-block__content"));return{getTargetElement:()=>n?t:s&&t.parentNode&&t.parentNode.parentNode?t.parentNode:i?t.closest("table[id*=WikiField]")||t:o?t.closest(".ql-container")||t:r?t.closest(".js-control-contenteditable, .js-control-contenteditable-amojo")||t:a?t.closest(".new-message-form")?t.parentElement:t:l&&t.closest(".ce-block__content")||t,addScrollEventListener(t){e.addEventListener("scroll",t)},removeScrollEventListener(t){e.removeEventListener("scroll",t)},createMutationObserver:e=>new MutationObserver(e),getZIndex(e,t){let n=t.getStyle(e,"z-index");return n=parseInt(n)||0,n>0||t.isStackingContext(e)?n+1:"auto"},getVisibleBox:e=>e.getPaddingBox(t,!0,!1),getScrollableElementSize:t=>t.getScrollDimensions(e,!1),getScrollPosition:(t,n,s)=>t.getScrollPosition(e,n,s),getTextBoxes:(e,t,n,s)=>e.getRelativeTextBoundingBoxes(t,n,s),supportsCanvas:()=>!0,isClickIgnored:e=>!1}},getToolbarAppearance(){const t=[Oe.CONTAINER_ELEMENT_NAME,Pe.CONTAINER_ELEMENT_NAME].join(", "),n="chat-input-control"===e.id&&e.classList.contains("window__chatInputControl"),s=function(e){return e.classList.contains("editor-rich-text__editable")||e.classList.contains("block-editor-writing-flow")||e.classList.contains("block-editor-rich-text__editable")}(e),i=_e(e);return{isPerformanceCritical:()=>!1,getParent:t=>"BODY"===e.tagName?t.documentElement:t.body,getClassName:()=>null,isVisible(t,o,r=32){if(n)return!1;let a=!0;if(a=Q(e)||J(e)?!e.value.trim():!e.textContent.trim(),s&&a)return!1;if(i)return!0;const l=o.getPaddingBox(e);return!(a&&l.height<r)&&(l.width>=160&&l.height>=18)},getZIndex:(e,t,n)=>n.getZIndex(e,t),getPosition(e,n,s,i,o,r=18,a=44){const l=e.ownerDocument.documentElement,c=e.ownerDocument.body;if(e===c){return{fixed:!0,left:(i?6:l.clientWidth-o.width-6)+"px"}}const d=l.clientHeight,h=W(e,s,d,t),_=h.bottom-h.top;if(_<r)return null;let u=s.getPaddingBox(e);if("IFRAME"===e.tagName){let t=null;try{t=e.contentWindow.document.documentElement}catch(e){}if(!t)return null;i=s.isRTL(t.ownerDocument.body),g=u,m=t.clientWidth,p=t.clientHeight,u=Object.assign({},g,{right:g.left+m,bottom:g.top+p,width:m,height:p})}var g,m,p;const E=s.getScaleFactor(n),f=s.getZoom(n),S=E.x*f,C=E.y*f;let T=(u.top+h.bottom)/C-6-o.height,b=i?u.left/S+6:u.right/S-6-o.width;if(_<=a){T=(u.top+h.bottom-_/2)/C-o.height/2}const A=u.height>=250,N=(l.scrollTop||c.scrollTop)+d,L=Math.round(u.top);if(A&&L+h.bottom>=N&&L+o.height+12<N)return{fixed:!0,left:Math.round(b)+"px"};if(T>N)return null;const I=N-o.height-8;return T=Math.min(T,I),{fixed:!1,left:Math.round(b)+"px",top:Math.round(T)+"px"}}}},getErrorCardTweaks:()=>({getKeyboardEventTarget:()=>e.ownerDocument}),getDialogAppearance:()=>({isPositionVisible:()=>!0,canDisplayAllSuggestions:()=>!0}),getMessagePopupAppearance:()=>({isVisible:()=>!0}),getMaxTextLength:(e,t)=>e.hasCustomServer()?i.MAX_TEXT_LENGTH_CUSTOM_SERVER:e.getUIState().hasPaidSubscription?i.MAX_TEXT_LENGTH_PREMIUM:"number"==typeof t?t:i.MAX_TEXT_LENGTH,getReplacedParts:e=>Be._getReplacedParts(e,Be.TEXT_IGNORING_DEFAULT_RULES_ARRAY,Be.TEXT_REPLACING_DEFAULT_RULES_ARRAY),getRecipientInfo(){try{const t="BODY"===e.tagName&&"tinymce"===e.id,n="TEXTAREA"===e.tagName&&"composebody"===e.id;if(t||n){const e=window.parent.document.getElementById("_from"),t=window.parent.document.getElementById("compose-subject"),n=window.parent.document.getElementById("_to");if(e&&t&&n){const e=Be.getEmail(n.value),t=Be.getFullName(n.value);return Promise.resolve({address:e,fullName:t})}}}catch(e){}return Promise.resolve({address:"",fullName:""})},shouldUseParagraphLevelCaching:e=>!0,canCorrectMultipleErrorsAtOnce:()=>!0,getCheckOptions:(e,t)=>({throttlingLimit:i.CHECK_THROTTLING_LIMIT,checkTextLevel:t.length<=i.TEXT_LEVEL_MAX_LENGTH_PER_REQUEST}),filterErrors:(e,t,n)=>n,applyFix(e){const{offset:t,length:n,replacementText:s,editor:i}=e;return i.inputAreaWrapper.replaceText(t,n,s)}}},Be.SITE_TWEAKS_RULES=[],Be.INPUT_AREA_TWEAKS_RULES=[];
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
let He,Fe,We,Ke,Ve=!1;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
s.init(new
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class extends n{addEventListener(e,t){}setLocale(e){}getMessage(e,t){return browser.i18n.getMessage(e,t)}}),M.init((()=>new y)),t.init(new
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class extends
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class{}{constructor(){super(...arguments),this._isProductionEnvironmentCached=null}isProductionEnvironment(){if(null===this._isProductionEnvironmentCached){if(e.isSafari())return!0;e.isFirefox()||e.isThunderbird()?this._isProductionEnvironmentCached=!browser.runtime.id.match("languagetool.dev"):this._isProductionEnvironmentCached="update_url"in browser.runtime.getManifest()}return this._isProductionEnvironmentCached}isRuntimeConnected(){try{return browser.runtime.getManifest(),!0}catch(e){return!1}}getVersion(){if(this.isRuntimeConnected()){const e=browser.runtime.getManifest();return e&&e.version?e.version:"unknown"}return"unknown"}getTrackingId(){return e.isSafari()?"13":e.isThunderbird()?"22":"12"}shouldTrack(){return"1"!==navigator.doNotTrack}getType(){return"extension"}getURL(e){return browser.runtime.getURL(e)}getUILanguageCode(){return browser.i18n.getUILanguage()}openWindow(e){browser.runtime.sendMessage({command:"OPEN_URL",url:e})}loadContentScripts(e,t){return this.isRuntimeConnected()?(browser.runtime.getManifest().content_scripts.forEach((n=>{if("js"===t&&n.js){const t=n.js.map((e=>{const t=this.getURL(e);return fetch(t).then((e=>e.text()))}));return Promise.all(t).then((t=>{const n=t.join("\n");e.eval(n)}))}if("css"===t&&n.css){const t=n.css.map((e=>{const t=this.getURL(e);return fetch(t).then((e=>e.text()))}));return Promise.all(t).then((t=>{t.forEach((t=>{const n=e.document.createElement("style");n.textContent=t,(e.document.head||e.document.documentElement).appendChild(n)}))}))}})),Promise.resolve()):Promise.reject()}initializeLTAssistant(e,t={}){return Promise.resolve()}getPreferredLanguages(){return browser.runtime.sendMessage({command:"GET_PREFERRED_LANGUAGES"})}startDictionarySync(){return browser.runtime.sendMessage({command:"START_DICTIONARY_SYNC"})}updateDictionary(){return browser.runtime.sendMessage({command:"UPDATE_DICTIONARY"})}addWordToDictionary(e){const t={command:"ADD_WORD_TO_DICTIONARY",word:e};return browser.runtime.sendMessage(t)}addWordsToDictionary(e){const t={command:"BATCH_ADD_WORDS_TO_DICTIONARY",words:e};return browser.runtime.sendMessage(t)}removeWordFromDictionary(e){const t={command:"REMOVE_WORD_FROM_DICTIONARY",word:e};return browser.runtime.sendMessage(t)}clearDictionary(){return browser.runtime.sendMessage({command:"CLEAR_DICTIONARY"})}loadSynonyms(e,t,n){const s={command:"LOAD_SYNONYMS",wordContext:e,language:t,motherLanguage:n};return browser.runtime.sendMessage(s)}loadPhrases(e,t,n,s){const i={command:"LOAD_PHRASES",uuid:e,phrase:t,language:n,inhouseOnly:s};return browser.runtime.sendMessage(i)}reportPhrase(e,t){const n={command:"REPORT_PHRASE",uuid:e,report:t};return browser.runtime.sendMessage(n)}trackEvent(e,t){const n={command:"TRACK_EVENT",action:e,label:t};return browser.runtime.sendMessage(n)}trackTextLength(e){const t={command:"TRACK_TEXT_LENGTH",textLength:e};return browser.runtime.sendMessage(t)}pageLoaded(e,t,n,s,i){const o={command:"PAGE_LOADED",enabled:e,capitalization:t,supported:n,beta:s,unsupportedMessage:i};return browser.runtime.sendMessage(o)}ltAssistantStatusChanged(e,t){const n="object"==typeof e?e:t,s={command:"LTASSISTANT_STATUS_CHANGED",tabId:"number"==typeof e?e:void 0,enabled:n.enabled,capitalization:n.capitalization};return browser.runtime.sendMessage(s)}check(e,t,n,s,i,o){const r={command:"CHECK_TEXT",text:t,changedParagraphs:n,language:e.language,forceLanguage:e.forceLanguage,hasUserChangedLanguage:o,metaData:s,options:i};return browser.runtime.sendMessage(r)}isOptionsPageSupported(){return!0}openOptionsPage(e,t){const n={command:"OPEN_OPTIONS",target:e,ref:t};return browser.runtime.sendMessage(n)}isFeedbackFormSupported(){return!0}openFeedbackForm(e,t="",n=""){const s={command:"OPEN_FEEDBACK_FORM",url:e,title:t,html:n};return browser.runtime.sendMessage(s)}openPremiumPage(e,t=0,n=0,s=0,i="",o){const r={command:"OPEN_PREMIUM_PAGE",campaign:e,hiddenGrammarMatches:t,hiddenStyleMatches:n,hiddenPunctuationMatches:s,historicMatches:i,textLanguage:o||void 0};return browser.runtime.sendMessage(r)}}),w.init();const $e=document.getElementById("popup-container"),ze=document.getElementById("lt-popup__package-badge-container"),Xe=document.getElementById("onboarding-button"),Ye=document.getElementById("popup-hint"),je=document.getElementById("popup-option-synonyms"),qe=document.getElementById("popup-global-settings"),Ze=document.querySelector("#popup-option-capitalization"),Qe=document.querySelector("#popup-option-picky-mode"),Je=document.querySelector("#popup-option-check"),et=document.querySelector("#popup-option-synonyms"),tt=document.getElementById("popup-validator"),nt=document.getElementById("popup-validator-button"),st=document.getElementById("popup-teaser"),it=document.getElementById("feedback-link"),ot=document.getElementById("popup-more-options-link"),rt=document.getElementById("lt-popup-logo");var at;at=document.body,Array.from(at.querySelectorAll("[data-t]")).forEach((e=>{D(e,e.getAttribute("data-t"))})),Array.from(at.querySelectorAll("[data-t-placeholder]")).forEach((e=>{D(e,{key:e.getAttribute("data-t-placeholder"),attr:"placeholder"})})),Array.from(at.querySelectorAll("[data-t-html]")).forEach((e=>{D(e,{key:e.getAttribute("data-t-html"),isHTML:!0})})),Array.from(at.querySelectorAll("[data-t-title]")).forEach((e=>{D(e,{key:e.getAttribute("data-t-title"),attr:"title"})})),Array.from(at.querySelectorAll("[data-t-attr]")).forEach((e=>{const[t,n]=(e=>{const t=String(e.getAttribute("data-t-attr"));try{const e=JSON.parse(t);if((e=>Array.isArray(e)&&"string"==typeof e[0]&&"string"==typeof e[1]&&2===e.length)(e))return e;throw Error()}catch(e){return["",""]}})(e);t&&n&&D(e,{key:n,attr:t})})),D("#popup-onboarding-text-1",{key:"popupOnboardingStep1",isHTML:!0}),D("#popup-onboarding-text-2",{key:"popupOnboardingStep2",isHTML:!0,interpolations:['<span class="lt-popup__onboarding__icon1"></span>','<span class="lt-popup__onboarding__icon2"></span>']}),D("#popup-onboarding-text-3",{key:"popupOnboardingStep3",isHTML:!0}),D("#popup-onboarding-text-4",{key:"popupOnboardingStep4",isHTML:!0}),ot.setAttribute("title",s.getMessage("popupSettingsHover")),ot.addEventListener("click",(()=>{t.openOptionsPage(void 0,"popup-icon"),window.close()})),rt.addEventListener("click",(e=>{browser.runtime.sendMessage({command:"OPEN_URL",url:rt.href}),e.preventDefault(),window.close()})),Xe.addEventListener("click",(()=>{$e.classList.remove("lt-popup--show-onboarding"),$e.classList.remove("lt-popup--disabled"),lt.updateUIState({hasSeenOnboarding:!0}),w.trackEvent("Action","popup:onboarding_banner:close")})),it.addEventListener("click",(()=>t.openFeedbackForm(He)));let lt=M.create();lt.onReady((()=>{browser.tabs.query({currentWindow:!0,active:!0}).then((n=>{if(!n||!n.length)return void window.close();We=n[0].id,He=n[0].url||"about:blank",Fe=A(He),Ke=Be.getSiteTweaks(He);if(!lt.getPrivacySettings().allowRemoteCheck&&!He.startsWith(i.INSTALL_URL)&&!e.isSafari()){const e={command:"OPEN_PRIVACY_CONFIRMATION"};return browser.runtime.sendMessage(e),void window.close()}!function(e,t){Ve||(Ve=!0,browser.runtime.onMessage.addListener(((n,s)=>{n&&"INJECT_SCRIPTS"===n.command&&((browser.runtime.getManifest().content_scripts||[]).forEach((t=>{t.js&&"document_start"!==t.run_at&&t.js.forEach((t=>{browser.tabs.executeScript(e,{file:"/"+t,matchAboutBlank:!0,allFrames:!1,frameId:s.frameId}).catch((e=>console.error(e.message)))})),t.css&&t.css.forEach((t=>{browser.tabs.insertCSS(e,{file:"/"+t,matchAboutBlank:!0,allFrames:!1,frameId:s.frameId}).catch((e=>console.error(e.message)))}))})),w.trackEvent("Action","inject_scripts",t))}))),browser.tabs.executeScript(e,{code:'\n\t\t\t\tif (typeof(LTAssistant) === "undefined" && navigator.userAgent.match(/Chrome\\/|Chromium\\//) && !location.pathname.includes(\'_generated_background_page\')) {\n\t\t\t\t\twindow.__ltLastActiveElement = document.activeElement;\n\t\t\t\t\tchrome.runtime.sendMessage({ command: "INJECT_SCRIPTS" }, () => null);\n\t\t\t\t}\n\t\t\t',matchAboutBlank:!0,allFrames:!0}).catch((()=>null))}(We,Fe);const o=lt.getCheckSettings(Fe,Ke.getEditorGroupId(He)),r={enabled:!o.isDomainDisabled&&!o.isEditorGroupDisabled,supported:!0,unsupportedMessage:"",capitalization:o.shouldCapitalizationBeChecked,pickyMode:!0};Ke.isSupported()?lt.isDomainSupported(Fe)||(r.supported=!1,r.unsupportedMessage=browser.i18n.getMessage("siteTemporarilyUnsupported")):(r.supported=!1,r.unsupportedMessage=Ke.unsupportedMessage());const a=lt.getStatistics(),l=lt.getSettings(),c=lt.getUIState(),d=Date.now()-1e3*a.firstVisit;if(new ve(null,c.hasPaidSubscription?"premium":"basic","default",ze).getElement().addEventListener("click",(()=>{t.openOptionsPage(void 0,"popup-badge"),window.close()})),st.classList.add("lt-popup__teaser--hide"),a.appliedSuggestions<2&&!c.hasSeenOnboarding&&!e.isThunderbird())$e.classList.add("lt-popup--show-onboarding"),$e.classList.add("lt-popup--disabled"),w.trackEvent("Action","popup:onboarding_banner",Fe);else if(r.supported&&!lt.hasCustomServer())if(!c.hasPaidSubscription&&("like"===a.ratingValue||a.appliedSuggestions>7||d>432e5)){const e=oe(a);if(e.hiddenErrorsCount>5){const t="popup:historic_premium_teaser",n=browser.i18n.getMessage("historicPremiumErrorsHeadline"),s=browser.i18n.getMessage("historicPremiumErrorsText2",[e.hiddenErrorsCount,e.dayCount]),i=browser.i18n.getMessage("historicPremiumErrorsButton");st.classList.remove("lt-popup__teaser--hide"),new xe(st,t,n,s,i,{campaign:"addon2-popup-historic-premium-errors",historicMatches:e.hiddenErrorsCountStr})}else{const e="popup:premium_teaser",t=browser.i18n.getMessage("popupPremiumHeadline"),n=browser.i18n.getMessage("popupPremiumText"),s=browser.i18n.getMessage("popupPremiumLink");st.classList.remove("lt-popup__teaser--hide"),new xe(st,e,t,n,s,{campaign:"addon2-popup"})}w.trackEvent("Action","popup:upgrade_teaser")}else c.hasRated||(st.classList.remove("lt-popup__teaser--hide"),new Re(st,"popup",He));c.hasPaidSubscription&&$e.classList.add("lt-popup--plus"),lt.hasLanguageToolAccount()&&(nt.textContent=s.getMessage("popupOpenEditorButton"),nt.classList.add("lt-popup__button--edit"),tt.classList.remove("lt-popup__validator--hide"),nt.onclick=()=>{browser.runtime.sendMessage({command:"LAUNCH_EDITOR"}),w.trackEvent("Action","popup:open_editor"),window.close()});browser.tabs.sendMessage(We,{command:"GET_SELECTED_TEXT"}).then((e=>{!e||e.selectedText.trim().length<i.MIN_TEXT_LENGTH||He.includes("//"+browser.runtime.id)||(tt.classList.remove("lt-popup__validator--hide"),nt.textContent=s.getMessage(lt.hasLanguageToolAccount()?"popupOptionValidateInEditor":"popupOptionValidate"),nt.onclick=()=>{const t={command:"LAUNCH_EDITOR",text:e.selectedText,html:e.selectedHTML};browser.runtime.sendMessage(t),w.trackEvent("Action","popup:check_selected_text"),window.close()})})).catch((e=>console.log("Failed getting selected text",e))),r.supported||(Ye.classList.add("lt-popup__hint-visible"),Ye.innerHTML=r.unsupportedMessage,$e.classList.add("lt-popup--disabled"),w.trackEvent("Action","popup:disabled",A(He))),r.enabled||(Je.classList.add("lt-popup__option--switch-off"),Et(),Lt()),lt.hasCustomServer()&&Nt(),r.capitalization||Ze.classList.add("lt-popup__option--switch-off"),r.pickyMode||Qe.classList.add("lt-popup__option--switch-off"),l.hasSynonymsEnabled?et.classList.remove("lt-popup__option--switch-off"):et.classList.add("lt-popup__option--switch-off"),l.hasPickyModeEnabledGlobally?Qe.classList.remove("lt-popup__option--switch-off"):Qe.classList.add("lt-popup__option--switch-off"),Ze.addEventListener("click",(()=>ht())),Je.addEventListener("click",(()=>dt())),et.addEventListener("click",(()=>_t())),Qe.addEventListener("click",(()=>ut())),setTimeout((()=>{$e.classList.add("lt-popup--animations-enabled")}),500),w.trackPageView()}))}));const ct=e=>"extensions"===e?He:e,dt=()=>{Je.classList.contains("lt-popup__option--switch-off")?gt():mt()},ht=()=>{Ze.classList.contains("lt-popup__option--switch-off")?Ct():Tt()},_t=()=>{et.classList.contains("lt-popup__option--switch-off")?bt():At()},ut=()=>{Qe.classList.contains("lt-popup__option--switch-off")?ft():St()},gt=()=>{if(!lt)return;Je.classList.remove("lt-popup__option--switch-off");const e=Ke.getEditorGroupId(He);lt.enableDomainAndEditorGroup(Fe,e),t.ltAssistantStatusChanged(We,{enabled:!0}),pt(),It(),w.trackEvent("Action","enable_domain",ct(Fe))},mt=()=>{lt&&(Je.classList.add("lt-popup__option--switch-off"),lt.disableDomain(Fe),t.ltAssistantStatusChanged(We,{enabled:!1}),Lt(),Et(),w.trackEvent("Action","disable_domain",ct(Fe)))},pt=()=>{Ze.classList.remove("lt-popup__option--hide")},Et=()=>{Ze.classList.add("lt-popup__option--hide")},ft=()=>{lt&&(Qe.classList.remove("lt-popup__option--switch-off"),lt.updateSettings({hasPickyModeEnabledGlobally:!0}),w.trackEvent("Action","enable_picky_mode",x.getUserLanguageCodes()[0]))},St=()=>{lt&&(Qe.classList.add("lt-popup__option--switch-off"),lt.updateSettings({hasPickyModeEnabledGlobally:!1}),w.trackEvent("Action","disable_picky_mode",x.getUserLanguageCodes()[0]))},Ct=()=>{lt&&(Ze.classList.remove("lt-popup__option--switch-off"),lt.enableCapitalization(Fe),t.ltAssistantStatusChanged(We,{capitalization:!0}),w.trackEvent("Action","enable_capitalization",ct(Fe)))},Tt=()=>{lt&&(Ze.classList.add("lt-popup__option--switch-off"),lt.disableCapitalization(Fe),t.ltAssistantStatusChanged(We,{capitalization:!1}),w.trackEvent("Action","disable_capitalization",ct(Fe)))},bt=()=>{lt&&(et.classList.remove("lt-popup__option--switch-off"),lt.updateSettings({hasSynonymsEnabled:!0}),w.trackEvent("Action","enable_synonyms",x.getUserLanguageCodes()[0]))},At=()=>{lt&&(et.classList.add("lt-popup__option--switch-off"),lt.updateSettings({hasSynonymsEnabled:!1}),w.trackEvent("Action","disable_synonyms",x.getUserLanguageCodes()[0]))},Nt=()=>{je.classList.add("lt-popup__option--hide")},Lt=()=>{qe.classList.add("lt-popup__settings--hide")},It=()=>{qe.classList.remove("lt-popup__settings--hide")};e.isSafari()&&($e.classList.add("lt-popup--safari"),rt.href=rt.href+(rt.href.includes("?")?"&":"?")+"hidePremium=true"),e.isFirefox()&&$e.classList.add("lt-popup--firefox"),e.isThunderbird()&&$e.classList.add("lt-popup--thunderbird")})();