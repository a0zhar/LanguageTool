(()=>{"use strict";const e=class{static init(e){this._instance=e}static isProductionEnvironment(){return this._instance.isProductionEnvironment()}static isRuntimeConnected(){return this._instance.isRuntimeConnected()}static getVersion(){return this._instance.getVersion()}static getTrackingId(){return this._instance.getTrackingId()}static shouldTrack(){return this._instance.shouldTrack()}static getType(){return this._instance.getType()}static getURL(e){return this._instance.getURL(e)}static getUILanguageCode(){return this._instance.getUILanguageCode()}static openWindow(e){return this._instance.openWindow(e)}static loadContentScripts(e,t){return this._instance.loadContentScripts(e,t)}static initializeLTAssistant(e,t={}){return this._instance.initializeLTAssistant(e,t)}static getPreferredLanguages(){return this._instance.getPreferredLanguages()}static startDictionarySync(){return this._instance.startDictionarySync()}static addWordToDictionary(e){return this._instance.addWordToDictionary(e)}static addWordsToDictionary(e){return this._instance.addWordsToDictionary(e)}static removeWordFromDictionary(e){return this._instance.removeWordFromDictionary(e)}static clearDictionary(){return this._instance.clearDictionary()}static updateDictionary(){return this._instance.updateDictionary()}static loadSynonyms(e,t,n){return this._instance.loadSynonyms(e,t,n)}static loadPhrases(e,t,n,s){return this._instance.loadPhrases(e,t,n,s)}static reportPhrase(e,t){return this._instance.reportPhrase(e,t)}static trackEvent(e,t){return this._instance.trackEvent(e,t)}static trackTextLength(e){return this._instance.trackTextLength(e)}static pageLoaded(e,t,n,s,i){return this._instance.pageLoaded(e,t,n,s,i)}static ltAssistantStatusChanged(e,t){return"number"==typeof e?this._instance.ltAssistantStatusChanged(e,t):this._instance.ltAssistantStatusChanged(e)}static check(e,t,n,s,i,r){return this._instance.check(e,t,n,s,i,r)}static isOptionsPageSupported(){return this._instance.isOptionsPageSupported()}static openOptionsPage(e,t){return this._instance.openOptionsPage(e,t)}static isFeedbackFormSupported(){return this._instance.isFeedbackFormSupported()}static openFeedbackForm(e,t,n){return this._instance.openFeedbackForm(e,t,n)}static openPremiumPage(e,t=0,n=0,s=0,i="",r){return this._instance.openPremiumPage(e,t,n,s,i,r)}};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class t{static _contructor(){if(this._isInitialized)return;t._isChromium=navigator.userAgent.includes("Chrome/")||navigator.userAgent.includes("Chromium/"),t._isFirefox=navigator.userAgent.includes("Firefox/"),t._isThunderbird=navigator.userAgent.includes("Thunderbird/"),t._isOpera=navigator.userAgent.includes("OPR/"),t._isEdge=navigator.userAgent.includes("Edg/"),t._isOldEdge=navigator.userAgent.includes("Edge/"),t._isSafari=(navigator.userAgent.includes("Safari/")||navigator.userAgent.includes("AppleWebKit"))&&!t._isChromium&&!t._isEdge&&!t._isOpera,t._isYaBrowser=navigator.userAgent.includes("YaBrowser/"),t._isChrome=t._isChromium&&!t._isOpera&&!t._isEdge&&!t._isOldEdge&&!t._isYaBrowser;const e=navigator.userAgent.match(/Chrome\/(\d+)/);e&&(t._isUnsupportedChrome=parseInt(e[1])<67&&!navigator.userAgent.includes("Edge/"));const n=navigator.userAgent.match(/Firefox\/(\d+)/);n&&(t._isUnsupportedFirefox=parseInt(n[1])<60),this._isInitialized=!0}static getOS(){return navigator.userAgent.includes("Macintosh")?"Mac":navigator.userAgent.includes("Windows")?"Windows":navigator.userAgent.includes("CrOS")?"CrOS":navigator.userAgent.includes("Linux")?"Linux":"Other"}static isChromium(){return t._isChromium}static isChrome(){return t._isChrome}static isThunderbird(){return t._isThunderbird}static isFirefox(){return t._isFirefox}static isOpera(){return t._isOpera}static isEdge(){return t._isEdge}static isSafari(){return t._isSafari}static isYaBrowser(){return t._isYaBrowser}static isUnsupportedChrome(){return t._isUnsupportedChrome}static isUnsupportedFirefox(){return t._isUnsupportedFirefox}static isUnsupportedBrowser(){return t.isUnsupportedChrome()||t.isUnsupportedFirefox()}static getBrowserName(){return t.isChrome()?"Chrome":t.isFirefox()?"Firefox":t.isOpera()?"Opera":t.isEdge()?"Edge":t.isSafari()?"Safari":t.isYaBrowser()?"Yandex":"Unknown Browser"}static getUserAgentIdentifier(){let e="webextension";return this.isChrome()?e+="-chrome":this.isFirefox()?e+="-firefox":this.isOpera()?e+="-opera":this.isEdge()?e+="-edge":this.isYaBrowser()?e+="-chrome":this.isSafari()?e+="-safari":e+="-unknown",e+"-ng"}static isTouchDevice(){if(!("ontouchstart"in window))return!1;const e=navigator.userAgent.includes("Android");return this.isIOS()||e}static isIOS(){const e=navigator.userAgent.includes("iPhone OS"),t=navigator.userAgent.includes("Macintosh")&&Boolean(navigator.maxTouchPoints&&navigator.maxTouchPoints>2);return e||t}static isIOSTouchDevice(){return"ontouchstart"in window&&this.isIOS()}}t._isChromium=!1,t._isChrome=!1,t._isFirefox=!1,t._isThunderbird=!1,t._isOpera=!1,t._isOldEdge=!1,t._isEdge=!1,t._isSafari=!1,t._isYaBrowser=!1,t._isUnsupportedChrome=!1,t._isUnsupportedFirefox=!1,t._isInitialized=!1,t._contructor();
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class n{}n.eventNames={localeChanged:"lt-i18nManager.localeChanged"};const s=class{static init(e){this._instance=e}static addEventListener(e,t){this._instance.addEventListener(e,t)}static setLocale(e){this._instance.setLocale(e)}static getMessage(e,t){return this._instance.getMessage(e,t)}};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
const i={EXTENSION_HEALTH_RECHECK_INTERVAL:3e3,UI_MODE_RECHECK_INTERVAL:6e4,ACCOUNT_STATUS_RECHECK_INTERVAL:36e5,EXTERNAL_CONFIG_RELOAD_INTERVAL:144e5,PING_INTERVAL:864e5,SYNC_USER_DATA_INTERVAL:864e5,IFRAME_INITILIZATION_RECHECK_INTERVAL:1500,DICTIONARY_SYNC_INTERVAL:72e5,RENDER_INTERVAL:300,TOOLBAR_DECREASE_SIZE_INTERVAL:900,CHECK_REQUEST_TIMEOUT:5e4,CHECK_THROTTLING_LIMIT:30,INSTALL_URL:"https://languagetool.org/webextension/welcome",UNINSTALL_URL:"https://languagetool.org/webextension/uninstall",USER_DATA_URL:"https://languagetool.org/webextension/user",BASE_SERVER_URL:"https://api.languagetool.org",get MAIN_SERVER_URL(){return`${this.BASE_SERVER_URL}/v2`},MAIN_FALLBACK_SERVER_URL:"https://api-fallback.languagetool.org/v2",PREMIUM_SERVER_URL:"https://api.languagetoolplus.com/v2",PREMIUM_FALLBACK_SERVER_URL:"https://languagetoolplus.com/api/v2",LOCAL_SERVER_URL:"http://localhost:8081/v2",FEEDBACK_SERVER_URL:"https://languagetool.org/send-feedback/",EXTERNAL_CONFIG_URL:"https://languagetool.org/webextension_config.json",CLIENT_LOGIN_URL:"https://languagetool.org/client-login",PING_URL:"https://languagetool.org/ping",WEBAPI_URL:"https://languagetool.org/webapi",SWITCH_TO_FALLBACK_SERVER_ERRORS:[502,503,504],MAIN_SERVER_RECHECK_INTERVAL:18e4,MIN_TEXT_LENGTH:4,SHORT_TEXT_MAX_LENGTH:50,MAX_TEXT_LENGTH:1e4,TEXT_LEVEL_MAX_LENGTH_PER_REQUEST:2e4,MAX_TEXT_LENGTH_PERFORMANCE_DEGRADATION:4e4,MAX_TEXT_LENGTH_PREMIUM:1e5,MAX_TEXT_LENGTH_CUSTOM_SERVER:Number.MAX_SAFE_INTEGER,PARAGRAPH_LEVEL_CHUNK_LENGTH:5e3,CHECK_DELAY:1400,CHECK_MAX_DELAY:3500,STOPPED_TYPING_TIMEOUT:2250,COLORS:{GRAMMAR:{UNDERLINE:"#f2b24c",BACKGROUND:"rgba(242,179,77,0.3)",EMPHASIZE:"rgba(241,179,76,0.1)"},STYLE:{UNDERLINE:"#8F7FFF",BACKGROUND:"rgba(142,128,255,0.2)",EMPHASIZE:"rgba(138,128,255,0.1)",TITLE:"#5C4CFF"},LONG_SENTENCE:{UNDERLINE:"#D2CBFF",BACKGROUND:"rgba(210,203,255,0.2)",EMPHASIZE:"rgba(210,203,255,0.1)"},HIDDEN_MATCH:{UNDERLINE:"#F37B23",BACKGROUND:"rgba(253,177,55,0.2)",EMPHASIZE:"rgba(253,177,55,0.1)"},IGNORED_RANGE:{UNDERLINE:"#00bbe6",BACKGROUND:"rgb(92, 222, 251, 0.2)",EMPHASIZE:"rgb(154, 232, 250, 0.1)"},SPELLING:{UNDERLINE:"#EB5757",BACKGROUND:"rgba(235,88,88,0.2)",EMPHASIZE:"rgba(239,88,88,0.1)"},SYNONYMS:{UNDERLINE:"#0042d7"},NEW_SENTENCE:{BACKGROUND:"rgba(30, 225, 151, 0.2)"}},MAX_FIXES_COUNT:5,MAX_EXCEPTION_COUNT:6,MAX_USAGE_COUNT_ONBOARDING:5,SUPPORTED_SYNONYM_LANGUAGES:["de","de-CH","ru","sv","pt","el","en","eo","it","fr","es","uk","sk","sl","pl","da","ro","nl","ca"],COUNTRY_COUPON_MAPPING:{UKRAINE:{countries:["UA","BY"],percent:50},"ITALY-DISCOUNT":{countries:["IT"],percent:20},"SPAIN-DISCOUNT":{countries:["ES"],percent:20},SOUTH_EUROPE:{countries:["RO","AL","GR","ME","EE","LT","LV","BG","CY","MT","SK","SI","RS","HR","XK","HU","MD","TR","PT"],percent:20},AFRICA:{countries:["NG","ET","EG","CD","CG","TZ","KE","UG","DZ","SD","MA","AO","MZ","TN","CI","DJ","SZ","MU","GQ","GA","BW","SO","CD","ER","MG"],percent:50},ASIA:{countries:["ID","PK","BD","VN","MM","PH","UZ","MY","NP","KZ","KH","UZ","TH","YE","SY","JO"],percent:50},LATIN_AMERICA:{countries:["PE","VE","EC","SV","DO","BO","SR","AR","HN","BZ","CR","PA","GT","NI","GY","UY","HT","JM","TT","CU"],percent:50},BRAZIL:{countries:["BR"],percent:50}},COUPON_INTERVAL:5184e6,PACKAGE:{BASIC:"Basic",PREMIUM:"Premium"},PICKY_RULES_THAT_ARE_CONSIDERED_ANNOYING:["EN_QUOTES","PASSIVE_VOICE","DASH_RULE","SENTENCE_FRAGMENT","TOO_LONG_SENTENCE","FALSCHE_VERWENDUNG_DES_BINDESTRICHS","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_CH","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_2","PUNCTUATION_PARAGRAPH_END","FINAL_STOPS","FINAL_PUNCTUATION","SMART_QUOTES","DASH_SPACE_RULES","HIPHEN_SPACE_RULES","BRAK_KROPKI","DYWIZ","CUDZYSLOW_DRUKARSKI","EINDE_ZIN_ONVERWACHT","BACKTICK","GEDACHTESTREEPJE","OPTIONAL_HYPHEN"],ERRORS_THAT_CAN_BE_CORRECTED_ALL_AT_ONCE:[{ruleId:"FALSCHES_ANFUEHRUNGSZEICHEN",suggestions:[{match:/[„“]/,message:"Alle <lt-em>“</lt-em>…<lt-em>”</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN",suggestions:[{match:/[„“]/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"},{match:/(^»)|(«$)/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>»</lt-em>…<lt-em>«</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_CH",suggestions:[{match:/[„“]/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"},{match:/(^«)|(»$)/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>«</lt-em>…<lt-em>»</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_2",suggestions:[{match:/[‚‘]/,message:"Alle <lt-em>'</lt-em>…<lt-em>'</lt-em> zu <lt-em>‚</lt-em>…<lt-em>‘</lt-em> ändern"},{match:/[„“]/,message:"Alle <lt-em>'</lt-em>…<lt-em>'</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_APOSTROPHE",suggestions:[{match:/’/,message:"Alle Apostrophe zu <lt-em>’</lt-em> ändern"}]},{ruleId:"EN_QUOTES",suggestions:[{match:/[“”]/,message:"Change all <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> to <lt-em>“</lt-em>…<lt-em>”</lt-em>"}]},{ruleId:"WRONG_APOSTROPHE",suggestions:[{match:/'/,message:"Use <lt-em>'</lt-em> for all bad apostrophes"},{match:/’/,message:"Use <lt-em>’</lt-em> for all bad apostrophes"}]},{ruleId:"PARAGRAF_LEERZEICHEN",suggestions:[{match:/§\u00A0/,message:"Alle Leerzeichen nach <lt-em>§</lt-em> ändern"}]}]};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
function r(e,t){if("function"==typeof e.matchAll)return Array.from(e.matchAll(t));const n=[];let s=t.exec(e);for(;s;)n.push(s),s=t.exec(e);return n}function o(e){return e.length>0&&" "===e[e.length-1]}let a,l,c,d,h,_;function u(e){return/\s/.test(e)}function g(e){return e.substring(0,1).toUpperCase()+e.substring(1)}!function(){let e;try{e=new RegExp("\\p{L}","u")}catch(t){e=/[a-zäöüß]/i}a=function(t){return e.test(t)}}(),function(){const e=new RegExp("^[\b\t          ‏　]$"),t=new RegExp("[\b\t          ‏　]","g");l=function(t){return e.test(t)},c=function(e){return e.replace(t," ")}}(),function(){const e="​‌‍­⁠‪‫‬‭",t=new RegExp("^["+e+"]$"),n=new RegExp("["+e+"]"),s=new RegExp("["+e+"]","g");d=function(e){return t.test(e)},h=function(e){const t=e.match(n);return t?t.index:-1},_=function(e){return e.replace(s,"")}}();!function(){const e=/^[A-ZÈÉÊÁÀÂÓÒÔÚÙÛÍÌÎÄÜÖ]+[A-ZÈÉÊÁÀÂÓÒÔÚÙÛÍÌÎÄÜÖ\-!?#@=%().:;<>'’´`"”“*+,\s]+[A-ZÈÉÊÁÀÂÓÒÔÍÌÎÄÜÖ]$/}();let m,p;function E(e,t){if(0===t.length)return{text:e,originalText:e,usedParts:[{start:0,end:e.length,originalStart:0,originalEnd:e.length,posDiff:0,length:e.length,text:e}],ignoredParts:[]};t=function(e,t){const n=[];n.length=t,b(n,!1);const s=[];s.length=t;const i=[];i.length=t,b(i,0);for(const t of e)if("replacingText"in t)for(let e=0;e<t.replacingText.length;e++)s[t.offset+e]=t.replacingText[e],i[t.offset+e]=t.offsetShift||0;else b(n,!0,t.offset,t.offset+t.length);for(let e=0;e<t;e++)n[e]&&(s[e]=void 0,i[e]=0);const r=[];let o=0;for(;o<t;)if(n[o]){let e=o;for(;e<t&&n[e];)e++;r.push({offset:o,length:e-o}),o=e}else o++;for(o=0;o<t;)if(void 0!==s[o]){const e=i[o];let t=o;for(;t<s.length&&i[t]===e&&void 0!==s[t];)t++;const n=s.slice(o,t).join("");r.push({offset:o,length:t-o,replacingText:n,offsetShift:e}),o=t}else o++;return r.sort(((e,t)=>e.offset-t.offset)),r}(t,e.length);const n=[];let s=0,i=0;for(const r of t){if(i<r.offset){const t=r.offset-i;n.push({start:s,end:s+t,originalStart:i,originalEnd:i+t,posDiff:i-s,length:t,text:e.substr(i,t)}),s+=t}if("replacingText"in r){let e=r.offset;e+=r.offsetShift||0,n.push({start:s,end:s+r.length,originalStart:e,originalEnd:e+r.length,posDiff:e-s,length:r.length,text:r.replacingText.padEnd(r.length," ")}),s+=r.length}i=r.offset+r.length}if(i<e.length){const t=e.length-i;n.push({start:s,end:s+t,originalStart:i,originalEnd:i+t,posDiff:i-s,length:t,text:e.substr(i)})}const r=n.map((e=>e.text)).join(""),o=[];for(const e of t)if("replacingText"in e){const t=e.offsetShift||0;0!==t&&o.push({start:e.offset,end:e.offset+t}),e.length!==e.replacingText.length+t&&o.push({start:e.offset+t+e.replacingText.length,end:e.offset+e.length})}else o.push({start:e.offset,end:e.offset+e.length});return{text:r,originalText:e,usedParts:n,ignoredParts:o}}function f(e,t){if(e===t)return null;let n=0;const s=Math.max(e.length,t.length);for(n=0;n<s&&e[n]===t[n];n++);let i=0;const r=Math.min(e.length,t.length);for(;n+i<r;){if(e[e.length-i-1]!==t[t.length-i-1])break;i++}return{from:n,oldFragment:e.substring(n,e.length-i),newFragment:t.substring(n,t.length-i)}}function C(e,t){const n=[],s=e.split("\n"),i=t.split("\n");let r=0;const o=Math.max(s.length,i.length);for(r=0;r<o&&s[r]===i[r];r++);let a=0;const l=Math.min(s.length,i.length);for(;r+a<l;){if(s[s.length-a-1]!==i[i.length-a-1])break;a++}let c=0;for(let e=0;e<r;e++)c+=s[e].length+1;let d=c;for(let e=r;e<o-a;e++){const t=e<s.length-a?s[e]:null,r=e<i.length-a?i[e]:null;t===r&&c===d||n.push({oldText:t,newText:r,oldOffset:c,newOffset:d,textDiff:f(t||"",r||"")}),null!==t&&(c+=t.length+1),null!==r&&(d+=r.length+1)}if(c!==d)for(let e=a-1;e>=0;e--){const t=s[s.length-e-1],r=i[i.length-e-1];n.push({oldText:t,newText:r,oldOffset:c,newOffset:d,textDiff:null}),c+=t.length+1,d+=r.length+1}return n}function S(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/`/g,"&#x60;").replace(/\//g,"&#x2F;")}function T(e,t){let n=0,s=e.length-1;for(;n<=s;){const i=n+Math.ceil((s-n)/2),r=t(e[i]);if(r>0)n=i+1;else{if(!(r<0)){for(let n=i;n>0;n--)if(0!==t(e[n-1]))return e[n];return e[0]}s=i-1}}return null}function v(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function b(e,t,n=0,s=e.length){for(let i=n;i<s;i++)e[i]=t}function A(e,t){return e===t||JSON.stringify(e)===JSON.stringify(t)}function y(e){return null===e||"object"!=typeof e?e:e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e):Array.isArray(e)?Array.from(e):Object.assign({},e)}function L(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e);if(e instanceof RegExp)return new RegExp(e);const t=Array.isArray(e)?[]:{};for(const n in e)t[n]=L(e[n]);return t}function I(e){const t=e.toString();return 1===t.length?"0"+t:t}function N(){if("about:blank"===location.href||"about:srcdoc"===location.href)try{return(window.opener||window.parent).location.href}catch(e){}return location.href}function x(e,t=e){if(e.startsWith("about:blank"))return"blank";if(e.startsWith("about:srcdoc"))return"srcdoc";if(e.startsWith("file:"))return"file";e&&!/^([a-z\-]+:\/\/)/i.test(e)&&(e="http://"+e);try{return new URL(e).hostname}catch(e){return t}}function k(){const e=document.location||document.defaultView.location;if(e&&e.hostname)return e.hostname.replace(/^www\./,"");try{if(window.parent!==window)return window.parent.location.hostname.replace(/^www\./,"")}catch(e){}return e.href.startsWith("about:blank")?"blank":e.href.startsWith("about:srcdoc")?"srcdoc":e.href.startsWith("file:")?"file":""}function w(e,t){return e.toLocaleString(t)}function M(){let e;return window.parent!==window&&document.referrer&&(e=x(document.referrer)),e||(e=k()),e}function R(e){const t=[e];for(;e.split(".").length>2;){const n=e.indexOf(".");e=e.substr(n+1),t.push(e)}return t}!function(){let e,t;const n=/(?:\S+\s+){0,4}\S+$/,s=/^\S+(?:\s+\S+){0,4}/;try{e=new RegExp("^\\s*(-?\\p{L}+)*-?\\s*$","u"),t=new RegExp("^\\s*\\p{L}+(-\\p{L}+)*\\s*$","u")}catch(n){e=/^\s*(-?[a-zäöüß]+)*-?\s*$/i,t=/^\s*[a-zäöüß]+(-[a-zäöüß]+)*\s*$/i}m=(n,s,i=s)=>{const r=n.substring(s,i);if(!e.test(r))return null;let o=0===r.length||a(r[0]),l="-"===r[0],c=s;if(o||l)for(;c>0;){const e=n[c-1],t=a(e),s="-"===e;if(!t&&!s)break;if(s&&l)return null;c--,o=t,l=s}o=a(r[r.length-1]),l=r.endsWith("-");let d=i;if(o||l)for(;d<n.length;){const e=n[d],t=a(e),s="-"===e;if(!t&&!s)break;if(s&&l)return null;d++,o=t,l=s}const h=r.match(/\s+$/);h&&(d-=h[0].length);const _=n.substring(c,d);return t.test(_)?{start:c,end:d}:null},p=(e,t,i)=>{const r=m(e,t,i);if(!r)return null;const o=n.exec(e.substring(0,r.start).trim()),a=o?o[0]:"",l=s.exec(e.substring(r.end).trim()),c=l?l[0]:"";return{word:e.substring(r.start,r.end),position:r,beforeText:a,afterText:c}}}();const P=function(){const e=/^\w+\.$/;return(t,n)=>{if(!t.isSpellingError)return!1;let s=t.originalPhrase;if(e.test(s)&&(s=s.substring(0,s.length-1)),n.includes(s))return!0;if(function(e){const t=e.charAt(0);return t===t.toUpperCase()&&t!==t.toLowerCase()}(s)){const e=(i=s).charAt(0).toLowerCase()+i.substr(1);if(n.includes(e))return!0}var i;return!1}}();function O(e,t){const n=e.language.code.split("-")[0];return t.some((t=>!(t.id!==e.rule.id||"*"!==t.language&&t.language!==n)&&(!t.phrase||(!!(t.id.includes("TOO_LONG_SENTENCE")&&function(e,t,n=2,s=!1){s||(e=e.toLowerCase(),t=t.toLowerCase());if(e.length<n||t.length<n)return 0;const i=new Map;for(let t=0;t<e.length-(n-1);t++){const s=e.substr(t,n);i.set(s,i.has(s)?i.get(s)+1:1)}let r=0;for(let e=0;e<t.length-(n-1);e++){const s=t.substr(e,n),o=i.has(s)?i.get(s):0;o>0&&(i.set(s,o-1),r++)}return 2*r/(e.length+t.length-2*(n-1))}(t.phrase,e.originalPhrase)>.75)||t.phrase.toLowerCase()===e.originalPhrase.toLowerCase()))))}const D=function(){const e=/[\u0300-\u036f]/g,t=/\u0142/g,n=/\u00F8/g;return function(s){return s.normalize("NFD").replace(e,"").replace(t,"l").replace(n,"o")}}();function U(e,t,n,s,i=!1){return i?e<=s&&t>=n:e<s&&t>n}function B(e,t,n,s=!1){if(s){if(t<=e&&e<n)return 0}else if(t<=e&&e<=n)return 0;return e-t}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class G{constructor(){this._eventHandlers=new Map}subscribe(e,t){this._eventHandlers.has(e)||this._eventHandlers.set(e,[]),this._eventHandlers.get(e).push(t)}fire(e,t){const n=this._eventHandlers.get(e);n&&n.forEach((e=>{try{e(t)}catch(e){console.error(e)}}))}destroy(){this._eventHandlers.clear()}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class H{static get LANGUAGES(){return this._languages||(this._languages=[{code:"ar",name:s.getMessage("ar")},{code:"ast-es",name:s.getMessage("ast")},{code:"be-by",name:s.getMessage("be")},{code:"br-fr",name:s.getMessage("br")},{code:"ca-es",name:s.getMessage("ca")},{code:"ca-es-valencia",name:s.getMessage("ca_ES_valencia")},{code:"da-dk",name:s.getMessage("da_DK")},{code:"de-at",name:s.getMessage("de_AT")},{code:"de-ch",name:s.getMessage("de_CH")},{code:"de-de",name:s.getMessage("de_DE")},{code:"el-gr",name:s.getMessage("el")},{code:"en-au",name:s.getMessage("en_AU")},{code:"en-ca",name:s.getMessage("en_CA")},{code:"en-gb",name:s.getMessage("en_GB")},{code:"en-nz",name:s.getMessage("en_NZ")},{code:"en-us",name:s.getMessage("en_US")},{code:"en-za",name:s.getMessage("en_ZA")},{code:"eo",name:s.getMessage("eo")},{code:"es",name:s.getMessage("es")},{code:"fa",name:s.getMessage("fa")},{code:"ga-ie",name:s.getMessage("ga")},{code:"fr",name:s.getMessage("fr")},{code:"gl-es",name:s.getMessage("gl")},{code:"it",name:s.getMessage("it")},{code:"ja-jp",name:s.getMessage("ja")},{code:"km-kh",name:s.getMessage("km")},{code:"nl",name:s.getMessage("nl")},{code:"no",name:s.getMessage("no")},{code:"pl-pl",name:s.getMessage("pl")},{code:"pt-ao",name:s.getMessage("pt_AO")},{code:"pt-br",name:s.getMessage("pt_BR")},{code:"pt-mz",name:s.getMessage("pt_MZ")},{code:"pt-pt",name:s.getMessage("pt_PT")},{code:"ro-ro",name:s.getMessage("ro")},{code:"ru-ru",name:s.getMessage("ru")},{code:"sk-sk",name:s.getMessage("sk")},{code:"sl-si",name:s.getMessage("sl")},{code:"sv",name:s.getMessage("sv")},{code:"ta-in",name:s.getMessage("ta")},{code:"tl-ph",name:s.getMessage("tl")},{code:"uk-ua",name:s.getMessage("uk")},{code:"zh-cn",name:s.getMessage("zh")}],this._languages.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),this._isSubscribed||(s.addEventListener(n.eventNames.localeChanged,(()=>this._languages=null)),this._isSubscribed=!0)),this._languages}static isLanguageVariant(e){return e.code.includes("-")}static getPrimaryLanguageCode(e){return e.split("-")[0]}static formatLanguageCode(e){const t=e.split("-");return 1===t.length?t[0]:2===t.length?t[0]+"-"+t[1].toUpperCase():t[0]+"-"+t[1].toUpperCase()+"-"+t[2]}static getUserLanguageCode(){for(const e of navigator.languages){if(e.includes("-")&&e.startsWith(navigator.language))return e}return navigator.language}static getUserLanguageCodes(){const t=Array.from(navigator.languages,(e=>this.getPrimaryLanguageCode(e).toLowerCase()));try{t.push(this.getPrimaryLanguageCode(e.getUILanguageCode()).toLowerCase())}catch(e){}return v(t)}static getPreferredLanguageVariant(e){const t={"en-in":"en-us","en-ie":"en-gb"},n=navigator.languages||[];for(let s of n){s=s.toLowerCase(),s=t[s]||s;for(const t of e){const e=t.toLowerCase();if(s.length>2&&s===e)return t}}return null}static getLanguagesForGeoIPCountry(){return new Promise((function(e,t){let n=!1;const s=window.setTimeout((()=>{n=!0,t(new Error("geoip timeout"))}),15e3);fetch("https://languagetool.org/webextension/init",{method:"GET",mode:"cors"}).then((e=>e.json())).then((t=>{if(!n){const n=(t.geoIpCountry||"").toUpperCase();e({geoIpLanguages:t.geoIpLanguages||[],geoIpCountry:n}),clearTimeout(s)}})).catch((e=>{console.error(e),n||(t(e),clearTimeout(s))}))}))}}H._languages=null,H._isSubscribed=!1,H.ALL_LANGUAGES=[{code:"ak",name:"Akan"},{code:"am",name:"አማርኛ"},{code:"an",name:"aragonés"},{code:"ar",name:"عربي"},{code:"as",name:"অসমীয়া"},{code:"ast",name:"Asturianu"},{code:"be",name:"Беларуская"},{code:"bg",name:"Български"},{code:"bm",name:"Bamanankan"},{code:"bn",name:"বাংলা"},{code:"br",name:"Brezhoneg"},{code:"bs",name:"босански"},{code:"ca",name:"Català"},{code:"cs",name:"čeština"},{code:"cy",name:"Cymraeg"},{code:"da",name:"Dansk"},{code:"de",name:"Deutsch"},{code:"el",name:"Ελληνικά"},{code:"en",name:"English"},{code:"eo",name:"Esperanto"},{code:"es",name:"Español"},{code:"et",name:"Eesti keel"},{code:"eu",name:"Euskara"},{code:"fa",name:"فارسی"},{code:"fi",name:"suomi"},{code:"fj",name:"Vosa vaka-Viti"},{code:"fr",name:"Français"},{code:"ga",name:"Gaeilge"},{code:"gd",name:"Gàidhlig"},{code:"gl",name:"Galego"},{code:"gn",name:"Avañe'ẽ"},{code:"gu",name:"ગુજરાતી"},{code:"ha",name:"هَرْشَن هَوْسَ‎"},{code:"he",name:"עברית"},{code:"hi",name:"हिन्दी"},{code:"hr",name:"hrvatski"},{code:"hu",name:"magyar"},{code:"hy",name:"Հայերեն"},{code:"ia",name:"Interlingua"},{code:"id",name:"Bahasa Indonesia"},{code:"ig",name:"Ásụ̀sụ̀ Ìgbò"},{code:"is",name:"íslenska"},{code:"it",name:"Italiano"},{code:"ja",name:"日本語"},{code:"kk",name:"Қазақ"},{code:"km",name:"ខ្មែរ"},{code:"kn",name:"ಕನ್ನಡ"},{code:"ko",name:"한국어"},{code:"ku",name:"Kurdî"},{code:"ks",name:"كشمیری"},{code:"la",name:"Latina"},{code:"lg",name:"Luganda"},{code:"lo",name:"ພາສາລາວ"},{code:"lt",name:"Lietuvių"},{code:"lv",name:"Latviešu"},{code:"mg",name:"malagasy"},{code:"mi",name:"Māori"},{code:"ml",name:"മലയാളം"},{code:"mk",name:"Македонски"},{code:"mn",name:"Монгол"},{code:"mr",name:"मराठी"},{code:"ms",name:"Melayu"},{code:"my",name:"မြန်မာဘာသာ"},{code:"nb",name:"Norsk bokmål"},{code:"ne",name:"नेपाली"},{code:"nn",name:"Norsk nynorsk"},{code:"no",name:"Norsk"},{code:"nl",name:"Nederlands"},{code:"nr",name:"isiNdebele"},{code:"oc",name:"Occitano"},{code:"or",name:"ଓଡ଼ିଆ"},{code:"pa",name:"ਪੰਜਾਬੀ"},{code:"pl",name:"Polski"},{code:"ps",name:"پښتو"},{code:"pt",name:"Português"},{code:"rm",name:"rumantsch"},{code:"ro",name:"românesc"},{code:"ru",name:"Русский"},{code:"rw",name:"Ikinyarwanda"},{code:"sa",name:"संस्कृत"},{code:"si",name:"සිංහල"},{code:"sk",name:"slovenčina"},{code:"sl",name:"Slovenščina"},{code:"so",name:"Soomaali"},{code:"sr",name:"Српски"},{code:"ss",name:"siSwati"},{code:"st",name:"Sesotho"},{code:"sv",name:"Svenska"},{code:"ta",name:"தமிழ்"},{code:"te",name:"తెలుగు"},{code:"th",name:"ภาษาไทย"},{code:"tl",name:"Tagalog"},{code:"fil",name:"Filipino"},{code:"tr",name:"Türkçe"},{code:"ts",name:"Xitsonga"},{code:"tt",name:"Tatarça"},{code:"uk",name:"Українська"},{code:"ur",name:"اُردو"},{code:"uz",name:"Oʻzbek tili"},{code:"ve",name:"Tshivenḓa"},{code:"vi",name:"Tiếng Việt"},{code:"yo",name:"عِدعِ يوْرُبا"},{code:"zh",name:"中文"},{code:"zu",name:"isiZulu"}],H.POPULAR_LANGUAGES=["de","en","es","fr","nl","pl","pt","ru","uk","zh","it","hi"];
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class F{constructor(){this._eventBus=new G,this._onReadyCallbacks=[]}static get DEFAULT_SETTINGS(){return null===this.DEFAULT_SETTINGS_CACHED&&(this.DEFAULT_SETTINGS_CACHED={apiServerUrl:i.MAIN_SERVER_URL,autoCheck:!0,knownEmail:"",username:"",password:"",token:"",userId:null,dpaLevel:0,motherTongue:"",geoIpLanguages:[],geoIpCountry:"",preferredLanguages:[],enVariant:H.getPreferredLanguageVariant(["en-US","en-GB","en-AU","en-CA","en-NZ","en-ZA"])||"en-US",deVariant:H.getPreferredLanguageVariant(["de-DE","de-AT","de-CH"])||"de-DE",ptVariant:H.getPreferredLanguageVariant(["pt-PT","pt-BR","pt-MZ","pt-AO"])||"pt-BR",caVariant:"ca-ES",dictionary:[],hasSynonymsEnabled:!1,hasPickyModeEnabledGlobally:!1,openCardHotkey:"",isDictionarySynced:!1,ignoredRules:[],disabledDomains:[],disabledEditorGroups:[],disabledDomainsCapitalization:[],ignoreCheckOnDomains:[],autoCheckOnDomains:[],confirmedGPT3:!1}),this.DEFAULT_SETTINGS_CACHED}static _combineObjects(e,t){const n=L(e);for(const e in n)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}static _dec2hex(e){return("0"+e.toString(16)).substr(-2)}static _generateUniqueId(){const e=new Uint8Array(8);return window.crypto.getRandomValues(e),Array.from(e,F._dec2hex).join("")}static _normalizeDomain(e=""){return e.toLowerCase().trim().replace(/^www\./,"")}static _isListContainsDomain(e,t){const n=F._normalizeDomain(t);return(e||[]).some((e=>{const t=F._normalizeDomain(e);return t===n||n.endsWith("."+t)}))}static getDefaultSettings(){return L(F.DEFAULT_SETTINGS)}static getDefaultPrivacySettings(){return y(F.DEFAULT_PRIVACY_SETTINGS)}addEventListener(e,t){this._eventBus.subscribe(e,t)}disableDomain(e){const t=F._normalizeDomain(e),n=this.getSettings(),s="object"==typeof n.disabledDomains?n.disabledDomains:[];return s.push(t),this.updateSettings({disabledDomains:s})}enableDomain(e){const t=F._normalizeDomain(e),n=this.getSettings();let s="object"==typeof n.disabledDomains?n.disabledDomains:[];return s=s.filter((e=>{const n=F._normalizeDomain(e);return n!==t&&!t.endsWith("."+n)})),this.updateSettings({disabledDomains:s})}disableEditorGroup(e,t){const n=F._normalizeDomain(e),s=this.getSettings(),i="object"==typeof s.disabledEditorGroups?s.disabledEditorGroups:[];return i.push({domain:n,editorGroupId:t}),this.updateSettings({disabledEditorGroups:i})}enableEditorGroup(e,t){const n=F._normalizeDomain(e),s=this.getSettings();let i="object"==typeof s.disabledEditorGroups?s.disabledEditorGroups:[];return i=i.filter((e=>!(e.domain===n&&e.editorGroupId===t))),this.updateSettings({disabledEditorGroups:i})}enableDomainAndEditorGroup(e,t){return this.getCheckSettings(e,t).isEditorGroupDisabled&&this.enableEditorGroup(e,t),this.enableDomain(e)}disableCapitalization(e){const t=F._normalizeDomain(e),n=this.getSettings(),s="object"==typeof n.disabledDomainsCapitalization?n.disabledDomainsCapitalization:[];return s.push(t),this.updateSettings({disabledDomainsCapitalization:s})}enableCapitalization(e){const t=F._normalizeDomain(e),n=this.getSettings();let s="object"==typeof n.disabledDomainsCapitalization?n.disabledDomainsCapitalization:[];return s=s.filter((e=>{const n=F._normalizeDomain(e);return n!==t&&!t.endsWith("."+n)})),this.updateSettings({disabledDomainsCapitalization:s})}destroy(){this._eventBus.destroy(),this._onReadyCallbacks=[]}}F.eventNames={settingsChanged:"lt-storageController.settingsChanged",configurationChanged:"lt-storageController.configurationChanged",privacySettingsChanged:"lt-storageController.privacySettingsChanged",uiStateChanged:"lt-storageController.uiStateChanged"},F.DEFAULT_SETTINGS_CACHED=null,F.DEFAULT_MANAGED_SETTINGS={apiServerUrl:"",loginUrl:"",disablePrivacyConfirmation:!1,disablePersonalDictionary:!1,disableIgnoredRules:!1},F.DEFAULT_CONFIGURATION={unsupportedDomains:[]},F.DEFAULT_PRIVACY_SETTINGS={allowRemoteCheck:!1},F.DEFAULT_STATISTICS={usageCount:0,sessionCount:0,appliedSuggestions:0,appliedSynonyms:0,hiddenErrors:[],firstVisit:null,lastActivity:null,ratingValue:null,premiumClicks:0,isOverleafUser:!1,isThunderbirdUser:!1,isNotionUser:!1},F.DEFAULT_UI_STATE={hasSeenPrivacyConfirmationDialog:!1,hasPaidSubscription:!1,hasRated:!1,hasUsedValidator:!1,hasSeenOnboarding:!1,isNewUser:!1,hasSeenNewOverleafTeaser:!1,hasSeenNewGoogleDocsTeaser:!1,hasSeenNewGoogleSlidesTeaser:!1,hasSeenGoogleDocsMenuBarHint:!1,lastChangelogNov2021Seen:null,changelogNov2021CountdownEnd:null,changelogNov2021Coupon:null,showRuleId:!1,dialogPosition:"default",countMode:"characters",hasSeenTurnOnMessagePopup:!1},F.DEFAULT_TEST_FLAGS={};class W{static init(e){this._instanceCtor=e}static create(){return this._instanceCtor()}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class $ extends F{constructor(){super(),this._onStoredDataChanged=(e,t)=>{let n=!1,s=!1,i=!1,r=!1,o=!1;for(const a in e)"managed"!==t?(/^dictionary(_\d+)?$/.test(a)&&(n=!0),this._settings&&F.DEFAULT_SETTINGS.hasOwnProperty(a)&&"dictionary"!==a&&(this._settings[a]=e[a].newValue,s=!0),this._configuration&&F.DEFAULT_CONFIGURATION.hasOwnProperty(a)&&(this._configuration[a]=e[a].newValue,i=!0),this._privacySettings&&F.DEFAULT_PRIVACY_SETTINGS.hasOwnProperty(a)&&(this._privacySettings[a]=e[a].newValue,r=!0),this._statistics&&F.DEFAULT_STATISTICS.hasOwnProperty(a)&&(this._statistics[a]=e[a].newValue),this._uiState&&F.DEFAULT_UI_STATE.hasOwnProperty(a)&&(this._uiState[a]=e[a].newValue,o=!0),this._testFlags&&F.DEFAULT_TEST_FLAGS.hasOwnProperty(a)&&(this._testFlags[a]=e[a].newValue),"uniqueId"===a&&(this._uniqueId=e[a].newValue)):this._managedSettings&&F.DEFAULT_MANAGED_SETTINGS.hasOwnProperty(a)&&(this._managedSettings[a]=e[a].newValue);if(s){for(const e of this._settings.ignoredRules)e.turnOffDate&&(e.turnOffDate=new Date(e.turnOffDate));this._eventBus.fire(F.eventNames.settingsChanged,e)}n&&this._storage.get().then((e=>{if(!this._settings)return;const t=this._joinChunks(e,"dictionary"),n={dictionary:{oldValue:this._settings.dictionary,newValue:t}};this._settings.dictionary=t,this._eventBus.fire(F.eventNames.settingsChanged,n)})),i&&this._eventBus.fire(F.eventNames.configurationChanged,e),r&&this._eventBus.fire(F.eventNames.privacySettingsChanged,e),o&&this._eventBus.fire(F.eventNames.uiStateChanged,e)},this._storage=$._getStorage(),this._managedStorage=$._getManagedStorage(),this._isInitialized=!1,this._loadData(),browser.storage.onChanged.addListener(this._onStoredDataChanged)}static _getStringSize(e){let t=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t+=s<128?1:s<2048?2:s<65536?3:s<1<<21?4:s<1<<26?5:s<1<<31?6:Number.NaN}return t}static _getStorage(){return browser.storage.sync&&!t.isFirefox()?browser.storage.sync:browser.storage.local}static _getManagedStorage(){return browser.storage.managed}_splitInChunks(e,t,n=this._storage.QUOTA_BYTES_PER_ITEM){let s=e[t],i=0,r=[],o=$._getStringSize(t)+$._getStringSize("[]");for(;s.length;){const a=s.shift(),l=$._getStringSize(`,"${a}"`);if(o+l>n){e[0===i?t:`${t}_${i}`]=r,i++,r=[a],o=$._getStringSize(`${t}_${n}`)+$._getStringSize(`["${a}"]`)}else r.push(a),o+=l;if(0===s.length){e[0===i?t:`${t}_${i}`]=r}}e[`${t}_${i+1}`]=[]}_joinChunks(e,t,n=this._storage.MAX_ITEMS){let s=e[t]||[];for(let i=1;i<n;i++){const n=e[`${t}_${i}`];if(void 0===n||0===n.length)break;s=s.concat(n)}return s}_loadData(){const e=this._storage.get().then((e=>{const t=F._combineObjects(F.DEFAULT_SETTINGS,e);t.dictionary=this._joinChunks(e,"dictionary");for(const e of t.ignoredRules){if(void 0===e.description){const t=F.DEFAULT_SETTINGS.ignoredRules.find((t=>t.id===e.id&&t.language===e.language));e.description=t?t.description:""}if(void 0===e.turnOffDate){const t=F.DEFAULT_SETTINGS.ignoredRules.some((t=>t.id===e.id&&t.language===e.language));e.turnOffDate=t?null:new Date(2019,9,1)}else null!==e.turnOffDate&&(e.turnOffDate=new Date(e.turnOffDate))}t.disabledDomains=t.disabledDomains.map((e=>x(e,""))).filter((e=>e)),t.ignoreCheckOnDomains=t.ignoreCheckOnDomains.map((e=>x(e,""))).filter((e=>e)),t.autoCheckOnDomains=t.autoCheckOnDomains.map((e=>x(e,""))).filter((e=>e)),this._settings=t,this._configuration=F._combineObjects(F.DEFAULT_CONFIGURATION,e),this._privacySettings=F._combineObjects(F.DEFAULT_PRIVACY_SETTINGS,e),this._statistics=F._combineObjects(F.DEFAULT_STATISTICS,e),this._uiState=F._combineObjects(F.DEFAULT_UI_STATE,e),this._testFlags=F._combineObjects(F.DEFAULT_TEST_FLAGS,e),e.uniqueId?this._uniqueId=e.uniqueId:(this._uniqueId=F._generateUniqueId(),this._storage.set({uniqueId:this._uniqueId})),this._statistics.firstVisit||this.updateStatistics({firstVisit:Math.round(Date.now()/1e3)})})),t=this._managedStorage.get().then((e=>{this._managedSettings=F._combineObjects(F.DEFAULT_MANAGED_SETTINGS,e)})).catch((()=>{this._managedSettings=F._combineObjects(F.DEFAULT_MANAGED_SETTINGS,{})}));Promise.all([e,t]).then((()=>{this._isInitialized=!0,this._onReadyCallbacks.forEach((e=>e(this))),this._onReadyCallbacks=[]}))}isReady(){return this._isInitialized}onReady(e){this._isInitialized?e(this):this._onReadyCallbacks.push(e)}getUniqueId(){return this._uniqueId}getSettings(){return L(this._settings)}updateSettings(e){for(const t in e)if(!F.DEFAULT_SETTINGS.hasOwnProperty(t))throw new Error(`Unknown setting ${t}`);if(Object.assign(this._settings||{},L(e)),void 0===e.dictionary||t.isFirefox()||this._splitInChunks(e,"dictionary"),void 0!==e.ignoredRules)for(const t of e.ignoredRules)null!==t.turnOffDate&&(t.turnOffDate=t.turnOffDate.toISOString());return this._storage.set(e)}getCheckSettings(e,t){if(!this._settings)return{isDomainDisabled:!1,isEditorGroupDisabled:!1,isAutoCheckEnabled:!0,shouldCapitalizationBeChecked:!0};if(e===browser.runtime.id)return{isDomainDisabled:!1,isEditorGroupDisabled:!1,isAutoCheckEnabled:!0,shouldCapitalizationBeChecked:!0};const n=(this._settings.disabledEditorGroups||[]).some((n=>F._normalizeDomain(n.domain)===F._normalizeDomain(e)&&n.editorGroupId===t)),s=F._isListContainsDomain(this._settings.disabledDomains,e),i=!F._isListContainsDomain(this._settings.disabledDomainsCapitalization,e);if(this._settings.autoCheck){return{isDomainDisabled:s,isEditorGroupDisabled:n,isAutoCheckEnabled:!F._isListContainsDomain(this._settings.ignoreCheckOnDomains,e),shouldCapitalizationBeChecked:i}}return{isDomainDisabled:s,isEditorGroupDisabled:n,isAutoCheckEnabled:F._isListContainsDomain(this._settings.autoCheckOnDomains,e),shouldCapitalizationBeChecked:i}}hasLanguageToolAccount(){return Boolean(this._settings&&this._settings.username&&!this.hasCustomServer())}hasCustomServer(){return this._managedSettings&&this._managedSettings.apiServerUrl?this._managedSettings.apiServerUrl!==F.DEFAULT_SETTINGS.apiServerUrl:Boolean(this._settings&&this._settings.apiServerUrl&&this._settings.apiServerUrl.trim()&&this._settings.apiServerUrl!==i.MAIN_SERVER_URL&&this._settings.apiServerUrl!==i.PREMIUM_SERVER_URL)}getCustomServerUrl(){return this.hasCustomServer()?this._managedSettings.apiServerUrl||this._settings.apiServerUrl:null}getManagedSettings(){return y(this._managedSettings)}getConfiguration(){return y(this._configuration)}updateConfiguration(e){for(const t in e)if(!F.DEFAULT_CONFIGURATION.hasOwnProperty(t))throw new Error(`Unknown configuration ${t}`);return Object.assign(this._configuration||{},y(e)),this._storage.set(e)}isDomainSupported(e){return!this._configuration||!this._configuration.unsupportedDomains.includes("*")&&!F._isListContainsDomain(this._configuration.unsupportedDomains,e)}getPrivacySettings(){return y(this._privacySettings)}updatePrivacySettings(e){for(const t in e)if(!F.DEFAULT_PRIVACY_SETTINGS.hasOwnProperty(t))throw new Error(`Unknown privacy setting ${t}`);return Object.assign(this._privacySettings||{},e),this._storage.set(e)}getStatistics(){return L(this._statistics)}updateStatistics(e){for(const t in e)if(!F.DEFAULT_STATISTICS.hasOwnProperty(t))throw new Error(`Unknown privacy setting ${t}`);return Object.assign(this._statistics||{},e),this._storage.set(e)}getUIState(){return L(this._uiState)}updateUIState(e){for(const t in e)if(!F.DEFAULT_UI_STATE.hasOwnProperty(t))throw new Error(`Unknown UI state ${t}`);return Object.assign(this._uiState||{},e),this._storage.set(e)}checkForPaidSubscription(){return new Promise(((e,t)=>{this.onReady((()=>{const{username:n,password:s,token:i}=this.getSettings();let r=null;if("function"==typeof window.LTAssistantChecker){const e=this.hasCustomServer()?this.getCustomServerUrl():void 0;r=window.LTAssistantChecker.checkForPaidSubscription(n,s,i,e)}else{const e={command:"CHECK_FOR_PAID_SUBSCRIPTION",username:n,password:s,token:i};r=browser.runtime.sendMessage(e).then((e=>{if("CHECK_FOR_PAID_SUBSCRIPTION"===(t=e).initialCommand&&t.isSuccessful)return e.hasPaidSubscription;if(function(e){return"CHECK_FOR_PAID_SUBSCRIPTION"===e.initialCommand&&!e.isSuccessful}(e))throw e.error;var t;return!1}))}r.then((t=>{t?this.enablePaidSubscription():this.disablePaidSubscription(),e(t)})).catch(t)}))}))}enablePaidSubscription(){return!this._uiState||this._uiState.hasPaidSubscription?Promise.resolve():this.updateUIState({hasPaidSubscription:!0})}disablePaidSubscription(){return this._uiState&&this._uiState.hasPaidSubscription?this.updateUIState({hasPaidSubscription:!1}):Promise.resolve()}getTestFlags(){return y(this._testFlags)}updateTestFlags(e){for(const t in e)if(!F.DEFAULT_TEST_FLAGS.hasOwnProperty(t))throw new Error(`Unknown test flag ${t}`);return Object.assign(this._testFlags||{},e),this._storage.set(e)}getActiveCoupon(){const{changelogNov2021CountdownEnd:e,changelogNov2021Coupon:t,hasPaidSubscription:n}=this.getUIState();if(n)return null;if(e&&t&&Date.now()<e){const n=20,{geoIpCountry:s}=this.getSettings(),i=this._getDefaultCoupon(s);return i&&i.percent>n?Object.assign(Object.assign({},i),{expires:e}):{code:t,expires:e,percent:n}}return null}_getDefaultCoupon(e){for(const t in i.COUNTRY_COUPON_MAPPING)if(i.COUNTRY_COUPON_MAPPING.hasOwnProperty(t)&&i.COUNTRY_COUPON_MAPPING[t].countries.includes(e))return{code:t,percent:i.COUNTRY_COUPON_MAPPING[t].percent};return null}isRelevantForChangelogCoupon(){if(this.hasCustomServer())return{status:!1,reason:1};const{hasPaidSubscription:e}=this.getUIState();if(e)return{status:!1,reason:2};let{firstVisit:t,appliedSuggestions:n}=this.getStatistics();if(!t)return{status:!1,reason:3};t*=1e3;return Date.now()-t<6048e5?{status:!1,reason:4}:n<8?{status:!1,reason:5}:{status:!0}}startChangelogCoupon(){if(!this.canStartChangelogCoupon())return;const e=Date.now();var t,n;this.updateUIState({changelogNov2021Coupon:"2021-NOV-CHANGELOG",changelogNov2021CountdownEnd:e+1656e5+(t=0,n=72e5,t=Math.ceil(t),n=Math.floor(n),Math.floor(Math.random()*(n-t+1))+t)})}isChangelogCouponRunning(){if(!this.isRelevantForChangelogCoupon().status)return!1;const{changelogNov2021CountdownEnd:e}=this.getUIState();return Boolean(e&&e>Date.now())}canStartChangelogCoupon(){if(!this.isRelevantForChangelogCoupon().status)return!1;const e=Date.now(),{changelogNov2021CountdownEnd:t}=this.getUIState();return!t||e-t>i.COUPON_INTERVAL}destroy(){this._isInitialized=!1,super.destroy();try{browser.storage.onChanged.removeListener(this._onStoredDataChanged)}catch(e){}}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class V{static init(){if(V._isInitialized)return;this.TRACKING_SITE_ID=e.getTrackingId(),this.VERSION=e.getVersion(),this._storageController=W.create();const t=e.getURL("/");window.addEventListener("error",(e=>{const n=e.message,s=e.filename,i=e.lineno,r=e.error;if(!s||!s.startsWith(t))return;if("string"!=typeof n)return;if(n.includes("ResizeObserver"))return;const o=r&&function(e){if(!e.stack)return;let t=[];if(e.stack.split(/\n/).forEach((e=>{const n=e.match(/([\w_<>]+)\s+\(.+?([\w_\-]+\.(js|html))/);n&&t.push(`${n[2]}:${n[1]}`)})),!t.length){const n=e.stack.match(/([\w_\-]+\.(js|html))/);n&&t.push(n[1])}return t.join(",").substr(0,140)}(r);o?V.trackError("js",n,o):V.trackError("js",n,`${s}:${i}`)})),V._isInitialized=!0}static getCustomDimensions(){const e=V._storageController.getSettings(),t=V._storageController.getUIState();return{dimension2:this.VERSION,dimension3:t.hasPaidSubscription,dimension4:e.username&&(e.password||e.token),dimension5:e.preferredLanguages.join(","),dimension6:e.hasPickyModeEnabledGlobally}}static _getTrackingUrlForPageView(e){return e=(e=e.replace(/^(chrome|moz|safari|edge)-extension:\/\/.+?\//i,"")).replace(/^[a-z0-9]{8}\//i,"/"),e=`${V.TRACKING_BASE_PAGE_URL}${e}`,new Promise(((t,n)=>{V._storageController.onReady((()=>{const{firstVisit:n,sessionCount:s}=V._storageController.getStatistics(),i=V._storageController.getUniqueId(),r=Object.assign({idsite:V.TRACKING_SITE_ID,rec:"1",url:e,rand:Date.now(),apiv:"1",res:`${screen.width}x${screen.height}`,_id:i,_idts:n,_idvc:s},this.getCustomDimensions());let o="";for(const e in r)r.hasOwnProperty(e)&&(o+=`${e}=${encodeURIComponent(r[e])}&`);t(`${V.TRACKING_BASE_URL}?${o}`)}))}))}static _getTrackingUrlForEvent(e,t,n="",s){return s=s||V.TRACKING_BASE_PAGE_URL,new Promise(((i,r)=>{V._storageController.onReady((()=>{const{firstVisit:r,sessionCount:o}=V._storageController.getStatistics(),a=V._storageController.getUniqueId(),l=Object.assign({idsite:V.TRACKING_SITE_ID,rec:"1",url:s,action_name:t,rand:Date.now(),apiv:"1",res:`${screen.width}x${screen.height}`,_id:a,_idts:r,_idvc:o,e_c:e,e_a:t,e_n:n},this.getCustomDimensions());let c="";for(const e in l)l.hasOwnProperty(e)&&(c+=`${e}=${encodeURIComponent(l[e])}&`);i(`${V.TRACKING_BASE_URL}?${c}`)}))}))}static _sendRequest(t){if(e.shouldTrack()&&!V._storageController.hasCustomServer()&&!navigator.webdriver){const e=new Image;e.referrerPolicy="no-referrer",e.src=t}}static trackPageView(t){t=t||N(),V._getTrackingUrlForPageView(t).then((n=>{e.isProductionEnvironment()?V._sendRequest(n):console.log("LT Page view tracking disabled in dev mode",{pageUrl:t,trackingUrl:n})})).catch((e=>{console.log("LT could not track because:",e&&e.message)}))}static trackDisabledRule(t,n,s,r){if(!t.match(/^de|en|nl|es|fr|ca|pt/i))return;const o=r?i.PACKAGE.PREMIUM:i.PACKAGE.BASIC,a=t+":"+n,l=s;let c=V.TRACKING_BASE_URL;c+=`?idsite=18&rec=1&url=${encodeURIComponent(V.TRACKING_BASE_PAGE_URL)}`,c+=`&action_name=${o}&rand=${Date.now()}&apiv=1&_id=${this._storageController.getUniqueId()}`,c+=`&e_c=${o}&e_a=${encodeURIComponent(a)}&e_n=${encodeURIComponent(s)}`,e.isProductionEnvironment()?this._sendRequest(c):console.log("LT Event tracking disabled in dev mode",{actionCategory:o,action:a,actionName:l,trackingUrl:c})}static trackDictionaryEvent(t,n,s=!1){if(!t.match(/^de|en|nl|es|fr|it|pt|ru|ca|pl/i))return;const i=s?"TemporaryIgnored":"PersistentlyIgnored",r=`${t}:add_word`,o=n;let a=V.TRACKING_BASE_URL;a+=`?idsite=19&rec=1&url=${encodeURIComponent(V.TRACKING_BASE_PAGE_URL)}`,a+=`&action_name=${i}&rand=${Date.now()}&apiv=1&_id=${this._storageController.getUniqueId()}`,a+=`&e_c=${i}&e_a=${encodeURIComponent(r)}&e_n=${encodeURIComponent(n)}`,e.isProductionEnvironment()?this._sendRequest(a):console.log("LT Event tracking disabled in dev mode",{actionCategory:i,action:r,actionName:o,trackingUrl:a})}static trackEvent(t,n,s,i){this._getTrackingUrlForEvent(t,n,s,i).then((i=>{e.isProductionEnvironment()?this._sendRequest(i):console.log("LT Event tracking disabled in dev mode",{actionCategory:t,action:n,actionName:s,trackingUrl:i})})).catch((e=>{console.log("LT could not track because:",e&&e.message)}))}static trackInstall(){V.trackEvent("Action","install",H.getPrimaryLanguageCode(navigator.language)),this._storageController.updateUIState({isNewUser:!0})}static trackActivity(){const e=Date.now(),{sessionCount:t,firstVisit:n,lastActivity:s}=this._storageController.getStatistics(),{isNewUser:i}=this._storageController.getUIState();if((!s||e-s>V.ACTIVITY_TRACK_INTERVAL)&&(this._storageController.updateStatistics({sessionCount:t+1,lastActivity:e}),this.trackEvent("Action","ping",H.getPrimaryLanguageCode(navigator.language))),i&&n){const t=6048e5,s=8*t,i=e-1e3*n;i>t&&i<s&&this._storageController.updateUIState({isNewUser:!1}).then((()=>{this.trackEvent("Action","active_after_one_week",H.getPrimaryLanguageCode(navigator.language))})).catch((e=>{const t=String(e&&e.message?e.message:e);this.trackEvent("JS-Error",`activity error: ${t}`)}))}}static trackError(e,n,s=""){try{if(t.isUnsupportedBrowser())return;if(V._errorCount++,V._errorCount>i.MAX_EXCEPTION_COUNT)return;if("string"!=typeof n)return;if(V._loggedErrors)if(V._loggedErrors.length<V.THROTTLE_REQUESTS)V._loggedErrors.push(Date.now());else{const e=Date.now();if(!(e-V._loggedErrors[0]>=V.MAX_TIME))return;V._loggedErrors.push(e),V._loggedErrors.splice(0,1)}else V._loggedErrors=[Date.now()];let r="JS-Error";"message"===e?r="Message-Error":"http"===e?r="HTTP-Error":"other"===e&&(r="Other-Error");let o=N();o=o.replace(/^moz-extension:\/\/[a-z0-9\-]+\//,"moz-extension://xxxx-xxxx-xxxx-xxxx/"),o.match(/(chrome|moz|safari)\-extension:/)||(o=void 0),this.trackEvent(r,n,s||o,o)}catch(e){console.error("Error while logging error from language tool",e)}}static trackStat(e,t){0===Math.floor(10*Math.random())&&V.trackEvent("Stat",e,t)}static trackTextLength(e){if(0===e)return;let t="";t=e<=100?"1-100":e<=1e3?"101-1000":e<=2500?"1001-2500":e<=5e3?"2501-5000":e<=7500?"5001-7500":e<=1e4?"7501-10000":e<=15e3?"10001-15000":e<=2e4?"15001-20000":e<=4e4?"20001-40000":e<=6e4?"40001-60000":e<=8e4?"60001-80000":e<=1e5?"80001-100000":">100000",this.trackStat("text_length",t)}}V.TRACKING_BASE_URL="https://analytics.languagetoolplus.com/matomo/piwik.php",V.TRACKING_BASE_PAGE_URL="https://fake/",V.ACTIVITY_TRACK_INTERVAL=864e5,V.MAX_TIME=6e4,V.THROTTLE_REQUESTS=10,V._isInitialized=!1,V._loggedErrors=null,V._errorCount=0;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class K{constructor(e=document){this._window=e.defaultView,this._document=e,this.clearCache()}_getElementCache(e){let t=this._elementCache.get(e);return t||(t={},this._elementCache.set(e,t)),t}clearCache(){this._documentVisibleBox=null,this._documentGap=null,this._documentScroll=null,this._elementCache=new WeakMap}_contains(e,t){return e&&e!==t&&e.contains(t)}_getComputedStyle(e,t,n){let s,i;return"object"==typeof t?(s=t,i=""):(s=n,i=t),s.computedStyle||(s.computedStyle=new Map),s.computedStyle.has(i)||s.computedStyle.set(i,this._window.getComputedStyle(e,i||null)),s.computedStyle.get(i)}getComputedStyle(e,t=""){return this._getComputedStyle(e,t,this._getElementCache(e))}_getComputedStyleMap(e,t){return e.computedStyleMap?(t.computedStyleMap||(t.computedStyleMap=e.computedStyleMap()),t.computedStyleMap):null}getComputedStyleMap(e){return this._getComputedStyleMap(e,this._getElementCache(e))}getInlineStyle(e,t){return e.style.getPropertyValue(t)}getStyle(e,t,n=""){return this.getStyles(e,[t],n)[t]}getStyles(e,t,n=""){let s=null,i={};const r=this._getElementCache(e);for(const o of t)if(s=s||this._getComputedStyle(e,n,r),"line-height"===o||"lineHeight"===o)i[o]=this.getInlineStyle(e,o)||s[o]||"";else if("font"!==o||s[o])i[o]="zoom"===o?s[o]||"1":s[o]||"";else{const t=s["font-style"],n=s["font-variant"],r=s["font-weight"],a=s["font-size"],l=this.getInlineStyle(e,"line-height")||s["line-height"]||"",c=s["font-family"];i[o]=`${t} ${n} ${r} ${a} ${l?"/ "+l:""} ${c}`}return i}getExactStyle(e,t){return this.getExactStyles(e,[t])[t]}getExactStyles(e,t){const n=this._getElementCache(e),s=this._getComputedStyleMap(e,n);if(s){const e={};for(const n of t){const t=s.get(n);t?"number"==typeof(i=t).value&&"string"==typeof i.unit?"number"===t.unit?e[n]=t.value.toString():e[n]=t.value+t.unit:e[n]=t.toString():e[n]=""}return e}return this.getStyles(e,t);var i}setStyles(e,t,n=!1){Array.isArray(e)||(e=[e]);for(const s of e)for(const e in t){let i=t[e].trim();const r=n||K.IMPORTANT_REG_EXP.test(i);i=i.replace(K.IMPORTANT_REG_EXP,""),s.style.setProperty(e,i,r?"important":"")}}copyStyles(e,t,n,s=!1){const i=this.getStyles(e,n);this.setStyles(t,i,s)}resetStyles(e,t,n=!1){Array.isArray(e)||(e=[e]);let s="";for(const e in t){let i=t[e].trim();n&&!K.IMPORTANT_REG_EXP.test(i)&&(i+=" !important"),s+=`${e}: ${i};`}for(const t of e)t.style.cssText=s}removeStyle(e,t){Array.isArray(e)||(e=[e]),this.removeStyles(e,[t])}removeStyles(e,t){Array.isArray(e)||(e=[e]);for(const n of e)for(const e of t)n.style.removeProperty(e)}_getBoundingClientRect(e,t){return t.boundingClientRect||(t.boundingClientRect=L(e.getBoundingClientRect())),t.boundingClientRect}_getBorderBox(e,t,n,s){const i="borderBox"+(t?"WithScroll":"")+(n?"WithScale":"");if(!s[i]){const r=this._getBoundingClientRect(e,s);let{top:o,left:a,width:l,height:c}=r;if(n){const t=this.getZoom(e);o*=t,a*=t,l*=t,c*=t}else{const t=this._getScaleFactor(e,s);l/=t.x,c/=t.y}if(t){const t=this.getDocumentScroll();if(o+=t.top,a+=t.left,this._document.body&&this._contains(this._document.body,e)){const e=this.getDocumentGap();o-=e.top,a-=e.left}}s[i]={top:o,right:a+l,bottom:o+c,left:a,width:l,height:c}}return s[i]}getBorderBox(e,t=!0,n=!0){return this._getBorderBox(e,t,n,this._getElementCache(e))}_getPaddingBox(e,t,n,s){const i="paddingBox"+(t?"WithScroll":"")+(n?"WithScale":"");if(!s[i]){let{top:r,left:o,width:a,height:l}=this._getBorderBox(e,t,n,s),c={x:1,y:1};n&&(c=this._getScaleFactor(e,s));const d=n?this._getZoom(e,s):1,h=this._getComputedStyle(e,s),_=(parseFloat(h["border-top-width"])||0)*c.y*d,u=(parseFloat(h["border-right-width"])||0)*c.x*d,g=(parseFloat(h["border-bottom-width"])||0)*c.y*d,m=(parseFloat(h["border-left-width"])||0)*c.x*d;let p=0,E=0;if("BackCompat"!==this._document.compatMode||e!==this._document.body||e!==this._document.scrollingElement){const t=e.clientWidth*c.x*d,n=e.clientHeight*c.y*d;p=a-m-t-u,E=l-_-n-g,p<1&&(p=0),E<1&&(E=0)}r+=_,o+=m,a=a-m-p-u,l=l-_-E-g,this._isRTL(e,s)&&(o+=p),s[i]={top:r,right:o+a,bottom:r+l,left:o,width:a,height:l,border:{top:_,right:u,bottom:g,left:m}}}return s[i]}getPaddingBox(e,t=!0,n=!0){return this._getPaddingBox(e,t,n,this._getElementCache(e))}_getContentBox(e,t,n,s){const i="contentBox"+(t?"WithScroll":"")+(n?"WithScale":"");if(!s[i]){let{top:r,left:o,width:a,height:l,border:c}=this._getPaddingBox(e,t,n,s),d={x:1,y:1};n&&(d=this._getScaleFactor(e,s));const h=n?this._getZoom(e,s):1,_=this._getComputedStyle(e,s),u=(parseFloat(_["padding-top"])||0)*d.y*h,g=(parseFloat(_["padding-right"])||0)*d.x*h,m=(parseFloat(_["padding-bottom"])||0)*d.y*h,p=(parseFloat(_["padding-left"])||0)*d.x*h;r+=u,o+=p,a=a-p-g,l=l-u-m,s[i]={top:r,right:o+a,bottom:r+l,left:o,width:a,height:l,border:c,padding:{top:u,right:g,bottom:m,left:p}}}return s[i]}getContentBox(e,t=!0,n=!0){return this._getContentBox(e,t,n,this._getElementCache(e))}_getScrollDimensions(e,t,n){const s="scrollDimensions"+(t?"WithScale":"");if(!n[s]){let i=e.scrollWidth,r=e.scrollHeight;if(t){const t=this._getScaleFactor(e,n),s=this._getZoom(e,n);i=i*t.x*s,r=r*t.y*s}n[s]={width:i,height:r}}return n[s]}getScrollDimensions(e,t=!0){return this._getScrollDimensions(e,t,this._getElementCache(e))}_getScrollPosition(e,t,n,s){const i="scrollPosition"+(t?"WithScale":"")+(n?"WithZoom":"");if(!s[i]){let r={x:1,y:1};t&&(r=this._getScaleFactor(e,s));const o=n?this._getZoom(e,s):1,a=e===this._document.body&&"BackCompat"===this._document.compatMode,l=a?0:e.scrollTop*r.y*o,c=a?0:e.scrollLeft*r.x*o;s[i]={top:l,left:c}}return s[i]}getScrollPosition(e,t=!0,n=t){return this._getScrollPosition(e,t,n,this._getElementCache(e))}getScaleFactor(e){return this._getScaleFactor(e,this._getElementCache(e))}_getScaleFactor(e,n){if(void 0===n.scaleFactor){if(e instanceof SVGElement){if(t.isFirefox()||t.isThunderbird())return{x:1,y:1};let n=1;const s=e.getAttribute("transform")||"",i=/scale\((\d+(\.\d+)?)\)/.exec(s);return i&&(n=+i[1]),{x:n,y:n}}{const t=this._getBoundingClientRect(e,n),s=e.offsetWidth,i=e.offsetHeight;n.scaleFactor={x:1,y:1},t.width>0&&s>0&&Math.abs(t.width-s)>1&&(n.scaleFactor.x=t.width/s),t.height>0&&i>0&&Math.abs(t.height-i)>1&&(n.scaleFactor.y=t.height/i)}}return n.scaleFactor}_getZoom(e,n){if(t.isFirefox()||t.isThunderbird())return 1;if("number"!=typeof n.zoom){let t=1,s=e;for(;s&&s!==this._document.documentElement;){t*=+this.getStyle(s,"zoom"),s=s.parentElement}n.zoom=t}return n.zoom}getZoom(e){return this._getZoom(e,this._getElementCache(e))}_getStackingContextWithZIndex(e){const t=this.getComputedStyle(e),n=parseInt(t.zIndex||"");if(isNaN(n))return null;if(t.position&&K.NON_STATIC_POSITIONS.indexOf(t.position)>-1)return{zIndex:n};if(e.parentElement){const t=this.getComputedStyle(e.parentElement);if("flex"===t.display||"grid"===t.display)return{zIndex:n}}return null}getZIndex(e,t=this._document.documentElement){let n="auto",s=e;if(!s.ownerDocument)return"auto";const i=s.ownerDocument.defaultView.Element,r=s.ownerDocument.defaultView.ShadowRoot;for(;s&&s!==this._document&&s!==t&&s instanceof i;){const e=this._getStackingContextWithZIndex(s);e&&(n=e.zIndex),s=s.parentNode instanceof r?s.parentNode.host:s.parentElement}return n}_isRTL(e,t){return"boolean"!=typeof t.isRTL&&(t.isRTL="rtl"===this.getStyle(e,"direction")),t.isRTL}isRTL(e){return this._isRTL(e,this._getElementCache(e))}isStackingContext(e){const t=this.getComputedStyle(e);return!!(t.position&&K.NON_STATIC_POSITIONS.indexOf(t.position)>-1)||("none"!==t.transform||"none"!==t.filter||"none"!==t.clipPath||"none"!==t.perspective||Number(t.opacity)<1)}_getTextClientRects(e){const t=this._document.createRange();return t.setStart(e.node,e.start),t.setEnd(e.node,e.end),Array.from(t.getClientRects())}getTextBoundingBoxes(e,t,n=!0){Array.isArray(e)||(e=[e]);let s=[],i=0,r=0;if(n){const e=this.getDocumentScroll();if(i+=e.top,r+=e.left,this._document.body&&this._contains(this._document.body,t)){const e=this.getDocumentGap();i-=e.top,r-=e.left}}for(const t of e)try{const e=this._getTextClientRects(t);for(const t of e){if(t.width<K.MIN_TEXT_BOX_WIDTH)continue;const e=s[s.length-1],n=t.top+i,o=t.right+r,a=t.bottom+i,l=t.left+r,c=t.width,d=t.height;e&&e.right===l&&e.top===n&&e.bottom===a&&e.height===d?(e.right=o,e.width=e.width+c):s.push({top:n,right:o,bottom:a,left:l,width:c,height:d})}}catch(e){}return s}getRelativeTextBoundingBoxes(e,t,n=this.getScrollPosition(t)){Array.isArray(e)||(e=[e]);let s=[];const i=this.getPaddingBox(t,!1,!1),r=i.left-n.left,o=i.top-n.top;for(const t of e)try{const e=this._getTextClientRects(t);for(const t of e){if(t.width<K.MIN_TEXT_BOX_WIDTH)continue;const e=s[s.length-1],n=t.top-o,i=t.right-r,a=t.bottom-o,l=t.left-r,c=t.width,d=t.height;e&&e.right===l&&e.top===n&&e.bottom===a&&e.height===d?(e.right=i,e.width=e.width+c):s.push({top:n,right:i,bottom:a,left:l,width:c,height:d})}}catch(e){console.error("LT range error",e)}const a=this.getScaleFactor(t);for(const e of s)e.top=Math.round(e.top/a.y),e.right=Math.round(e.right/a.x),e.bottom=Math.round(e.bottom/a.y),e.left=Math.round(e.left/a.x),e.width=e.right-e.left,e.height=e.bottom-e.top;return s}getRelativeTextBoundingBox(e,t){const n=this.getRelativeTextBoundingBoxes(e,t),s=Math.min(...n.map((e=>e.top))),i=Math.max(...n.map((e=>e.right))),r=Math.max(...n.map((e=>e.bottom))),o=Math.min(...n.map((e=>e.left)));return{top:s,right:i,bottom:r,left:o,width:i-o,height:r-s}}_hasRelativePosition(e,t){const n=this._getComputedStyle(e,t).position||"static";return K.NON_STATIC_POSITIONS.indexOf(n)>-1}getDocumentGap(){if(!this._documentGap&&(this._documentGap={top:0,left:0},this._document.body&&this._hasRelativePosition(this._document.body,this._getElementCache(this._document.body)))){const e=this.getBorderBox(this._document.documentElement),n=this.getBorderBox(this._document.body);let s=this._document.documentElement.offsetTop,i=this._document.documentElement.offsetLeft;if(t.isFirefox()||t.isThunderbird()){let e=null;0===s&&(e=this.getComputedStyle(this._document.documentElement),s=parseInt(e["margin-top"])||0),0===i&&(e=e||this.getComputedStyle(this._document.documentElement),i=parseInt(e["margin-left"])||0)}const r=n.top-e.top+s,o=n.left-e.left+i,a=this.getComputedStyle(this._document.body),l=parseFloat(a["border-top-width"])||0,c=parseFloat(a["border-left-width"])||0;this._documentGap={top:r+l,left:o+c}}return this._documentGap}getDocumentVisibleBox(){if(!this._documentVisibleBox){const e=this.getDocumentScroll();let n=this._document.documentElement.clientHeight,s=this._document.documentElement.clientWidth;t.isThunderbird()&&(n=window.innerHeight,s=window.innerWidth),this._documentVisibleBox={top:e.top,right:e.left+s,bottom:e.top+n,left:e.left,width:s,height:n}}return this._documentVisibleBox}getDocumentScroll(){if(!this._documentScroll){const e=this._document.documentElement&&this._document.documentElement.scrollTop||this._document.body&&this._document.body.scrollTop||0,t=this._document.documentElement&&this._document.documentElement.scrollLeft||this._document.body&&this._document.body.scrollLeft||0;this._documentScroll={top:e,left:t}}return this._documentScroll}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
function z(e=25,t=null){return new Promise((n=>setTimeout((()=>n(t)),e)))}function X(e,t){let n=null,s=!1;const i=()=>{n=function(e,t){let n=null,s=!1;const i=window.setTimeout((()=>{s||(n=window.requestAnimationFrame((()=>e())))}),t);return{destroy:()=>{s=!0,window.clearTimeout(i),n&&window.cancelAnimationFrame(n)}}}((()=>{s||(e(),i())}),t)};return i(),{destroy:()=>{s=!0,n&&(n.destroy(),n=null)}}}function Y(e,t){"string"==typeof e&&(e=document.querySelector(e)),"string"==typeof t&&(t={key:t}),t.isHTML?e.innerHTML=s.getMessage(t.key,t.interpolations):t.attr?e[t.attr]=s.getMessage(t.key,t.interpolations):e.textContent=s.getMessage(t.key,t.interpolations)}function j(e,t){return e.top===t.top&&e.right===t.right&&e.bottom===t.bottom&&e.left===t.left}function q(e,t){const n=t.left+t.width/2;let s=null,i=Number.MAX_SAFE_INTEGER;for(const t of e){const e=Math.min(Math.abs(n-t.left),Math.abs(n-t.right));e<=i&&(s=t,i=e)}return s}function Z(e,t){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}function J(e,t,n=0){return"object"==typeof t&&(n=t.y,t=t.x),e.left<=t&&t<=e.right&&e.top<=n&&n<=e.bottom}function Q(e,n){const s=e.createElement(n);return s.setAttribute("contenteditable","false"),navigator.userAgent.includes("Mac OS")&&s.classList.add("lt--mac-os"),t.isThunderbird()&&s.classList.add("lt--thunderbird"),s}function ee(e,t){return"object"==typeof t?e!==t&&e.contains(t):e instanceof Element&&!!e.querySelector(t)}function te(e,t){if(e.closest)return e.closest(t);{let n=e;for(;n;){if(n.matches(t))return n;n=n.parentElement}}return null}function ne(e){return e.frameElement}function se(e){const t=window.getComputedStyle(e);return"auto"===t.overflowY||"scroll"===t.overflowY}function ie(e){return Boolean(e.ownerDocument&&"on"===e.ownerDocument.designMode&&"read-write"===e.ownerDocument.defaultView.getComputedStyle(e)["-moz-user-modify"])}K.IMPORTANT_REG_EXP=/!important$/,K.TRANSFORM_MATRIX_REG_EXP=/(?:matrix|scale)\(([\d\.]+),/,K.NON_STATIC_POSITIONS=["relative","fixed","absolute","sticky"],K.MIN_TEXT_BOX_WIDTH=.1;const re=(()=>{const e=(e,t,n,s)=>{const i=e.ownerDocument;let r=i.elementFromPoint(n,s);if(!r)return!1;if(e===r||e.contains(r))return!0;if(!t.length)return!1;const o=t.find((e=>e.contains(r)));return o&&(r=i.elementsFromPoint(n,s).find((e=>!o.contains(e)))||null),Boolean(r&&(e===r||e.contains(r)))};return(t,n,s,i)=>{const r=n.getPaddingBox(t,!1),o=t.ownerDocument.contains(t);if(r.bottom<0||r.top>s||!o)return{top:0,bottom:r.height};let a=[];i&&(a=Array.from(t.ownerDocument.querySelectorAll(i)));let l=r.left+Math.round(r.width/100*33);const c=Math.max(r.top,0);let d=c;for(;;){if(e(t,a,l,d)){if(d===c)break;for(;d--;)if(!e(t,a,l,d)){d++;break}break}if(d===r.bottom)break;d=Math.min(r.bottom,d+6)}const h=Math.min(r.bottom,s);let _=h;for(;;){if(e(t,a,l,_-1)){if(_===h)break;for(;_++<h;)if(!e(t,a,l,_-1)){_--;break}break}if(_===d)break;_=Math.max(d,_-6)}return{top:Math.round(Math.max(0,d-r.top)),bottom:Math.round(Math.max(0,_-r.top))}}})();function oe(e){return(e.offsetWidth>0||e.offsetHeight>0)&&"hidden"!==new K(document).getStyle(e,"visibility")}function ae(e,t){let n=1;const s=new K(e.ownerDocument),i=X((()=>{if(n-=.08,n<=0)return e.remove(),i.destroy(),void(t&&t());s.setStyles(e,{opacity:n+" !important"})}),16)}function le(e){let t=20,n=e;for(;--t;){const e=window.getComputedStyle(n);if(e.backgroundImage&&"none"!==e.backgroundImage)return!1;const t=e.backgroundColor;if(t&&"transparent"!==t&&ke(t)>=.25)return we(t)<=35;if(!n.parentElement)return!1;n=n.parentElement}return!1}function ce(e){if("function"==typeof e.composedPath){const t=e.composedPath();if(t[0])return t[0]}return e.target}function de(e,t,n={}){const s=new CustomEvent(t,{detail:n,cancelable:!0});return e.dispatchEvent(s)}function he(e,t,n){const s=e.nodeType===Node.DOCUMENT_NODE?e:e.ownerDocument;const i=t=>{const s=ce(t);(Ae(s)||ye(s))&&e.contains(s)&&n(t)};return s.defaultView.addEventListener(t,i,!0),{destroy(){s.defaultView.removeEventListener(t,i,!0)}}}const _e=(()=>{let e;const t=[];return(n,s)=>{t.push({element:n,callback:s}),e=e||window.setInterval((()=>{const n=[];t.forEach((e=>{(e.element.readOnly||e.element.disabled||!oe(e.element))&&(n.push(e),e.callback(e.element))})),n.forEach((e=>{t.splice(t.indexOf(e),1)})),t.length||(clearInterval(e),e=null)}),600)}})(),ue=(()=>{let e;const t=[];return(n,s)=>{t.push({element:n,callback:s}),e||(e=new MutationObserver((n=>{if(!n.some((e=>e.removedNodes.length>0)))return;const s=[];for(const e of t)fe(e.element)||(e.callback(e.element),s.push(e));s.forEach((e=>{t.splice(t.indexOf(e),1)})),t.length||(e.disconnect(),e=null)})),e.observe(document.documentElement,{childList:!0,subtree:!0}))}})();function ge(e){const t=document;if(t.caretRangeFromPoint)return t.caretRangeFromPoint(e.x,e.y);if(t.caretPositionFromPoint){const n=t.caretPositionFromPoint(e.x,e.y);if(!n||!n.offsetNode)return null;try{const e=new Range;return e.setStart(n.offsetNode,n.offset),e.setEnd(n.offsetNode,n.offset),e}catch(e){return null}}return null}function me(e,t){return!(!e||!t||e.startContainer!==t.startContainer||e.startOffset!==t.startOffset||e.endOffset!==t.endOffset||e.endContainer!==t.endContainer)}function pe(){const e=Ee(),t=e?e.tagName.toLowerCase():null;return"textarea"===t||"input"===t&&/^(?:text|search|password|tel|url)$/i.test(e.type)&&"number"==typeof e.selectionStart?e.value.slice(e.selectionStart,e.selectionEnd):window.getSelection&&window.getSelection()?window.getSelection().toString():""}function Ee(){let e=document.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function fe(e){if(e.ownerDocument&&e.ownerDocument.contains(e))return!0;for(var t=e;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof DocumentFragment?t.parentNode.host:t.parentNode}return!1}function Ce(e){for(var t=e&&e.parentNode;t;){if("[object ShadowRoot]"===t.toString())return t;t=t.parentNode}return null}function Se(e){let t=e.isCollapsed;return e.anchorNode===e.focusNode&&e.anchorOffset!==e.focusOffset&&(t=!1),e.toString().length>0&&(t=!1),t}function Te(e){return ve(e)||be(e)}function ve(e){return e instanceof HTMLTextAreaElement}function be(e){return e instanceof HTMLInputElement&&("text"===e.type||"search"===e.type)}function Ae(e){return e.nodeType===Node.ELEMENT_NODE}function ye(e){return e.nodeType===Node.TEXT_NODE}function Le(e){try{return e.document.documentElement.hasAttribute("data-lt-installed")}catch(e){}return!1}function Ie(e){if(!e.ownerDocument||!e.ownerDocument.defaultView)return!0;const t=e.ownerDocument.createElement("div");t.className="lt-test-element",e.appendChild(t);const n="absolute"===e.ownerDocument.defaultView.getComputedStyle(t).position;return t.remove(),n}function Ne(e){["content/styles/shadow.css"].forEach((t=>{const n=browser.runtime.getURL(t);if(!e.querySelector(`[href="${n}"]`)){const t=document.createElement("link");t.href=n,t.rel="stylesheet",e.append(t)}}))}function xe(e,t,n,s=Date.now().toString()){const i=void 0!==window.screenLeft?window.screenLeft:window.screenX,r=void 0!==window.screenTop?window.screenTop:window.screenY,o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,l=o/window.screen.availWidth,c=(o-t)/2/l+i,d=(a-n)/2/l+r;return window.open(e,s,`\n      scrollbars=yes,\n\t  resizable=yes,\n      width=${t/l},\n      height=${n/l},\n      top=${d},\n      left=${c}\n      `)}(function(){let e,t=null;const n=t=>{t.origin.match(/^chrome|moz|safari/)&&e(t.data)}})(),function(){let e,t=null;const n=t=>{e(t.data)}}();let ke,we;!function(){const e=/ /g,t=/^#(?:[0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{8})$/i,n=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,s=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,i=/^rgba?\(/i,r=/^rgba?\((\d+),(\d+),(\d+)(?:,(\d*(?:\.\d+)?))?\)/i,o=/^hsla?\(/i,a=/^hsla?\(\d+,\d+%,(\d+)%(?:,(\d*(?:\.\d+)?))?\)/i;function l(e,t,n){const s=Math.max(e,t,n)/255,i=Math.min(e,t,n)/255;return Math.round((s+i)/2*100)}ke=function(l){if("string"!=typeof l)return 3===l.length?1:l[3];if(l=l.replace(e,""),t.test(l)){const e=n.exec(l)||s.exec(l);if(e&&e[4])return parseInt(2===e[4].length?e[4]:e[4]+e[4],16)/255}else if(i.test(l)){const e=r.exec(l);if(e&&e[4])return+e[4]}else if(o.test(l)){const e=a.exec(l);if(e&&e[2])return+e[2]}return 1},we=function(c){if("string"!=typeof c)return l(c[0],c[1],c[2]);if(c=c.replace(e,""),t.test(c)){const e=n.exec(c)||s.exec(c);if(e){return l(parseInt(2===e[1].length?e[1]:e[1]+e[1],16),parseInt(2===e[2].length?e[2]:e[2]+e[2],16),parseInt(2===e[3].length?e[3]:e[3]+e[3],16))}}else if(i.test(c)){const e=r.exec(c);if(e){return l(+e[1],+e[2],+e[3])}}else if(o.test(c)){const e=a.exec(c);if(e)return+e[1]}return 100}}();const Me=Array.from({length:16},((e,t)=>t.toString(16)));function Re(e,t){const n=e.length,s=Math.max(0,t-n);return e+Array.from({length:s},(()=>{const e=Math.floor(Math.random()*Me.length);return Me[e]})).join("")}function Pe(e){if(e.length>24)throw new Error(`Given unique ID "${e}" exceeds length of 24`);const t=e.slice(0,12),n=e.slice(12,20),s=e.slice(20,24);return[Re(n,12),Re(s,4),"4A96","BEA4",Re(t,12)].join("-")}function Oe(e){return Boolean(e.closest(".DraftEditor-editorContainer"))||/(facebook|messenger)\.com/.test(location.host)&&(e.hasAttribute("aria-describedBy")||["textfield","textbox"].includes(e.getAttribute("role")||""))&&e.hasAttribute("contenteditable")||!!e.querySelector("div[data-contents=true]")&&e.classList.contains("notranslate")}function De(e){return e.classList.contains("mce-content-body")||e.classList.contains("mceContentBody")}function Ue(e){const t=e.classList.contains("cke_editable"),n="string"==typeof e.className&&e.className.includes("ck-editor_");return t||n}function Be(e){return e.hasAttribute("data-slate-editor")}function Ge(e){return!!e.closest("[data-app-name='io.ox/office/text']")}function He(e){return"trix-editor"===e.nodeName.toLowerCase()}function Fe(e){return e.classList.contains("CodeMirror-code")}function We(e){return window!==window.parent&&e.ownerDocument&&e===e.ownerDocument.body&&e.ownerDocument.documentElement.isContentEditable&&e.classList.contains("cke_show_borders")}function $e(e,t){for(const n of i.ERRORS_THAT_CAN_BE_CORRECTED_ALL_AT_ONCE){if(n.ruleId!==e.rule.id)continue;if(e.originalPhrase.length!==t.length)continue;const s=n.suggestions.find((e=>e.match.test(t)));if(s)return{suggestion:s,ruleId:e.rule.id}}}function Ve(e,t){return e.some((e=>e.rule.id===t.rule.id&&e.start!==t.start))}function Ke(e){let t=S(e);return["<lt-strong>","</lt-strong>","<lt-em>","</lt-em>"].forEach((e=>{t=t.split(S(e)).join(e)})),t}function ze(e,t){return t.length<5?`<lt-strong>${t}</lt-strong>`:Xe(e,t)||`<lt-strong>${t}</lt-strong>`}function Xe(e,t){if(t.length>2&&t.startsWith(e))return`${e}<lt-strong>${t.substring(e.length)}</lt-strong>`;if(t.length>2&&t.endsWith(e))return`<lt-strong>${t.substring(0,t.lastIndexOf(e))}</lt-strong>${e}`;if(g(e)===t)return`<lt-strong>${t.charAt(0)}</lt-strong>${t.substring(1)}`;if(e+","===t)return e+"<lt-strong>,</lt-strong>";if(", "+e===t)return"<lt-strong>, </lt-strong>"+e;if(t.length>2&&e.length>2)for(let n=0;n<t.length;n++)if(t[n]!==e[n]){if(t.substring(n+1)&&t.substring(n+1)===e.substring(n+1))return`${t.substring(0,n)}<lt-strong>${t[n]}</lt-strong>${t.substring(n+1)}`;if(t[n+1]&&t[n+1]!==e[n+1]&&t.substring(n+2)&&t.substring(n+2)===e.substring(n+2)&&t.length>3)return`${t.substring(0,n)}<lt-strong>${t[n]}${t[n+1]}</lt-strong>${t.substring(n+2)}`;if(t.substring(n+1)&&t.substring(n+1)===e.substring(n))return`${t.substring(0,n)}<lt-strong>${t[n]}</lt-strong>${t.substring(n+1)}`;break}if(e.length>=2&&t.length>2&&t.startsWith(e.substring(0,2))){let n=2;for(;n<=t.length&&t[n]===e[n];n++);if(n<t.length)return t.substring(n)===e.substring(n+1)&&t.substring(n).length>2?`${t.substring(0,n-1)}<lt-strong>${t.substring(n-1,n+1)}</lt-strong>${t.substring(n+1)}`:`${t.substring(0,n)}<lt-strong>${t.substring(n)}</lt-strong>`}return null}const Ye=/[ \u00A0]+/;function je(e,t){const n=e.split(Ye),s=t.split(Ye);if(n.join(" ")===s.join(" "))return`<lt-em>${t}</lt-em>`;if(1===n.length&&2===s.length&&s[0]===n[0])return`${s[0]} <lt-strong>${s[1]}</lt-strong>`;if(1===n.length&&2===s.length&&s[1]===n[0])return`<lt-strong>${s[0]}</lt-strong> ${s[1]}`;if(1===n.length&&2===s.length&&g(s[1])===n[0])return`<lt-strong>${s[0]}</lt-strong> <lt-strong>${s[1].substring(0,1)}</lt-strong>${s[1].substring(1)}`;if(s.length>2&&n.length+1===s.length&&n[0]===s[0]&&n[1]!==s[1]&&n.slice(1).join(" ")===s.slice(2).join(" "))return`${s[0]} ${ze(n[1],s[1])} ${s.slice(2).join(" ")}`;if(3===s.length&&2===n.length&&n[0]!==s[0]&&n[1]!==s[1]&&n[1]===s[2])return`<lt-strong>${s[0]} ${s[1]}</lt-strong> ${s[2]}`;if(s.length>2&&n.length+1===s.length&&n[0]!==s[0]&&n.slice(0).join(" ")===s.slice(1).join(" "))return`${ze(n[0],s[0])} ${s.slice(1).join(" ")}`;if(2===n.length&&s.length>2&&n[0]===s[0]&&n[1]===s[1])return`${s[0]} ${s[1]} <lt-strong>${s.slice(2).join(" ")}</lt-strong>`;if(n.length>=2&&s.length>=2&&n[0]===s[0]&&n[1]!==s[1]&&n.slice(2).join(" ")===s.slice(2).join(" "))return`${s[0]} ${ze(n[1],s[1])} ${s.slice(2).join(" ")}`.trim();if(2===n.length&&s.length>2&&n[0]===s[0]&&n[1]!==s[1])return`${s[0]} <lt-strong>${s.slice(1).join(" ")}</lt-strong>`;if(n.length===s.length&&s.length>1){let e=0;const t=s.map(((t,s)=>{if(t===n[s])return t;let i=Xe(n[s],t);return i||(e++,i=`<lt-strong>${t}</lt-strong>`),i})).join(" ");return e===s.length?`<lt-em>${s.join(" ")}</lt-em>`:t}return 1===n.length&&1===s.length?Xe(n[0],s[0])||`<lt-em>${s[0]}</lt-em>`:`<lt-em>${t}</lt-em>`}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
var qe;!function(e){e.PERMISSION_REQUIRED="PERMISSION_REQUIRED",e.DISABLED="DISABLED",e.DISCONNECTED="DISCONNECTED",e.TEXT_TOO_SHORT="TEXT_TOO_SHORT",e.TEXT_TOO_LONG="TEXT_TOO_LONG",e.IN_PROGRESS="IN_PROGRESS",e.COMPLETED="COMPLETED",e.UNSUPPORTED_LANGUAGE="UNSUPPORTED_LANGUAGE",e.NEEDS_LANGUAGE_HINT="NEEDS_LANGUAGE_HINT",e.FAILED="FAILED"}(qe||(qe={}));class Ze{calculateTextScore(e,t,n,s){if(e<100)return 0;let i=0,r=0,o=0;const a=e=>{e.isSpellingError?o++:e.isStyleError?r++:i++};t.forEach(a),n.forEach(a),s.forEach(a);const l=3*i+4*o+2*r;return Math.max(0,Math.floor((e-l)/e*100))}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Je{static _update(e){return this._storageController.updateSettings({dictionary:e})}static init(e,t=[]){this._isInitialized||(this._storageController=e||W.create(),this._defaultWords=t,this._isInitialized=!0)}static get(){let e=this._storageController.getSettings().dictionary;return Array.isArray(e)||(e=[]),e=e.concat(this._defaultWords),e=v(e),e}static getSorted(){return this.get().sort(((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase())))}static add(t){const n=this.get();return n.push(t.trim()),e.addWordToDictionary(t),this._update(n)}static addBatch(t){const n=this.get();return t.forEach((e=>{e&&e.trim()&&!e.trim().match(/\s/)&&n.push(e.trim())})),e.addWordsToDictionary(t),this._update(n)}static remove(t){const n=this.get(),s=n.indexOf(t);return-1===s?Promise.resolve():(n.splice(s,1),e.removeWordFromDictionary(t),this._update(n))}static clear(){return e.clearDictionary(),this._update([])}}Je._isInitialized=!1;class Qe{static set(e,t){let n=this.get(this.ROOT_KEY)||[];const s=n.findIndex((t=>t.key===e));for(s>-1&&n.splice(s,1),n.push({key:e,value:t});JSON.stringify(n).length>this.MAX_BYTE_SIZE;)n.shift();try{localStorage.setItem(this.ROOT_KEY,JSON.stringify(n))}catch(e){}}static get(e){try{const t=localStorage.getItem(this.ROOT_KEY),n=t?JSON.parse(t):null;if(!n)return null;const s=n.find((t=>t.key===e));return s&&s.value?s.value:null}catch(e){return null}}static getAll(){try{const e=localStorage.getItem(this.ROOT_KEY),t=e?JSON.parse(e):null;return t||[]}catch(e){return[]}}static remove(e){let t=this.get(this.ROOT_KEY)||[];const n=t.findIndex((t=>t.key===e));if(n>-1){t.splice(n,1);try{localStorage.setItem(this.ROOT_KEY,JSON.stringify(t))}catch(e){}}}}Qe.ROOT_KEY="__lt_host_storage",Qe.MAX_BYTE_SIZE=1048576;class et{constructor(e,t){this._allWords=null,this._text=e,this._normalizedText=this.normalizeText(e),this._sentenceRanges=t}updateText(e,t){this._text=e,this._normalizedText=this.normalizeText(e),this._sentenceRanges=t,this._allWords=null}normalizeText(e){return e=(e=(e=(e=e.replace(/([a-zèéêáàâ0-9])['’`´‘]([a-z])/gi,"$1$2")).replace(/[\-_–"“”„'’`´‘˚^°\+\*\.\!\?…\:,;=\)\(\[\]%¡¿‽#<>•\/]/g," ")).replace(/\s+/g," ")).replace(/(^\s*)|(\s*$)/g,"")}_filterEmptySentenceRanges(e){return e.filter((e=>e.end-e.start>0))}getAllWords(){return this._normalizedText?(this._allWords||(this._allWords=this._normalizedText.replace(/([0-9])[\.,]([0-9])/g,"$1$2").split(/\s/)),this._allWords):[]}countWords(){return this.getAllWords().length}countUniqueWords(){return v(this.getAllWords()).length}getAllSentences(){return this._sentenceRanges}countSentences(){return this.getAllSentences().length}getReadingTime(){return Math.round(this.countWords()/200)}getSpeakingTime(){return Math.round(this.countWords()/130)}countCharacters(){return this._text.trim().length}uniq(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class tt{static create(e,t=e){return e===t?new tt.TreeWalkerWrapper(e):new tt.CustomWalker(e,t)}}tt.TreeWalkerWrapper=class extends tt{constructor(e){super(),this._treeWalker=document.createTreeWalker(e),this._currentNode=e}get currentNode(){return this._currentNode}next(e=!1){if(e){for(;!this._treeWalker.nextSibling();)if(!this._treeWalker.parentNode())return null;this._currentNode=this._treeWalker.currentNode}else try{const e=this._treeWalker.nextNode();if(!e)return null;this._currentNode=e}catch(e){return null}return this._currentNode}},tt.CustomWalker=class extends tt{constructor(e,t){super(),this._rootNode=e,this._currentNode=t}get currentNode(){return this._currentNode}next(e=!1){if(!e&&this._currentNode.firstChild)this._currentNode=this._currentNode.firstChild;else{if(this._currentNode===this._rootNode)return null;if(this._currentNode.nextSibling)this._currentNode=this._currentNode.nextSibling;else{let e=this._currentNode;for(;!e.nextSibling;){if(!e.parentNode||e.parentNode===this._rootNode)return null;e=e.parentNode}this._currentNode=e.nextSibling}}return this._currentNode}};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class nt{constructor(e,t,n){if(this._ceElement=e,this._parsingDetector=t,this._cacheInvalidationRules=n||{},this._enableCache=!!n,this._enableCache){this._nodePropertiesCache={isTextNode:{propertyName:"isTextNode",map:new WeakMap},isElementNode:{propertyName:"isElementNode",map:new WeakMap},computedStyle:{propertyName:"computedStyle",map:new WeakMap},isSkippingElement:{propertyName:"isSkippingElement",map:new WeakMap},replacementText:{propertyName:"replacementText",map:new WeakMap},isBr:{propertyName:"isBr",map:new WeakMap},isBlock:{propertyName:"isBlock",map:new WeakMap},parsingOptions:{propertyName:"parsingOptions",map:new WeakMap},parsedText:{propertyName:"parsedText",map:new WeakMap},blockParent:{propertyName:"blockParent",map:new WeakMap},paragraphLastValuableNode:{propertyName:"paragraphLastValuableNode",map:new WeakMap},isBRElementRelevant:{propertyName:"isBRElementRelevant",map:new WeakMap},isBlockElementRelevant:{propertyName:"isBlockElementRelevant",map:new WeakMap},isTextEndsWithLineBreak:{propertyName:"isTextEndsWithLineBreak",map:new WeakMap},isParagraphNonEmpty:{propertyName:"isParagraphNonEmpty",map:new WeakMap}},this.isTextNode=this.createCachedMethod(this.isTextNode,"isTextNode"),this.isElementNode=this.createCachedMethod(this.isElementNode,"isElementNode"),this.getComputedStyle=this.createCachedMethod(this.getComputedStyle,"computedStyle"),this.isSkippingElement=this.createCachedMethod(this.isSkippingElement,"isSkippingElement"),this.getReplacementText=this.createCachedMethod(this.getReplacementText,"replacementText"),this.isBr=this.createCachedMethod(this.isBr,"isBr"),this.isBlock=this.createCachedMethod(this.isBlock,"isBlock"),this.getParsingOptions=this.createCachedMethod(this.getParsingOptions,"parsingOptions"),this.getParsedText=this.createCachedMethod(this.getParsedText,"parsedText"),this.getBlockParent=this.createCachedMethod(this.getBlockParent,"blockParent"),this.getParagraphLastValuableNode=this.createCachedMethod(this.getParagraphLastValuableNode,"paragraphLastValuableNode"),this.isBRElementRelevant=this.createCachedMethod(this.isBRElementRelevant,"isBRElementRelevant"),this.isBlockElementRelevant=this.createCachedMethod(this.isBlockElementRelevant,"isBlockElementRelevant"),this.isTextEndsWithLineBreak=this.createCachedMethod(this.isTextEndsWithLineBreak,"isTextEndsWithLineBreak"),this.isParagraphNonEmpty=this.createCachedMethod(this.isParagraphNonEmpty,"isParagraphNonEmpty"),this._onCEElementChange=this._onCEElementChange.bind(this),this._ceElementObserver=this._parsingDetector.createMutationObserver(this._onCEElementChange);const e={attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0};this._ceElementObserver.observe(this._ceElement,e)}}static _replaceLineBreaks(e){return e.replace(nt.LINE_BREAKS_REGEXP," ")}static _joinWhitespaces(e){return e.replace(nt.WHITESPACE_REGEXP," ")}static _isBlankString(e){return!e.trim()}createCachedMethod(e,t){const n=this._nodePropertiesCache[t];return t=>{let s=n.map.get(t);return void 0===s&&(s=e.call(this,t),n.map.set(t,s)),s}}_deleteCacheForNode(e){const t=Object.values(this._nodePropertiesCache);if(t.forEach((t=>t.map.delete(e))),!this.isTextNode(e)){const n=tt.create(e);for(;n.next();)t.forEach((e=>e.map.delete(n.currentNode)))}}_normalizeMutations(e){const t={};e.forEach((e=>{"attributes"===e.type&&e.attributeName&&(t[e.attributeName]=t[e.attributeName]||[],t[e.attributeName].push(e))}));for(const n in t)if(t.hasOwnProperty(n)){const s=t[n];if(s.length<2)continue;const i=s[0];i.oldValue===i.target.getAttribute(n)&&s.forEach((t=>{e.splice(e.indexOf(t),1)}))}}_checkRuleConditions(e,t){if(!e)return!1;switch(t.type){case"attributes":return!!e.attributes&&(0===e.attributes.length||e.attributes.includes(t.attributeName));case"characterData":return!!e.characterData;case"childList":return!!e.childList}return!1}_onCEElementChange(e){this._normalizeMutations(e);for(const t of e){const e=t.target;if(!this._ceElement.contains(e)){this._deleteCacheForNode(e);continue}"childList"===t.type&&t.removedNodes.forEach((e=>this._deleteCacheForNode(e)));const n=this.getBlockParent(e);for(const[s,i]of Object.entries(this._cacheInvalidationRules)){const r=this._nodePropertiesCache[s];if(this._checkRuleConditions(i.any,t))r.map=new WeakMap;else{if(this._checkRuleConditions(i.self,t)&&r.map.delete(e),this._checkRuleConditions(i.parent,t))for(let t=0;t<e.childNodes.length;t++)r.map.delete(e.childNodes[t]);if(this._checkRuleConditions(i.ancestor,t)){const t=tt.create(e);for(;t.next();)r.map.delete(t.currentNode)}if(this._checkRuleConditions(i.descendant,t)){let t=e.parentElement;for(;t&&t!==this._ceElement;)r.map.delete(t),t=t.parentElement}if(this._checkRuleConditions(i.sibling,t)){const t=e.parentElement;if(t)for(let e=0;e<t.childNodes.length;e++)r.map.delete(t.childNodes[e])}if(this._checkRuleConditions(i.blockSibling,t)){const e=tt.create(n);for(;e.next();)r.map.delete(e.currentNode)}}}}}isWhiteSpace(e){return this._parsingDetector.isWhiteSpace(e)}isTextNode(e){return ye(e)}isElementNode(e){return Ae(e)}getComputedStyle(e){return window.getComputedStyle(e)}isSkippingElement(e){return this._ceElement!==e&&(this._parsingDetector.isIgnored(e,this.getComputedStyle(e))||this._parsingDetector.isSignature(e)||this._parsingDetector.isQuote(e))}getReplacementText(e){const t=this.getComputedStyle(e),n=this._parsingDetector.isIgnored(e,t);return this._parsingDetector.getReplacementText(e,n,t)}isBr(e){return"BR"===e.tagName}isBlock(e){return this._parsingDetector.isBlock(e,this.getComputedStyle(e))}getParsingOptions(e){const t=this.isElementNode(e)?e:e.parentNode;if(this._parsingDetector.getParsingOptions)return this._parsingDetector.getParsingOptions(t);const n=this.getComputedStyle(t).whiteSpace||"";return{element:t,preserveLineBreaks:nt.PRESERVE_LINEBREAKS_VALUES.includes(n),preserveWhitespaces:nt.PRESERVE_WHITESPACES_VALUES.includes(n)}}getParsedText(e){const t=this.getParsingOptions(e);let n=e.nodeValue;return t.preserveLineBreaks||(n=nt._replaceLineBreaks(n)),n=this._parsingDetector.replaceText(n,e,t.element),t.preserveWhitespaces||(n=nt._joinWhitespaces(n)),n}getBlockParent(e){let t=this.isElementNode(e)?e:e.parentElement;for(;t!==this._ceElement&&!this.isBlock(t);)t=t.parentElement;return t}getParagraphLastValuableNode(e){const t=this.getBlockParent(e),n=tt.create(t,e);let s=!1,i=null;do{const e=n.currentNode;if(s=!1,this.isElementNode(e))if(this.getReplacementText(e)&&(i=e),this.isSkippingElement(e))s=!0;else{if(this.isBlock(e))return i;if(this.isBr(e))return i}else if(this.isTextNode(e)){const t=this.getParsingOptions(e),n=this.getParsedText(e);(t.preserveWhitespaces&&n||!nt.BLANK_STRING_REGEXP.test(n))&&(i=e)}}while(n.next(s));return i}isBRElementRelevant(e){const t=this.getBlockParent(e);let n=tt.create(t),s=!1,i=!1;for(;n.next(s);){const t=n.currentNode;if(s=!1,this.isElementNode(t)){if(t===e)break;this.getReplacementText(t)&&(i=!0),this.isSkippingElement(t)?s=!0:this.isBlock(t)&&(i=!1,s=!0)}else if(this.isTextNode(t)){const e=this.getParsingOptions(t),n=this.getParsedText(t);(e.preserveWhitespaces&&n||!nt._isBlankString(n))&&(i=!0)}}for(n=tt.create(t,e),s=!1;n.next(s);){const e=n.currentNode;if(s=!1,this.isElementNode(e)){if(this.getReplacementText(e))return!0;if(this.isSkippingElement(e))s=!0;else{if(this.isBr(e))return!0;if(i&&this.isBlock(e))return!1}}else if(this.isTextNode(e)){const t=this.getParsingOptions(e),n=this.getParsedText(e);if(t.preserveWhitespaces&&n||!nt._isBlankString(n))return!0}}return!i}isBlockElementRelevant(e){return!!this._parsingDetector.isBlockElementRelevant&&this._parsingDetector.isBlockElementRelevant(e)}isTextEndsWithLineBreak(e){const t=tt.create(this._ceElement,e);let n=!!Ae(e)&&this.isSkippingElement(e),s=!1;for(;t.next(n);){const i=t.currentNode;if(n=!1,this.isElementNode(i)){if(this.getReplacementText(i)){return!ee(this.getBlockParent(e),i)}if(this.isSkippingElement(i))n=!0;else if(this.isBlock(i)){if(this.isParagraphNonEmpty(i))return!0;s=!0}}else if(this.isTextNode(i)){const t=this.getParsingOptions(i),n=this.getParsedText(i);if(t.preserveWhitespaces&&n||!nt._isBlankString(n)){if(s)return!0;return!ee(this.getBlockParent(e),i)}}}return!1}isParagraphNonEmpty(e){const t=tt.create(e);let n=!1;for(;t.next(n);){const e=t.currentNode;if(n=!1,this.isElementNode(e)){if(this.getReplacementText(e))return!0;if(this.isSkippingElement(e))n=!0;else if(this.isBlock(e))return!1}else if(this.isTextNode(e)){const t=this.getParsingOptions(e),n=this.getParsedText(e);if(t.preserveWhitespaces&&n||!nt._isBlankString(n))return!0}}return!1}destroy(){this._ceElementObserver&&this._ceElementObserver.disconnect()}}nt.DISPLAY_BLOCK_VALUES=["block","list-item","table","table-caption","table-row","table-cell","flex","grid"],nt.SKIPPING_TAGS=["CODE","NOSCRIPT","OBJECT","SCRIPT","STYLE","TEMPLATE","VAR","CANVAS","IMG","SVG","SELECT"],nt.PRESERVE_LINEBREAKS_VALUES=["pre","pre-wrap","pre-line"],nt.PRESERVE_WHITESPACES_VALUES=["pre","pre-wrap"],nt.LINE_BREAKS_REGEXP=/\n/g,nt.WHITESPACE_REGEXP=/  +/g,nt.BLANK_STRING_REGEXP=/^[ \uFEFF]*$/,nt.SUP_REGEXP=/^[\[\(]?\d+[\]\)]?/;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class st{constructor(e,t,n=Number.MAX_SAFE_INTEGER){this._inputArea=e,this._tweaks=t,this._textLengthThreshold=n,this._keyboardEventTarget=this._tweaks.getKeyboardEventTarget(),this._lastPressInfo={key:"",timeStamp:0},this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._inputArea.addEventListener("blur",this._onBlur),this._keyboardEventTarget.addEventListener("keyup",this._onKeyUp),this._inputArea.addEventListener("paste",this._onPaste)}_onBlur(){const e={inputAreaWrapper:this};de(document,st.eventNames.blur,e)}_onKeyUp(e){const t=Date.now();if(e.key&&e.isTrusted)if(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)this._lastPressInfo={key:"",timeStamp:0};else if(this._lastPressInfo.key===e.key){if(t-this._lastPressInfo.timeStamp<st.MAX_DOUBLE_PRESS_DELAY){const t={inputAreaWrapper:this,key:e.key};de(document,st.eventNames.dblPress,t),this._lastPressInfo={key:"",timeStamp:0}}else this._lastPressInfo={key:e.key,timeStamp:t}}else this._lastPressInfo={key:e.key,timeStamp:t}}_onPaste(e){const t=e.clipboardData,n={inputAreaWrapper:this,isSignificantTextChange:(t?t.getData("Text"):"").length>200};de(document,st.eventNames.paste,n)}_onInput(){const e=this._text;if(!this._updateText())return;const t={inputAreaWrapper:this,previousText:e,text:this._text};de(document,st.eventNames.textChanged,t)}_getTextChunkIndex(e){let t=0,n=this._textChunks.length,s=0;for(;t<n;){s=t+Math.floor((n-t)/2);const i=this._textChunks[t];if(i.parsedTextOffset<=e&&e<=i.parsedTextOffset+i.parsedText.length)return t;const r=this._textChunks[s];r.parsedTextOffset+r.parsedText.length>=e?n=s:t=s+1}return t<this._textChunks.length?t:-1}simulateKeyUp(){try{const e=new window.KeyboardEvent("keyup",{bubbles:!0,cancelable:!0,keyCode:17,which:17,charCode:0,location:1,key:"Control",code:"ControlLeft"});this._inputArea.dispatchEvent(e)}catch(e){}}simulateInput(e=""){const t=new window.InputEvent("input",{bubbles:!0,cancelable:!1,inputType:"insertText",data:e});this._inputArea.dispatchEvent(t)}simulateChange(){const e=new Event("change",{bubbles:!0,cancelable:!1});this._inputArea.dispatchEvent(e)}getText(){return this._text}getTextChunks(){return this._textChunks}getTextRanges(e,t,n=!0){if(e<0)return[];const s=this._getTextChunkIndex(e);if(-1===s)return[];const i=[];for(let r=s;r<this._textChunks.length;r++){const{node:s,isTextNode:o,rawText:a,parsedText:l,parsedTextOffset:c}=this._textChunks[r],d=Math.max(e-c,0);if(!o){t-=l.length-d;continue}const h=this._offsetInRawText(a,l,d),_=this._offsetInRawText(a,l,d+t);if((!n||h!==_)&&(i.push({node:s,text:a,start:h,end:_}),(t-=l.length-d)<=0))break}return i}destroy(){this._inputArea.removeEventListener("blur",this._onBlur),this._keyboardEventTarget.removeEventListener("keyup",this._onKeyUp),this._inputArea.removeEventListener("paste",this._onPaste)}}st.MAX_DOUBLE_PRESS_DELAY=400,st.eventNames={blur:"lt-inputAreaWrapper.blur",scroll:"lt-inputAreaWrapper.scroll",paste:"lt-inputAreaWrapper.paste",textChanged:"lt-inputAreaWrapper.textChanged",dblclick:"lt-inputAreaWrapper.dblclick",dblPress:"lt-inputAreaWrapper.dblPress"};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class it extends st{constructor(e,t,n=Number.MAX_SAFE_INTEGER){super(e,t,n),this._ceElementInspector=new nt(this._inputArea,this._tweaks.getParsingDetector(),this._tweaks.getCacheInvalidationRules()),this._domMeasurement=new K(this._inputArea.ownerDocument),this._scrollTop=this._inputArea.scrollTop,this._scrollLeft=this._inputArea.scrollLeft,this._updateText(),this._onDblClick=this._onDblClick.bind(this),this._onScroll=this._onScroll.bind(this),this._inputArea.addEventListener("dblclick",this._onDblClick),this._inputArea.addEventListener("scroll",this._onScroll),"BODY"===this._inputArea.nodeName&&window.addEventListener("scroll",this._onScroll),this._inputAreaObserver=this._tweaks.createMutationObserver(this._onInput),this._inputAreaObserver.observe(this._inputArea,it.INPUT_AREA_OBSERVER_CONFIG)}static _selectText(e,t=0,n=e.nodeValue.length){t=Math.max(t,0),n=Math.min(n,e.nodeValue.length);const s=window.getSelection();s.removeAllRanges();const i=new Range;i.setStart(e,t),i.setEnd(e,n),s.addRange(i)}static _simulateMouseDown(e,t){const n=new MouseEvent("mousedown",{bubbles:!0,cancelable:!1,clientX:t.x,clientY:t.y+t.height/2});return e.dispatchEvent(n)}static _simulateMouseUp(e,t){const n=new MouseEvent("mouseup",{bubbles:!0,cancelable:!1,clientX:t.x+t.width,clientY:t.y+t.height/2});return e.dispatchEvent(n)}static _simulateMouseMove(e,t){const n=new MouseEvent("mousemove",{bubbles:!0,cancelable:!1,clientX:t.x+t.width,clientY:t.y+t.height/2});return e.dispatchEvent(n)}static _simulateBackspaceDown(e){const t=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:8,which:8,location:0,key:"Backspace"});return e.dispatchEvent(t)}static _simulateBackspaceUp(e){const t=new KeyboardEvent("keyup",{bubbles:!0,cancelable:!0,keyCode:8,which:8,location:0,key:"Backspace"});return e.dispatchEvent(t)}static _simulateSelection(e){const t=e.ownerDocument.createRange();t.setStart(e,0),t.collapse(!1);const n=t.getBoundingClientRect();this._simulateMouseDown(e,n);const s=window.getSelection();s.removeAllRanges(),s.addRange(t),this._simulateMouseMove(e,n),this._simulateMouseUp(e,n)}_onDblClick(e){const t=_(this._tweaks.getSelectedText()),n=this.getSelection();if(!t||!n)return;const s=n.end||n.start,i=this.getTextRanges(n.start,s-n.start);if(!i.length)return;this._domMeasurement.clearCache();const r=this._domMeasurement.getTextBoundingBoxes(i,this._inputArea),o=this._domMeasurement.getTextBoundingBoxes(i,this._inputArea,!1);if(!r.length)return;if(!o.some((t=>J(t,e.clientX,e.clientY))))return;const a={inputAreaWrapper:this,selectedText:t,selection:n,clickedRectangles:r};de(document,st.eventNames.dblclick,a)}_onScroll(){let e=0,t=0;if("BODY"===this._inputArea.nodeName?(e=document.body&&document.body.scrollTop||document.documentElement&&document.documentElement.scrollTop||0,t=document.body&&document.body.scrollLeft||document.documentElement&&document.documentElement.scrollLeft||0):(e=this._inputArea.scrollTop,t=this._inputArea.scrollLeft),this._scrollTop===e&&this._scrollLeft===t)return;this._scrollTop=e,this._scrollLeft=t;const n={inputAreaWrapper:this};de(document,st.eventNames.scroll,n)}_hasSpaceBefore(e){if(e<=0)return!1;const t=this.getTextRanges(e-1,1)[0];return Boolean(t&&t.node.nodeValue&&it.VISIBLE_WHITE_SPACE_REGEXP.test(t.node.nodeValue.substring(t.start,t.end)))}_hasSpaceAfter(e){const t=this.getTextRanges(e,1)[0];return Boolean(t&&t.node.nodeValue&&it.VISIBLE_WHITE_SPACE_REGEXP.test(t.node.nodeValue.substring(t.start,t.end)))}_offsetInRawText(e,t,n){n=Math.min(e.length,n);let s=0,i=0;do{const r=e[s],o=t[i];if(r===o)i++;else if(this._ceElementInspector.isWhiteSpace(r)||"\n"===r)" "===o&&i++;else if(!d(r))break;if(i>n)break;s++}while(s<e.length);return s}_offsetInParsedText(e,t,n){let s=0,i=0;for(;s<n;){const n=e[s],r=t[i];if(n===r)i++;else if(this._ceElementInspector.isWhiteSpace(n)||"\n"===n)" "===r&&i++;else if(!d(n))break;s++}return i}_updateText(){const e=[];let t=0,n=0,s=null,i=!0,r=!1;const a=tt.create(this._inputArea);let l=!1;do{const c=a.currentNode;null===s&&(s=this._ceElementInspector.getParagraphLastValuableNode(c)),l=!1;let d=!1,h="";if(Ae(c))if(h=this._ceElementInspector.getReplacementText(c),i=i&&""===h,r=o(h),c===s&&(s=null,this._ceElementInspector.isTextEndsWithLineBreak(c)&&(i=!0,r=!1,h+="\n\n")),this._ceElementInspector.isSkippingElement(c)){if(l=!0,s=null,!h)continue}else this._ceElementInspector.isBlock(c)?(s=null,i=!0,r=!1,!h&&this._ceElementInspector.isBlockElementRelevant(c)&&(h="\n\n")):this._ceElementInspector.isBr(c)&&(s=null,i=!0,r=!1,!h&&this._ceElementInspector.isBRElementRelevant(c)&&(h="\n"));else if(ye(c)&&(d=!0,h=this._ceElementInspector.getParsedText(c),h)){const e=null===s||s===c;this._ceElementInspector.getParsingOptions(c).preserveWhitespaces||((i||r)&&(h=h.replace(it.LEADING_WHITESPACES_REGEXP,"")),e&&(h=h.replace(it.TRAILING_WHITESPACES_REGEXP,""))),i=i&&""===h,r=o(h),c===s&&(s=null,this._ceElementInspector.isTextEndsWithLineBreak(c)&&(i=!0,r=!1,h+="\n\n"))}const _=d?c.nodeValue:"";if(e.push({node:c,isTextNode:d,rawText:_,rawTextOffset:t,parsedText:h,parsedTextOffset:n}),d&&(t+=_.length),n+=h.length,n>this._textLengthThreshold)break}while(a.next(l));let c="";for(const t of e)c+=t.parsedText;const d=this._text!==c;return this._text=c,this._textChunks=e,d}_getTextPosition(e){const t=this._getTextChunkIndex(e);if(-1===t)return null;const n=this._textChunks[t];return e-=n.parsedTextOffset,{textNode:n.node,offset:this._offsetInRawText(n.rawText,n.parsedText,e)}}_getTextOffset(e,t){let n=null,s=0;if(Ae(e)){const i=tt.create(this._inputArea);do{const s=i.currentNode;if(s===e.childNodes[t])break;ye(s)&&s.textContent&&(n=s)}while(i.next());if(!n)return-1;s=n.textContent.length}else ye(e)&&(n=e,s=t);const i=this._textChunks.find((e=>e.node===n));return i?i.parsedTextOffset+this._offsetInParsedText(i.rawText,i.parsedText,s):-1}_applyReplacement(e){let n=Promise.resolve();console.log("_applyReplacement",JSON.stringify({currentText:e.textNode.textContent,replacementText:e.replacementText,from:e.from,to:e.to},null,2));const s=e.textNode.parentElement||this._inputArea,i=e.textNode.ownerDocument.createRange();i.setStart(e.textNode,e.from),i.setEnd(e.textNode,e.to);const r=i.getBoundingClientRect();n=n.then((()=>(it._simulateMouseDown(s,r),z(Fe(this._inputArea)?21:0)))).then((()=>(it._simulateMouseMove(s,r),it._selectText(e.textNode,e.from,e.to),z(Fe(this._inputArea)?21:0)))).then((()=>(it._simulateMouseUp(s,r),Be(this._inputArea)||Ge(this._inputArea)||He(this._inputArea)?z(201):Oe(this._inputArea)?z(0):Fe(this._inputArea)?z(21):void 0))).then((()=>{if(!He(this._inputArea)||!t.isFirefox()&&!t.isThunderbird()){if(Oe(this._inputArea)&&""===e.replacementText&&e.from!==e.to){if(it._simulateBackspaceDown(this._inputArea)){const e=new window.InputEvent("beforeinput",{bubbles:!0,cancelable:!0,inputType:"deleteContent"});let t=!0;"deleteContent"===e.inputType&&(t=this._inputArea.dispatchEvent(e)),t&&document.execCommand("delete",!1)}return z().then((()=>{it._simulateBackspaceUp(this._inputArea)}))}if(Ge(this._inputArea)||Be(this._inputArea)||this._inputArea.classList.contains("odoo-editor-editable"))!function(e,n,s){var i,r;let o;t.isFirefox()||t.isThunderbird()?o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,data:n,dataType:"text/plain"}):(o=new ClipboardEvent("paste",{clipboardData:new DataTransfer,cancelable:!0,bubbles:!0}),o.clipboardData.setData("text/plain",n),s&&o.clipboardData.setData("text/html",s));let a=e.dispatchEvent(o);if(a){const t=new InputEvent("beforeinput",{data:n,inputType:"insertFromPaste",cancelable:!0,bubbles:!0});null===(i=t.dataTransfer)||void 0===i||i.setData("text/plain",n),s&&(null===(r=t.dataTransfer)||void 0===r||r.setData("text/html",s)),"insertFromPaste"===t.inputType&&(a=e.dispatchEvent(t))}}(this._inputArea,e.replacementText);else{const t=new window.InputEvent("beforeinput",{bubbles:!0,cancelable:!0,inputType:"insertText",data:e.replacementText});let n=!0;"insertText"===t.inputType&&(n=this._inputArea.dispatchEvent(t)),n&&document.execCommand("insertText",!1,e.replacementText)}}}));return(t.isFirefox()||t.isThunderbird())&&(e.replacementText.includes(it.NBSP)||He(this._inputArea))&&(n=n.then((()=>{const t=new window.InputEvent("beforeinput",{bubbles:!0,cancelable:!1,inputType:"insertText",data:e.replacementText});this._inputArea.dispatchEvent(t),e.textNode.nodeValue=e.newText,this.simulateInput(e.replacementText)}))),n}getTextBoxes(e,t){const n=this.getTextRanges(e,t);return n.length?(this._domMeasurement.clearCache(),this._domMeasurement.getTextBoundingBoxes(n,this._inputArea)):[]}resetText(){this._inputAreaObserver.disconnect();const e=tt.create(this._inputArea);do{const t=e.currentNode;ye(t)&&(t.textContent=t.textContent)}while(e.next());this._inputAreaObserver.observe(this._inputArea,it.INPUT_AREA_OBSERVER_CONFIG)}replaceText(e,t,n){if(e<0)return Promise.resolve();const s=e+n.length;return""===n&&(this._hasSpaceBefore(e)||0===e)&&this._hasSpaceAfter(e+t)&&(e=Math.max(e-1,0),t+=1),z(50).then((()=>{const i=[],r=this._getTextChunkIndex(e);if(-1===r)return Promise.resolve();e-=this._textChunks[r].parsedTextOffset;for(let s=r;s<this._textChunks.length;s++){const{node:r,isTextNode:o,rawText:a,parsedText:l}=this._textChunks[s];if(o&&e<l.length){const s=l.substr(0,e)+n+l.substr(e+t);if(a!==s){const o=this._offsetInRawText(a,l,e),c=this._offsetInRawText(a,l,e+t);i.push({textNode:r,from:o,to:c,replacementText:n,newText:s})}t=Math.max(t-(l.length-e),0),e=0,n=""}else e-=l.length;if(0===t&&""===n)break}i.reverse().reduce(((e,t)=>e.then((()=>this._applyReplacement(t)))),Promise.resolve()).then((()=>{this.setSelection({start:s})})).then((()=>{this.simulateChange(),this.simulateKeyUp()}))}))}getSelection(){const e=this._tweaks.getSelection();if(!e||!e.startNode)return null;if(!this._inputArea.contains(e.startNode))return null;const t=this._getTextOffset(e.startNode,e.startOffset);return{start:t,end:e.isCollapsed||!e.endNode?t:this._getTextOffset(e.endNode,e.endOffset)}}setSelection(e){const t=e.start,n=void 0===e.end?t:e.end;this._inputArea.focus();const s=this._getTextPosition(t);if(!s)return;const i=window.getSelection();i.removeAllRanges();const r=new Range;if(r.setStart(s.textNode,s.offset),t!==n){const e=this._getTextPosition(n);if(!e)return;r.setEnd(e.textNode,e.offset)}else r.collapse(!1);i.addRange(r)}scrollToText(e,t,n="smooth",s="nearest",i){if(e<0)return;const r=()=>{i&&setTimeout((()=>i()),50)},o=this.getTextRanges(e,t);if(o.length)try{const e=new Range;e.setStart(o[0].node,o[0].start),e.setEnd(o[o.length-1].node,o[o.length-1].end),window.scrollRangeIntoView(e,{behavior:n,block:s},r)}catch(e){}}destroy(){super.destroy(),this._inputArea.removeEventListener("dblclick",this._onDblClick),this._inputArea.removeEventListener("scroll",this._onScroll),window.removeEventListener("scroll",this._onScroll),this._ceElementInspector.destroy(),this._inputAreaObserver&&this._inputAreaObserver.disconnect()}}it.NBSP=String.fromCharCode(160),it.VISIBLE_WHITE_SPACE_REGEXP=/\u00A0|\u0020|\u2009|\u202F/,it.LEADING_WHITESPACES_REGEXP=new RegExp(/^ /),it.TRAILING_WHITESPACES_REGEXP=new RegExp(/ $/),it.INPUT_AREA_OBSERVER_CONFIG={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0,attributeFilter:["id","class","style"]};class rt{constructor(e,t,n,s,i=!0){this._className=e,this._label=t,this._parentElement=s,this._toolTip=n,this._document=s.ownerDocument,this._render(i)}_render(e){if(this._element=this._document.createElement("lt-div"),this._element.classList.add("lt-icon","lt-icon--"+this._className),this._element.classList.toggle("lt-icon--clickable",e),this._element.setAttribute("data-lt-prevent-focus",""),this._parentElement.appendChild(this._element),this._icon=this._document.createElement("lt-span"),this._icon.classList.add("lt-icon__icon","lt-icon__"+this._className),this._element.appendChild(this._icon),this._toolTip){const e=this._document.createElement("lt-div");e.classList.add("lt-icon__tooltip","lt-icon__tooltip--"+this._toolTip.position,"lt-icon__tooltip--"+this._className),e.textContent=this._toolTip.label,this._element.appendChild(e)}if(this._label){const e=this._document.createElement("lt-span");e.classList.add("lt-icon__label"),e.textContent=this._label,this._element.appendChild(e)}}setIcon(e){this._icon.className="",this._icon.classList.add("lt-icon__icon","lt-icon__"+e)}getElement(){return this._element}}class ot{constructor(e,t,n,s,i,r,o=null){this._className=e,this._parentElement=n,this._dialog=s,this._appendElement=o,this._optionElements=[],this._options=t,this._document=n.ownerDocument,this._position=i,this._isSelectable=r,this._render()}_render(){this._overlay=this._document.createElement("lt-div"),this._overlay.setAttribute("data-lt-prevent-focus",""),this._overlay.classList.add("lt-menu-overlay","lt-menu-overlay--"+this._className),this._dialog.appendChild(this._overlay),this._element=this._document.createElement("lt-div"),this._element.setAttribute("data-lt-prevent-focus",""),this._element.classList.add("lt-menu","lt-menu--"+this._className,"lt-menu--position-"+this._position),this._parentElement.appendChild(this._element),this._options.forEach((e=>{const t=this._document.createElement("lt-div");t.classList.add("lt-menu__item","lt-menu__item--"+e.className,"lt-icon__"+e.className),e.isClickable&&t.classList.add("lt-menu__item--clickable"),this._isSelectable&&t.classList.add("lt-menu__item--selectable"),this._element.appendChild(t);const n=this._document.createElement("lt-span");if(n.classList.add("lt-menu__item__label","lt-menu__item__label--"+e.className),n.textContent=e.label,t.appendChild(n),e.info){const n=this._document.createElement("lt-span");n.classList.add("lt-menu__item__info","lt-menu__item__info--"+e.className),n.textContent=e.info,t.appendChild(n)}if(e.tag){const n=this._document.createElement("lt-span");n.classList.add("lt-menu__item__tag","lt-menu__item__tag--"+e.className),n.textContent=e.tag,t.appendChild(n)}this._optionElements.push(t)})),this._appendElement&&this._element.appendChild(this._appendElement)}show(){this._parentElement.classList.add("lt-menu-visible"),this._element.classList.add("lt-menu--show"),this._overlay.classList.add("lt-menu--show")}hide(){this._parentElement.classList.remove("lt-menu-visible"),this._element.classList.remove("lt-menu--show"),this._overlay.classList.remove("lt-menu--show")}getElement(){return this._element}getAllOptions(){return this._optionElements}getActiveOptions(){return this._optionElements}getOverlay(){return this._overlay}setInfo(e,t){if(e>=0&&e<this._optionElements.length){const n=this._optionElements[e].querySelector(".lt-menu__item__info");n&&(n.textContent=t)}}toggleActive(e,t,n){n&&this.getAllOptions().forEach((e=>{e.classList.remove("lt-menu__item--active")})),e>=0&&e<this._optionElements.length&&(t?this._optionElements[e].classList.add("lt-menu__item--active"):this._optionElements[e].classList.remove("lt-menu__item--active"))}toogleVisibility(e,t){e>=0&&e<this._optionElements.length&&(t?this._optionElements[e].classList.remove("lt-menu__item--hidden"):this._optionElements[e].classList.add("lt-menu__item--hidden"))}}class at{constructor(e,t,n,s){this._className=e,this._type=t,this._size=n,this._parentElement=s,this._document=s.ownerDocument,this._render()}_render(){this._element=this._document.createElement("lt-div"),this._element.classList.add("lt-package-badge","lt-package-badge--"+this._type,"lt-package-badge--"+this._size),this._element.textContent=this._type,this._parentElement.appendChild(this._element)}getElement(){return this._element}}class lt{constructor(e,t,n=null,s=null,i=null,r){this._parentElement=e,this._headline=n,this._text=s,this._buttonText=i,this._trackingEvent=t,this._linkParameters=r,this._document=e.ownerDocument,this._storageController=W.create(),this._element=this._document.createElement("lt-div"),this._element.addEventListener("click",(e=>{const t=Object.assign({command:"OPEN_PREMIUM_PAGE"},this._linkParameters);browser.runtime.sendMessage(t),e.preventDefault(),e.stopImmediatePropagation()}),!0),this._element.className="lt-premium-errors-teaser",this._parentElement.appendChild(this._element),this._renderPremiumErrorsTeaser()}_observe(){this._element.addEventListener("click",(()=>{V.trackEvent("Action",`${this._trackingEvent}:click`)}))}_renderPremiumErrorsTeaser(){V.trackEvent("Action",this._trackingEvent),this._observe(),this._storageController.onReady((()=>{this._storageController.startChangelogCoupon();const e=this._storageController.getActiveCoupon();if(e&&(this._linkParameters.campaign=this._linkParameters.campaign.replace(/addon2-(dialog|popup|validator)/,"addon2-changelog"),this._renderCoupon(e)),!this._headline&&!this._text&&!this._buttonText)return;const t=this._document.createElement("lt-div");if(t.className="lt-premium-errors-teaser__content",this._element.appendChild(t),this._headline&&!e){const e=this._document.createElement("lt-span");e.className="lt-premium-errors-teaser__content__headline",e.textContent=this._headline,t.appendChild(e)}if(this._text){const e=this._document.createElement("lt-span");e.className="lt-premium-errors-teaser__content__text",e.innerHTML=this._text,t.appendChild(e)}if(this._buttonText){const e=this._document.createElement("lt-span");e.className="lt-premium-errors-teaser__content__button",e.textContent=this._buttonText,t.appendChild(e)}}))}_renderCoupon(e){const t=this._document.createElement("lt-div");t.className="lt-premium-errors-teaser__coupon";const n=this._document.createElement("lt-span");n.textContent=s.getMessage("upgradeTeaserDiscountHeadline"),n.className="lt-premium-errors-teaser__coupon__title__headline";const i=this._document.createElement("lt-span");i.textContent=s.getMessage("upgradeTeaserDiscount",[e.percent]),i.className="lt-premium-errors-teaser__coupon__title__subline";const r=this._document.createElement("lt-div");r.className="lt-premium-errors-teaser__coupon__title",r.appendChild(n),r.appendChild(i),t.appendChild(r);const o=this._document.createElement("lt-div");o.className="lt-premium-errors-teaser__coupon__timer",t.appendChild(o),this._element.prepend(t),window.clearInterval(this._interval),this._renderTimer(t,o,e),this._interval=window.setInterval((()=>this._renderTimer(t,o,e)),1e3)}_renderTimer(e,t,n){const s=Date.now();let i=(n.expires||0)-s;if(i<0)return i=0,void e.remove();const r=Math.floor(i/1e3%60),o=Math.floor(i/1e3/60%60),a=`${I(Math.floor(i/1e3/60/60))}:${I(o)}:${I(r)}`.split(/:|/),l=this._document.createElement("lt-div");a.forEach(((e,t)=>{const n=this._document.createElement("lt-span");if(n.className="lt-premium-timer__timer__diget",n.textContent=e,l.appendChild(n),t%2==1&&t<a.length-1){const e=this._document.createElement("lt-span");e.className="lt-premium-timer__timer__divider",e.textContent=":",l.appendChild(e)}})),t.innerHTML=l.innerHTML}destroy(){window.clearInterval(this._interval)}}class ct{constructor(e,t,n){this._parentElement=e,this._componentName=t,this._url=n,this._document=e.ownerDocument,this._storageController=W.create(),this._element=this._document.createElement("lt-div"),this._element.className="lt-rating-teaser",this._parentElement.appendChild(this._element),this.render()}_sendRating(e){V.trackEvent("Stat",`rating:${H.getPrimaryLanguageCode(navigator.language)}`,e),this._storageController.updateStatistics({ratingValue:e}),this._storageController.updateUIState({hasRated:!0}),"like"===e?t.isChrome()||t.isFirefox()||t.isOpera()||t.isEdge()||t.isSafari()?this._showReviewContainer():this._showThanksContainer():"dislike"===e&&(this._showThanksContainer(),this._openFeedbackForm(s.getMessage("ratingUnhappyQuestion")),V.trackEvent("Stat","dislike_host",k()))}_showReviewContainer(){this._element.classList.remove("lt-rating-teaser--thanks-visible"),this._element.classList.add("lt-rating-teaser--review-visible")}_showThanksContainer(){this._element.classList.remove("lt-rating-teaser--review-visible"),this._element.classList.add("lt-rating-teaser--thanks-visible")}_openFeedbackForm(t){e.openFeedbackForm(this._url,t)}render(){if(t.isSafari())return;const e=this._document.createElement("lt-div");e.className="lt-rating-teaser__intro",this._element.appendChild(e);const n=this._document.createElement("lt-div");n.className="lt-rating-teaser__intro__question";const s=this._document.createElement("lt-div");s.className="lt-rating-teaser__intro__headline",s.innerText=browser.i18n.getMessage("ratingHeadline"),n.appendChild(s);const i=this._document.createElement("lt-div");i.innerText=browser.i18n.getMessage("ratingText"),n.appendChild(i),e.appendChild(n);const r=this._document.createElement("lt-div");r.className="lt-rating-teaser__intro__options";const o=this._document.createElement("lt-div");o.className="lt-rating-teaser__intro__option",o.setAttribute("data-lt-emotion","like"),r.appendChild(o);const a=this._document.createElement("lt-div");a.className="lt-rating-teaser__intro__option",a.setAttribute("data-lt-emotion","dislike"),r.appendChild(a),e.appendChild(r);const l=this._document.createElement("a");l.target="_blank",l.rel="noreferrer noopener",l.className="lt-rating-teaser__review",this._element.appendChild(l);const c=this._document.createElement("lt-div");c.className="lt-rating-teaser__review__text",l.appendChild(c),t.isFirefox()?Y(c,"reviewFirefoxHeadline"):t.isOpera()?Y(c,"reviewOperaHeadline"):t.isEdge()?Y(c,"reviewEdgeHeadline"):t.isSafari()?Y(c,"reviewSafariHeadline"):Y(c,"reviewChromeHeadline");const d=this._document.createElement("lt-a");d.className="lt-rating-teaser__review__link",d.innerText=browser.i18n.getMessage("reviewLink"),l.appendChild(d);const h=this._document.createElement("lt-div");h.className="lt-rating-teaser__thanks",h.innerText=browser.i18n.getMessage("ratingThankYou"),this._element.appendChild(h),o.addEventListener("click",(()=>this._sendRating("like"))),a.addEventListener("click",(()=>this._sendRating("dislike"))),l.addEventListener("click",(()=>{V.trackEvent("Action","dialog:rating_teaser:click")})),t.isChrome()?(this._element.classList.add("lt-rating-teaser--chrome"),l.href="https://chrome.google.com/webstore/detail/grammar-and-spell-checker/oldceeleldhonbafppcapldpdifcinji/reviews"):t.isFirefox()?(this._element.classList.add("lt-rating-teaser--firefox"),l.href="https://addons.mozilla.org/firefox/addon/languagetool/"):t.isOpera()?(this._element.classList.add("lt-rating-teaser--opera"),l.href="https://addons.opera.com/extensions/details/grammar-and-spell-checker-languagetool/"):t.isEdge()?(this._element.classList.add("lt-rating-teaser--edge"),l.href="https://microsoftedge.microsoft.com/addons/detail/hfjadhjooeceemgojogkhlppanjkbobc"):t.isSafari()&&(this._element.classList.add("lt-rating-teaser--safari"),l.href="https://appstoreconnect.apple.com/apps/1534275760/appstore"),V.trackEvent("Action",`${this._componentName}:rating_teaser`)}}class dt{constructor(e,t,n){this._className=e,this._parentElement=t,this._toolTip=n,this._document=t.ownerDocument,this._render()}_render(){this._element=this._document.createElement("lt-div"),this._element.classList.add("lt-score","lt-score--"+this._className),this._element.setAttribute("data-lt-prevent-focus",""),this._parentElement.appendChild(this._element),this._progressLabel=this._document.createElement("lt-span"),this._progressLabel.classList.add("lt-score__label"),this._progressLabel.setAttribute("data-lt-prevent-focus",""),this._progressLabel.textContent="0";const e=this._document.createElement("lt-div");e.classList.add("lt-icon__tooltip","lt-icon__tooltip--"+this._toolTip.position,"lt-icon__tooltip--"+this._className),e.textContent=this._toolTip.label,this._element.appendChild(e),this._element.appendChild(this._progressLabel)}setScore(e){Math.PI;e>0?(this._progressLabel.textContent=e.toString(),this._updateProgress(e),this._element.classList.remove("lt-score--hidden")):this._element.classList.add("lt-score--hidden")}_updateProgress(e){let t="",n="";if(e<50){t="linear-gradient(90deg, #DEE3ED 50%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0))",n="linear-gradient("+(90+3.6*e)+"deg, #1976F0 50%, #DEE3ED 50%, #DEE3ED)"}else{t="linear-gradient("+(3.6*(e-50)-90)+"deg, #1976F0 50%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0))",n="linear-gradient(270deg, #1976F0 50%, #DEE3ED 50%, #DEE3ED)"}this._element.setAttribute("style","background-image: "+t+", "+n+" !important")}}class ht{constructor(e,t,n){this._className=e,this._parentElement=t,this._select=n,this._document=t.ownerDocument,this._currentSelection=this._document.createElement("lt-span"),this._render()}_render(){this._selectorWrapper=this._document.createElement("lt-div"),this._selectorWrapper.classList.add("lt-dialog__selector-wrapper","lt-dialog__selector-wrapper--"+this._className,"lt-icon__chevron_down"),this._parentElement.appendChild(this._selectorWrapper),this._currentSelection.classList.add("lt-dialog__current-selection","lt-dialog__current-selection--"+this._className),this._selectorWrapper.appendChild(this._currentSelection),this._select.classList.add("lt-dialog__selector","lt-dialog__selector--"+this._className),this._selectorWrapper.appendChild(this._select)}setActive(e,t,n){this._currentSelection.textContent=e||"",this._select.value=t,new K(this._document).setStyles(this._currentSelection,n)}addOption(e){this._select.prepend(e)}updateOptionLable(e,t){this._select.querySelectorAll("option[value="+e+"]")[0].textContent=t}getSelect(){return this._select}getValue(){return this._select.value}toggleHighlight(e){this._selectorWrapper.classList.toggle("lt-dialog__selector-wrapper--highlight",e)}}class _t{constructor(e,t,n,s){this._className=e,this._label=t,this._info=n,this._parentElement=s,this._document=s.ownerDocument,this._render()}_render(){this._element=this._document.createElement("lt-div"),this._element.setAttribute("data-lt-prevent-focus",""),this._element.classList.add("lt-toggle-item","lt-toggle--"+this._className,"lt-icon__"+this._className),this._parentElement.appendChild(this._element);const e=this._document.createElement("lt-div");e.classList.add("lt-toggle-item__title","lt-toggle-item__title--"+this._className);const t=this._document.createElement("lt-span");t.classList.add("lt-toggle-item__title__label"),t.textContent=this._label,e.appendChild(t),this._info&&(this._infoElement=this._document.createElement("lt-span"),this._infoElement.classList.add("lt-toggle-item__title__info"),this._infoElement.textContent=this._info,e.appendChild(this._infoElement)),this._element.appendChild(e);const n=this._document.createElement("lt-div");n.classList.add("lt-toggle-item__toggle","lt-toggle-item__toggle--"+this._className),this._element.appendChild(n);const s=this._document.createElement("lt-div");s.classList.add("lt-toggle-item__toggle__dot"),n.appendChild(s)}set(e){e?this._element.classList.add("lt-toggle-item---checked"):this._element.classList.remove("lt-toggle-item---checked")}setInfo(e){this._infoElement.textContent=e}getElement(){return this._element}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
var ut=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};class gt{constructor(t,n,s,i,r){this._menus=[],this._allDisplyedErrorsCount=0,this._toolbarContainer=t,this._appearance=n,this._uiOptions=r,this._document=this._toolbarContainer.ownerDocument,this._languageCode=s,this._onCloseClick=this._onCloseClick.bind(this),this._onUnload=this._onUnload.bind(this),window.addEventListener("pagehide",this._onUnload,!0),this._controls={},this._eventListeners=[],this._render().then((()=>{this.setCurrentLanguage(s||H.getUserLanguageCode()),this.setCountOptions({mode:"words",counts:{words:0,characters:0,sentences:0}}),this.updateState(i)})),this._eventListeners.push(he(document,"keydown",this._onKeydown.bind(this))),this._inApplyFixMode=!1,this._inInsignificantChangeMode=!0,this._shouldShowRatingTeaser=!i.displayedPremiumErrors.length&&!this._controls.teaserElement&&!this._uiOptions.disableRatingTeaser&&e.isRuntimeConnected()&&0===Math.floor(2*Math.random())}static _cacheMessages(){gt.MESSAGES={EXTENSION_UPDATED_HEADLINE:s.getMessage("extensionUpdatedHeadline"),EXTENSION_UPDATED_TEXT:s.getMessage("extensionUpdatedText",["<lt-span class='lt-dialog__icon'></lt-span>"]),INCOMPLETE_RESULT:s.getMessage("incompleteResult"),POWERED_BY:s.getMessage("poweredBy"),FEEDBACK:s.getMessage("sendFeedback"),DELETE:s.getMessage("deleteWord"),ENABLE_HEADLINE:s.getMessage("dialogEnableInDialogHeadline"),ENABLE_TEXT:s.getMessage("dialogEnableInDialogText"),ENABLE_EVERYWHERE_BUTTON:s.getMessage("enableEverywhereButton"),ENABLE_HERE_BUTTON:s.getMessage("enableHereButton"),OPTIONS_TITLE:s.getMessage("settingsHeadline"),NO_ERRORS:s.getMessage("noErrorsFound2"),NO_ERRORS_TEXT:s.getMessage("noErrorsFoundText"),TEXT_TOO_LONG_HEADLINE:s.getMessage("dialogTextTooLongHeadline"),TEXT_TOO_LONG_TEXT:s.getMessage("dialogTextTooLongText"),SCROLL_HINT_HEADLINE:s.getMessage("dialogScrollHintHeadline"),SCROLL_HINT_TEXT:s.getMessage("dialogScrollHintText"),TEXT_TOO_LONG_BUTTON:s.getMessage("dialogTextTooLongButton"),TEXT_TOO_SHORT_TEXT:s.getMessage("dialogTextTooShortText"),TEXT_TOO_SHORT_HEADLINE:s.getMessage("dialogTextTooShortHeadline"),TEXT_SCORE_MENU_ITEM:s.getMessage("dialogMainMenuTextScore"),REGULAR_MISTAKE_MENU_ITEM:s.getMessage("dialogMainMenuRegularMistake"),PREMIUM_MISTAKE_MENU_ITEM:s.getMessage("dialogMainMenuPremiumMistake"),PICKY_MODE_MENU_ITEM:s.getMessage("dialogMainMenuPickyMode"),PICKY_MODE_MENU_ITEM_INFO:s.getMessage("dialogMainMenuPickyModeInfo"),COUNTER_CHARACTERS_OPTION:s.getMessage("dialogCounterCharactersOption"),COUNTER_WORDS_OPTION:s.getMessage("dialogCounterWordsOption"),COUNTER_SENTENCES_OPTION:s.getMessage("dialogCounterSentencesOption"),POSITION_DEFAULT_MENU_ITEM:s.getMessage("dialogPositionMenuDefault"),POSITION_RIGHT_MENU_ITEM:s.getMessage("dialogPositionMenuRight"),POSITION_LEFT_MENU_ITEM:s.getMessage("dialogPositionMenuLeft"),Fail_STATE_HEADLINE:s.getMessage("dialogFailStateHeadline"),Fail_STATE_TEXT:s.getMessage("dialogFailStateText"),HEADLINE_SPELLING_ERROR:s.getMessage("spellingError"),HEADLINE_CUSTOM_SUGGESTION_ERROR:s.getMessage("customSuggestionError"),HEADLINE_SUGGESTION_ERROR:s.getMessage("suggestionError"),HEADLINE_PUNCTUATION_ERROR:s.getMessage("punctuationError"),HEADLINE_GRAMMAR_ERROR:s.getMessage("grammarError"),SELECT_LANGUAGE_LABEL:s.getMessage("dialogSelectLanguageLabel"),UNSUPPORTED_LANGUAGE_LABEL:s.getMessage("dialogUnsupportedLanguageLabel"),UNSUPPORTED_LANGUAGE_HEADLINE:s.getMessage("dialogUnsupportedLanguageHeadline"),UNSUPPORTED_LANGUAGE_TEXT:s.getMessage("dialogUnsupportedLanguageText"),ALL_LANGUAGES:s.getMessage("dialogAllLanguages"),RECOMMENDED_LANGUAGES:s.getMessage("dialogRecommendedLanguages"),SCROLL_TO_LINK:s.getMessage("dialogScrollToLink"),SEND_FEEDBACK_TOOLTIP:s.getMessage("dialogTooltipSendFeedback"),HELP_TOOLTIP:s.getMessage("dialogTooltipHelp"),HELP_CENTER_TOOLTIP:s.getMessage("dialogTooltipHelpCenter"),IGNORE_RULE_TOOLTIP:s.getMessage("ignoreHere"),DISABLE_CHECKING_TOOLTIP:s.getMessage("dialogTooltipDisableChecking"),DISABLE_CHECKING_MENU_ITEM:s.getMessage("dialogDisableMenuDisableChecking"),PAUSE_CHECKING_MENU_ITEM:s.getMessage("dialogDisableMenuPauseChecking"),DIALOG_POSITION_TOOLTIP:s.getMessage("dialogTooltipPosition"),SETTINGS_TOOLTIP:s.getMessage("dialogTooltipSettings"),SAVE_TEXT_TOOLTIP:s.getMessage("dialogTooltipSaveText"),NEEDS_LANGUAGE_HINT_HEADLINE:s.getMessage("dialogNeedsLanguageHintHeadline"),NEEDS_LANGUAGE_HINT_TEXT:s.getMessage("dialogNeedsLanguageHintText"),NEEDS_LANGUAGE_HINT_IGNORE:s.getMessage("dialogNeedsLanguageHintIgnore"),LANGUAGES:H.LANGUAGES}}static init(){gt._isInitialized||(gt._cacheMessages(),gt._isInitialized=!0)}_render(){return ut(this,void 0,void 0,(function*(){if(this._controls.container)return;this._controls.container=Q(this._document,gt.CONTAINER_ELEMENT_NAME);const n=e=>{e.stopImmediatePropagation()};this._eventListeners.push(he(this._controls.container,"mousedown",(e=>{if(e.target===this._controls.languageSelector.getSelect()){const e=e=>{e.stopImmediatePropagation()};document.addEventListener("blur",e,!0),setTimeout((()=>{document.removeEventListener("blur",e,!0)}),10)}if(e.target===this._controls.countSelector.getSelect()){const e=e=>{e.stopImmediatePropagation()};document.addEventListener("blur",e,!0),setTimeout((()=>{document.removeEventListener("blur",e,!0)}),10)}e.target instanceof HTMLElement&&e.target.closest("[data-lt-prevent-focus]")&&e.preventDefault(),n(e)})),he(this._controls.container,"mouseup",n),he(this._controls.container,"pointerdown",n),he(this._controls.container,"pointerup",n),he(this._controls.container,"focusin",n),he(this._controls.container,"focusout",n)),this._controls.container.addEventListener("click",n),this._controls.innerContainer=this._document.createElement("lt-div"),this._controls.innerContainer.classList.add("lt-dialog__container","notranslate"),t.isSafari()&&this._controls.innerContainer.classList.add("lt-dialog__container--safari"),this._appearance.canDisplayAllSuggestions()||this._controls.innerContainer.classList.add("lt-dialog__container--small"),this._controls.container.appendChild(this._controls.innerContainer),this._controls.header=this._document.createElement("lt-div"),this._controls.header.className="lt-dialog__header",this._controls.innerContainer.appendChild(this._controls.header);const s=this._document.createElement("lt-div");s.className="lt-dialog__header__logo-wrapper",this._controls.logo=this._document.createElement("lt-div"),this._controls.logo.classList.add("lt-dialog__logo","lt-icon__lt"),s.appendChild(this._controls.logo),this._uiOptions.isPremiumAccount||(this._controls.packageBadge=new at(null,"basic","default",s),this._eventListeners.push(he(this._controls.packageBadge.getElement(),"click",this._onBadgeClicked.bind(this)))),this._controls.header.appendChild(s),this._controls.headerScoreProgress=this._document.createElement("lt-div"),this._controls.headerScoreProgress.className="lt-dialog__header__progress-score",this._controls.header.appendChild(this._controls.headerScoreProgress),this._controls.headerScoreProgressBar=this._document.createElement("lt-div"),this._controls.headerScoreProgressBar.className="lt-dialog__header__progress-score__bar",this._controls.headerScoreProgress.appendChild(this._controls.headerScoreProgressBar),this._controls.headerControlsWrapper=this._document.createElement("lt-div"),this._controls.headerControlsWrapper.className="lt-dialog__header__controls-wrapper";const i=this._document.createElement("select");if(gt.MESSAGES.LANGUAGES.forEach((e=>{const t=this._document.createElement("option");t.value=e.code,t.textContent=e.name,i.appendChild(t)})),e.isRuntimeConnected()){const t=yield e.getPreferredLanguages();if(!i||!t.length)return;const n=i.value,s=this._document.createElement("optgroup");s.label=gt.MESSAGES.ALL_LANGUAGES,Array.from(i.children).forEach((e=>{s.append(e)}));const r=this._document.createElement("optgroup");r.label=gt.MESSAGES.RECOMMENDED_LANGUAGES,t.forEach((e=>{const t=H.LANGUAGES.find((t=>t.code.startsWith(e.toLowerCase())));if(t){const e=this._document.createElement("option");e.value=t.code,e.textContent=t.name,r.appendChild(e)}})),i.append(r),i.append(s),i.value=n}if(this._controls.languageSelector=new ht("language-select",this._controls.headerControlsWrapper,i),this._eventListeners.push(he(this._controls.languageSelector.getSelect(),"change",this._onLanguageChange.bind(this))),!this._uiOptions.disableSaveDocument){const e={label:gt.MESSAGES.SAVE_TEXT_TOOLTIP,position:"top-center"};this._controls.saveIcon=new rt("save",null,e,this._controls.headerControlsWrapper),this._eventListeners.push(he(this._controls.saveIcon.getElement(),"click",this._onSaveTextClick.bind(this)))}if(this._appearance.isPositionVisible()&&e.isRuntimeConnected()){const e=this._document.createElement("lt-div");e.className="lt-icon-group",this._controls.headerControlsWrapper.appendChild(e);const t={label:gt.MESSAGES.DIALOG_POSITION_TOOLTIP,position:"bottom-right"};this._controls.positionIcon=new rt(this._uiOptions.dialogPosition,null,t,e);const n=[{className:"default",label:gt.MESSAGES.POSITION_DEFAULT_MENU_ITEM,info:null,tag:null,isClickable:!0},{className:"right",label:gt.MESSAGES.POSITION_RIGHT_MENU_ITEM,info:null,tag:null,isClickable:!0},{className:"left",label:gt.MESSAGES.POSITION_LEFT_MENU_ITEM,info:null,tag:null,isClickable:!0}];this._controls.positionMenu=new ot("position",n,this._controls.positionIcon.getElement(),this._controls.innerContainer,"bottom",!0),this._menus.push(this._controls.positionMenu);const s=this._controls.positionMenu.getAllOptions();this._eventListeners.push(he(s[0],"click",this._onPositionDialogClick.bind(this)),he(s[1],"click",this._onPositionRightClick.bind(this)),he(s[2],"click",this._onPositionLeftClick.bind(this)),he(this._controls.positionMenu.getOverlay(),"click",this._onPositionOverlayClick.bind(this)),he(this._controls.positionIcon.getElement(),"click",this._onPositionIconClick.bind(this)))}this._controls.closeIcon=new rt("close_filled",null,null,this._controls.headerControlsWrapper),this._eventListeners.push(he(this._controls.logo,"click",this._gotoLanguageTool.bind(this)),he(this._controls.closeIcon.getElement(),"click",this._onCloseClick)),this._controls.content=this._document.createElement("lt-div"),this._controls.content.className="lt-dialog__content",this._controls.innerContainer.appendChild(this._controls.content),this._eventListeners.push(he(this._controls.content,"scroll",this._onContentScroll.bind(this))),this._controls.contentTop=this._document.createElement("lt-div"),this._controls.contentTop.className="lt-dialog__content__top",this._controls.content.appendChild(this._controls.contentTop),this._controls.contentMain=this._document.createElement("lt-div"),this._controls.contentMain.className="lt-dialog__content__main",this._controls.content.appendChild(this._controls.contentMain),this._controls.contentBottom=this._document.createElement("lt-div"),this._controls.contentBottom.className="lt-dialog__content__bottom",this._controls.content.appendChild(this._controls.contentBottom),this._controls.footer=this._document.createElement("lt-div"),this._controls.footer.className="lt-dialog__footer",this._controls.loadingBar=this._document.createElement("lt-div"),this._controls.loadingBar.className="lt-dialog__footer__loading-bar-container";const r=this._document.createElement("lt-div");r.classList.add("lt-dialog__footer__loading-bar-container__loading-bar","lt-dialog__footer__loading-bar-container__loading-bar--loading-bar-1");const o=this._document.createElement("lt-div");o.classList.add("lt-dialog__footer__loading-bar-container__loading-bar","lt-dialog__footer__loading-bar-container__loading-bar--loading-bar-2");const a=this._document.createElement("lt-div");a.classList.add("lt-dialog__footer__loading-bar-container__loading-bar","lt-dialog__footer__loading-bar-container__loading-bar--loading-bar-3"),this._controls.loadingBar.appendChild(r),this._controls.loadingBar.appendChild(o),this._controls.loadingBar.appendChild(a),this._controls.footer.appendChild(this._controls.loadingBar);const l=[{label:gt.MESSAGES.COUNTER_CHARACTERS_OPTION,value:"characters"},{label:gt.MESSAGES.COUNTER_WORDS_OPTION,value:"words"},{label:gt.MESSAGES.COUNTER_SENTENCES_OPTION,value:"sentences"}],c=this._document.createElement("select");if(l.forEach((e=>{const t=this._document.createElement("option");t.value=e.value,t.textContent=e.label,c.appendChild(t)})),this._controls.countSelector=new ht("countSelect",this._controls.footer,c),this._controls.footerControlsWrapper=this._document.createElement("lt-div"),this._controls.footerControlsWrapper.className="lt-dialog__footer__controls-wrapper",this._controls.footer.appendChild(this._controls.footerControlsWrapper),this._eventListeners.push(he(this._controls.countSelector.getSelect(),"change",this._onCountChange.bind(this))),this._uiOptions.disableHelpCenter||this._uiOptions.disableFeedbackForm)if(this._uiOptions.disableFeedbackForm){if(!this._uiOptions.disableHelpCenter){const e={label:gt.MESSAGES.HELP_CENTER_TOOLTIP,position:"top-right"};this._controls.sendFeedback=new rt("help",null,e,this._controls.footerControlsWrapper),this._controls.footerControlsWrapper.appendChild(this._controls.sendFeedback.getElement()),this._eventListeners.push(he(this._controls.sendFeedback.getElement(),"click",this._gotoHelpCenter.bind(this)))}}else{const e={label:gt.MESSAGES.SEND_FEEDBACK_TOOLTIP,position:"top-right"};this._controls.sendFeedback=new rt("feedback",null,e,this._controls.footerControlsWrapper),this._controls.footerControlsWrapper.appendChild(this._controls.sendFeedback.getElement()),this._eventListeners.push(he(this._controls.sendFeedback.getElement(),"click",this._showFeedbackForm.bind(this)))}else{const e={label:gt.MESSAGES.HELP_TOOLTIP,position:"top-right"};this._controls.sendFeedback=new rt("help",null,e,this._controls.footerControlsWrapper),this._controls.footerControlsWrapper.appendChild(this._controls.sendFeedback.getElement());const t=[{className:"help",label:gt.MESSAGES.HELP_CENTER_TOOLTIP,info:null,tag:null,isClickable:!0,isSelectable:!1},{className:"feedback",label:gt.MESSAGES.SEND_FEEDBACK_TOOLTIP,info:null,tag:null,isClickable:!0}];this._controls.helpMenu=new ot("help",t,this._controls.sendFeedback.getElement(),this._controls.innerContainer,"top",!1,null),this._menus.push(this._controls.helpMenu);const n=this._controls.helpMenu.getAllOptions();this._eventListeners.push(he(n[0],"click",this._gotoHelpCenter.bind(this)),he(n[1],"click",this._showFeedbackForm.bind(this)),he(this._controls.helpMenu.getOverlay(),"click",this._onHelpOverlayClick.bind(this)),he(this._controls.sendFeedback.getElement(),"click",this._onHelpIconClick.bind(this)))}if(!this._uiOptions.disableTurnOff){const e={label:gt.MESSAGES.DISABLE_CHECKING_TOOLTIP,position:"top-right"};this._controls.disableIcon=new rt("disable",null,e,this._controls.footerControlsWrapper);const t=[{className:"pause",label:gt.MESSAGES.PAUSE_CHECKING_MENU_ITEM,info:null,tag:null,isClickable:!0},{className:"disable",label:gt.MESSAGES.DISABLE_CHECKING_MENU_ITEM,info:null,tag:null,isClickable:!0}];this._controls.disableMenu=new ot("disable",t,this._controls.disableIcon.getElement(),this._controls.innerContainer,"top",!1),this._menus.push(this._controls.disableMenu);const n=this._controls.disableMenu.getAllOptions();this._eventListeners.push(he(n[0],"click",this._onPauseCheckingClick.bind(this)),he(n[1],"click",this._onTurnOffClick.bind(this)),he(this._controls.disableMenu.getOverlay(),"click",this._onDisableOverlayClick.bind(this)),he(this._controls.disableIcon.getElement(),"click",this._onDisableIconClicked.bind(this)))}if(!this._uiOptions.disableOptionsPage){const e={label:gt.MESSAGES.SETTINGS_TOOLTIP,position:"top-right"};this._controls.optionsIcon=new rt("options",null,e,this._controls.footerControlsWrapper),this._eventListeners.push(he(this._controls.optionsIcon.getElement(),"click",this._onOptionsClick.bind(this)))}this._controls.incompleteResult=this._document.createElement("lt-div"),this._controls.incompleteResult.className="lt-dialog__incomplete-result",this._controls.incompleteResult.textContent=gt.MESSAGES.INCOMPLETE_RESULT,this._controls.footer.appendChild(this._controls.incompleteResult),this._controls.pointer=this._document.createElement("lt-span"),this._controls.pointer.className="lt-dialog__pointer",this._controls.innerContainer.appendChild(this._controls.pointer),this._toolbarContainer.appendChild(this._controls.container),this._toolbarContainer.classList.add("lt-toolbar--dialog-opened"),e.isRuntimeConnected()&&(this._controls.innerContainer.appendChild(this._controls.footer),this._controls.header.appendChild(this._controls.headerControlsWrapper));const d=this._toolbarContainer.querySelector(".lt-toolbar__status-icon-has-notification");d&&d.classList.remove("lt-toolbar__status-icon-has-notification")}))}_position(t=null){const n=this._controls.container.ownerDocument.body.offsetWidth,s=e.isRuntimeConnected()&&this._appearance.isPositionVisible()&&n>400?t||this._uiOptions.dialogPosition:"default";if(this._uiOptions.dialogPosition=s,this._controls.innerContainer.classList.remove("lt-dialog__container--fixed-right"),this._controls.innerContainer.classList.remove("lt-dialog__container--fixed-left"),"default"===s){!this._controls.positionMenu||this._controls.positionMenu.toggleActive(0,!0,!0);let e=this._controls.innerContainer.getBoundingClientRect();const t=document.doctype?this._document.documentElement.clientWidth:Math.min(this._document.documentElement.clientWidth,document.body.clientWidth);e.right>=t-gt.SPACE_TO_SCREEN_EDGE&&this._alignToBottom(),e=this._controls.innerContainer.getBoundingClientRect();const n=document.doctype?this._document.documentElement.clientHeight:Math.min(this._document.documentElement.clientHeight,document.body.clientHeight);e.bottom>=n&&this._alignToTop(),e=this._controls.innerContainer.getBoundingClientRect(),e.top<=gt.SPACE_TO_SCREEN_EDGE&&this._alignToBottom(),e.top<0&&!se(document.body)&&!se(document.documentElement)&&this._alignToBottom()}else"right"===s?(!this._controls.positionMenu||this._controls.positionMenu.toggleActive(1,!0,!0),this._controls.innerContainer.style.removeProperty("right"),this._controls.innerContainer.style.removeProperty("left"),this._controls.innerContainer.classList.remove("lt-dialog__container-top"),this._controls.innerContainer.classList.remove("lt-dialog__container-bottom"),this._controls.innerContainer.classList.add("lt-dialog__container--fixed-right")):"left"===s&&(!this._controls.positionMenu||this._controls.positionMenu.toggleActive(2,!0,!0),this._controls.innerContainer.style.removeProperty("right"),this._controls.innerContainer.style.removeProperty("left"),this._controls.innerContainer.classList.remove("lt-dialog__container-top"),this._controls.innerContainer.classList.remove("lt-dialog__container-bottom"),this._controls.innerContainer.classList.add("lt-dialog__container--fixed-left"))}_alignToBottom(){const e=new K(this._document);this._controls.innerContainer.classList.remove("lt-dialog__container-top"),this._controls.innerContainer.classList.add("lt-dialog__container-bottom");const t=this._controls.innerContainer.getBoundingClientRect();if(t.left<=gt.SPACE_TO_SCREEN_EDGE){const n=parseInt(e.getStyle(this._controls.innerContainer,"right"),10)+t.left-gt.SPACE_TO_SCREEN_EDGE,s=parseInt(e.getStyle(this._controls.pointer,"right"),10)-t.left+gt.SPACE_TO_SCREEN_EDGE;e.setStyles(this._controls.innerContainer,{right:n+"px !important",left:"auto !important"}),e.setStyles(this._controls.pointer,{right:s+"px !important",left:"auto !important"})}if(t.right>this._document.documentElement.clientWidth){e.setStyles(this._controls.innerContainer,{right:"0px !important",left:"auto !important"});const n=parseInt(e.getStyle(this._controls.pointer,"right"),10)+(this._controls.innerContainer.getBoundingClientRect().right-t.right);e.setStyles(this._controls.pointer,{right:n+"px !important",left:"auto !important"})}}_alignToTop(){this._controls.innerContainer.classList.remove("lt-dialog__container-bottom"),this._controls.innerContainer.classList.add("lt-dialog__container-top");const e=this._controls.innerContainer.getBoundingClientRect(),t=new K(this._document);if(this._controls.innerContainer.classList.add("lt-dialog__container-hide"),e.right>=this._document.documentElement.clientWidth-gt.SPACE_TO_SCREEN_EDGE){const n=parseInt(t.getStyle(this._controls.innerContainer,"left"),10)-(e.right-this._document.documentElement.clientWidth)-gt.SPACE_TO_SCREEN_EDGE,s=parseInt(t.getStyle(this._controls.pointer,"left"),10)+(e.right-this._document.documentElement.clientWidth)+gt.SPACE_TO_SCREEN_EDGE;t.setStyles(this._controls.innerContainer,{left:n+"px !important",right:"auto !important"}),t.setStyles(this._controls.pointer,{left:s+"px !important",right:"auto !important"})}this._controls.innerContainer.classList.remove("lt-dialog__container-hide")}_removeTeaser(){this._controls.teaserElement&&(this._controls.teaserElement.remove(),this._controls.teaserElement=void 0)}_updateContent(){if(!this._controls.content)return;this.closeAllMenus();const e=this._state.checkStatus;this._controls.content.classList.remove("lt-dialog__has-errors"),this._controls.content.classList.remove("lt-dialog__is-loading"),this._controls.contentMain.innerHTML="",this._controls.contentTop.innerHTML="",this._controls.contentBottom.innerHTML="",this.setCountOptions(this._state.countOptions);const t=(this._inApplyFixMode||this._inInsignificantChangeMode)&&e===qe.IN_PROGRESS&&this._allDisplyedErrorsCount>0;this._showLoadingBar(t);const n=e===qe.NEEDS_LANGUAGE_HINT;if(this._controls.languageSelector.toggleHighlight(n),t?(this._renderHeadline(),this._renderCompletedState()):e===qe.IN_PROGRESS?(this._renderHeadline(),this._renderInProgressState()):e===qe.COMPLETED?(this._renderHeadline(),this._renderCompletedState()):e===qe.DISABLED?this._renderDisabledState():e===qe.TEXT_TOO_SHORT?(this._renderHeadline(),this._renderTextTooShortState(),this._renderPremiumErrorsTeaser()):e===qe.TEXT_TOO_LONG?(this._renderHeadline(),this._renderTextTooLongState(),this._renderDiscountTimerTeaser()):e===qe.UNSUPPORTED_LANGUAGE?(this._renderHeadline(),this._renderLanguageUnsupportedState()):e===qe.DISCONNECTED?this._renderDisconnectedState():e===qe.FAILED?this._renderFailedState():n&&this._renderNeedsLanguageHintState(),e===qe.COMPLETED&&this._controls.mainHeadline){this._controls.headerScoreProgressBar.style.width=this._state.textScore+"%",this._controls.textScore.setScore(this._state.textScore);const e=this._state.displayedErrors.length||0,t=this._state.displayedPremiumErrors.length||0;this._allDisplyedErrorsCount=e+t,this._controls.errorsCounter.textContent=this._allDisplyedErrorsCount.toString()}this._position()}_showLoadingBar(e){e!==this._isLoadingBarShown&&(e?this._controls.loadingBar.classList.remove("lt-dialog__footer__loading-bar-container--hidden"):this._controls.loadingBar.classList.add("lt-dialog__footer__loading-bar-container--hidden"),this._isLoadingBarShown=e)}_getCountString(t,n){if(!e.isRuntimeConnected())return"";const i={words:[gt.MESSAGES.COUNTER_WORDS_OPTION,s.getMessage("dialogCounterWordsSingular"),s.getMessage("dialogCounterWordsPlural",[w(t.counts.words,e.getUILanguageCode())])],sentences:[gt.MESSAGES.COUNTER_SENTENCES_OPTION,s.getMessage("dialogCounterSentencesSingular"),s.getMessage("dialogCounterSentencesPlural",[w(t.counts.sentences,e.getUILanguageCode())])],characters:[gt.MESSAGES.COUNTER_CHARACTERS_OPTION,s.getMessage("dialogCounterCharactersSingular"),s.getMessage("dialogCounterCharactersPlural",[w(t.counts.characters,e.getUILanguageCode())])]},r=t.counts[n];return 0===r?i[n][0]:1===r?i[n][1]:i[n][2]}_renderHeadline(){this._controls.mainHeadline=this._document.createElement("lt-div"),this._controls.mainHeadline.classList.add("lt-dialog__content-top__menu"),this._controls.mainHeadline.setAttribute("data-lt-prevent-focus","");const e=this._document.createElement("lt-span");e.className="lt-dialog__main-headline";const t=this._document.createElement("lt-span");t.className="lt-dialog__main-headline__headline",t.textContent=gt.MESSAGES.REGULAR_MISTAKE_MENU_ITEM,this._controls.errorsCounter=this._document.createElement("lt-span"),this._controls.errorsCounter.className="lt-dialog__main-headline__counter",this._controls.errorsCounter.textContent=this._allDisplyedErrorsCount.toString(),e.appendChild(t),e.appendChild(this._controls.errorsCounter),this._controls.mainHeadline.appendChild(e);const n={label:gt.MESSAGES.TEXT_SCORE_MENU_ITEM,position:"bottom-right"};this._controls.textScore=new dt("lt-dialog__main-headline__score",this._controls.mainHeadline,n),this._controls.textScore.setScore(this._state.textScore),this._controls.contentTop.appendChild(this._controls.mainHeadline),this._controls.pickyToggle=new _t("picky_mode",gt.MESSAGES.PICKY_MODE_MENU_ITEM,"",this._controls.contentTop),this._controls.pickyToggle.set(this._state.isPickyModeEnabled),this._eventListeners.push(he(this._controls.pickyToggle.getElement(),"click",this._onTogglePickyMode.bind(this)))}_renderInProgressState(){this._controls.content.classList.add("lt-dialog__is-loading");const e=this._document.createElement("lt-div");e.className="lt-dialog-skeleton lt-dialog-skeleton--error-card";const t=this._document.createElement("lt-div");t.className="lt-dialog-skeleton lt-dialog-skeleton--error-card",this._controls.contentMain.appendChild(e),this._controls.contentMain.appendChild(t)}_renderCompletedState(){this._state.displayedErrors&&this._state.displayedErrors.length?this._appearance.canDisplayAllSuggestions()?(this._renderErrors(),this._renderIgnoredErrorsStats()):this._renderScrollHint():this._state.displayedPremiumErrors&&this._state.displayedPremiumErrors.length?(this._removeTeaser(),this._renderPremiumState()):(this._removeTeaser(),this._renderNoErrorsState(),this._renderIgnoredErrorsStats()),this._controls.incompleteResult.classList.toggle("lt-dialog__incomplete-result-show",!!this._state.isIncompleteResult)}_renderErrors(){this._controls.content.classList.add("lt-dialog__has-errors"),this._state.displayedPremiumErrors&&this._state.displayedPremiumErrors.length&&this._renderPremiumErrorsTeaser(),this._state.displayedErrors.forEach((e=>{const t=this._document.createElement("lt-div");t.className="lt-dialog__error-item";const n={label:gt.MESSAGES.IGNORE_RULE_TOOLTIP,position:"top-right"},s=new rt("trash",null,n,t);this._eventListeners.push(he(s.getElement(),"click",(n=>{e.isSpellingError?this._onTemporarilyIgnoreWordClick(e,n):this._onTemporarilyIgnoreRuleClick(e,n),t.remove()})));const i=this._document.createElement("lt-div");i.className="lt-dialog__error-headline",e.isPicky&&t.classList.add("lt-dialog__error-item--picky-mistake"),e.isCustomError?(i.textContent=e.shortDescription||gt.MESSAGES.HEADLINE_SUGGESTION_ERROR,t.classList.add("lt-dialog__error-item--custom-suggestion")):e.isSpellingError?(i.textContent=gt.MESSAGES.HEADLINE_SPELLING_ERROR,t.classList.add("lt-dialog__error-item--spelling-mistake")):e.isStyleError?(i.textContent=e.shortDescription||gt.MESSAGES.HEADLINE_SUGGESTION_ERROR,t.classList.add("lt-dialog__error-item--style-suggestion")):e.isPunctuationError?(i.textContent=e.shortDescription||gt.MESSAGES.HEADLINE_PUNCTUATION_ERROR,t.classList.add("lt-dialog__error-item--punctuation-mistake")):(i.textContent=e.shortDescription||gt.MESSAGES.HEADLINE_GRAMMAR_ERROR,t.classList.add("lt-dialog__error-item--grammar-mistake")),t.append(i),t.addEventListener("mouseenter",(()=>this._onErrorHighlighted(e.id))),t.addEventListener("mouseleave",(()=>this._onErrorHighlighted(null)));const r=this._document.createElement("lt-div");r.className="lt-dialog__original-phrase",t.appendChild(r);const o=this._document.createElement("lt-div");o.className="lt-dialog__original-phrase__header",r.appendChild(o);const a=this._document.createElement("lt-div");a.className="lt-dialog__original-phrase__header__title",a.textContent=e.originalPhrase,o.appendChild(a);const l=new rt("scroll-to-link",gt.MESSAGES.SCROLL_TO_LINK,null,o);this._eventListeners.push(he(l.getElement(),"click",(t=>{this._onErrorSelected(e.id)})));const c=this._document.createElement("lt-div");c.className="lt-dialog__original-phrase__long-context-phrase",c.innerHTML=e.longContextPhrase,r.appendChild(c),this._renderFixes(e,t),this._renderDescription(e,t),this._renderActions(e,t),this._controls.contentMain.appendChild(t)}))}_renderFixes(e,t){const n=this._document.createElement("lt-div");n.className="lt-dialog__fix-container",t.appendChild(n);const s=Math.min(e.fixes.length,i.MAX_FIXES_COUNT);for(let i=0;i<s;i++){const r=e.fixes[i],o=this._document.createElement("lt-div");if(o.title=r.shortDescription||"",o.className="lt-dialog__fix",o.setAttribute("data-lt-prevent-focus",""),!r.value.startsWith(" ")&&!r.value.endsWith(" ")||["FALSCHE_VERWENDUNG_DES_BINDESTRICHS"].includes(e.rule.id)){const t=r.value.replace(gt.NARROW_WHITESPACE_REGEXP," ");s>3&&e.isSpellingError?o.textContent=t:(o.classList.add("lt-dialog__fix--highlighted"),o.innerHTML=Ke(je(e.originalPhrase,t)))}else o.textContent=r.value.replace(gt.TRAILING_WHITESPACE_REGEXP,"·");""===r.value&&e.originalPhrase.match(/[a-z0-9]{2,}/)?(o.classList.add("lt-dialog__fix--strikethrough"),o.classList.remove("lt-dialog__fix--highlighted"),o.textContent=e.originalPhrase):""===r.value&&(o.classList.add("lt-dialog__fix--delete"),o.classList.remove("lt-dialog__fix--highlighted"),o.textContent=gt.MESSAGES.DELETE),this._eventListeners.push(he(o,"click",(n=>{this._onFixClick(e,i,n),t.remove()}))),n.appendChild(o);const a=$e(e,r.value);if(this._uiOptions.canCorrectMultipleErrorsAtOnce&&Ve(this._state.errors,e)&&a){const t=this._document.createElement("lt-span");t.classList.add("lt-dialog__fix--correct-all"),t.innerHTML=a.suggestion.message;const s=this._onCorrectAll.bind(this,e,a);this._eventListeners.push(he(t,"click",s)),n.appendChild(t),n.appendChild(this._document.createElement("br"))}r.value.length>=14&&t.classList.add("lt-dialog__long-fix")}}_renderActions(e,t){if(e.isSpellingError){if(!this._uiOptions.disableAddingWord&&!u(e.originalPhrase)){const n=this._document.createElement("lt-div");n.classList.add("lt-dialog__add-to-dictionary","lt-icon__dictionary"),n.setAttribute("data-lt-prevent-focus",""),n.textContent=s.getMessage("addToDictionaryCaption",e.originalPhrase),this._eventListeners.push(he(n,"click",(n=>{this._onAddToDictionaryClick(e,n),t.remove()}))),t.appendChild(n)}}else if(!this._uiOptions.disableIgnoringRule&&!e.isCustomError){const n=this._document.createElement("lt-div");n.classList.add("lt-dialog__ignore-rule"),n.classList.add("lt-icon__ignore"),n.setAttribute("data-lt-prevent-focus",""),n.classList.add("lt-icon__ignore"),n.textContent=s.getMessage("turnOffRule"),this._eventListeners.push(he(n,"click",(n=>{this._onIgnoreRuleClick(e,n),t.remove()}))),t.appendChild(n)}}_renderDescription(e,t){const n=this._document.createElement("lt-div");if(n.className="lt-dialog__error-text",n.setAttribute("data-lt-prevent-focus",""),n.textContent=e.description,t.append(n),e.rule.urls&&e.rule.urls.length>0){const t=this._document.createElement("lt-span");t.classList.add("lt-dialog__more-details","lt-icon__info"),t.setAttribute("data-lt-prevent-focus",""),t.title=s.getMessage("moreDetails"),this._eventListeners.push(he(t,"click",(t=>{this._onMoreDetailsClick(e.rule.urls[0],t)}))),n.appendChild(t)}}_renderScrollHint(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__scroll-hint__headline",t.textContent=gt.MESSAGES.SCROLL_HINT_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__scroll-hint__text",n.textContent=gt.MESSAGES.SCROLL_HINT_TEXT,e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e),this._shouldShowRatingTeaser?this._renderRatingTeaser():this._renderPremiumErrorsTeaser()}_renderTextTooShortState(){this._removeTeaser();const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__text-too-short__headline",t.innerHTML=gt.MESSAGES.TEXT_TOO_SHORT_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__text-too-short__text",n.innerHTML=gt.MESSAGES.TEXT_TOO_SHORT_TEXT,e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e)}_renderNoErrorsState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__no-errors__headline",t.textContent=gt.MESSAGES.NO_ERRORS;const n=this._document.createElement("lt-div");n.className="lt-dialog__no-errors__text",n.textContent=gt.MESSAGES.NO_ERRORS_TEXT,e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e),this._shouldShowRatingTeaser?this._renderRatingTeaser():this._renderPremiumErrorsTeaser()}_renderIgnoredErrorsStats(){if(!this._state.ignoredErrorsStats)return;if(0===this._state.ignoredErrorsStats.byDictionary&&0===this._state.ignoredErrorsStats.byRules)return;const e=this._document.createElement("lt-div");if(this._state.displayedErrors&&this._state.displayedErrors.length?e.className="lt-dialog__ignored-errors-item":e.className="lt-dialog__ignored-errors-message",this._state.ignoredErrorsStats.byDictionary>0&&!this._uiOptions.disableAddingWord){const t=1===this._state.ignoredErrorsStats.byDictionary?"errorsIgnoredByDictionarySingular":"errorsIgnoredByDictionary",n=s.getMessage(t,[this._state.ignoredErrorsStats.byDictionary]),i=document.createElement("lt-span");i.textContent=n,i.dataset.type="byDictionary",e.appendChild(i)}if(this._state.ignoredErrorsStats.byRules>0&&!this._uiOptions.disableIgnoringRule){if(this._state.ignoredErrorsStats.byDictionary>0){const t=document.createElement("lt-span");t.textContent=", ",e.appendChild(t)}const t=1===this._state.ignoredErrorsStats.byRules?"errorsIgnoredByRulesSingular":"errorsIgnoredByRules",n=s.getMessage(t,[this._state.ignoredErrorsStats.byRules]),i=document.createElement("lt-span");i.textContent=n,i.dataset.type="byRules",e.appendChild(i)}this._controls.contentMain.appendChild(e),this._eventListeners.push(he(e,"click",this._onIgnoredErrorsClick.bind(this)))}_renderRatingTeaser(){new ct(this._controls.contentBottom,"dialog",N().substr(0,150))}_renderPremiumErrorsTeaser(){this._controls.teaserElement||e.isRuntimeConnected()&&W.create().onReady((e=>{if(e.getUIState().hasPaidSubscription)return;const t=function(e){const t=300;let n=0;const s=Date.now();let i=0;for(const r of e.hiddenErrors){const e=+new Date(r.day);if(s-e>864e6)break;if(i=e,n+=r.count,n>t){n=t;break}}let r=String(n);return n>=t&&(r="300+"),{hiddenErrorsCount:n,hiddenErrorsCountStr:r,dayCount:Math.ceil((s-i)/1e3/60/60/24)}}(e.getStatistics());e.startChangelogCoupon();const n=e.getActiveCoupon();if(this._state.displayedPremiumErrors.length){const e=this._state.displayedPremiumErrors.filter((e=>!e.isStyleError&&!e.isPunctuationError)).length,t=this._state.displayedPremiumErrors.filter((e=>e.isPunctuationError)).length,n=this._state.displayedPremiumErrors.filter((e=>e.isStyleError)).length,i="dialog:premium_teaser",r=1===e+t+n?s.getMessage("premiumErrorsTextSingular"):s.getMessage("premiumErrorsTextPlural",[this._state.displayedPremiumErrors.length]),o=s.getMessage("premiumErrorsButton");this._premiumTeaser=new lt(this._controls.contentTop,i,null,r,o,{campaign:"addon2-dialog-premium-errors",hiddenGrammarMatches:e,hiddenStyleMatches:n,hiddenPunctuationMatches:t,textLanguage:this._languageCode||void 0})}else if(t.hiddenErrorsCount>5){const e="dialog:historic_premium_teaser",n=s.getMessage("historicPremiumErrorsHeadline"),i=s.getMessage("historicPremiumErrorsText2",[t.hiddenErrorsCount,t.dayCount]),r=s.getMessage("historicPremiumErrorsButton");this._premiumTeaser=new lt(this._controls.contentBottom,e,n,i,r,{campaign:"addon2-dialog-historic-premium-errors",historicMatches:t.hiddenErrorsCountStr})}else if(n){const e="dialog:premium_teaser";this._premiumTeaser=new lt(this._controls.contentBottom,e,null,null,null,{campaign:"addon2-dialog"})}e.destroy()}))}_renderDiscountTimerTeaser(){W.create().onReady((e=>{e.startChangelogCoupon();if(e.getActiveCoupon()){const e="dialog:premium_teaser";this._premiumTeaser=new lt(this._controls.contentBottom,e,null,null,null,{campaign:"addon2-dialog-premium"})}e.destroy()}))}_renderPremiumState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__premium__headline",t.textContent=1===this._state.displayedPremiumErrors.length?s.getMessage("dialogPremiumHeadlineSingular"):s.getMessage("dialogPremiumHeadlinePlural",[this._state.displayedPremiumErrors.length]);const n=this._document.createElement("lt-div");n.className="lt-dialog__premium__text",n.textContent=s.getMessage("dialogPremiumText");const i=this._document.createElement("lt-div");i.className="lt-dialog__premium__button lt-icon__new_window",i.textContent=s.getMessage("dialogPremiumButton");let r="addon2-dialog-premium";this._eventListeners.push(he(i,"click",(e=>{e.stopImmediatePropagation();const t={dialog:this,campaign:r};de(document,gt.eventNames.premiumTeaserClicked,t),V.trackEvent("Action","dialog:premium:click")}))),e.appendChild(t),e.appendChild(n),e.appendChild(i),this._controls.contentMain.appendChild(e),W.create().onReady((e=>{e.startChangelogCoupon();e.getActiveCoupon()&&(r=r.replace("addon2","addon2-changelog"),this._premiumTeaser=new lt(this._controls.contentBottom,"dialog:premium_teaser",null,null,null,{campaign:r})),e.destroy()}))}_renderDisabledState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__enable-text__headline",t.textContent=gt.MESSAGES.ENABLE_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__enable-text__text",n.textContent=gt.MESSAGES.ENABLE_TEXT;const s=this._document.createElement("lt-div");s.className="lt-dialog__enable-everywhere",s.innerHTML=gt.MESSAGES.ENABLE_EVERYWHERE_BUTTON,this._eventListeners.push(he(s,"click",this._enableEverywhere.bind(this)));const i=this._document.createElement("lt-div");i.className="lt-dialog__enable-here",i.innerHTML=gt.MESSAGES.ENABLE_HERE_BUTTON,this._eventListeners.push(he(i,"click",this._enableHere.bind(this))),e.appendChild(t),e.appendChild(n),e.appendChild(s),e.appendChild(i),this._controls.contentMain.appendChild(e)}_renderTextTooLongState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__premium__headline",t.textContent=gt.MESSAGES.TEXT_TOO_LONG_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__premium__text",n.textContent=gt.MESSAGES.TEXT_TOO_LONG_TEXT;const s=this._document.createElement("lt-div");s.className="lt-dialog__premium__button lt-icon__new_window",s.textContent=gt.MESSAGES.TEXT_TOO_LONG_BUTTON;let i="addon2-dialog-text-too-long";W.create().onReady((e=>{e.getActiveCoupon()&&(i=i.replace("addon2-dialog","addon2-changelog")),e.destroy()})),this._eventListeners.push(he(s,"click",(e=>{e.stopImmediatePropagation();const t={command:"OPEN_PREMIUM_PAGE",campaign:i};browser.runtime.sendMessage(t),V.trackEvent("Action","dialog:text_too_long:click")}))),e.appendChild(t),e.appendChild(n),e.appendChild(s),this._controls.contentMain.appendChild(e)}_renderLanguageUnsupportedState(){const t=this._document.createElement("lt-div");t.className="lt-dialog__text-wrapper";const n=this._document.createElement("lt-div");n.className="lt-dialog__language-unsupported__headline",n.textContent=gt.MESSAGES.UNSUPPORTED_LANGUAGE_HEADLINE;const s=this._document.createElement("lt-div");if(s.className="lt-dialog__language-unsupported__text",s.textContent=gt.MESSAGES.UNSUPPORTED_LANGUAGE_TEXT,t.appendChild(n),t.appendChild(s),this._controls.contentMain.appendChild(t),this._controls.languageSelector){const t=this._document.createElement("option");t.disabled=!0,t.selected=!0,t.textContent=gt.MESSAGES.UNSUPPORTED_LANGUAGE_LABEL,this._controls.languageSelector.addOption(t);const n=e.getURL("/assets/images/flags/not_found.svg");this._controls.languageSelector.setActive(gt.MESSAGES.SELECT_LANGUAGE_LABEL,"",{"background-image":`url('${n}') !important`})}}_renderDisconnectedState(){this._controls.footer.remove(),this._controls.headerControlsWrapper.remove();const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.innerHTML=gt.MESSAGES.EXTENSION_UPDATED_HEADLINE,t.className="lt-dialog__reload-headline",this._controls.contentMain.appendChild(t);const n=this._document.createElement("lt-div");n.innerHTML=gt.MESSAGES.EXTENSION_UPDATED_TEXT,n.className="lt-dialog__reload__text",this._controls.contentMain.appendChild(n),e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e)}_renderFailedState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__exception-headline",t.textContent=gt.MESSAGES.Fail_STATE_HEADLINE,e.appendChild(t);const n=this._document.createElement("lt-div");n.className="lt-dialog__exception__text",n.textContent=this._state.checkErrorMessage||gt.MESSAGES.Fail_STATE_TEXT,e.appendChild(n),this._controls.contentMain.appendChild(e)}_renderNeedsLanguageHintState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__needs-language-hint__headline",t.textContent=gt.MESSAGES.NEEDS_LANGUAGE_HINT_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__needs-language-hint__text",n.textContent=gt.MESSAGES.NEEDS_LANGUAGE_HINT_TEXT;const s=this._document.createElement("lt-div");s.className="lt-dialog__needs-language-hint__button",s.textContent=gt.MESSAGES.NEEDS_LANGUAGE_HINT_IGNORE,e.appendChild(t),e.appendChild(n),e.appendChild(s),this._controls.contentMain.appendChild(e),this._eventListeners.push(he(s,"click",(()=>{const e={dialog:this,language:this._controls.languageSelector.getValue()};V.trackEvent("Action","dialog:ignore_language_hint"),de(document,gt.eventNames.languageChanged,e)})))}_onUnload(){this.destroy()}_onKeydown(e){"Escape"===e.key&&(this.destroy(),e.stopImmediatePropagation())}_onLanguageChange(e){e.stopImmediatePropagation();const t={dialog:this,language:this._controls.languageSelector.getValue()};this.setCurrentLanguage(this._controls.languageSelector.getValue()),de(document,gt.eventNames.languageChanged,t)}_onTogglePickyMode(e){e.stopImmediatePropagation(),this._state.isPickyModeEnabled=!this._state.isPickyModeEnabled,this.setInsignificantChangeMode(!1);const t={dialog:this,isEnabled:this._state.isPickyModeEnabled};de(document,gt.eventNames.togglePickyMode,t)}_onCountChange(e){e.stopImmediatePropagation(),this._state.countOptions.mode=this._controls.countSelector.getValue(),this.setCountOptions(this._state.countOptions);const t={dialog:this,countMode:this._controls.countSelector.getValue()};de(document,gt.eventNames.countChanged,t)}_onCloseClick(e){e.stopImmediatePropagation(),this._onUnload()}_onHelpIconClick(e){e.stopImmediatePropagation(),this._controls.helpMenu.show()}_onHelpOverlayClick(e){e.stopImmediatePropagation(),this._controls.helpMenu.hide()}_onPositionIconClick(e){e.stopImmediatePropagation(),this._controls.positionMenu.show()}_onPositionOverlayClick(e){e.stopImmediatePropagation(),this._controls.positionMenu.hide()}_onPositionRightClick(e){e.stopImmediatePropagation();const t={dialog:this,newPosition:"right"};this._controls.positionMenu.hide(),this._controls.positionIcon.setIcon("right"),this._position("right"),de(document,gt.eventNames.positionChangeClicked,t)}_onPositionLeftClick(e){e.stopImmediatePropagation();const t={dialog:this,newPosition:"left"};this._controls.positionMenu.hide(),this._controls.positionIcon.setIcon("left"),this._position("left"),de(document,gt.eventNames.positionChangeClicked,t)}_onPositionDialogClick(e){e.stopImmediatePropagation();const t={dialog:this,newPosition:"default"};this._controls.positionMenu.hide(),this._controls.positionIcon.setIcon("default"),this._position("default"),de(document,gt.eventNames.positionChangeClicked,t)}_onSaveTextClick(e){e.stopImmediatePropagation()}_onTurnOffClick(e){e.stopImmediatePropagation();const t={dialog:this};de(document,gt.eventNames.turnOff,t)}_onPauseCheckingClick(e){e.stopImmediatePropagation();const t={dialog:this};de(document,gt.eventNames.pauseChecking,t)}_onDisableIconClicked(e){e.stopImmediatePropagation(),this._controls.disableMenu.show()}_onDisableOverlayClick(e){e.stopImmediatePropagation(),this._controls.disableMenu.hide()}_onBadgeClicked(e){e.stopImmediatePropagation();const t={dialog:this};de(document,gt.eventNames.badgeClicked,t)}_onOptionsClick(e){e.stopImmediatePropagation();const t={dialog:this};de(document,gt.eventNames.openOptions,t)}_onContentScroll(e){this._controls.content.scrollTop>50?this._controls.headerScoreProgress.classList.add("show"):this._controls.headerScoreProgress.classList.remove("show")}_onIgnoredErrorsClick(e){e.stopImmediatePropagation();let t="personalDictionary";if(e.target){const n=e.target;n.dataset&&"byRules"===n.dataset.type&&(t="ignoredRules")}const n={dialog:this,target:t,ref:"dialog-ignored-errors"};de(document,gt.eventNames.openOptions,n)}_gotoLanguageTool(n){n.stopImmediatePropagation();let s="https://languagetool.org/?pk_campaign=addon2-dialog";t.isSafari()&&(s+="&hidePremium=true"),e.openWindow(s)}_gotoHelpCenter(t){t.stopImmediatePropagation(),this._controls.helpMenu.hide(),e.openWindow("https://languagetooler.freshdesk.com/support/home")}_showFeedbackForm(e){e.stopImmediatePropagation();const t={dialog:this};this._controls.helpMenu.hide(),de(document,gt.eventNames.showFeedbackForm,t)}_onErrorHighlighted(e){const t={dialog:this,errorId:e};de(document,gt.eventNames.errorHighlighted,t)}_onErrorSelected(e){const t={dialog:this,errorId:e};de(document,gt.eventNames.errorSelected,t)}_onMoreDetailsClick(e,t){t.stopImmediatePropagation();const n={dialog:this,url:e.value};de(document,gt.eventNames.moreDetailsClicked,n)}_onCorrectAll(e,t,n){n.stopImmediatePropagation();const s={dialog:this,config:t,selectedError:e};de(document,gt.eventNames.correctAll,s)}_onFixClick(e,t,n){n.stopImmediatePropagation(),this._inApplyFixMode=!0;const s={dialog:this,error:e,fixIndex:t,selectNextError:!1};de(document,gt.eventNames.fixSelected,s)}_onAddToDictionaryClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e,selectNextError:!1};de(document,gt.eventNames.addToDictionaryClicked,n)}_onIgnoreRuleClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e,selectNextError:!1};de(document,gt.eventNames.ignoreRuleClicked,n)}_onTemporarilyIgnoreWordClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e,selectNextError:!1};de(document,gt.eventNames.temporarilyIgnoreWordClicked,n)}_onTemporarilyIgnoreRuleClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e,selectNextError:!1};de(document,gt.eventNames.temporarilyIgnoreRuleClicked,n)}_enableEverywhere(e){e.stopImmediatePropagation();const t={dialog:this};de(document,gt.eventNames.enableEverywhere,t)}_enableHere(e){e.stopImmediatePropagation();const t={dialog:this};de(document,gt.eventNames.enableHere,t)}getCurrentPosition(){return this._uiOptions.dialogPosition}updateState(e){A(this._state,e)||(this._state=Object.assign(this._state||{},e),this._updateContent())}setCurrentLanguage(t){if(!e.isRuntimeConnected())return;t=t.toLowerCase();const n=H.LANGUAGES.find((e=>e.code===t))||H.LANGUAGES.find((e=>t.startsWith(e.code)))||H.LANGUAGES.find((e=>"en-us"===e.code)),s=e.getURL("/assets/images/flags/"+n.code+".svg");this._controls.languageSelector&&this._controls.languageSelector.setActive(this._shortenLanguageName(n.name),n.code,{"background-image":`url('${s}') !important`})}_shortenLanguageName(e){return e.split(" ",1)[0]}setCountOptions(e){this._controls.countSelector&&(this._controls.countSelector.setActive(this._getCountString(e,e.mode),e.mode,{}),this._controls.countSelector.updateOptionLable("characters",this._getCountString(e,"characters")),this._controls.countSelector.updateOptionLable("sentences",this._getCountString(e,"sentences")),this._controls.countSelector.updateOptionLable("words",this._getCountString(e,"words")))}setInsignificantChangeMode(e){this._inInsignificantChangeMode=e}setApplyFixMode(e){this._inApplyFixMode=e}closeAllMenus(){this._menus.forEach((e=>{e.hide()}))}fadeOut(){this._controls.innerContainer.classList.add("lt-dialog--faded")}fadeIn(){this._controls.innerContainer.classList.remove("lt-dialog--faded")}destroy(){ae(this._controls.container,(()=>{this._toolbarContainer.classList.remove("lt-toolbar--dialog-opened")})),this._controls={},window.removeEventListener("pagehide",this._onUnload,!0),this._eventListeners.forEach((e=>{e.destroy()})),this._eventListeners=[];const e={dialog:this};this._premiumTeaser&&this._premiumTeaser.destroy(),de(document,gt.eventNames.destroyed,e)}}gt.CONTAINER_ELEMENT_NAME="lt-dialog",gt.SPACE_TO_SCREEN_EDGE=5,gt.TRAILING_WHITESPACE_REGEXP=/^ | $/g,gt.NARROW_WHITESPACE_REGEXP=/\u202F/g,gt.eventNames={turnOff:"lt-dialog.turnOff",pauseChecking:"lt-dialog.pauseChecking",enableHere:"lt-dialog.enableHere",enableEverywhere:"lt-dialog.enableEverywhere",languageChanged:"lt-dialog.languageChanged",countChanged:"lt-dialog.countChanged",errorSelected:"lt-dialog.errorSelected",errorHighlighted:"lt-dialog.errorHighlighted",addToDictionaryClicked:"lt-dialog.addToDictionaryClicked",ignoreRuleClicked:"lt-dialog.ignoreRuleClicked",temporarilyIgnoreWordClicked:"lt-dialog.temporarilyIgnoreWordClicked",temporarilyIgnoreRuleClicked:"lt-dialog.temporarilyIgnoreRuleClicked",moreDetailsClicked:"lt-dialog.moreDetailsClicked",fixSelected:"lt-dialog.fixSelected",openOptions:"lt-dialog.openOptions",showFeedbackForm:"lt-dialog.showFeedbackForm",destroyed:"lt-dialog.destroyed",togglePickyMode:"lt-dialog.togglePickyMode",positionChangeClicked:"lt-dialog.positionChangeClicked",badgeClicked:"lt-dialog.badgeClicked",premiumTeaserClicked:"lt-dialog.premiumTeaserClicked",correctAll:"lt-dialog.correctAll"},gt._isInitialized=!1;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class mt{constructor(e,t,n,s,i){this._renderOutsideIframe=!1,this._inputArea=e,this._error=n,this._tweaks=s,this._uiOptions=i,this._referenceArea=e,this._keyboardEventTarget=this._tweaks.getKeyboardEventTarget(),this._document=this._inputArea.ownerDocument,this._isHiddenMatch="HIDDEN_RULE"===n.rule.id,this._buttons=[];const r=ne(window);r&&this._inputArea===this._inputArea.ownerDocument.body&&Le(window.parent)&&(this._referenceArea=r,this._document=this._referenceArea.ownerDocument,this._renderOutsideIframe=!0,this._onPageHide=this._onPageHide.bind(this),window.addEventListener("pagehide",this._onPageHide,!0)),this._domMeasurement=new K(this._document),this._eventListeners=[],this._render(t),this._uiOptions.enableKeyboard&&this._buttons.length&&(this._focusedButtonIndex=0,this._updateFocus())}static _cacheMessages(){mt.MESSAGES={HEADLINE_SPELLING_ERROR:s.getMessage("spellingError"),HEADLINE_HIDDEN_MATCH:s.getMessage("hiddenMatchHeadline"),HEADLINE_CUSTOM_SUGGESTION_ERROR:s.getMessage("customSuggestionError"),HEADLINE_SUGGESTION_ERROR:s.getMessage("suggestionError"),HEADLINE_PUNCTUATION_ERROR:s.getMessage("punctuationError"),HEADLINE_GRAMMAR_ERROR:s.getMessage("grammarError"),LINK_MORE_DETAILS:s.getMessage("moreDetails"),LINK_IGNORE_RULE:s.getMessage("turnOffRule"),LINK_IGNORE_RULE_PICKY:s.getMessage("turnOffRulePicky"),LINK_IGNORE_HERE:s.getMessage("ignoreHere"),TURN_OFF_PICKY_MODE:s.getMessage("turnOffPickyMode"),EN_US_LINK:s.getMessage("switchToAmericanEnglish"),EN_CA_LINK:s.getMessage("switchToCanadianEnglish"),EN_AU_LINK:s.getMessage("switchToAustralianEnglish"),EN_NZ_LINK:s.getMessage("switchToNewZealandEnglish"),EN_ZA_LINK:s.getMessage("switchToSouthAfricanEnglish"),EN_GB_LINK:s.getMessage("switchToBritishEnglish"),DELETE:s.getMessage("deleteWord"),REMOVE_EXTRA_WHITESPACE:s.getMessage("removeExtraWhitespace"),PREMIUM_TEXT:s.getMessage("suggestionOnlyVisibleToPremiumText"),PREMIUM_BUTTON:s.getMessage("suggestionOnlyVisibleToPremiumButton"),KEYBOARD_INSTRUCTIONS:s.getMessage("errorCardKeyboardInstructions",["<lt-em>Enter</lt-em>","<lt-em>&#8679;</lt-em> <lt-em>Enter</lt-em>"])}}static init(){mt._isInitialized||(mt._cacheMessages(),s.addEventListener(n.eventNames.localeChanged,mt._cacheMessages.bind(mt)),mt._isInitialized=!0)}_render(e){this._container=Q(this._document,mt.CONTAINER_ELEMENT_NAME),this._container.style.display="none",this._container.setAttribute("data-lt-adjust-appearance","true"),this._container.classList.add("lt-error-card"),this._container.addEventListener("click",(e=>e.stopPropagation())),le(this._inputArea)?this._container.setAttribute("data-lt-force-appearance","dark"):this._container.setAttribute("data-lt-force-appearance","light"),this._eventListeners.push(he(this._keyboardEventTarget,"keydown",this._onKeyDown.bind(this)),he(this._container,"mousedown",(e=>{e.stopImmediatePropagation(),e.target&&!e.target.closest(".lt-errorcard__text, .lt-card__headline")&&e.preventDefault()})),he(this._container,"mouseup",(e=>e.stopImmediatePropagation())),he(this._container,"pointerdown",(e=>e.stopImmediatePropagation())),he(this._container,"pointerup",(e=>e.stopImmediatePropagation())));const t=this._document.createElement("lt-div");t.classList.add("lt-card__container"),t.classList.add("lt-card__container--error-card"),t.classList.add("notranslate"),this._renderContent(t);const n=this._document.createElement("lt-span");n.className="lt-card__close-button lt-icon__close_small",this._eventListeners.push(he(n,"click",this._onCloseClicked.bind(this))),t.appendChild(n),this._container.appendChild(t);const s=this._domMeasurement.getDocumentVisibleBox(),i=this._document.elementFromPoint(e.left-s.left+10,e.bottom-s.top+10),r=i&&!this._inputArea.contains(i),o="BODY"===this._referenceArea.nodeName?this._document.documentElement:this._document.body;o.appendChild(this._container),this._domMeasurement.clearCache();const a=this._domMeasurement.getBorderBox(t);if(this._renderOutsideIframe){let t=document.createElement("lt-span");t.style.position="absolute",t.style.left=e.left+"px",t.style.top=e.top+"px",document.documentElement.appendChild(t);const n=t.getBoundingClientRect();t.remove(),t=null;const s=new K(this._document).getContentBox(this._referenceArea);e.left=s.left+n.left,e.top=s.top+n.top,e.bottom=s.top+n.top+e.height,e.right=s.left+n.left+e.width}let l=Math.min(e.left,s.width-a.width),c=e.bottom+5;const d=a.height<e.top;(c+a.height>s.bottom||r&&d)&&(c=Math.max(s.top,e.top-a.height-5));const h=this._domMeasurement.getScaleFactor(o),_=this._domMeasurement.getZoom(o);l/=h.x*_,c/=h.y*_,t.style.left=Math.round(l)+"px",t.style.top=Math.round(c)+"px"}_renderContent(e){const t=this._document.createElement("lt-div");if(t.classList.add("lt-card__headline"),this._isHiddenMatch&&"test2"===this._uiOptions.showHiddenMatchesInplace?(t.textContent=mt.MESSAGES.HEADLINE_HIDDEN_MATCH,e.classList.add("lt-card__container--hidden-mistake")):this._error.isCustomError?(t.textContent=this._error.shortDescription||mt.MESSAGES.HEADLINE_CUSTOM_SUGGESTION_ERROR,e.classList.add("lt-card__container--custom-suggestion")):this._error.isSpellingError?(t.textContent=mt.MESSAGES.HEADLINE_SPELLING_ERROR,e.classList.add("lt-card__container--spelling-mistake")):this._error.isStyleError?(t.textContent=this._error.shortDescription||mt.MESSAGES.HEADLINE_SUGGESTION_ERROR,e.classList.add("lt-card__container--style-suggestion")):this._error.isPunctuationError?(t.textContent=this._error.shortDescription||mt.MESSAGES.HEADLINE_PUNCTUATION_ERROR,e.classList.add("lt-card__container--punctuation-mistake")):(t.textContent=this._error.shortDescription||mt.MESSAGES.HEADLINE_GRAMMAR_ERROR,e.classList.add("lt-card__container--grammar-mistake")),e.appendChild(t),this._error.isPicky&&!this._isHiddenMatch&&e.classList.add("lt-card__container--picky-mistake"),this._isHiddenMatch){const t=this._document.createElement("lt-div");t.textContent=mt.MESSAGES.PREMIUM_TEXT,t.className="lt-errorcard__premium-text";const n=this._document.createElement("lt-div");n.textContent=mt.MESSAGES.PREMIUM_BUTTON,n.className="lt-errorcard__premium-button",this._eventListeners.push(he(n,"click",(e=>{e.stopImmediatePropagation();const t={errorCard:this,campaign:"addon2-errorcard-match"};de(document,mt.eventNames.premiumTeaserClicked,t)}))),e.append(t),e.append(n)}else{const t=this._document.createElement("lt-div");if(t.classList.add("lt-errorcard__text"),t.textContent=this._error.description,e.appendChild(t),this._error.rule.urls&&this._error.rule.urls.length>0){const e=this._document.createElement("lt-span");e.classList.add("lt-errorcard__more-details"),e.classList.add("lt-icon__info"),e.title=mt.MESSAGES.LINK_MORE_DETAILS,this._eventListeners.push(he(e,"click",this._onMoreDetailsClick.bind(this))),t.appendChild(e)}}this._renderFixes(e),this._renderKeyboardInstructuions(e),this._renderActions(e),this._renderFooter(e)}_renderFixes(e){if(this._error.fixes.length){const t=this._document.createElement("lt-div");t.classList.add("lt-errorcard__suggestion-wrapper");const n=Math.min(this._error.fixes.length,i.MAX_FIXES_COUNT);for(let e=0;e<n;e++){const n=this._error.fixes[e],s=this._document.createElement("lt-span");if(s.classList.add("lt-errorcard__suggestion"),!n.value.startsWith(" ")&&!n.value.endsWith(" ")||["FALSCHE_VERWENDUNG_DES_BINDESTRICHS"].includes(this._error.rule.id)){const e=n.value.replace(mt.NARROW_WHITESPACE_REGEXP," ");this._error.fixes.length>3&&this._error.isSpellingError?s.textContent=e:(s.classList.add("lt-errorcard__suggestion--highlighted"),s.innerHTML=Ke(je(this._error.originalPhrase,e)))}else s.textContent=n.value.replace(mt.TRAILING_WHITESPACE_REGEXP,"·");if(""===n.value&&this._error.originalPhrase.match(/[a-z0-9]{2,}/)?(s.classList.remove("lt-errorcard__suggestion--highlighted"),s.classList.add("lt-errorcard__suggestion--strikethrough"),s.textContent=this._error.originalPhrase):""===n.value?(s.classList.remove("lt-errorcard__suggestion--highlighted"),s.classList.add("lt-errorcard__suggestion--delete"),s.textContent=mt.MESSAGES.DELETE):" "===n.value&&/^\s\s+$/.test(this._error.originalPhrase)&&(s.className="lt-errorcard__suggestion--optional",s.textContent=mt.MESSAGES.REMOVE_EXTRA_WHITESPACE),n.suffix){const e=this._document.createElement("lt-span");e.textContent=n.suffix,e.classList.add("lt-card__hint"),s.append(e)}else if(n.prefix){const e=this._document.createElement("lt-span");e.classList.add("lt-card__hint"),s.prepend(e)}s.title=n.shortDescription||"";const i=this._onFixClick.bind(this,e);this._eventListeners.push(he(s,"click",i)),t.appendChild(s),this._buttons.push({element:s,onSelect:i});const r=$e(this._error,n.value);if(this._uiOptions.canCorrectMultipleAtOnce&&r){const e=this._onCorrectAll.bind(this,r),n=this._document.createElement("lt-span");n.classList.add("lt-errorcard__suggestion--correct-all"),n.innerHTML=r.suggestion.message,this._eventListeners.push(he(n,"click",e)),t.appendChild(n),t.appendChild(this._document.createElement("br")),this._buttons.push({element:n,onSelect:e})}}if(1===this._error.fixes.length&&(this._error.description.match(/i[ns]\s+(chiefly\s)?((North\s)?American|British)\s+English/)||"EN_GB_SIMPLE_REPLACE"===this._error.rule.id)){const e=this._document.createElement("lt-span");e.classList.add("lt-errorcard__suggestion--optional");let n=null;if(this._error.description.match(/is\s+(chiefly\s)?British English/)?"CA"===this._uiOptions.geoIpCountry?(n="en-ca",e.textContent=mt.MESSAGES.EN_CA_LINK):"AU"===this._uiOptions.geoIpCountry?(n="en-au",e.textContent=mt.MESSAGES.EN_AU_LINK):"NZ"===this._uiOptions.geoIpCountry?(n="en-nz",e.textContent=mt.MESSAGES.EN_NZ_LINK):"ZA"===this._uiOptions.geoIpCountry?(n="en-za",e.textContent=mt.MESSAGES.EN_ZA_LINK):(n="en-gb",e.textContent=mt.MESSAGES.EN_GB_LINK):(this._error.description.match(/is\s+(chiefly\s)?(North\s)?American English/)||this._error.description.includes("is a common American expression"))&&(n="en-us",e.textContent=mt.MESSAGES.EN_US_LINK),n){const s=this._onLanguageChange.bind(this,n);this._eventListeners.push(he(e,"click",s)),t.appendChild(e),this._buttons.push({element:e,onSelect:s})}}e.appendChild(t)}}_renderKeyboardInstructuions(e){if(!this._uiOptions.enableKeyboard)return;const t=this._document.createElement("lt-div");t.className="lt-errorcard__keyboard-instructions",e.append(t),t.innerHTML=mt.MESSAGES.KEYBOARD_INSTRUCTIONS}_renderActions(t){if(this._error.isSpellingError){if(!this._uiOptions.disableAddingWord&&!u(this._error.originalPhrase)){const e=this._document.createElement("lt-div");e.classList.add("lt-errorcard__add-to-dictionary","lt-icon__dictionary"),e.textContent=s.getMessage("addToDictionaryCaption",this._error.originalPhrase);const n=this._onAddToDictionaryClick.bind(this);this._eventListeners.push(he(e,"click",n)),t.appendChild(e),this._buttons.push({element:e,onSelect:n})}const e=this._document.createElement("lt-div");e.classList.add("lt-errorcard__temporarily-ignore-word"),e.classList.add("lt-icon__mute"),e.textContent=mt.MESSAGES.LINK_IGNORE_HERE;const n=this._onTemporarilyIgnoreWordClick.bind(this);this._eventListeners.push(he(e,"click",n)),t.appendChild(e),this._buttons.push({element:e,onSelect:n})}else{if(!this._uiOptions.disableIgnoringRule&&!this._isHiddenMatch&&!this._error.isCustomError){const e=this._document.createElement("lt-div");e.classList.add("lt-errorcard__ignore-rule"),e.classList.add("lt-icon__ignore"),e.textContent=mt.MESSAGES.LINK_IGNORE_RULE;const n=this._onIgnoreRuleClick.bind(this);this._eventListeners.push(he(e,"click",n)),t.appendChild(e),this._buttons.push({element:e,onSelect:n})}const e=this._document.createElement("lt-div");e.classList.add("lt-errorcard__temporarily-ignore-rule"),e.classList.add("lt-icon__mute"),e.textContent=mt.MESSAGES.LINK_IGNORE_HERE;const n=this._onTemporarilyIgnoreRuleClick.bind(this);this._eventListeners.push(he(e,"click",n)),t.appendChild(e),this._buttons.push({element:e,onSelect:n})}if(this._error.isPicky&&"extension"===e.getType()&&!this._isHiddenMatch){const e=this._document.createElement("lt-div");e.classList.add("lt-errorcard__turn-off-picky-mode"),e.classList.add("lt-icon__picky_mode"),e.textContent=mt.MESSAGES.TURN_OFF_PICKY_MODE;const n=this._onTurnOffPickyMode.bind(this);this._eventListeners.push(he(e,"click",n)),t.appendChild(e),this._buttons.push({element:e,onSelect:n})}}_renderFooter(e){if(this._uiOptions.showFooter){const t=this._document.createElement("lt-div");t.classList.add("lt-card__footer"),e.appendChild(t);const n=this._document.createElement("lt-div");n.classList.add("lt-card__logo","lt-icon__lt"),t.appendChild(n),this._eventListeners.push(he(n,"click",this._onLogoClicked.bind(this)));const s=this._document.createElement("lt-div");s.classList.add("lt-card__badge-container"),t.appendChild(s);const i=this._document.createElement("lt-div");if(i.classList.add("lt-card__name"),i.textContent="LanguageTool",s.appendChild(i),this._uiOptions.isPremiumAccount)new at(null,"premium","small",s);else{const e=new at(null,"basic","small",s);this._eventListeners.push(he(e.getElement(),"click",this._onBadgeClicked.bind(this)))}}}_updateFocus(){for(const e of this._buttons)e.element.classList.remove("lt-card__button-focused");void 0!==this._focusedButtonIndex&&this._buttons[this._focusedButtonIndex]&&this._buttons[this._focusedButtonIndex].element.classList.add("lt-card__button-focused")}_onBadgeClicked(e){e.stopImmediatePropagation();const t={errorCard:this};de(document,mt.eventNames.badgeClicked,t)}_onLogoClicked(e){e.stopImmediatePropagation();const t={errorCard:this};de(document,mt.eventNames.logoClicked,t)}_onMoreDetailsClick(e){e.stopImmediatePropagation();const t={errorCard:this,url:this._error.rule.urls[0].value};de(document,mt.eventNames.moreDetailsClicked,t)}_onFixClick(e,t){t.stopImmediatePropagation();const n={errorCard:this,error:this._error,fixIndex:e,selectNextError:!!t.shiftKey};de(document,mt.eventNames.fixSelected,n)}_onLanguageChange(e,t){t.stopImmediatePropagation();const n={errorCard:this,error:this._error,language:e};de(document,mt.eventNames.languageChanged,n)}_onCorrectAll(e,t){t.stopImmediatePropagation();const n={errorCard:this,config:e,selectedError:this._error};de(document,mt.eventNames.correctAll,n)}_onAddToDictionaryClick(e){e.stopImmediatePropagation();const t={errorCard:this,error:this._error,selectNextError:e instanceof KeyboardEvent&&e.shiftKey};de(document,mt.eventNames.addToDictionaryClicked,t)}_onIgnoreRuleClick(e){e.stopImmediatePropagation();const t={errorCard:this,error:this._error,selectNextError:e instanceof KeyboardEvent&&e.shiftKey};de(document,mt.eventNames.ignoreRuleClicked,t)}_onTemporarilyIgnoreWordClick(e){e.stopImmediatePropagation();const t={errorCard:this,error:this._error,selectNextError:e instanceof KeyboardEvent&&e.shiftKey};de(document,mt.eventNames.temporarilyIgnoreWordClicked,t)}_onTemporarilyIgnoreRuleClick(e){e.stopImmediatePropagation();const t={errorCard:this,error:this._error,selectNextError:e instanceof KeyboardEvent&&e.shiftKey};de(document,mt.eventNames.temporarilyIgnoreRuleClicked,t)}_onTurnOffPickyMode(e){e.stopImmediatePropagation();const t={errorCard:this};de(document,mt.eventNames.turnOffPickyModeClicked,t)}_onCloseClicked(e){e.stopImmediatePropagation(),this.destroy()}_onKeyDown(e){var t;if("Escape"===e.key)return this.destroy(),null===(t=e.target)||void 0===t||t.addEventListener("keyup",(e=>e.stopImmediatePropagation()),{once:!0,capture:!0}),void e.stopImmediatePropagation();if(!this._uiOptions.enableKeyboard||void 0===this._focusedButtonIndex)return;let n=e.key;switch("Tab"===e.key&&(n=e.shiftKey?"ArrowLeft":"ArrowRight"),n){case"ArrowLeft":this._focusedButtonIndex--,-1===this._focusedButtonIndex&&(this._focusedButtonIndex=this._buttons.length-1),this._updateFocus(),e.stopImmediatePropagation(),e.preventDefault();break;case"ArrowRight":this._focusedButtonIndex++,this._focusedButtonIndex===this._buttons.length&&(this._focusedButtonIndex=0),this._updateFocus(),e.stopImmediatePropagation(),e.preventDefault();break;case"ArrowUp":{const t=this._buttons.map((e=>this._domMeasurement.getBorderBox(e.element))),n=t[this._focusedButtonIndex];let s=null;for(const e of t)if(!(e.bottom>n.top))if(s){(e.bottom>s.bottom||e.bottom===s.bottom&&e.left<s.left)&&(s=e)}else s=e;this._focusedButtonIndex=s?t.indexOf(s):this._buttons.length-1,this._updateFocus(),e.stopImmediatePropagation(),e.preventDefault();break}case"ArrowDown":{const t=this._buttons.map((e=>this._domMeasurement.getBorderBox(e.element))),n=t[this._focusedButtonIndex];let s=null;for(const e of t)if(!(e.top<n.bottom))if(s){(e.top<s.top||e.top===s.top&&e.left<s.left)&&(s=e)}else s=e;this._focusedButtonIndex=s?t.indexOf(s):0,this._updateFocus(),e.stopImmediatePropagation(),e.preventDefault();break}case"Enter":this._buttons[this._focusedButtonIndex]&&this._buttons[this._focusedButtonIndex].onSelect(e),e.stopImmediatePropagation(),e.preventDefault()}}_onPageHide(){this.destroy()}destroy(){if(this._container){this._container.remove(),this._container=null;const e={errorCard:this,error:this._error};de(document,mt.eventNames.destroyed,e)}window.removeEventListener("pagehide",this._onPageHide,!0),this._eventListeners.forEach((e=>{e.destroy()})),this._eventListeners=[]}}mt.CONTAINER_ELEMENT_NAME="lt-card",mt.TRAILING_WHITESPACE_REGEXP=/^ | $/g,mt.NARROW_WHITESPACE_REGEXP=/\u202F/g,mt.eventNames={addToDictionaryClicked:"lt-errorCard.addToDictionaryClicked",ignoreRuleClicked:"lt-errorCard.ignoreRuleClicked",temporarilyIgnoreWordClicked:"lt-errorCard.temporarilyIgnoreWordClicked",temporarilyIgnoreRuleClicked:"lt-errorCard.temporarilyIgnoreRuleClicked",turnOffPickyModeClicked:"lt-errorCard.turnOffPickyModeClicked",moreDetailsClicked:"lt-errorCard.moreDetailsClicked",fixSelected:"lt-errorCard.fixSelected",languageChanged:"lt-errorCard.languageSwitched",badgeClicked:"lt-errorCard.badgeClicked",logoClicked:"lt-errorCard.logoClicked",premiumTeaserClicked:"lt-errorCard.premiumTeaserClicked",destroyed:"lt-errorCard.destroyed",correctAll:"lt-errorCard.correctAll"},mt._isInitialized=!1;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class pt{}pt.eventNames={input:"lt-mirror.input",click:"lt-mirror.click"};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Et extends pt{constructor(e){super(),this._firefoxHackEnabled=!1,this._mimickedElement=e,this._domMeasurement=new K(this._mimickedElement.ownerDocument),this._isRoamResearchIssue=Boolean(location.hostname.match(/roamresearch/)&&e.closest(".roam-article")),this._isHootsuiteIssue=Boolean(location.hostname.match(/hootsuite/)&&e.closest(".rc-TextArea")),this._isDotSyntaxHighlighterIssue=Boolean(e.previousElementSibling&&"wpTextbox0"===e.previousElementSibling.id),this._render=this._render.bind(this),this._updateText=this._updateText.bind(this),this._onMimickedElementScroll=this._onMimickedElementScroll.bind(this),this._onMimickedElementClick=this._onMimickedElementClick.bind(this),this._render(),this._mimickedElement.addEventListener("scroll",this._onMimickedElementScroll),this._mimickedElement.addEventListener("click",this._onMimickedElementClick),this._mimickedElement.addEventListener("input",this._updateText),window.ResizeObserver&&(this._mimickedElementResizeObserver=new window.ResizeObserver(this._render),this._mimickedElementResizeObserver.observe(this._mimickedElement)),this._renderInterval=X(this._render,i.RENDER_INTERVAL)}_dispatchClick(e){const t=new MouseEvent(pt.eventNames.click,{view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,button:e.button,buttons:e.buttons,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,bubbles:!0,cancelable:!0});this._wrapper.dispatchEvent(t)}_dispatchInput(){const e=new Event(pt.eventNames.input,{bubbles:!0,cancelable:!0});this._ensureContainerIsBeforeTargetElement(),this._wrapper.dispatchEvent(e)}_ensureContainerIsBeforeTargetElement(){const e=this._getTargetElement();e.previousElementSibling!==this._container&&e.parentElement&&e.parentElement.insertBefore(this._container,e)}_getTargetElement(){return this._isRoamResearchIssue||this._isHootsuiteIssue||this._isDotSyntaxHighlighterIssue?this._mimickedElement.parentNode:this._mimickedElement}_render(){if(!this._mimickedElement.parentElement)return;this._domMeasurement.clearCache();const e=this._domMeasurement.getContentBox(this._mimickedElement,!1,!1),n=this._domMeasurement.getContentBox(this._mimickedElement,!1,!0);if(!this._container){if(this._container=Q(document,Et.CONTAINER_ELEMENT_NAME),this._container.style.display="none",this._wrapper=document.createElement("lt-div"),this._wrapper.setAttribute("spellcheck","false"),this._wrapper.className="lt-mirror__wrapper notranslate",this._canvas=document.createElement("lt-div"),this._canvas.className="lt-mirror__canvas",this._wrapper.appendChild(this._canvas),this._container.appendChild(this._wrapper),t.isFirefox()||t.isThunderbird()){this._elementInlineLineHeight=this._domMeasurement.getInlineStyle(this._mimickedElement,"line-height"),this._elementComputedLineHeight=this._domMeasurement.getStyle(this._mimickedElement,"line-height");this._domMeasurement.getStyle(this._mimickedElement,"transition-property").match(/all|line\-height/)||(this._firefoxHackEnabled=!0)}const e=this._domMeasurement.getStyle(this._mimickedElement.parentElement,"display");"grid"!==e&&"inline-grid"!==e||this._container.classList.add("lt-mirror--grid-item")}this._firefoxHackEnabled&&(this._mimickedElement.style.lineHeight===this._elementComputedLineHeight?this._domMeasurement.setStyles(this._mimickedElement,{"line-height":this._elementInlineLineHeight}):this._elementInlineLineHeight=this._domMeasurement.getInlineStyle(this._mimickedElement,"lineHeight"),this._elementComputedLineHeight=this._domMeasurement.getStyle(this._mimickedElement,"line-height"),this._elementComputedLineHeight.includes("px")&&this._domMeasurement.setStyles(this._mimickedElement,{"line-height":this._elementComputedLineHeight}));const s=this._domMeasurement.getStyles(this._mimickedElement,["border","border-radius","border-top-width","border-right-width","border-left-width","border-bottom-width","border-top-style","border-right-style","border-left-style","border-bottom-style","direction","font","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-weight","hyphens","letter-spacing","line-break","margin","margin-top","margin-left","margin-bottom","margin-right","padding","padding-top","padding-left","padding-right","padding-bottom","text-align","text-decoration","text-indent","text-rendering","text-transform","transform","transform-origin","unicode-bidi","white-space","word-spacing","word-wrap","writing-mode","zoom","-webkit-locale","-webkit-rtl-ordering"]);s["font-size"]=this._getWrapperFontSizeValue(s["font-size"]),s["line-height"]=this._domMeasurement.getExactStyle(this._mimickedElement,"line-height"),s["white-space"]=this._getWrapperWhiteSpaceValue(s["white-space"]),A(s,this._wrapperStyles)||(this._domMeasurement.resetStyles(this._wrapper,s,!0),this._wrapperStyles=s),this._updateText(),this._ensureContainerIsBeforeTargetElement(),this._domMeasurement.setStyles(this._wrapper,{width:e.width+"px",height:e.height+"px"},!0);const i=this._domMeasurement.getContentBox(this._wrapper,!1),r=n.left-i.left;if(Math.abs(r)>.05){let e=parseFloat(this._domMeasurement.getStyle(this._wrapper,"margin-left"));e+=r,this._domMeasurement.setStyles(this._wrapper,{"margin-left":e+"px"},!0)}const o=n.top-i.top;if(Math.abs(o)>.05){let e=parseFloat(this._domMeasurement.getStyle(this._wrapper,"margin-top"));e+=o,this._domMeasurement.setStyles(this._wrapper,{"margin-top":e+"px"},!0)}const a=this._domMeasurement.getScrollDimensions(this._mimickedElement,!1);let l=a.width-e.padding.left-e.padding.right,c=a.height-e.padding.top-e.padding.bottom;l===Math.round(e.width)&&(l=e.width),this._domMeasurement.setStyles(this._canvas,{width:l+"px",height:c+"px"},!0),this._updateScrolling(!1)}_getTextZoom(e=!1){if(e&&this._domMeasurement.clearCache(),!this._container)return 1;if(!t.isFirefox()&&!t.isThunderbird())return 1;this._measurer||(this._measurer=document.createElement("lt-div"),this._measurer.className="lt-mirror__measurer",this._container.appendChild(this._measurer));return(Number.parseInt(this._domMeasurement.getStyle(this._measurer,"font-size"))||0)/100}_getWrapperFontSizeValue(e){const t=this._getTextZoom();if(1===t)return e;return(Number.parseFloat(e)||0)/t+"px"}_getWrapperWhiteSpaceValue(e){if(t.isChromium()){if("normal"===e)return"pre-wrap";if("nowrap"===e)return"pre"}return e}_updateScrolling(e=!0){e&&this._domMeasurement.clearCache();const t=this._domMeasurement.getScrollPosition(this._mimickedElement,!1),n=this._domMeasurement.getScrollPosition(this._mimickedElement,!0,!1),s=this._domMeasurement.getScrollPosition(this._mimickedElement);this._domMeasurement.setStyles(this._canvas,{"margin-top":-t.top+"px","margin-left":-t.left+"px"},!0),this._wrapper.dataset.ltScrollTop=t.top.toString(),this._wrapper.dataset.ltScrollLeft=t.left.toString(),this._wrapper.dataset.ltScrollTopScaled=n.top.toString(),this._wrapper.dataset.ltScrollLeftScaled=n.left.toString(),this._wrapper.dataset.ltScrollTopScaledAndZoomed=s.top.toString(),this._wrapper.dataset.ltScrollLeftScaledAndZoomed=s.left.toString()}_updateText(){const e=this._mimickedElement.value;this._currentText!==e&&(this._currentText=e,this._canvas.textContent=e,this._updateScrolling(),this._dispatchInput())}_onMimickedElementScroll(){window.requestAnimationFrame((()=>{this._updateScrolling()}))}_onMimickedElementClick(e){void 0!==e.clientX&&void 0!==e.clientY&&this._dispatchClick(e)}getCloneElement(){return this._wrapper}getTextElement(){return this._canvas}enableRangeMeasurements(){this._wrapper.classList.add("lt-mirror-enable-range-measurement")}disableRangeMeasurements(){this._wrapper.classList.remove("lt-mirror-enable-range-measurement")}destroy(){this._mimickedElement.removeEventListener("input",this._updateText),this._mimickedElement.removeEventListener("scroll",this._onMimickedElementScroll),this._mimickedElement.removeEventListener("click",this._onMimickedElementClick),this._renderInterval&&this._renderInterval.destroy(),this._container&&this._container.remove(),this._mimickedElementResizeObserver&&this._mimickedElementResizeObserver.disconnect(),this._domMeasurement.clearCache()}}Et.CONTAINER_ELEMENT_NAME="lt-mirror";
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class ft extends st{constructor(e,t,n,s=Number.MAX_SAFE_INTEGER){super(e,n,s),this._scrollToInterval=null,this._mirror=t,this._mirrorElement=t.getCloneElement(),this._ceElementInspector=new nt(this._mirrorElement,this._tweaks.getParsingDetector()),this._domMeasurement=new K(this._inputArea.ownerDocument),this._scrollTop=this._inputArea.scrollTop,this._scrollLeft=this._inputArea.scrollLeft,this._updateText(),this._onDblClick=this._onDblClick.bind(this),this._onScroll=this._onScroll.bind(this),this._inputArea.addEventListener("dblclick",this._onDblClick),this._inputArea.addEventListener("scroll",this._onScroll),this._mirrorElement.addEventListener(pt.eventNames.input,this._onInput)}_onDblClick(e){const t=_(this._tweaks.getSelectedText()),n=this.getSelection();if(!t||!n)return;const s=n.end||n.start,i=this.getTextRanges(n.start,s-n.start);if(!i.length)return;this._domMeasurement.clearCache();const r=this._domMeasurement.getTextBoundingBoxes(i,this._mirrorElement),o=this._domMeasurement.getTextBoundingBoxes(i,this._mirrorElement,!1);if(!r.length)return;if(!o.some((t=>J(t,e.clientX,e.clientY))))return;const a={inputAreaWrapper:this,selectedText:t,selection:n,clickedRectangles:r};de(document,st.eventNames.dblclick,a)}_onScroll(){const e=this._inputArea.scrollTop,t=this._inputArea.scrollLeft;if(this._scrollTop===e&&this._scrollLeft===t)return;this._scrollTop=e,this._scrollLeft=t;const n={inputAreaWrapper:this};de(document,st.eventNames.scroll,n)}_hasSpaceBefore(e){if(e<=0||0===this._textChunks.length)return!1;const t=this._textChunks[0],n=this._offsetInRawText(t.rawText,t.parsedText,e-1),s=this._offsetInRawText(t.rawText,t.parsedText,e);return ft.VISIBLE_WHITE_SPACE_REGEXP.test(t.rawText.substring(n,s))}_hasSpaceAfter(e){if(0===this._textChunks.length)return!1;const t=this._textChunks[0],n=this._offsetInRawText(t.rawText,t.parsedText,e),s=this._offsetInRawText(t.rawText,t.parsedText,e+1);return ft.VISIBLE_WHITE_SPACE_REGEXP.test(t.rawText.substring(n,s))}_offsetInRawText(e,t,n){n=Math.min(e.length,n);const s=h(e);if(-1===s||n<s)return n;let i=s,r=s;do{if(d(e[i])||r++,r>n)break;i++}while(i<e.length);return i}_offsetInParsedText(e,t,n){let s=0;for(let t=0;t<Math.min(e.length,n);t++)d(e[t])&&s++;return n-s}_updateText(){const e=[];let t="";const n=this._mirror.getTextElement().firstChild;if(n){const s=n.textContent||"";t=this._ceElementInspector.getParsedText(n),e.push({node:n,isTextNode:!0,rawText:s,rawTextOffset:0,parsedText:t,parsedTextOffset:0})}const s=this._text!==t;return this._text=t,this._textChunks=e,s}getTextBoxes(e,t){const n=this.getTextRanges(e,t);return n.length?(this._domMeasurement.clearCache(),this._domMeasurement.getTextBoundingBoxes(n,this._mirrorElement)):[]}resetText(){const e=this._inputArea.value;this._inputArea.value="",this._inputArea.value=e}replaceText(e,n,s){if(e<0||0===this._textChunks.length)return Promise.resolve();const i=e+s.length;""===s&&(this._hasSpaceBefore(e)||0===e)&&this._hasSpaceAfter(e+n)&&(e=Math.max(e-1,0),n+=1),this.setSelection({start:e,end:e+n});let r=document.execCommand("insertText",!1,s);""===s&&(t.isFirefox()||t.isThunderbird())&&(r=!1);const o=(t.isFirefox()||t.isThunderbird())&&s.includes(ft.NBSP);if(r){if(o){const t=this._inputArea.value,n=this._textChunks[0],i=this._offsetInRawText(t,n.parsedText,e),r=this._offsetInRawText(t,n.parsedText,e+s.length),o=t.substring(0,i)+s+t.substring(r);this._inputArea.value=o}}else{const t=this._textChunks[0],i=this._offsetInRawText(t.rawText,t.parsedText,e),r=this._offsetInRawText(t.rawText,t.parsedText,e+n),o=t.rawText.substring(0,i)+s+t.rawText.substring(r);this._inputArea.value=o}return this.setSelection({start:i}),r||this.simulateInput(s),Promise.resolve()}getSelection(){if(this._inputArea!==Ee())return null;const e=this.getText();return{start:this._offsetInParsedText(this._inputArea.value,e,this._inputArea.selectionStart),end:this._offsetInParsedText(this._inputArea.value,e,this._inputArea.selectionEnd)}}setSelection(e){const t=e.start,n=void 0===e.end?t:e.end;if(this._inputArea.focus(),0===this._textChunks.length)return;const s=this._textChunks[0];this._inputArea.selectionStart=this._offsetInRawText(s.rawText,s.parsedText,t),this._inputArea.selectionEnd=this._offsetInRawText(s.rawText,s.parsedText,n)}scrollToText(e,t,n="smooth",s="nearest",i){const r="smooth"===n?300:0;function o(e,t,n,s){return(e/=s/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}if(e<0)return;this._scrollToInterval&&(this._scrollToInterval.destroy(),this._scrollToInterval=null);const a=this._inputArea.scrollTop,l=this._inputArea.scrollLeft;this._domMeasurement.clearCache();const c=this.getTextRanges(e,t),d=this._domMeasurement.getRelativeTextBoundingBox(c,this._mirrorElement),h=this._inputArea.getBoundingClientRect();let _=this._inputArea.scrollTop+d.top;"center"===s&&(_-=this._inputArea.clientHeight/2,_-=d.height/2),h.top<0&&(_+=h.top);let u=this._inputArea.scrollLeft+d.left;h.left<0&&(u+=h.left);const g=_-a,m=u-l;let p=0;this._scrollToInterval=X((()=>{p+=ft.SCROLL_TO_FRAME_INTERVAL;const e=o(p,a,g,r),t=o(p,l,m,r);this._inputArea.scrollTop=e,this._inputArea.scrollLeft=t,p>=r&&(this._scrollToInterval&&(this._scrollToInterval.destroy(),this._scrollToInterval=null),i&&setTimeout((()=>i()),50))}),ft.SCROLL_TO_FRAME_INTERVAL)}destroy(){super.destroy(),this._inputArea.removeEventListener("dblclick",this._onDblClick),this._inputArea.removeEventListener("scroll",this._onScroll),this._mirrorElement.removeEventListener(pt.eventNames.input,this._onInput),this._ceElementInspector.destroy(),this._scrollToInterval&&this._scrollToInterval.destroy()}}ft.SCROLL_TO_FRAME_INTERVAL=20,ft.NBSP=String.fromCharCode(160),ft.VISIBLE_WHITE_SPACE_REGEXP=/\u00A0|\u0020|\u2009|\u202F/;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Ct{static _splitExcludedPart(e,t,n){const s=[],i=e.substr(t,n);let r=0,o=i.indexOf("\n");for(;-1!==o;)s.push({offset:t+r,length:o-r}),r=o+1,o=i.indexOf("\n",o+1);return s.push({offset:t+r,length:i.length-r}),s}static _getReplacedParts(e,t,n){const s=[];for(const n of t){const t=r(e,n.pattern);for(const i of t){let t=i.index;if(void 0===n.excludedParts){const r=i[0].length;n.preserveNewlineChars?s.push(...Ct._splitExcludedPart(e,t,r)):s.push({offset:t,length:r})}else for(let r=0;r<n.excludedParts.length;r++){if(void 0===i[r+1])continue;const o=i[r+1].length,a=n.excludedParts[r];("boolean"==typeof a?a:a.test(i[r+1]))&&(n.preserveNewlineChars?s.push(...Ct._splitExcludedPart(e,t,o)):s.push({offset:t,length:o})),t+=o}}}for(const t of n){const n=r(e,t.pattern);for(const e of n)if("replacingText"in t){const n=e.index,i=e[0].length;s.push({offset:n,length:t.replacingText.length,replacingText:t.replacingText}),s.push({offset:n+t.replacingText.length,length:i-t.replacingText.length})}else"getReplacedParts"in t&&s.push(...t.getReplacedParts(e))}return s}static _testString(e,t,n=!1){Array.isArray(t)||(t=[t]);for(const s of t)if("string"==typeof s){if(e===s||n&&e.startsWith(s))return!0}else if(s.test(e))return!0;return!1}static getEmail(e){const t=Ct.EMAIL_REGEXP.exec(e);if(!t)return"";return t[0].replace(Ct.EMAIL_DOMAIN_REGEXP,"@replaced.domain").trim()}static getFullName(e){return e.replace(Ct.EMAIL_REGEXP,"").replace(Ct.ADDRESS_SPECIAL_CHARS_REGEXP,"").trim()}static getSiteTweaks(e){const t=x(e,"");if(!t)return Ct.DEFAULT_SITE_TWEAKS;const n=R(t);for(const t of Ct.SITE_TWEAKS_RULES){let s=!0;if("hostname"in t.precondition){const e=t.precondition.hostname;s=n.some((t=>Ct._testString(t,e)))}else"url"in t.precondition&&(s=Ct._testString(e,t.precondition.url));if(s&&t.precondition.isMatch&&(s=t.precondition.isMatch(n,e)),s)return Object.assign({},Ct.DEFAULT_SITE_TWEAKS,t)}return Ct.DEFAULT_SITE_TWEAKS}static getInputAreaTweaks(e,t){const n=Ct.DEFAULT_INPUT_AREA_TWEAKS_FACTORY(t),s=x(e,"");if(!s)return n;const i=R(s);for(const s of Ct.INPUT_AREA_TWEAKS_RULES){let r=!0;if("hostname"in s.precondition){const e=s.precondition.hostname;r=i.some((t=>Ct._testString(t,e)))}else"url"in s.precondition&&(r=Ct._testString(e,s.precondition.url));if(r&&s.precondition.isMatch&&(r=s.precondition.isMatch(t)),r)return Object.assign({},n,s.create(t,n))}return n}}Ct.EMAIL_REGEXP=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/gi,Ct.EMAIL_DOMAIN_REGEXP=/@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/i,Ct.ADDRESS_SPECIAL_CHARS_REGEXP=/["'`<>]/g,Ct.NON_COMPATIBLE_TAGS=["TR","TH","TD","THEAD","TBODY","TFOOT","CAPTION","IFRAME"],Ct.INLINE_DISPLAY_VALUES=["inline","inline-block"],Ct.TEXT_IGNORING_DEFAULT_RULES=new Map([["QUOTED_LINE",{pattern:/^[ \t]*>.*$/gm,preserveNewlineChars:!1}],["HTML_CODE_BLOCK",{pattern:/\s?<code\b[^>]*>[^]*?<\/code>/gi,preserveNewlineChars:!0}],["MARKDOWN_BOLD_1",{pattern:/(^|\s|\s\()(_|~~)?(\*\*)([^\s\*](?:.*?\S)?)(\*\*)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]}],["MARKDOWN_BOLD_2",{pattern:/(^|\s|\s\()(\*|~~)?(__)([^\s_](?:.*?\S)?)(__)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]}],["MARKDOWN_ITALIC_1",{pattern:/(^|\s|\s\()(__|~~)?(\*)([^\s\*](?:.*?\S)?)(\*)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]}],["MARKDOWN_ITALIC_2",{pattern:/(^|\s|\s\()(\*\*|~~)?(_)([^\s_](?:.*?\S)?)(_)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]}],["MARKDOWN_BOLD_AND_ITALIC_1",{pattern:/(^|\s|\s\()(\*\*\*)([^\s\*](?:.*?\S)?)(\*\*\*)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!0,!1,!0,!1]}],["MARKDOWN_BOLD_AND_ITALIC_2",{pattern:/(^|\s|\s\()(___)([^\s_](?:.*?\S)?)(___)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!0,!1,!0,!1]}],["MARKDOWN_STRIKETHROUGH",{pattern:/(^|\s|\s\()(\*|\*\*|_|__)?(~~)([^\s~](?:.*?\S)?)(~~)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]}],["MARKDOWN_MULTILINE_CODE_BLOCK",{pattern:/(^|[^`])(```)(?!`)([^]*?[^`])(```)(?=[^`]|$)/gm,preserveNewlineChars:!0,excludedParts:[/^\s$/,!0,!0,!0]}],["MARKDOWN_IMAGE_WITHOUT_TITLE",{pattern:/(!\[(?:(?:Uploading\s)?(?:Screen\sShot\s|Bildschirmfoto\s)?)?)([^\[\]]+)(\]\(\s*[^()"'\s]*\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0]}],["MARKDOWN_IMAGE_WITH_TITLE",{pattern:/(!\[)([^\[\]]+)(\]\(\s*[^()"'\s]+)(\s+)(["'])([^]*?)(\5\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0,!1,!0,!1,!0]}],["MARKDOWN_LINK_WITHOUT_TITLE",{pattern:/(\[)([^\[\]]+)(\]\(\s*[^()"'\s]+\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0]}],["MARKDOWN_LINK_WITH_TITLE",{pattern:/(\[)([^\[\]]+)(\]\(\s*[^()"'\s]+)(\s+)(["'])([^]*?)(\5\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0,!1,!0,!1,!0]}],["BBCODE_CODE_BLOCK",{pattern:/\s?\[code\][^]*?\[\/code\]/gi,preserveNewlineChars:!0}],["JIRA_CODE_BLOCK",{pattern:/\s?{code(:[a-z0-9#]+)?}[^]*?{code}/gi,preserveNewlineChars:!0}],["TEXTILE_STRIKETHROUGH",{pattern:/(^|\s)(~)([^\s~](?:.*?\S)?)(~)([\s.!?,:;]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!0,!1,!0,!1]}],["TEXTILE_BLOCK_TAG",{pattern:/^(h[1-6]|bq|bc|p|pre|###|notextile)\./gim,preserveNewlineChars:!1}],["WIKITEXT_LINK_WITHOUT_TITLE",{pattern:/(\[\[)([a-z:][^|\]\n]*)(\]\])/gi,preserveNewlineChars:!1,excludedParts:[!0,!1,!0]}],["WIKITEXT_LINK_WITH_TITLE",{pattern:/(\[\[[a-z:][^|\]\n]*\|)([^\]\n]+)(]])/gi,preserveNewlineChars:!1,excludedParts:[!0,!1,!0]}],["EMOTICONS_LTR",{pattern:/(^|\s+)([:;|=][-~^]?[()\[\]\\/|@$*#&XxDOoPp])(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["EMOTICONS_LTR_2",{pattern:/(^|\s+)([8B%][-~^][D()\[\]])(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["EMOTICONS_LTR_3",{pattern:/(^|\s+)([:;%|=][-~^]?3)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["EMOTICONS_RTL",{pattern:/(^|\s+)([()[\]\\/|@$*#&XxDOo][-~^]?[:;%|])(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["XD_SMILE",{pattern:/(^|\s+)([xX]D)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["HEART_SMILE",{pattern:/(^|\s+)(<[\\/]?3)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}],["JIRA_SMILEYS",{pattern:/(^|\s+)\(([-+!?ynxi]|(\*[rgby]?)|on|off|flag|flagoff)\)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0}]]),Ct.TEXT_IGNORING_DEFAULT_RULES_ARRAY=Array.from(Ct.TEXT_IGNORING_DEFAULT_RULES.values()),Ct.TEXT_REPLACING_DEFAULT_RULES=new Map([["BR_TAG",{pattern:/<([a-z]+:)?br(\s[^>]*)?\/?>/gi,replacingText:"\n"}],["HTML_OPENING_TAG",{pattern:/<([a-z]+:)?(html|xml|base|head|link|meta|style|title|body|address|article|aside|footer|header|h1|h2|h3|h4|h5|h6|main|nav|section|blockquote|dd|div|dl|dt|figcaption|figure|hr|li|ol|p|pre|ul|a|abbr|b|bdi|bdo|cite|code|data|dfn|em|i|kbd|mark|q|rp|rt|ruby|s|samp|small|span|strong|sub|sup|time|u|var|wbr|area|audio|img|map|track|video|embed|iframe|object|param|picture|portal|source|svg|canvas|noscript|script|del|ins|caption|col|colgroup|table|tbody|td|tfoot|th|thead|tr|button|datalist|fieldset|form|input|label|legend|meter|optgroup|option|output|progress|select|textarea|details|dialog|menu|summary|slot|template|acronym|applet|basefont|bgsound|big|blink|center|content|dir|font|frame|frameset|hgroup|image|keygen|marquee|menuitem|nobr|noembed|noframes|plaintext|rb|rtc|shadow|spacer|strike|tt|xmp)(\s[^>]*)?>/gi,replacingText:"⁣"}],["HTML_CLOSING_TAG",{pattern:/<\/([a-z]+:)?(html|xml|base|head|link|meta|style|title|body|address|article|aside|footer|header|h1|h2|h3|h4|h5|h6|main|nav|section|blockquote|dd|div|dl|dt|figcaption|figure|hr|li|ol|p|pre|ul|a|abbr|b|bdi|bdo|cite|code|data|dfn|em|i|kbd|mark|q|rp|rt|ruby|s|samp|small|span|strong|sub|sup|time|u|var|wbr|area|audio|img|map|track|video|embed|iframe|object|param|picture|portal|source|svg|canvas|noscript|script|del|ins|caption|col|colgroup|table|tbody|td|tfoot|th|thead|tr|button|datalist|fieldset|form|input|label|legend|meter|optgroup|option|output|progress|select|textarea|details|dialog|menu|summary|slot|template|acronym|applet|basefont|bgsound|big|blink|center|content|dir|font|frame|frameset|hgroup|image|keygen|marquee|menuitem|nobr|noembed|noframes|plaintext|rb|rtc|shadow|spacer|strike|tt|xmp)>/gi,replacingText:"⁣"}],["SVG_OPENING_TAG",{pattern:/<([a-z]+:)?(a|altGlyph|altGlyphDef|altGlyphItem|animate|animateColor|animateMotion|animateTransform|circle|clipPath|color-profile|cursor|defs|desc|discard|ellipse|feBlend|feColorMatrix|feComponentTransfer|feComposite|feConvolveMatrix|feDiffuseLighting|feDisplacementMap|feDistantLight|feFlood|feFuncA|feFuncB|feFuncG|feFuncR|feGaussianBlur|feImage|feMerge|feMergeNode|feMorphology|feOffset|fePointLight|feSpecularLighting|feSpotLight|feTile|feTurbulence|filter|font|font-face|font-face-format|font-face-name|font-face-src|font-face-uri|foreignObject|g|glyph|glyphRef|hatch|hatchpath|hkern|image|line|linearGradient|marker|mask|mesh|meshgradient|meshpatch|meshrow|metadata|missing-glyph|mpath|path|pattern|polygon|polyline|radialGradient|rect|script|set|solidcolor|stop|style|svg|switch|symbol|text|textPath|title|tref|tspan|unknown|use|view|vkern)(\s[^>]*)?>/gi,replacingText:"⁣"}],["SVG_CLOSING_TAG",{pattern:/<\/([a-z]+:)?(a|altGlyph|altGlyphDef|altGlyphItem|animate|animateColor|animateMotion|animateTransform|circle|clipPath|color-profile|cursor|defs|desc|discard|ellipse|feBlend|feColorMatrix|feComponentTransfer|feComposite|feConvolveMatrix|feDiffuseLighting|feDisplacementMap|feDistantLight|feFlood|feFuncA|feFuncB|feFuncG|feFuncR|feGaussianBlur|feImage|feMerge|feMergeNode|feMorphology|feOffset|fePointLight|feSpecularLighting|feSpotLight|feTile|feTurbulence|filter|font|font-face|font-face-format|font-face-name|font-face-src|font-face-uri|foreignObject|g|glyph|glyphRef|hatch|hatchpath|hkern|image|line|linearGradient|marker|mask|mesh|meshgradient|meshpatch|meshrow|metadata|missing-glyph|mpath|path|pattern|polygon|polyline|radialGradient|rect|script|set|solidcolor|stop|style|svg|switch|symbol|text|textPath|title|tref|tspan|unknown|use|view|vkern)>/gi,replacingText:"⁣"}],["SELF_CLOSED_TAG",{pattern:/<([a-z]+:)?[a-z][^\/]*\/>/gi,replacingText:"⁣"}],["PAIRED_TAGS",{pattern:/(<)((?:[a-z]+:)?[a-z][^\s>]*)(\s[^>]*)?(>)(?=([^]*?)(<\/\2>))/gi,getReplacedParts:e=>{if("code"===e[2].toLowerCase())return[];const t=e.index,n=e[1].length+e[2].length+(e[3]?e[3].length:0)+e[4].length,s=t+n+e[5].length;return[{offset:t,length:1,replacingText:"⁣"},{offset:t+1,length:n-1},{offset:s,length:1,replacingText:"⁣"},{offset:s+1,length:e[6].length-1}]}}],["BBCODE_OPENING_TAG",{pattern:/\[(img|url|email|post|quote|list|youtube|vimeo|googlemaps|googlewidget|code|modalurl|topic|highlight|left|center|right|font|size|color|s|u|i|b|style|table|tr|td)\b[^\]\n]*\]/gi,replacingText:"⁣"}],["BBCODE_CLOSING_TAG",{pattern:/\[\/(img|url|email|post|quote|list|youtube|vimeo|googlemaps|googlewidget|code|modalurl|topic|highlight|left|center|right|font|size|color|s|u|i|b|style|table|tr|td)\]/gi,replacingText:"⁣"}],["WORDPRESS_TAG",{pattern:/\[[a-z0-9_\-]+\s[a-z0-9_\-]+=.+?\]/gi,replacingText:"⁣"}],["MARKDOWN_INLINE_CODE_BLOCK",{pattern:/(^|\s|\s\()`([^`\n]+)`([\s.!?,:;\)]|$)/g,getReplacedParts:e=>{const t=e.index+e[1].length+1;return[{offset:t,length:1,replacingText:"⁣"},{offset:t+1,length:e[2].length-1}]}}],["JIRA_OPENING_OR_CLOSING_TAG",{pattern:/{(color|code|noformat|quote)(:[a-z0-9#]+)?}/gi,replacingText:"⁣"}],["EMOJI",{pattern:/(^|\s+)(\:\w+\:)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,replacingText:"⁣"}]]),Ct.TEXT_REPLACING_DEFAULT_RULES_ARRAY=Array.from(Ct.TEXT_REPLACING_DEFAULT_RULES.values()),Ct.DEFAULT_SITE_TWEAKS={init(){document.documentElement.setAttribute("data-lt-installed","true")},destroy(){document.documentElement&&document.documentElement.removeAttribute("data-lt-installed")},isSupported:()=>!0,unsupportedMessage:()=>"",isBeta:()=>!1,persistTemporarySettings:()=>!1,onNewElement(e){},getInitElements:e=>[e],shouldDisableOtherSpellCheckers:e=>!0,isElementCompatible(e){if(Ct.NON_COMPATIBLE_TAGS.includes(e.tagName))return!1;if(!((Te(e)||function(e){return e instanceof HTMLElement&&(e.isContentEditable||"BODY"===e.nodeName&&ie(e))}(e))&&!e.readOnly))return!1;if("true"===e.getAttribute("data-lt-active"))return!0;if("false"===e.getAttribute("data-lt-active"))return!1;if("false"===document.documentElement.getAttribute("data-lt-active"))return!1;if(be(e))return!1;if(e.classList.contains("ck-editor__nested-editable")&&e.parentElement&&e.parentElement.closest(".cke_editable"))return!1;if(We(e))return!0;if(function(e){try{const t=e.ownerDocument.defaultView.frameElement;return!!t&&t.classList.contains("arx-editor-frame")}catch(e){return!1}}(e))return!1;if(Be(e)&&"true"===e.getAttribute("contenteditable"))return!0;if(e.classList.contains("cke_editable"))return!0;if(e.classList.contains("ve-ce-documentNode"))return!0;if(e.classList.contains("fr-element")&&!e.classList.contains("wsc-instance"))return!0;if(e.parentElement&&e.parentElement.classList.contains("wp-block-code"))return!1;const t=e.ownerDocument;if(t.head&&De(e)){const n=t.createElement("script"),s="_isTinymceSpellcheckerActivated";return n.innerText=`\n                    try {\n                        if (window.parent.tinymce.get(document.body.dataset.id).plugins.tinymcespellchecker) {\n                            document.body.dataset.${s} = true;\n                        }\n                    } catch(e) {}\n                `,t.head.appendChild(n),n.remove(),!Boolean(e.dataset[s])}return!!(window.innerHeight>=20&&window.innerWidth>=100)&&!("false"===e.getAttribute("spellcheck")&&!e.lang)},hasFocus:e=>function(e){return e.matches(":focus")||"BODY"===e.nodeName&&ie(e)&&e.ownerDocument.hasFocus()}(e),getEditorId:e=>Math.round(99999*Math.random())+":"+Date.now(),getEditorGroupId(e){try{return new URL(e).pathname}catch(e){return"unknown"}},getClickEvent:()=>"click",isClickEventIgnored:e=>!e.isTrusted,getSelectedText:()=>pe(),getSelectedHTML:()=>function(){const e=document.activeElement,t=e?e.tagName.toLowerCase():null;if("textarea"===t||"input"===t&&/^(?:text|search|password|tel|url)$/i.test(e.type)&&"number"==typeof e.selectionStart)return;const n=window.getSelection();if(!n||0===n.rangeCount)return;const s=n.getRangeAt(0).cloneContents(),i=document.createElement("div");return i.appendChild(s),i.innerHTML}()},Ct.DEFAULT_INPUT_AREA_WRAPPER_TWEAKS_FACTORY=function(e){return{createMutationObserver:e=>new MutationObserver(e),getParsingDetector(){const t=document.body&&document.body.dataset&&document.body.dataset.id&&document.body.dataset.id.includes("ZmHtmlEditor");let n=location.href.includes("/owa/")||!!document.querySelector(".owa-font-compose");try{n=n||window.parent.location.href.includes("/owa/")||!!window.parent.document.querySelector(".owa-font-compose")}catch(e){}let s=!1;try{s=!!window.parent.document.title.match(/roundcube/i)||!!window.parent.location.href.match(/_action=compose/i)}catch(e){}const i=function(e){return e.classList.contains("ProseMirror")}(e),r=De(e),o=Ue(e),a=function(e){return e.classList.contains("ql-editor")}(e),d=function(e){return e.classList.contains("lt-textarea__textarea")}(e);return{createMutationObserver:e=>new MutationObserver(e),isIgnored(e,t){const n=e.tagName.toUpperCase();return!!nt.SKIPPING_TAGS.includes(n)||("none"===t.display||("BLOCKQUOTE"===n&&!d||("false"===e.getAttribute("contenteditable")||"false"===e.getAttribute("spellcheck")?(!i||!e.hasAttribute("data-mention-id")&&!e.hasAttribute("usertype"))&&((!a||!e.classList.contains("ql-mention"))&&((!r||!e.classList.contains("user-hover"))&&((!o||!e.classList.contains("cke_widget_mention-box"))&&((!o||!e.classList.contains("ck-user__marker"))&&((!o||!e.classList.contains("ck-user__marker-line"))&&!(e instanceof HTMLElement&&"inline"===t.display&&(!e.firstElementChild||1===e.childElementCount&&e.offsetWidth>0))))))):"SUP"===n&&e.textContent?nt.SUP_REGEXP.test(e.textContent.trim()):!(!a||!e.classList.contains("ql-code-block")&&!e.classList.contains("ql-formula")))))},isSignature:e=>t?!!(e.dataset&&e.dataset.marker&&e.dataset.marker.includes("_SIG_")):n?"signature"===e.id.toLowerCase():!!s&&"_rc_sig"===e.id,isQuote:e=>t?!!(e.dataset&&e.dataset.marker&&e.dataset.marker.includes("_QUOTED_")):!!n&&("divRplyFwdMsg"===e.id||!!e.previousElementSibling&&"divRplyFwdMsg"===e.previousElementSibling.id),isBlock:(e,t)=>nt.DISPLAY_BLOCK_VALUES.includes(t.display||""),getReplacementText(e,t,n){if(!Ct.INLINE_DISPLAY_VALUES.includes(n.display))return"";const s=e.tagName.toUpperCase();return"BR"===s?"":t&&("IMG"===s||"CODE"===s||"false"===e.getAttribute("spellcheck")||e instanceof HTMLElement&&"false"===e.contentEditable)?"⁣":""},replaceText:(e,t,n)=>(e=_(e),e=c(e)),isWhiteSpace:e=>l(e)}},getCacheInvalidationRules:()=>({isSkippingElement:{self:{attributes:[],childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},descendant:{attributes:["id","class","style"],characterData:!0,childList:!0},sibling:{attributes:["id"]}},replacementText:{self:{attributes:["id","class","style","contenteditable","spellcheck","data-mention-id","usertype"],childList:!0},ancestor:{attributes:["id","class","style"]},descendant:{attributes:["id","class","style"],characterData:!0,childList:!0}},isBlock:{self:{attributes:["id","class","style"]},ancestor:{attributes:["id","class","style"]}},parsingOptions:{self:{attributes:["id","class","style"]},ancestor:{attributes:["id","class","style"]}},parsedText:{self:{characterData:!0},ancestor:{attributes:["id","class","style"]}},blockParent:{self:{attributes:["id","class","style"]},ancestor:{attributes:["id","class","style"]}},paragraphLastValuableNode:{self:{attributes:[],characterData:!0,childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},sibling:{attributes:["id"]},blockSibling:{attributes:[],characterData:!0,childList:!0}},isBRElementRelevant:{self:{attributes:[],childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},sibling:{attributes:["id"]},blockSibling:{attributes:[],characterData:!0,childList:!0}},isTextEndsWithLineBreak:{any:{attributes:[],characterData:!0,childList:!0}},isParagraphNonEmpty:{self:{attributes:["id","class","style"],childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},descendant:{attributes:[],characterData:!0,childList:!0}}}),getKeyboardEventTarget:()=>e,getSelectedText:()=>pe(),getSelection(){const n=function(e){if(t.isFirefox())return e.ownerDocument.getSelection();const n=Ce(e);return n&&"getSelection"in n?n.getSelection():window.getSelection()}(e);return n?{startNode:n.anchorNode,startOffset:n.anchorOffset,endNode:n.focusNode,endOffset:n.focusOffset,isCollapsed:Se(n)}:null}}},Ct.DEFAULT_INPUT_AREA_WRAPPER_FACTORY=function(e,t,n,s){if(Te(e)){if(!t)throw new Error("No mirror instance for FormElementWrapper.");return new ft(e,t,n,s)}return new it(e,n,s)},Ct.DEFAULT_INPUT_AREA_TWEAKS_FACTORY=function(e){return{init(){},destroy(){},onDestroy(t){_e(e,t),ue(e,t)},getMirror:()=>Te(e)?new Et(e):null,getInputAreaWrapper(t,n){const s=Ct.DEFAULT_INPUT_AREA_WRAPPER_TWEAKS_FACTORY(e);return Ct.DEFAULT_INPUT_AREA_WRAPPER_FACTORY(e,t,s,n)},getHighlighterTweaks(t,n){const s=Boolean(t.firstElementChild&&t.firstElementChild.hasAttribute("data-contents")),i=t.classList.contains("ms-rtestate-write"),r=Boolean(t.classList.contains("ql-editor")&&t.closest(".ql-editor")),o=Boolean(t.classList.contains("control-contenteditable__area")&&t.closest(".js-control-contenteditable, .js-control-contenteditable-amojo")),a=Boolean(t.closest(".app-Talk, .app-talk")),l=Boolean(t.closest(".ce-redactor .ce-block .ce-block__content"));return{getTargetElement:()=>n?t:s&&t.parentNode&&t.parentNode.parentNode?t.parentNode:i?t.closest("table[id*=WikiField]")||t:r?t.closest(".ql-container")||t:o?t.closest(".js-control-contenteditable, .js-control-contenteditable-amojo")||t:a?t.closest(".new-message-form")?t.parentElement:t:l&&t.closest(".ce-block__content")||t,addScrollEventListener(t){e.addEventListener("scroll",t)},removeScrollEventListener(t){e.removeEventListener("scroll",t)},createMutationObserver:e=>new MutationObserver(e),getZIndex(e,t){let n=t.getStyle(e,"z-index");return n=parseInt(n)||0,n>0||t.isStackingContext(e)?n+1:"auto"},getVisibleBox:e=>e.getPaddingBox(t,!0,!1),getScrollableElementSize:t=>t.getScrollDimensions(e,!1),getScrollPosition:(t,n,s)=>t.getScrollPosition(e,n,s),getTextBoxes:(e,t,n,s)=>e.getRelativeTextBoundingBoxes(t,n,s),supportsCanvas:()=>!0,isClickIgnored:e=>!1}},getToolbarAppearance(){const t=[gt.CONTAINER_ELEMENT_NAME,mt.CONTAINER_ELEMENT_NAME].join(", "),n="chat-input-control"===e.id&&e.classList.contains("window__chatInputControl"),s=function(e){return e.classList.contains("editor-rich-text__editable")||e.classList.contains("block-editor-writing-flow")||e.classList.contains("block-editor-rich-text__editable")}(e),i=We(e);return{isPerformanceCritical:()=>!1,getParent:t=>"BODY"===e.tagName?t.documentElement:t.body,getClassName:()=>null,isVisible(t,r,o=32){if(n)return!1;let a=!0;if(a=ve(e)||be(e)?!e.value.trim():!e.textContent.trim(),s&&a)return!1;if(i)return!0;const l=r.getPaddingBox(e);return!(a&&l.height<o)&&(l.width>=160&&l.height>=18)},getZIndex:(e,t,n)=>n.getZIndex(e,t),getPosition(e,n,s,i,r,o=18,a=44){const l=e.ownerDocument.documentElement,c=e.ownerDocument.body;if(e===c){return{fixed:!0,left:(i?6:l.clientWidth-r.width-6)+"px"}}const d=l.clientHeight,h=re(e,s,d,t),_=h.bottom-h.top;if(_<o)return null;let u=s.getPaddingBox(e);if("IFRAME"===e.tagName){let t=null;try{t=e.contentWindow.document.documentElement}catch(e){}if(!t)return null;i=s.isRTL(t.ownerDocument.body),g=u,m=t.clientWidth,p=t.clientHeight,u=Object.assign({},g,{right:g.left+m,bottom:g.top+p,width:m,height:p})}var g,m,p;const E=s.getScaleFactor(n),f=s.getZoom(n),C=E.x*f,S=E.y*f;let T=(u.top+h.bottom)/S-6-r.height,v=i?u.left/C+6:u.right/C-6-r.width;if(_<=a){T=(u.top+h.bottom-_/2)/S-r.height/2}const b=u.height>=250,A=(l.scrollTop||c.scrollTop)+d,y=Math.round(u.top);if(b&&y+h.bottom>=A&&y+r.height+12<A)return{fixed:!0,left:Math.round(v)+"px"};if(T>A)return null;const L=A-r.height-8;return T=Math.min(T,L),{fixed:!1,left:Math.round(v)+"px",top:Math.round(T)+"px"}}}},getErrorCardTweaks:()=>({getKeyboardEventTarget:()=>e.ownerDocument}),getDialogAppearance:()=>({isPositionVisible:()=>!0,canDisplayAllSuggestions:()=>!0}),getMessagePopupAppearance:()=>({isVisible:()=>!0}),getMaxTextLength:(e,t)=>e.hasCustomServer()?i.MAX_TEXT_LENGTH_CUSTOM_SERVER:e.getUIState().hasPaidSubscription?i.MAX_TEXT_LENGTH_PREMIUM:"number"==typeof t?t:i.MAX_TEXT_LENGTH,getReplacedParts:e=>Ct._getReplacedParts(e,Ct.TEXT_IGNORING_DEFAULT_RULES_ARRAY,Ct.TEXT_REPLACING_DEFAULT_RULES_ARRAY),getRecipientInfo(){try{const t="BODY"===e.tagName&&"tinymce"===e.id,n="TEXTAREA"===e.tagName&&"composebody"===e.id;if(t||n){const e=window.parent.document.getElementById("_from"),t=window.parent.document.getElementById("compose-subject"),n=window.parent.document.getElementById("_to");if(e&&t&&n){const e=Ct.getEmail(n.value),t=Ct.getFullName(n.value);return Promise.resolve({address:e,fullName:t})}}}catch(e){}return Promise.resolve({address:"",fullName:""})},shouldUseParagraphLevelCaching:e=>!0,canCorrectMultipleErrorsAtOnce:()=>!0,getCheckOptions:(e,t)=>({throttlingLimit:i.CHECK_THROTTLING_LIMIT,checkTextLevel:t.length<=i.TEXT_LEVEL_MAX_LENGTH_PER_REQUEST}),filterErrors:(e,t,n)=>n,applyFix(e){const{offset:t,length:n,replacementText:s,editor:i}=e;return i.inputAreaWrapper.replaceText(t,n,s)}}},Ct.SITE_TWEAKS_RULES=[],Ct.INPUT_AREA_TWEAKS_RULES=[];var St=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};class Tt{constructor(e,t,n){this._autoDestroy=()=>{this._autoDestroyTimeout=window.setTimeout(this.destroy.bind(this),2e4)},this._document=e,this._uiOptions=n,this._controls={},this._eventListeners=[],this._render().then((()=>{n.destroysAutomatically&&this._autoDestroy()}))}static _cacheMessages(){Tt.MESSAGES={DISABLED_MESSAGE_HEADLINE:s.getMessage("messagePopupTurnOnheadline"),DISABLED_MESSAGE_TEXT:s.getMessage("messagePopupTurnOntext"),DISABLED_MESSAGE_PRIMARY_BUTTON:s.getMessage("messagePopupTurnOnPrimaryButton"),DISABLED_MESSAGE_SECONDARY_BUTTON:s.getMessage("messagePopupTurnOnSecondaryButton")}}static init(){Tt._isInitialized||(Tt._cacheMessages(),Tt._isInitialized=!0)}_render(){var e;return St(this,void 0,void 0,(function*(){if(this._controls.container)return;this._controls.container=Q(this._document,Tt.CONTAINER_ELEMENT_NAME),this._controls.container.classList.add("lt-message-container","lt-message-container--"+this._uiOptions.className),null===(e=document.firstElementChild)||void 0===e||e.appendChild(this._controls.container);const n=e=>{e.stopImmediatePropagation()};this._eventListeners.push(he(this._controls.container,"mousedown",(e=>{e.target instanceof HTMLElement&&e.target.closest("[data-lt-prevent-focus]")&&e.preventDefault(),n(e)})),he(this._controls.container,"mouseup",n),he(this._controls.container,"pointerdown",n),he(this._controls.container,"pointerup",n),he(this._controls.container,"focusin",n),he(this._controls.container,"focusout",n)),this._controls.container.addEventListener("click",n);const s=this._document.createElement("lt-div");if(s.classList.add("lt-message-container__illustration"),t.isSafari()&&s.classList.add("lt-message-container__illustration--safari"),this._controls.container.appendChild(s),this._uiOptions.isClosable&&(this._controls.closeButton=this._document.createElement("lt-div"),this._controls.closeButton.className="lt-message-container__close lt-icon__close_small",this._controls.closeButton.setAttribute("data-lt-prevent-focus",""),this._controls.container.appendChild(this._controls.closeButton),this._eventListeners.push(he(this._controls.closeButton,"click",this._onCloseButtonClicked.bind(this)))),this._uiOptions.destroysAutomatically){const e=this._document.createElement("lt-div");e.className="lt-message-container__progressbar",this._controls.container.appendChild(e)}const i=this._document.createElement("lt-div");i.className="lt-message-container__text-wrapper",this._controls.container.appendChild(i);const r=this._document.createElement("lt-span");r.className="lt-message-container__text-wrapper__headline",r.textContent=Tt.MESSAGES.DISABLED_MESSAGE_HEADLINE,i.appendChild(r);const o=this._document.createElement("lt-span");if(o.className="lt-message-container__text-wrapper__text",o.textContent=Tt.MESSAGES.DISABLED_MESSAGE_TEXT,i.appendChild(o),this._uiOptions.hasPrimaryButton||this._uiOptions.hasSecondaryButton){const e=this._document.createElement("lt-div");e.className="lt-message-container__button-wrapper",this._controls.container.appendChild(e),this._uiOptions.hasPrimaryButton&&(this._controls.primaryButton=this._document.createElement("lt-div"),this._controls.primaryButton.className="lt-message-container__button-wrapper__primary",this._controls.primaryButton.setAttribute("data-lt-prevent-focus",""),this._controls.primaryButton.textContent=Tt.MESSAGES.DISABLED_MESSAGE_PRIMARY_BUTTON,e.appendChild(this._controls.primaryButton),this._eventListeners.push(he(this._controls.primaryButton,"click",this._onPrimaryButtonClicked.bind(this)))),this._uiOptions.hasSecondaryButton&&(this._controls.secondaryButton=this._document.createElement("lt-div"),this._controls.secondaryButton.className="lt-message-container__button-wrapper__secondary",this._controls.secondaryButton.setAttribute("data-lt-prevent-focus",""),this._controls.secondaryButton.textContent=Tt.MESSAGES.DISABLED_MESSAGE_SECONDARY_BUTTON,e.appendChild(this._controls.secondaryButton),this._eventListeners.push(he(this._controls.secondaryButton,"click",this._onSecondaryButtonClicked.bind(this))))}}))}_onPrimaryButtonClicked(e){e.stopImmediatePropagation(),W.create().onReady((e=>{e.updateUIState({hasSeenTurnOnMessagePopup:!0}),e.destroy()})),this.destroy()}_onSecondaryButtonClicked(e){e.stopImmediatePropagation();const t={message:this};de(document,Tt.eventNames.turnOn,t),this.destroy()}_onCloseButtonClicked(e){e.stopImmediatePropagation(),W.create().onReady((e=>{e.updateUIState({hasSeenTurnOnMessagePopup:!0}),e.destroy()})),this.destroy()}_onUnload(){this.destroy()}destroy(){ae(this._controls.container),this._controls={},window.removeEventListener("pagehide",this._onUnload,!0),this._eventListeners.forEach((e=>{e.destroy()})),this._eventListeners=[];const e={message:this};window.clearTimeout(this._autoDestroyTimeout),de(document,Tt.eventNames.destroyed,e)}}Tt.CONTAINER_ELEMENT_NAME="lt-message",Tt.eventNames={destroyed:"lt-message.destroyed",turnOn:"lt-message.turn-on"},Tt._isInitialized=!1;class vt{constructor({language:e,label:t,description:n,parentElement:s,lifetime:i,undo:r}){this.TRANSITION_DURATION=250,this._hideTimeout=null,this._unscheduleHiding=()=>{"number"==typeof this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null)},this._rescheduleHiding=()=>{null===this._hideTimeout&&this._scheduleHiding()},this._handleMousedown=e=>e.preventDefault(),this._handleClick=()=>{this._undo(),this._hide()},this._handleKeydown=e=>{"z"===e.key&&e.getModifierState(this._getModifierKeyName())&&this._hide()},this._parentElement=s,this._language=e,this._label=t,this._description=n,this._lifetime=i,this._undo=r,this._document=s.ownerDocument}static create(e){return vt._instance&&vt._instance._remove(),vt._instance=new vt(e),vt._instance._render(),vt._instance}show(){requestAnimationFrame((()=>{var e;null===(e=this._element)||void 0===e||e.classList.add("lt-undo-notification--visible")})),this._scheduleHiding()}_render(){this._element=this._document.createElement("lt-notification"),this._element.classList.add("lt-undo-notification"),this._element.style.setProperty("--transition-duration",`${this.TRANSITION_DURATION}ms`),this._element.dataset.testid="undo";const e=this._document.createElement("lt-span");e.classList.add("lt-undo-notification__content");const t=this._document.createElement("lt-span");t.classList.add("lt-undo-notification__label"),t.textContent=this._label;const n=this._getLocalizedCommand(this._language),s=this._document.createElement("lt-span");s.classList.add("lt-undo-notification__description"),s.innerHTML=this._description.replace("%{cmd}",`<lt-span class="lt-undo-notification__description__cmd">${n}</lt-span>`),this._button=this._document.createElement("lt-span"),this._button.classList.add("lt-undo-notification__button"),this._button.addEventListener("click",this._handleClick),this._button.addEventListener("mousedown",this._handleMousedown),this._button.dataset.testid="undo-button",e.appendChild(t),e.appendChild(s),this._element.appendChild(e),this._element.appendChild(this._button),this._element.addEventListener("mouseover",this._unscheduleHiding),this._element.addEventListener("mouseout",this._rescheduleHiding),this._parentElement.appendChild(this._element),this._document.addEventListener("keydown",this._handleKeydown)}_remove(){this._element&&this._button&&(this._button.removeEventListener("click",this._handleClick),this._button.removeEventListener("mousedown",this._handleMousedown),this._element.removeEventListener("mouseover",this._unscheduleHiding),this._element.removeEventListener("mouseout",this._rescheduleHiding),this._document.removeEventListener("keydown",this._handleKeydown),this._parentElement.removeChild(this._element),this._element=void 0)}_scheduleHiding(){var e;this._hideTimeout=window.setTimeout(this._hide.bind(this),this.TRANSITION_DURATION+(null!==(e=this._lifetime)&&void 0!==e?e:0))}_hide(){var e,t;null===(e=this._element)||void 0===e||e.classList.remove("lt-undo-notification--visible"),null===(t=this._element)||void 0===t||t.classList.add("lt-undo-notification--hiding"),setTimeout((()=>this._remove()),this.TRANSITION_DURATION)}_getLocalizedCommand(e){let n=e.startsWith("de")?"Strg":"Ctrl";return n="Mac"===t.getOS()?"⌘":n,`${n} + Z`}_getModifierKeyName(){return"Mac"===t.getOS()?"Meta":"Control"}}vt._instance=null;class bt{static merge(e,t=!1){let{errors:n,pickyErrors:s,premiumErrors:r,premiumPickyErrors:o,sentenceRanges:a=[]}=this.filterAndMigrateErrors(e.existing.errors,e.existing.pickyErrors,e.existing.premiumErrors,e.existing.premiumPickyErrors,e.existing.sentenceRanges,e.existingCheckedText,e.newCheckedText);this.mergeParagraphLevelErrors(n,s,r,o,a,e.new.paragraphLevel.errors,e.new.paragraphLevel.pickyErrors,e.new.paragraphLevel.premiumErrors,e.new.paragraphLevel.premiumPickyErrors,e.new.paragraphLevel.sentenceRanges),this.mergeTextLevelErrors(n,s,r,o,e.new.textLevel.errors,e.new.textLevel.pickyErrors,e.new.textLevel.premiumErrors,e.new.textLevel.premiumPickyErrors);const l=this.getDuplicateErrors(e.existing,e.existingCheckedText,e.newCheckedText);return this.sortErrors(n,s,r,o),this.setIdsOnErrors(n,s,r,o,l),n=this.migrateErrorsToOriginalText(n,e.newCheckedText.usedParts),s=this.migrateErrorsToOriginalText(s,e.newCheckedText.usedParts),r=this.migrateErrorsToOriginalText(r,e.newCheckedText.usedParts),o=this.migrateErrorsToOriginalText(o,e.newCheckedText.usedParts),a=this.migrateErrorsToOriginalText(a,e.newCheckedText.usedParts),t&&(s=s.filter((e=>!i.PICKY_RULES_THAT_ARE_CONSIDERED_ANNOYING.includes(e.rule.id))),s.forEach((e=>{e.rule.id="HIDDEN_RULE",e.fixes=[]})),r=[...r,...o,...s],o=[],s=[],this.sortErrorsByOffset(r)),{errors:n,pickyErrors:s,premiumErrors:r,premiumPickyErrors:o,sentenceRanges:a}}static getDuplicateErrors(e,t,n){let{errors:s,pickyErrors:i,premiumErrors:r,premiumPickyErrors:o}=e;s=this.migrateErrorsToValuableText(s,t.usedParts),i=this.migrateErrorsToValuableText(i,t.usedParts),r=this.migrateErrorsToValuableText(r,t.usedParts),o=this.migrateErrorsToValuableText(o,t.usedParts);const a=C(t.text,n.text),l=e=>{if(!e.isParagraphLevelCheck)return!0;const t=T(a,(t=>{const n=t.oldOffset;if(null===t.oldText)return e.start>=n?1:-1;const s=t.oldOffset+t.oldText.length+1;return B(e.start,n,s,!0)}));return!(!t||!t.textDiff)||void 0};return s=s.filter(l),i=i.filter(l),r=r.filter(l),o=o.filter(l),s=this.migrateErrorsBetweenTexts(s,a),i=this.migrateErrorsBetweenTexts(i,a),r=this.migrateErrorsBetweenTexts(r,a),o=this.migrateErrorsBetweenTexts(o,a),{errors:s,pickyErrors:i,premiumErrors:r,premiumPickyErrors:o}}static migrateErrorsToValuableText(e,t){const n=[];for(const s of e){const e=T(t,(e=>B(s.start,e.originalStart,e.originalEnd,!0))),i=T(t,(e=>B(s.end,e.originalStart,e.originalEnd)));if(!e||!i)continue;const r=L(s);r.start-=e.posDiff,r.end-=i.posDiff,r.length=r.end-r.start,n.push(r)}return n}static migrateErrorsBetweenTexts(e,t,n,s){let i,r=!1;"string"==typeof t&&"string"==typeof n?(i=C(t,n),r="boolean"==typeof s&&s):(i=t,r="boolean"==typeof n&&n);const o=[];for(const t of e){const e=T(i,(e=>{const n=e.oldOffset;if(null===e.oldText)return t.start>=n?1:-1;const s=e.oldOffset+e.oldText.length+1;return B(t.start,n,s,!0)})),n=L(t);if(e){if(e.textDiff){if(r)continue;{const t=e.oldOffset+e.textDiff.from,s=t+e.textDiff.oldFragment.length;if(U(t,s,n.start,n.end,!0))continue;if(n.start>=s){const t=e.textDiff.newFragment.length-e.textDiff.oldFragment.length;n.start+=t,n.end+=t}}}n.start+=e.newOffset-e.oldOffset,n.end=n.start+n.length}o.push(n)}return o}static migrateErrorsToOriginalText(e,t){const n=[];for(const s of e){const e=T(t,(e=>B(s.start,e.start,e.end,!0))),i=T(t,(e=>B(s.end,e.start,e.end)));if(!e||!i)continue;const r=L(s);r.start+=e.posDiff,r.end+=i.posDiff,r.length=r.end-r.start,n.push(r)}return n}static filterAndMigrateErrors(e,t,n,s,i,r,o){e=e.filter((e=>e.isParagraphLevelCheck)),t=t.filter((e=>e.isParagraphLevelCheck)),n=n.filter((e=>e.isParagraphLevelCheck)),s=s.filter((e=>e.isParagraphLevelCheck)),e=this.migrateErrorsToValuableText(e,r.usedParts),t=this.migrateErrorsToValuableText(t,r.usedParts),n=this.migrateErrorsToValuableText(n,r.usedParts),s=this.migrateErrorsToValuableText(s,r.usedParts),i=this.migrateErrorsToValuableText(i||[],r.usedParts);const a=C(r.text,o.text);return{errors:e=this.migrateErrorsBetweenTexts(e,a,!0),pickyErrors:t=this.migrateErrorsBetweenTexts(t,a,!0),premiumErrors:n=this.migrateErrorsBetweenTexts(n,a,!0),premiumPickyErrors:s=this.migrateErrorsBetweenTexts(s,a,!0),sentenceRanges:i=this.migrateErrorsBetweenTexts(i,a,!0)}}static mergeParagraphLevelErrors(e,t,n,s,i,r,o,a,l,c=[]){e.push(...r),t.push(...o),n.push(...a),s.push(...l),i.push(...c)}static mergeTextLevelErrors(e,t,n,s,i,r,o,a){for(const t of i)e.some((e=>e.start===t.start&&e.end===t.end))||e.push(t);for(const e of r)t.some((t=>t.start===e.start&&t.end===e.end))||t.push(e);for(const e of o)n.some((t=>t.start===e.start&&t.end===e.end))||n.push(e);for(const e of a)s.some((t=>t.start===e.start&&t.end===e.end))||s.push(e)}static sortErrors(e,t,n,s){this.sortErrorsByOffset(e),this.sortErrorsByOffset(t),this.sortErrorsByOffset(n),this.sortErrorsByOffset(s)}static sortErrorsByOffset(e){e.sort(((e,t)=>e.start===t.start?e.isParagraphLevelCheck?1:-1:e.start>t.start?1:-1))}static migrateErrorsBetweenSameOriginalTexts(e,t,n){const s=[];for(const i of e){let e=i.start,r=i.end,o=T(t.usedParts,(t=>B(e,t.originalStart,t.originalEnd,!0))),a=T(t.usedParts,(e=>B(r,e.originalStart,e.originalEnd)));if(!o||!a)continue;if(e-=o.posDiff,r-=a.posDiff,o=T(n.usedParts,(t=>B(e,t.start,t.end,!0))),a=T(n.usedParts,(e=>B(r,e.start,e.end))),!o||!a)continue;e+=o.posDiff,r+=a.posDiff;const l=L(i);l.start=e,l.end=r,l.length=r-e,s.push(l)}return s}static setIdsOnErrors(e,t,n,s,i){function r(e,t){if(e.id)return;const n=t.find((t=>{return s=e,(n=t).start===s.start&&n.end===s.end&&n.isParagraphLevelCheck===s.isParagraphLevelCheck;var n,s}));e.id=n?n.id:"error:"+ ++bt.INCREMENTAL_ID}e.forEach((e=>r(e,i.errors))),t.forEach((e=>r(e,i.pickyErrors))),n.forEach((e=>r(e,i.premiumErrors))),s.forEach((e=>r(e,i.premiumPickyErrors)))}}bt.INCREMENTAL_ID=0;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class At{constructor(e,t=250,n=0){this.callImmediately=()=>{this._args&&this._wrappedFunc(...this._args),this.cancelCall()},this._wrappedFunc=e,this._delay=t,this._maxDelay=n,this._args=null,this._delayTimeoutId=null,this._maxDelayTimeoutId=null}call(...e){this.cancelCall(!0),this._args=e,this._delayTimeoutId=window.setTimeout(this.callImmediately,this._delay),this._maxDelay>0&&null===this._maxDelayTimeoutId&&(this._maxDelayTimeoutId=window.setTimeout(this.callImmediately,this._maxDelay))}cancelCall(e=!1){this._args=null,null!==this._delayTimeoutId&&(window.clearTimeout(this._delayTimeoutId),this._delayTimeoutId=null),e||null===this._maxDelayTimeoutId||(window.clearTimeout(this._maxDelayTimeoutId),this._maxDelayTimeoutId=null)}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class yt{constructor(n,s,r,o,a,l){this._highlightingAreas=[],this._width=0,this._height=0,this._currentZIndex="auto",this._lastScrollingTimeStamp=0,this._supportsCanvas=!0,this._touchStartDetails=null,this._onCEElementTouchStart=e=>{e.touches&&e.touches[0]&&(this._touchStartDetails={timestamp:Date.now(),x:e.touches[0].clientX,y:e.touches[0].clientY})},this._onCEEElementTouchEnd=e=>{if(!e.changedTouches||1!==e.changedTouches.length)return;if(!this._touchStartDetails)return;const t=Date.now()-this._touchStartDetails.timestamp;if(this._touchStartDetails=null,t>300)return;const n=e.changedTouches[0];this._handleClick(e,n.clientX,n.clientY,!0)},this._onCEElementClick=e=>{const t=0===e.button;("click"===e.type||t)&&(this._tweaks.isClickIgnored(e)||this._handleClick(e,e.clientX,e.clientY,!1))},this._handleClick=(e,t,n,s=!1)=>{if(this._isMirror&&e.stopImmediatePropagation(),!this._container)return;if(this._isHighlightingDisabled)return;this._domMeasurement.clearCache();let i={x:t,y:n};i=this._toElementCoordinates(i,this._element);let r=this._highlightedBlocks.length;for(;r--;){const t=this._highlightedBlocks[r];if(!t.textBoxes)continue;const n=t.textBoxes.find((e=>J(e,i)));if(n){const i={highlighter:this,blockId:t.id,clickedBox:this._toPageCoordinates(n,this._element)};return void(de(document,yt.eventNames.blockClicked,i)&&s&&e.preventDefault())}}},this._inputArea=n,this._inputAreaWrapper=s,this._element=r,this._isMirror=o,this._tweaks=a,this._clickEvent=l,this._highlightedText="",this._highlightedBlocks=[],this._supportsCanvas=this._tweaks.supportsCanvas(),this._domMeasurement=new K(n.ownerDocument),this._onScrollableElementScroll=this._onScrollableElementScroll.bind(this),this._onContentChanged=this._onContentChanged.bind(this),this._redrawDebounce=new At(this._redraw.bind(this),250,500),this._enableHighlightingDebounce=new At(this.enableHighlighting.bind(this),this._tweaks.scrollingThrottleLimit||0),this._tweaks.addScrollEventListener(this._onScrollableElementScroll),"standalone"===e.getType()&&t.isIOSTouchDevice()?(this._element.addEventListener("touchstart",this._onCEElementTouchStart,!0),this._element.addEventListener("touchend",this._onCEEElementTouchEnd,!0)):this._element.addEventListener(this._clickEvent,this._onCEElementClick,!0),this._element.addEventListener(pt.eventNames.click,this._onCEElementClick,!0),this._contentChangedObserver=this._tweaks.createMutationObserver(this._onContentChanged);const c=["style"];this._tweaks.attributeMutations&&c.push(...this._tweaks.attributeMutations),o||c.push("class","size","face","align");const d={attributes:!0,attributeFilter:c,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:void 0===this._tweaks.observeSubtreeMutations?!o:this._tweaks.observeSubtreeMutations};this._contentChangedObserver.observe(this._element,d),window.ResizeObserver&&(this._ceElementResizeObserver=new window.ResizeObserver((()=>this._render())),this._ceElementResizeObserver.observe(this._element)),this._renderInterval=X(this._render.bind(this),i.RENDER_INTERVAL),this._render()}_toPageCoordinates(e,t){const n=this._domMeasurement.getPaddingBox(t),s=this._getScrollPosition(!1),i=this._domMeasurement.getScaleFactor(t),r=this._domMeasurement.getZoom(t),o=Math.round((e.top-s.top)*i.y*r+n.top),a=Math.round((e.left-s.left)*i.x*r+n.left),l=Math.round(e.width*i.x*r),c=Math.round(e.height*i.y*r);return{top:o,right:a+l,bottom:o+c,left:a,width:l,height:c}}_toElementCoordinates(e,t){const n=this._domMeasurement.getPaddingBox(t,!1),s=this._getScrollPosition(),i=this._domMeasurement.getScaleFactor(t),r=this._domMeasurement.getZoom(t);return{x:Math.round((e.x-n.left+s.left)/i.x/r),y:Math.round((e.y-n.top+s.top)/i.y/r)}}_getScrollPosition(e=!0,t=e,n=!0){if(this._isMirror){let n=0,s=0;return e?(n=t?+this._element.dataset.ltScrollTopScaledAndZoomed:+this._element.dataset.ltScrollTopScaled,s=t?+this._element.dataset.ltScrollLeftScaledAndZoomed:+this._element.dataset.ltScrollLeftScaled):(n=+this._element.dataset.ltScrollTop,s=+this._element.dataset.ltScrollLeft),{top:n,left:s}}return n&&this._domMeasurement.clearCache(),this._tweaks.getScrollPosition(this._domMeasurement,e,t)}_render(e=!1){if(!this._element.parentElement||!this._inputArea.parentElement)return;this._domMeasurement.clearCache();const t=this._inputArea.ownerDocument,n=this._tweaks.getTargetElement();if(!n.parentNode)return;if(!this._container&&(this._container=Q(t,yt.CONTAINER_ELEMENT_NAME),this._container.style.display="none",Ue(this._inputArea)&&this._container.setAttribute("data-cke-temp","1"),this._wrapper=t.createElement("lt-div"),this._wrapper.setAttribute("spellcheck","false"),this._wrapper.className="lt-highlighter__wrapper",this._scrollElement=t.createElement("lt-div"),this._scrollElement.className="lt-highlighter__scroll-element",this._wrapper.appendChild(this._scrollElement),this._container.appendChild(this._wrapper),n.parentElement)){const e=this._domMeasurement.getStyle(n.parentElement,"display");"grid"!==e&&"inline-grid"!==e||this._container.classList.add("lt-highlighter--grid-item")}const s={};if(this._inputArea===t.body&&t.scrollingElement===t.documentElement&&"BackCompat"!==t.compatMode){const e=this._domMeasurement.getStyles(this._inputArea,["overflow-x","overflow-y"]);s["overflow-x"]="hidden"===e["overflow-x"]?"hidden":"visible",s["overflow-y"]="hidden"===e["overflow-y"]?"hidden":"visible"}const i=this._tweaks.getVisibleBox(this._domMeasurement);s.width=i.width+"px",s.height=i.height+"px";const r=this._domMeasurement.getStyles(this._element,["transform","transform-origin","zoom"]);s.transform=r.transform,s["transform-origin"]=r["transform-origin"],s.zoom=r.zoom,this._domMeasurement.setStyles(this._wrapper,s,!0);const o=this._isMirror?this._inputArea:n,a=this._tweaks.getZIndex(o,this._domMeasurement);a!==this._currentZIndex&&("auto"!==a&&a>0?(this._currentZIndex=a,this._domMeasurement.setStyles(this._container,{"z-index":String(a)},!0)):"auto"!==this._currentZIndex&&(this._currentZIndex="auto",this._domMeasurement.setStyles(this._container,{"z-index":"auto"},!0))),this._applyScrolling(),n.parentNode&&n.previousElementSibling!==this._container&&n.parentNode.insertBefore(this._container,n);const l=this._domMeasurement.getPaddingBox(this._wrapper,!0,!1),c=i.top-l.top;if(Math.abs(c)>.05){const e=this._domMeasurement.getScaleFactor(this._inputArea.parentElement);let t=parseFloat(this._domMeasurement.getStyle(this._wrapper,"margin-top"));t+=c/e.y,this._domMeasurement.setStyles(this._wrapper,{"margin-top":t+"px"},!0)}const d=i.left-l.left;if(Math.abs(d)>.05){const e=this._domMeasurement.getScaleFactor(this._inputArea.parentElement);let t=parseFloat(this._domMeasurement.getStyle(this._wrapper,"margin-left"));t+=d/e.x,this._domMeasurement.setStyles(this._wrapper,{"margin-left":t+"px"},!0)}const h=this._tweaks.getScrollableElementSize(this._domMeasurement);if(this._width!==h.width||this._height!==h.height){this._width=h.width,this._height=h.height;const t=this._width-i.width;t<1&&t>0&&(this._width=i.width);const n=this._height-i.height;n<1&&n>0&&(this._height=i.height),this._domMeasurement.setStyles(this._scrollElement,{width:this._width+"px",height:this._height+"px"},!0),this._updateHighlightedAreas(),e?this._redraw(!1):this._throttledRedraw(!1)}}_updateHighlightedAreas(){const e=[];for(let t=0;t<this._width;t+=yt.CANVAS_MAX_WIDTH)for(let n=0;n<this._height;n+=yt.CANVAS_MAX_HEIGHT){const s={top:n,right:t+yt.CANVAS_MAX_WIDTH,bottom:n+yt.CANVAS_MAX_HEIGHT,left:t,width:yt.CANVAS_MAX_WIDTH,height:yt.CANVAS_MAX_HEIGHT};let i=this._highlightingAreas.find((e=>j(e.cell,s)));if(!i){const e=this._inputArea.ownerDocument.createElement("canvas");if(e.className="lt-highlighter__canvas",e.width=0,e.height=0,this._domMeasurement.setStyles(e,{display:"none"}),i={cell:s,canvas:e,context:e.getContext("2d"),drawnItems:new Map},!this._supportsCanvas){const e=this._inputArea.ownerDocument.createElement("img");e.className="lt-highlighter__canvas",e.width=0,e.height=0,this._domMeasurement.setStyles(e,{display:"none"}),i.image=e}}e.push(i)}for(const t of this._highlightingAreas){const n=t.image||t.canvas;!e.includes(t)&&n.parentElement&&n.parentElement.removeChild(n)}this._highlightingAreas=e}_throttledRedraw(e=!0){this._inputAreaWrapper.getText().length>i.MAX_TEXT_LENGTH_PERFORMANCE_DEGRADATION?this._redrawDebounce.call(e):this._redraw(e)}_redraw(e=!0){if(e&&this._domMeasurement.clearCache(),!this._highlightingAreas.length)return;this._highlightedText=this._inputAreaWrapper.getText();const t=this._getScrollPosition(!0,!1,!1),n=this._tweaks.getScrollableElementSize(this._domMeasurement);for(const e of this._highlightedBlocks)e.textRanges=this._inputAreaWrapper.getTextRanges(e.offset,e.length),e.textBoxes=this._tweaks.getTextBoxes(this._domMeasurement,e.textRanges,this._element,t),e.textBoxes.forEach((e=>{const t=e.width<10?3:1;e.left=Math.max(0,e.left-t),e.right=Math.min(n.width,e.right+t),e.width=e.right-e.left,e.top=Math.max(0,e.top),e.bottom=Math.min(n.height,e.bottom),e.height=e.bottom-e.top}));const s=[];for(const e of this._highlightedBlocks)for(const t of e.textBoxes){if(e.simulateSelection&&s.push({top:t.bottom-yt.LINE_WIDTH/2,right:t.right,bottom:t.bottom+yt.LINE_WIDTH/2,left:t.left,width:t.width,height:yt.LINE_WIDTH,color:e.underlineColor,textBox:t}),e.isEmphasized){const n=t.bottom-yt.LINE_WIDTH/2;s.push({top:t.top,right:t.right,bottom:n,left:t.left,width:t.width,height:n-t.top,color:e.backgroundColor,textBox:t})}if(e.isUnderlined){let i=t.bottom-yt.LINE_WIDTH/2,r=t.bottom+yt.LINE_WIDTH/2;r>n.height&&(i-=1,r-=1),s.push({top:i,right:t.right,bottom:r,left:t.left,width:t.width,height:yt.LINE_WIDTH,color:e.underlineColor,textBox:t})}}for(const e of this._highlightingAreas){const t=s.filter(Z.bind(null,e.cell));if(!t.length){delete e.canvasBox,e.drawnItems.clear();const t=e.image||e.canvas;t.parentElement&&t.parentElement.removeChild(t);continue}let n={top:Number.MAX_VALUE,right:0,bottom:0,left:Number.MAX_VALUE,width:0,height:0};for(const e of t)n.top=Math.min(n.top,e.top,e.textBox.top),n.right=Math.max(n.right,e.right,e.textBox.right),n.bottom=Math.max(n.bottom,e.bottom,e.textBox.bottom),n.left=Math.min(n.left,e.left,e.textBox.left);n.top=Math.max(e.cell.top,n.top),n.right=Math.min(e.cell.right,n.right),n.bottom=Math.min(e.cell.bottom,n.bottom),n.left=Math.max(e.cell.left,n.left),n.width=n.right-n.left,n.height=n.bottom-n.top;const o=!e.canvasBox||e.canvasBox.width<n.width||e.canvasBox.height<n.height||e.canvasBox.width*e.canvasBox.height/(n.width*n.height)>=2,a=!(o||(i=e.canvasBox,r=n,i.left<=r.left&&i.right>=r.right&&i.top<=r.top&&i.bottom>=r.bottom));if(o){const t=!e.canvasBox||e.canvasBox.top!==n.top||e.canvasBox.left!==n.left;e.canvas.width=n.width,e.canvas.height=n.height,e.image&&(e.image.width=n.width,e.image.height=n.height),e.canvasBox=n,e.drawnItems.clear();const s=e.image||e.canvas;t&&this._domMeasurement.setStyles(s,{top:e.canvasBox.top+"px",left:e.canvasBox.left+"px"},!0),s.parentElement||this._scrollElement.appendChild(s)}else if(a){const t=e.image||e.canvas;e.canvasBox.top=n.top,e.canvasBox.right=n.left+e.canvasBox.width,e.canvasBox.bottom=n.top+e.canvasBox.height,e.canvasBox.left=n.left,this._domMeasurement.setStyles(t,{top:e.canvasBox.top+"px",left:e.canvasBox.left+"px"},!0)}let l=new Map;for(const n of t){const t=Math.max(n.left-e.canvasBox.left,0),s=Math.min(n.right-e.canvasBox.left,e.canvasBox.width),i=Math.max(n.top-e.canvasBox.top,0),r=Math.min(n.bottom-e.canvasBox.top,e.canvasBox.height),o=s-t,a=r-i,c={top:i,right:s,bottom:r,left:t,width:o,height:a,color:n.color},d={x:t,y:i,w:o,h:a,c:n.color};l.set(JSON.stringify(d),c)}let c=[],d=!1;for(const[t,n]of l)e.drawnItems.delete(t)||(c.push(n),d=!0);let h=Array.from(e.drawnItems.values());const _=h.length;_>0&&(d=!0);if(_>20&&(e.canvas.width=e.canvasBox.width,c=Array.from(l.values()),h=[]),e.drawnItems=l,!d)continue;const u=Array.from(l.values());for(const t of h){e.context.clearRect(t.left,t.top,t.width,t.height);for(const e of u){if(Z(e,t)){const n=Math.max(e.top,t.top),s=Math.min(e.right,t.right),i=Math.min(e.bottom,t.bottom),r=Math.max(e.left,t.left),o=i-n;if(0===s-r||0===o)continue;const a={top:n,right:s,bottom:i,left:r,width:s-r,height:i-n,color:e.color};c.some((e=>e.color===a.color&&j(e,a)))||c.push(a)}}}for(const e of c){let t=!1;for(const n of u){if(!t){t=e===n;continue}if(Z(n,e)){const t=Math.max(n.top,e.top),s=Math.min(n.right,e.right),i=Math.min(n.bottom,e.bottom),r=Math.max(n.left,e.left);c.push({top:t,right:s,bottom:i,left:r,width:s-r,height:i-t,color:n.color})}}}for(const t of c)e.context.fillStyle=t.color,e.context.fillRect(t.left,t.top,t.width,t.height);e.image&&(e.image.src=e.canvas.toDataURL())}var i,r}_applyScrolling(){const e=this._getScrollPosition(!1),t=-e.top+"px",n=-e.left+"px";this._domMeasurement.setStyles(this._scrollElement,{top:t,left:n},!0)}_onScrollableElementScroll(){if(!this._container)return;const e=Date.now(),t=this._isHighlightingDisabled||!!this._tweaks.scrollingThrottleLimit&&e-this._lastScrollingTimeStamp<this._tweaks.scrollingThrottleLimit;this._lastScrollingTimeStamp=e,t?(this.disableHighlighting(),this._enableHighlightingDebounce.call()):window.requestAnimationFrame((()=>{this._applyScrolling()}))}_onContentChanged(e){if(!this._container)return;const t=this._inputAreaWrapper.getText(),n=e.some((e=>{if("attributes"===e.type)return!0;if(this._isMirror&&!this._tweaks.observeSubtreeMutations)return!1;if(Array.from(e.addedNodes||[]).some((e=>e.nodeType===document.ELEMENT_NODE)))return!0;return!!Array.from(e.removedNodes||[]).some((e=>e.nodeType===document.ELEMENT_NODE))}));(this._highlightedText!==t||n)&&this._throttledRedraw()}disableHighlighting(){this._isHighlightingDisabled||(this._isHighlightingDisabled=!0,this._wrapper&&this._wrapper.classList.add("lt-highlighter__wrapper-invisible"))}enableHighlighting(){this._isHighlightingDisabled&&(this._isHighlightingDisabled=!1,this._wrapper&&(this._redraw(),this._wrapper.classList.remove("lt-highlighter__wrapper-invisible")))}highlight(e=[],t=!1){this._highlightedBlocks=e,t?this._redraw():this._throttledRedraw()}getTextBoxes(e){const t=this._highlightedBlocks.find((t=>t.id===e));return t&&t.textBoxes?t.textBoxes.map((e=>this._toPageCoordinates(e,this._element))):[]}destroy(){this._tweaks.removeScrollEventListener(this._onScrollableElementScroll),this._element.removeEventListener(this._clickEvent,this._onCEElementClick,!0),this._element.removeEventListener(pt.eventNames.click,this._onCEElementClick),this._element.removeEventListener("touchstart",this._onCEElementTouchStart,!0),this._element.removeEventListener("touchend",this._onCEEElementTouchEnd,!0),this._contentChangedObserver.disconnect(),this._renderInterval&&this._renderInterval.destroy(),this._container&&this._container.remove(),this._ceElementResizeObserver&&this._ceElementResizeObserver.disconnect(),this._redrawDebounce.cancelCall(),this._enableHighlightingDebounce.cancelCall(),this._domMeasurement.clearCache()}}yt.CONTAINER_ELEMENT_NAME="lt-highlighter",yt.CANVAS_MAX_WIDTH=1024,yt.CANVAS_MAX_HEIGHT=1024,yt.LINE_WIDTH=2,yt.eventNames={blockClicked:"lt-highlighter.blockClicked"};const Lt=/^[a-zA-Z\u{C0}-\u{FF}\u{D8}-\u{F6}\u{F8}-\u{2C6}\u{2C8}-\u{2D7}\u{2DE}-\u{2FF}\u{1E00}-\u{1EFF}]+$/u,It=/\S/;class Nt{static isRewrite(e){return e.filter((({added:e})=>!0===e)).map((({value:e})=>e)).join("").length/Nt.toNewString(e).length>=.7}static toNewString(e){return e.filter((({removed:e})=>!1===Boolean(e))).map((({value:e})=>e)).join("")}static ignoreCaseChangeAtBeginning(e){var t,n,s,i,r,o;const[a,l,c,d]=e,h=!0===l.added&&"string"==typeof l.value&&!0===(null==d?void 0:d.removed)&&(null===(t=null==d?void 0:d.value)||void 0===t?void 0:t.trim().endsWith(l.value.toLocaleLowerCase()));if(!0!==a.removed||!1===h||""!==(null===(s=null===(n=null==c?void 0:c.value)||void 0===n?void 0:n.trim)||void 0===s?void 0:s.call(n)))return e;const _=null===(i=null==d?void 0:d.value)||void 0===i?void 0:i.replace(String(l.value).toLocaleLowerCase(),"").replace(/\s+$/," ");return[{value:(a.value?`${a.value} `:"")+_,count:null!==(r=null==d?void 0:d.count)&&void 0!==r?r:0,removed:!0},{value:null!==(o=l.value+(null==c?void 0:c.value))&&void 0!==o?o:"",count:0},...e.slice(4)]}compute(e,t){const n=this.removeEmpty(this.tokenize(e)),s=this.removeEmpty(this.tokenize(t));let i=s.length,r=n.length,o=1,a=i+r,l=[{newPos:-1,components:[]}],c=this.extractCommon(l[0],s,n,0);if(l[0].newPos+1>=i&&c+1>=r)return[{value:this.join(s),count:s.length}];const d=()=>{for(let t=-1*o;t<=o;t+=2){let o;const a=l[t-1],c=l[t+1];let d=(c?c.newPos:0)-t;a&&(l[t-1]=void 0);const h=a&&a.newPos+1<i,_=c&&0<=d&&d<r;if(h||_){if(!h||_&&a.newPos<c.newPos?(o={newPos:(e=c).newPos,components:e.components.slice(0)},this.pushComponent(o.components,void 0,!0)):(o=a,o.newPos++,this.pushComponent(o.components,!0,void 0)),d=this.extractCommon(o,s,n,t),o.newPos+1>=i&&d+1>=r)return xt(this,o.components,s,n);l[t]=o}else l[t]=void 0}var e;o++};for(;o<=a;){let e=d();if(e)return e}}pushComponent(e,t,n){let s=e[e.length-1];s&&s.added===t&&s.removed===n?e[e.length-1]={count:s.count+1,added:t,removed:n}:e.push({count:1,added:t,removed:n})}extractCommon(e,t,n,s){let i=t.length,r=n.length,o=e.newPos,a=o-s,l=0;for(;o+1<i&&a+1<r&&this.equals(t[o+1],n[a+1]);)o++,a++,l++;return l&&e.components.push({count:l}),e.newPos=o,a}removeEmpty(e){let t=[];for(let n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}equals(e,t){return e===t||!It.test(e)&&!It.test(t)}tokenize(e){const t=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/);for(let e=0;e<t.length-1;e++)!t[e+1]&&t[e+2]&&Lt.test(t[e])&&Lt.test(t[e+2])&&(t[e]+=t[e+2],t.splice(e+1,2),e--);return t}join(e){return e.join("")}}function xt(e,t,n,s){let i=0,r=t.length,o=0,a=0;for(;i<r;i++){let r=t[i];if(r.removed){if(r.value=e.join(s.slice(a,a+r.count)),a+=r.count,i&&t[i-1].added){let e=t[i-1];t[i-1]=t[i],t[i]=e}}else{if(r.added)r.value=e.join(n.slice(o,o+r.count));else{const t=n.slice(o,o+r.count).map(((e,t)=>{let n=s[a+t];return n.length>e.length?n:e}));r.value=e.join(t)}o+=r.count,r.added||(a+=r.count)}}let l=t[r-1];return r>1&&"string"==typeof l.value&&(l.added||l.removed)&&e.equals("",l.value)&&(t[r-2].value+=l.value,t.pop()),t}var kt=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};class wt{constructor(e,t,n,s,i,r,o,a,l,c,d,h,_,u,g,m,p){this.PHRASES_BATCH_SIZE=3,this._rendered=!1,this._destroyed=!1,this._visiblePhraseBatches=1,this._selectedVariant=null,this._userRevertedSentence=!1,this._handleConfirmation=e=>{this._content&&this._confirmation&&this._content.removeChild(this._confirmation),this._updateGPT3Confirmation(!0),e(),V.trackEvent("Action","rephrasesV2:privacy_confirmed",this._language)},this._uniqueId=e,this._container=t,this._document=t.ownerDocument,this._editorText=n,this._language=H.getPrimaryLanguageCode(s),this._userLanguage=i,this._preferredLanguages=r,this._dpaLevel=o,this._confirmedGPT3=a,this._country=l,this._hasSubscription=c,this._anchorSelection=d,this._host=h,this._hasGrammarMistakes=_,this._hasSpellingMistakes=u,this._getSentenceRanges=g,this._hasValidSentenceRanges=m,this._updateGPT3Confirmation=p}static _cacheMessages(){const e=t.isSafari()?"https://languagetool.org/legal/privacy/?hidePremium=true#rephrasing":"https://languagetool.org/legal/privacy/#rephrasing";wt.MESSAGES={HEADLINE:s.getMessage("phrasesCardHeadline"),PHRASE_PREFIX:s.getMessage("phrasesCardSentencePrefix"),LOADING:s.getMessage("synonymsCardLoading"),NO_SENTENCE:s.getMessage("phrasesCardNoSentence"),NO_RESULT:s.getMessage("phrasesCardNoResult"),NOT_SUPPORTED_HEADING:s.getMessage("phrasesCardNotSupportedHeading"),NOT_SUPPORTED_TEXT:s.getMessage("phrasesCardNotSupportedText"),ERROR:s.getMessage("phrasesCardGeneralError"),TIMEOUT:s.getMessage("phrasesCardTimeoutError"),LABEL_FORMALITY:s.getMessage("phrasesCardLabelFormality"),LABEL_PARAPHRASE:s.getMessage("phrasesCardLabelParaphrase"),LABEL_FLUENCY:s.getMessage("phrasesCardLabelFluency"),LABEL_SHORTENED:s.getMessage("phrasesCardLabelShortened"),LABEL_SIMPLICITY:s.getMessage("phrasesCardLabelSimplicity"),LABEL_USER_:"Source sentence",CONFIRMATION_HEADING:s.getMessage("phrasesCardConfirmationHeading"),CONFIRMATION_TEXT:s.getMessage("phrasesCardConfirmationText",[e]),CONFIRMATION_BUTTON:s.getMessage("phrasesCardConfirmationButton")}}static init(){wt._isInitialized||(wt._cacheMessages(),s.addEventListener(n.eventNames.localeChanged,wt._cacheMessages.bind(wt)),wt._isInitialized=!0)}static isSupportedLanguage(e){return wt.REPHRASE_SENTENCE_LANGUAGES.some((t=>e.startsWith(t)))}get ADJUSTED_BATCH_SIZE(){var e;const t="string"==typeof(null===(e=this._phrasesResult)||void 0===e?void 0:e.previousSentence)?1:0;return this.PHRASES_BATCH_SIZE-t}get _phrase(){return this._selection?this._editorText.slice(this._selection.start,this._selection.end):""}get _isEnabled(){return wt.isSupportedLanguage(this._language)}get _isAllowed(){return!0===this._confirmedGPT3||"standalone"===e.getType()||!0===this._inhouseOnly}get _inhouseOnly(){return 1===this._dpaLevel}render(){var e;this._rendered||this._destroyed||(this._content=this._document.createElement("lt-div"),this._content.classList.add("lt-card__pane__content"),null===(e=this._container)||void 0===e||e.appendChild(this._content),this._rendered=!0)}show(){this._content&&this._content.classList.remove("lt-card__pane__content--hidden"),this._checkConfirmation((()=>{this._isEnabled?(this._renderPhrasesPlaceholder(),this._selection=this._getSentence(),this._selection?(this._loadRephrasings(),this._host.updateSelection(this._selection),this._host.dispatchHighlight(),this._renderText()):this._setMessage(wt.MESSAGES.NO_SENTENCE)):this._renderNotSupportedMessage(),this._host.position(),V.trackEvent("Action","rephrasesV2:open",this._language+":"+(this._isEnabled?"enabled":"disabled"))}))}hide(){this._content&&this._content.classList.add("lt-card__pane__content--hidden")}destroy(){this._reportPhrase(),this._destroyed=!0}_setMessage(e){if(this._phrases){const t=this._document.createElement("lt-div");t.classList.add("lt-rephrasecontent__message"),t.textContent=e,this._phrases.innerHTML="",this._phrases.appendChild(t)}}_renderText(e){if(!this._content)return;const t=(null==e?void 0:e.reduce(((e,t)=>(!0!==t.added&&(e+=!0===t.removed?'<lt-span class="lt-phrasescontent__sentence__removal">':"",e+=t.value,e+=!0===t.removed?"</lt-span>":""),e)),""))||this._phrase;this._text=this._text||this._document.createElement("lt-div"),this._text.classList.add("lt-phrasescontent__sentence"),this._text.innerHTML=`${wt.MESSAGES.PHRASE_PREFIX}: "${t.trim()}"`,this._content.contains(this._text)||(this._phrases?this._content.insertBefore(this._text,this._phrases):this._content.appendChild(this._text))}_renderPhrasesPlaceholder(){this._content&&!this._phrases&&(this._phrases=this._document.createElement("lt-div"),this._phrases.classList.add("lt-phrasescontent__phrases"),this._setMessage(wt.MESSAGES.LOADING),this._content.appendChild(this._phrases))}_createLabel(e){const t=`LABEL_${e.toUpperCase()}`,n=wt.MESSAGES[t];if(void 0===n)return this._document.createTextNode("");const s=this._document.createElement("lt-span");return s.classList.add("lt-phrasescontent__row__label"),s.textContent=n,s}_renderPhrases(){if(this._content&&this._phrasesResult&&this._phrases){if(!this._previousSentence&&this._phrasesResult.previousSentence){const e=[{value:this._phrasesResult.previousSentence,added:!0,count:0}];this._previousSentence=this._renderVariantSelector(e,{label:"user_",origin:"user",score:{},uuid:"00000000-0000-4000-A000-000000000000",text:this._phrasesResult.previousSentence},"lt-phrasescontent__previous-sentence"),this._content.insertBefore(this._previousSentence,this._phrases)}this._phrasesHeadline||(this._phrasesHeadline=this._document.createElement("lt-div"),this._phrasesHeadline.classList.add("lt-card__headline","lt-card__headline--rephrase"),this._phrasesHeadline.textContent=wt.MESSAGES.HEADLINE,this._content.insertBefore(this._phrasesHeadline,this._phrases)),this._phrases.innerHTML="",this._phrases.classList.toggle("lt-phrasescontent__phrases--shortened",this.ADJUSTED_BATCH_SIZE<this.PHRASES_BATCH_SIZE),this._hasDanglingItem()&&(this._visiblePhraseBatches+=1);for(let n of this._phrasesResult.phrases){if(this._phrase.trim()===n.text.trim())continue;const s=Nt.ignoreCaseChangeAtBeginning((e=this._phrase,t=n.text,(new Nt).compute(e,t)||[]));if(0===s.length)continue;const i=this._renderVariantSelector(s,n,"lt-phrasescontent__row"),r=this._renderText.bind(this,s),o=this._renderText.bind(this,void 0);i.dataset.testid="rephrase-suggestion",this._host.addEventListener(he(i,"mouseover",r)),this._host.addEventListener(he(i,"mouseout",o)),this._phrases.appendChild(i)}var e,t;this._renderLoadMore(),this._updatePagination(),this._host.position()}}_renderLoadMore(){if(!this._phrases||!this._phrasesResult)return;const{wrapper:e,button:t}=this._host.createLoadMoreButton("rephrasings");this._host.addEventListener(he(t,"click",(e=>{e.stopImmediatePropagation(),this._showMorePhrases()}))),this._host.addInteractiveElement(t,(()=>{var e;const t=`.lt-phrasescontent__row:nth-child(${this.ADJUSTED_BATCH_SIZE*this._visiblePhraseBatches})`,n=null===(e=this._phrases)||void 0===e?void 0:e.querySelector(t);n&&this._showMorePhrases(n)})),this._loadMore=e,this._phrases.appendChild(this._loadMore)}_renderVariantSelector(e,t,...n){const s=this._document.createElement("lt-div"),i=this._onPhraseClick.bind(this,t);return s.classList.add(...n),s.appendChild(this._createLabel(t.label)),this._host.addEventListener(he(s,"click",i)),this._host.addInteractiveElement(s,i),this._renderNiceDiff(s,e),s}_renderNiceDiff(e,t){const n=this._document.createElement("lt-div");for(const e of t){if(Nt.isRewrite(t)){n.textContent=Nt.toNewString(t);break}if(!e.value||!0===e.removed)continue;let s=this._document.createTextNode(e.value);if(e.added){const t=s;s=this._document.createElement("lt-span"),s.classList.add("lt-phrasescontent__diff-item"),s.classList.toggle("lt-phrasescontent__diff-item--added",!0===e.added),s.appendChild(t)}n.appendChild(s)}e.appendChild(n)}_renderNotSupportedMessage(){if(!this._content||this._notSupported)return;this._notSupported=this._document.createElement("lt-div"),this._notSupported.classList.add("lt-phrasescontent__not-supported");const e=this._document.createElement("lt-div");e.classList.add("lt-phrasescontent__not-supported__image");const t=this._document.createElement("lt-div");t.classList.add("lt-phrasescontent__not-supported__heading"),t.textContent=wt.MESSAGES.NOT_SUPPORTED_HEADING;const n=this._document.createElement("lt-div");n.classList.add("lt-phrasescontent__not-supported__text"),n.innerHTML=wt.MESSAGES.NOT_SUPPORTED_TEXT,this._notSupported.appendChild(e),this._notSupported.appendChild(t),this._notSupported.appendChild(n),this._content.appendChild(this._notSupported)}_updatePagination(){var e,t;if(!this._phrases)return;const n=null!==(t=null===(e=this._phrasesResult)||void 0===e?void 0:e.phrases.length)&&void 0!==t?t:0,s=this.ADJUSTED_BATCH_SIZE*this._visiblePhraseBatches,i=n>s;this._phrases.classList.toggle("lt-phrasescontent__phrases--truncated",i),this._phrases.dataset.visibleItems=String(s),this._phrases.dataset.testid="rephrase-list"}_showMorePhrases(e){var t,n;this._visiblePhraseBatches+=1,this._hasDanglingItem()&&(this._visiblePhraseBatches+=1),this._host.clearDomMeasurementCache(),this._updatePagination(),null===(n=(t=this._host).updateFocus)||void 0===n||n.call(t,null!==e?e:void 0)}_onPhraseClick(e,t){var n;t&&t.stopImmediatePropagation(),this._userRevertedSentence="user_"===e.label;const s=this._userRevertedSentence?"reverted":"selected";this._selectedVariant=e.text,this._host.dispatchRephraseClick(e.text),"number"==typeof(null===(n=this._selection)||void 0===n?void 0:n.start)&&this._host.dispatchFlashSentence(this._selection.start,e.text.length),V.trackEvent("Action",`rephrasesV2:${s}`,`${this._language}:${e.label}`)}_loadRephrasings(){return kt(this,void 0,void 0,(function*(){try{this._phrasesResult=yield e.loadPhrases(Pe(this._uniqueId),this._phrase,this._language,this._inhouseOnly),this._phrasesResult.phrases.length?this._renderPhrases():(V.trackEvent("Action","rephrasesV2:no_results",this._language),this._setMessage(wt.MESSAGES.NO_RESULT))}catch(e){const t="ServerTimeout"===e.message?wt.MESSAGES.TIMEOUT:wt.MESSAGES.ERROR;this._setMessage(t),V.trackError("Action","rephrasesV2:load_failed",`${this._language}:${e.message}`)}}))}_reportPhrase(){var t;return kt(this,void 0,void 0,(function*(){let n=!1,s="Request failed";if(this._phrasesResult&&!navigator.webdriver&&!this._userRevertedSentence){try{const t=Math.min(this._visiblePhraseBatches*this.ADJUSTED_BATCH_SIZE,this._phrasesResult.phrases.length);n=yield e.reportPhrase(Pe(this._uniqueId),{app:"extension",rephrases:this._phrasesResult.phrases.slice(0,t).map((({label:e,origin:t,text:n})=>({label:e,origin:t,text:n}))),country:this._country,hostname:location.hostname,hasSubscription:this._hasSubscription,userLanguage:this._userLanguage,textLanguage:this._language,userAgent:navigator.userAgent,preferredLanguages:this._preferredLanguages,hardwareConcurrency:navigator.hardwareConcurrency,hasGrammarMistakes:this._hasGrammarMistakes,hasSpellingMistakes:this._hasSpellingMistakes,chosenSentence:this._selectedVariant,originalSentence:this._phrase})}catch(e){s=null!==(t=e.message)&&void 0!==t?t:""}n||V.trackError("other","phrases_card:report_failed",s)}}))}_getSentence(){var e;if(this._selection)return this._selection;if(!1===this._hasValidSentenceRanges())return;const t=null===(e=this._getSentenceRanges())||void 0===e?void 0:e.find((({start:e,end:t})=>e<=this._anchorSelection.start&&t>=this._anchorSelection.end));if("number"==typeof(null==t?void 0:t.start)&&"number"==typeof(null==t?void 0:t.end)){const{start:e,end:n}=t;return{start:e,end:n}}}_hasDanglingItem(){return!!this._phrasesResult&&this._phrasesResult.phrases.length-this._visiblePhraseBatches*this.ADJUSTED_BATCH_SIZE==1}_checkConfirmation(e){var t;if(this._isAllowed||!1===this._isEnabled)return e();if(this._confirmation)return;this._confirmation=this._document.createElement("lt-div"),this._confirmation.classList.add("lt-phrases-confirmation"),this._confirmation.classList.add("lt-phrases-confirmation--"+this._language);const n=this._document.createElement("lt-div");n.classList.add("lt-phrases-confirmation__content");const s=this._document.createElement("lt-div");s.classList.add("lt-phrases-confirmation__heading"),s.textContent=wt.MESSAGES.CONFIRMATION_HEADING;const i=this._document.createElement("lt-div");i.classList.add("lt-phrases-confirmation__text"),i.innerHTML=wt.MESSAGES.CONFIRMATION_TEXT;const r=this._document.createElement("lt-span");r.classList.add("lt-phrases-confirmation__button"),r.textContent=wt.MESSAGES.CONFIRMATION_BUTTON,this._host.addEventListener(he(r,"click",this._handleConfirmation.bind(this,e))),n.appendChild(s),n.appendChild(i),n.appendChild(r),this._confirmation.appendChild(n),null===(t=this._content)||void 0===t||t.appendChild(this._confirmation),V.trackEvent("Action","rephrasesV2:privacy_confirmation_required",this._language)}}wt.REPHRASE_SENTENCE_LANGUAGES=["en","de"],wt._isInitialized=!1;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Mt{static _contructor(){this._isInitialized||(this._isPlaying=!1,this._isInitialized=!0)}static supportsLanguage(e){return["de","en","es","fr","it","nl","pl","pt","ru"].includes(e.toLowerCase().substr(0,2))}static supportsWord(e){return!["languagetool"].includes(e.toLowerCase())}static _getVoices(e){this.isSupported()&&(window.speechSynthesis.getVoices().length?e(window.speechSynthesis.getVoices()):speechSynthesis.onvoiceschanged=function(){e(window.speechSynthesis.getVoices())})}static _findVoice(e,t){let n=t.toLowerCase();"en-au"!==n&&"en-nz"!==n||(n="en-gb");for(const t of e)if(t.lang.toLowerCase()===n&&t.name.toLowerCase().indexOf("google")>-1)return t;n=n.substr(0,2);for(const t of e)if(t.lang.substr(0,2).toLowerCase()===n&&t.name.toLowerCase().indexOf("google")>-1)return t;for(const t of e)if(t.lang.substr(0,2).toLowerCase()===n)return t;return null}static _createUtterance(e,t,n=!1,s,i){const r=new SpeechSynthesisUtterance;r.voice=t,r.text=e,r.lang=s,r.rate=.8;const o=this;return n&&r.addEventListener("end",(function(){o.stop(),i()})),r.addEventListener("error",(function(){o.stop(),i()})),r}static playMany(e,t,n,s=500){const i=[...e],r=()=>{const e=i.shift();e?this.play(e,t,(()=>{setTimeout(r,s)})):n()};r()}static play(e,t,n){this._getVoices((s=>{const i=this._findVoice(s,t);if(this._isPlaying=!0,i){const s=this._createUtterance(e,i,!0,t,n);speechSynthesis.speak(s),V.trackEvent("Action","speak_word")}}))}static stop(){this._isPlaying=!1,speechSynthesis.cancel()}static isSupported(){return window.speechSynthesis&&"function"==typeof window.speechSynthesis.getVoices&&t.isChrome()&&!navigator.userAgent.includes("Chromium")}static isPlaying(){return this._isPlaying}}Mt._isInitialized=!1,Mt._contructor();var Rt=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};class Pt{constructor(e,t,n,s,i){this.SYNONYMS_BATCH_SIZE=3,this.MAX_SYNONYMS_PER_ROW=3,this._rendered=!1,this._tts=[],this._destroyed=!1,this._visibleSynonymBatches=1,this._container=e,this._document=e.ownerDocument,this._wordContext=t,this._language=n,this._motherLanguage=s,this._host=i,this._tts=[t.word],this.selection={start:t.position.start,end:t.position.end}}static _cacheMessages(){Pt.MESSAGES={HEADLINE:s.getMessage("synonymsCardHeadline"),LOADING:s.getMessage("synonymsCardLoading"),ERROR:s.getMessage("synonymsCardGeneralError"),NO_SYNONYMS_FOUND:s.getMessage("synonymsCardNoSynonymsAvailable"),LANGUAGE_NOT_SUPPORTED:s.getMessage("synonymsCardLanguageNotSupported"),READ_TEXT:s.getMessage("synonymsCardTooltipReadText"),MORE:s.getMessage("synonymsCardMore")}}static init(){Pt._isInitialized||(Pt._cacheMessages(),s.addEventListener(n.eventNames.localeChanged,Pt._cacheMessages.bind(Pt)),Pt._isInitialized=!0)}render(){var e,t;return Rt(this,void 0,void 0,(function*(){if(!this._rendered&&!this._destroyed)return this._host.addEventListener(he(this._container,"mousedown",(e=>{e.stopImmediatePropagation(),e.target&&!e.target.closest(".lt-synonymscontent__synonym-title, .lt-card__headline")&&e.preventDefault()}))),this._content=this._document.createElement("lt-div"),this._content.classList.add("lt-card__pane__content"),this._intro=this._document.createElement("lt-div"),this._intro.classList.add("lt-synonymscontent__intro"),null===(e=this._content)||void 0===e||e.appendChild(this._intro),this._renderIntro(),this._renderSynonymsPlaceholder(),null===(t=this._container)||void 0===t||t.appendChild(this._content),this._rendered=!0,this._loadSynonyms()}))}show(){this._content&&(this._content.classList.remove("lt-card__pane__content--hidden"),this._host.position()),this._host.updateSelection(this.selection),this._host.dispatchHighlight()}hide(){this._content&&this._content.classList.add("lt-card__pane__content--hidden")}destroy(){this._destroyed=!0}_setMessage(e){if(this._synonyms){const t=this._document.createElement("lt-div");t.classList.add("lt-rephrasecontent__message"),t.textContent=e,this._synonyms.innerHTML="",this._synonyms.appendChild(t)}}_loadSynonyms(){let t,n=H.getPrimaryLanguageCode(this._language);const s=new Promise((e=>t=e));if("de-ch"===this._language.toLowerCase()&&(n="de-CH"),-1===i.SUPPORTED_SYNONYM_LANGUAGES.indexOf(n))return this.render(),this._renderIntro(),this._setMessage(Pt.MESSAGES.LANGUAGE_NOT_SUPPORTED),requestAnimationFrame((()=>t())),s;const r=Date.now(),o=window.setTimeout((()=>{this.render(),t()}),400);return e.loadSynonyms(this._wordContext,n,this._motherLanguage).then((e=>{window.clearTimeout(o);const t=Date.now()-r;return z(Math.max(0,400-t),e)})).then((e=>{this._destroyed||(this._synonymResult=e,this.render(),this._renderIntro(),this._renderSynonyms(),this._host.updateFocus(),t(),e.genders&&e.genders.length&&(this._tts=[],e.genders[0].display.toLowerCase().includes(this._wordContext.word.toLowerCase())||this._tts.push(this._wordContext.word),e.genders.forEach((e=>{this._tts.push(e.display)}))))})).catch((e=>{this._destroyed||(window.clearTimeout(o),this.render(),this._renderIntro(),this._setMessage(Pt.MESSAGES.ERROR),t(),V.trackEvent("Other-Error","synonym_card:load_failed",e&&e.message))})),s}_renderIntro(){var e,t;if(!this._intro)return;const n=null===(e=this._synonymResult)||void 0===e?void 0:e.genders;let s;if(this._intro.innerHTML="",null==n?void 0:n.length){const[e,...t]=n[0].display.split(/\s+/),i=n.map((({displayType:e})=>e)).filter(Boolean),r=n.map((({display:e})=>e.split(/\s+/).shift()));s=this._createCaption(`${r.join("/")} ${t.join(" ")}`,i.join("/"))}else s=this._createCaption(this._wordContext.word);if(this._intro.appendChild(s),Mt.isSupported()&&Mt.supportsLanguage(this._language)&&Mt.supportsWord(this._wordContext.word)){const e={label:Pt.MESSAGES.READ_TEXT,position:"bottom-right"};this._readIcon=new rt("audio",null,e,this._intro),this._host.addEventListener(he(null===(t=this._readIcon)||void 0===t?void 0:t.getElement(),"click",this._onReadOutLoudClicked.bind(this)))}}_renderSynonymsPlaceholder(){this._content&&(this._synonyms=this._document.createElement("lt-div"),this._synonyms.classList.add("lt-synonymscontent__synonyms"),this._setMessage(Pt.MESSAGES.LOADING),this._content.appendChild(this._synonyms))}_renderSynonyms(){if(this._synonymResult&&this._content&&this._synonyms){if(this._synonyms.innerHTML="",!this._synonymResult.synonymSets.length){const e=this._document.createElement("lt-div");return e.classList.add("lt-card__no-synonyms"),e.textContent=Pt.MESSAGES.NO_SYNONYMS_FOUND,void this._synonyms.appendChild(e)}if(!this._synonymsHeadline&&(this._synonymsHeadline=this._document.createElement("lt-div"),this._synonymsHeadline.classList.add("lt-card__headline","lt-card__headline--rephrase"),this._synonymsHeadline.textContent=Pt.MESSAGES.HEADLINE,this._content.insertBefore(this._synonymsHeadline,this._synonyms),!this._language.startsWith("de")&&!t.isSafari())){const e=this._document.createElement("lt-span");e.classList.add("lt-card__beta-sign"),e.textContent="Beta",this._synonymsHeadline.appendChild(e)}if(this._synonymResult.synonymSets.forEach((e=>{const t=this._document.createElement("lt-div");t.classList.add("lt-synonymscontent__row");const n=this._document.createElement("lt-div");if(n.classList.add("lt-synonymscontent__synonym-title"),n.textContent=e.title,t.appendChild(n),e.synonyms.forEach((e=>{const n=this._document.createElement("lt-div");n.classList.add("lt-synonymscontent__synonym"),n.textContent=e.word,e.hints.forEach((e=>{const t=this._document.createElement("lt-span");t.classList.add("lt-card__hint"),t.textContent=e,n.appendChild(t)}));const s=this._onSynonymClick.bind(this,e.word);this._host.addEventListener(he(n,"click",s)),t.appendChild(n),this._host.addInteractiveElement(n,s)})),e.synonyms.length>this.MAX_SYNONYMS_PER_ROW+1){t.classList.add("lt-synonymscontent__row__limited");const e=this._document.createElement("lt-div");e.classList.add("lt-synonymscontent__row__expand"),e.textContent=Pt.MESSAGES.MORE;const n=this._onShowMoreClick.bind(this,t);this._host.addEventListener(he(e,"click",n)),t.appendChild(e),this._host.addInteractiveElement(e,(()=>{var e,s;n();const i=`.lt-synonymscontent__synonym:nth-child(n + ${this.MAX_SYNONYMS_PER_ROW+1})`,r=t.querySelector(i);r&&(null===(s=(e=this._host).updateFocus)||void 0===s||s.call(e,r))}))}this._synonyms.appendChild(t)})),!this._language.startsWith("de")&&this._synonyms.lastElementChild){const e=this._document.createElement("lt-div");e.classList.add("lt-synonymscontent__info-text"),e.innerHTML="Source: ";const t=this._document.createElement("lt-span");t.textContent=this._synonymResult.dataSource.sourceName,e.appendChild(t),this._host.addEventListener(he(t,"click",(e=>{e.stopImmediatePropagation(),this._synonymResult&&window.open(this._synonymResult.dataSource.sourceUrl,"_blank")}))),this._synonyms.lastElementChild.appendChild(e)}this._renderLoadMore(),this._updatePagination(),this._host.position()}}_renderLoadMore(){if(!this._synonyms||!this._synonymResult||this._synonymResult.synonymSets.length<=this.SYNONYMS_BATCH_SIZE)return;const{wrapper:e,button:t}=this._host.createLoadMoreButton("synonyms");this._host.addEventListener(he(t,"click",(e=>{e.stopImmediatePropagation(),this._showMoreSynonyms()}))),this._host.addInteractiveElement(t,(()=>{var e;const t=`.lt-synonymscontent__row:nth-child(${this.SYNONYMS_BATCH_SIZE*this._visibleSynonymBatches}) lt-div:last-child`,n=null===(e=this._synonyms)||void 0===e?void 0:e.querySelector(t);n&&this._showMoreSynonyms(n)})),this._loadMore=e,this._synonyms.appendChild(this._loadMore)}_createCaption(e,t){const n=e.trim().split(/'| /),s=this._document.createElement("lt-div");if(s.classList.add("lt-synonymscontent__intro__caption"),n.length>1){const t=this._document.createElement("lt-span");t.classList.add("lt-synonymscontent__intro__article"),t.textContent=n[0]+(e.includes("'")?"'":""),s.appendChild(t);const i=this._document.createElement("lt-span");i.textContent=n[1],s.appendChild(i)}else{const e=this._document.createElement("lt-span");e.textContent=n[0],s.appendChild(e)}if(t){const e=this._document.createElement("lt-span");e.classList.add("lt-synonymscontent__intro__gender"),e.textContent=`(${t})`,s.appendChild(e)}return s}_updatePagination(){var e,t;if(!this._synonyms)return;const n=null!==(t=null===(e=this._synonymResult)||void 0===e?void 0:e.synonymSets.length)&&void 0!==t?t:0,s=this.SYNONYMS_BATCH_SIZE*this._visibleSynonymBatches,i=n>s;this._synonyms.classList.toggle("lt-synonymscontent__synonyms--truncated",i),this._synonyms.dataset.visibleItems=String(s)}_showMoreSynonyms(e){var t,n;this._visibleSynonymBatches+=1,this._host.clearDomMeasurementCache(),this._updatePagination(),null===(n=(t=this._host).updateFocus)||void 0===n||n.call(t,null!==e?e:void 0)}_onSynonymClick(e,t){t&&t.stopImmediatePropagation(),this._host.dispatchRephraseClick(e)}_onReadOutLoudClicked(){Mt.isPlaying()?(Mt.stop(),this._readIcon&&this._readIcon.setIcon("audio")):(Mt.playMany(this._tts,this._language,(()=>{var e;null===(e=this._readIcon)||void 0===e||e.setIcon("audio")})),this._readIcon&&this._readIcon.setIcon("audio_play"))}_onShowMoreClick(e){e.classList.add("lt-synonymscontent__row--expanded"),this._host.position()}}Pt._isInitialized=!1;class Ot{constructor(e,t,n,s,i,r,o,a,l,c,d,h,_,u,g,m){this._currentRephraseType="word",this._renderOutsideIframe=!1,this._destroyed=!1,this._renderInitialContent=()=>{this._content&&this._getContentWord().render().then((()=>{var e;null===(e=this._innerContainer)||void 0===e||e.classList.remove("lt-card__container--hidden"),this._contentWord.show()}))},this._toggleTabs=e=>{var t;const n=e.target;if(this._tabNav&&n instanceof HTMLElement&&n.dataset.tabType){if(this._tabNav.dataset.activeType===n.dataset.tabType)return;this._tabNav.dataset.activeType=n.dataset.tabType,null===(t=this._innerContainer)||void 0===t||t.classList.add("lt-card__container--animates-transition"),setTimeout((()=>{var e;return null===(e=this._innerContainer)||void 0===e?void 0:e.classList.remove("lt-card__container--animates-transition")}),300),"word"===n.dataset.tabType&&(this._currentRephraseType="word",this._getContentSentence().hide(),this._getContentWord().show()),"sentence"===n.dataset.tabType&&(this._currentRephraseType="sentence",this._getContentWord().hide(),this._getContentSentence().show())}},this._toggleTabsViaKeyboard=e=>{var t,n;const s=null===(t=this._tabNav)||void 0===t?void 0:t.dataset.activeType;if(!s)return;const i=null===(n=this._tabNav)||void 0===n?void 0:n.querySelector(`[data-tab-type="${s}"]`);if(!i)return;const r=new MouseEvent("click",{bubbles:!1,cancelable:!0});Object.defineProperty(r,"target",{value:e}),this._addInteractiveElement(i,(()=>this._toggleTabsViaKeyboard(i))),this._toggleTabs(r),this._updateFocus(i),this._removeInteractiveElement(e),this._focusedButtonIndex=this._buttons.findIndex((({element:e})=>e===i))},this._dispatchRephraseClick=(e,t)=>{if("word"===e){const e={rephraseCard:this,selection:this.selection,word:this._wordContext.word.trim(),synonym:t};de(document,Ot.eventNames.synonymSelected,e)}if("sentence"===e){const e={rephraseCard:this,selection:this.selection,phrase:t};de(document,Ot.eventNames.phraseSelected,e)}},this._onKeyDown=e=>{var t,n,s,i,r;if("Escape"===e.key)return this.destroy(),null===(t=e.target)||void 0===t||t.addEventListener("keyup",(e=>e.stopImmediatePropagation()),{once:!0,capture:!0}),void e.stopImmediatePropagation();if(!this._uiOptions.enableKeyboard||void 0===this._focusedButtonIndex)return;let o=e.key;switch("Tab"===e.key&&(o=e.shiftKey?"ArrowLeft":"ArrowRight"),o){case"ArrowLeft":for(let e=1;e<this._buttons.length;e++){let t=this._focusedButtonIndex-e;if(t<0&&(t+=this._buttons.length),oe(this._buttons[t].element)){this._focusedButtonIndex=t;break}}null===(n=this._updateFocus)||void 0===n||n.call(this),e.stopImmediatePropagation(),e.preventDefault();break;case"ArrowRight":for(let e=1;e<this._buttons.length;e++){let t=this._focusedButtonIndex+e;if(t>=this._buttons.length&&(t-=this._buttons.length),oe(this._buttons[t].element)){this._focusedButtonIndex=t;break}}null===(s=this._updateFocus)||void 0===s||s.call(this),e.stopImmediatePropagation(),e.preventDefault();break;case"ArrowUp":{const t=this._buttons.map((e=>oe(e.element)?this._domMeasurement.getBorderBox(e.element):null)),n=t[this._focusedButtonIndex],s=t.filter((e=>e&&e.bottom<=n.top)),r=Math.max(...s.map((e=>e.top))),o=q(s.filter((e=>e.top===r)),n);if(o)this._focusedButtonIndex=t.indexOf(o);else for(let e=this._buttons.length-1;e>=0;e--)if(oe(this._buttons[e].element)){this._focusedButtonIndex=e;break}null===(i=this._updateFocus)||void 0===i||i.call(this),e.stopImmediatePropagation(),e.preventDefault();break}case"ArrowDown":{const t=this._buttons.map((e=>oe(e.element)?this._domMeasurement.getBorderBox(e.element):null)),n=t[this._focusedButtonIndex],s=t.filter((e=>e&&e.top>=n.bottom)),i=Math.min(...s.map((e=>e.top))),o=q(s.filter((e=>e.top===i)),n);if(o)this._focusedButtonIndex=t.indexOf(o);else for(let e=0;e<this._buttons.length;e++)if(oe(this._buttons[e].element)){this._focusedButtonIndex=e;break}null===(r=this._updateFocus)||void 0===r||r.call(this),e.stopImmediatePropagation(),e.preventDefault();break}case"Enter":this._buttons[this._focusedButtonIndex]&&this._buttons[this._focusedButtonIndex].onSelect(),e.stopImmediatePropagation(),e.preventDefault()}},this._uniqueId=e,this._inputArea=t,this._editorText=n,this._getSentenceRanges=g,this._targetBoxes=s,this._wordContext=i,this._language=r,this._motherLanguage=o,this._preferredLanguages=a,this._dpaLevel=l,this._confirmedGPT3=c,this._hasGrammarMistakes=d,this._hasSpellingMistakes=h,this._uiOptions=_,this._updateGPT3Confirmation=m,this._referenceArea=t,this._document=this._inputArea.ownerDocument,this._buttons=[],this._keyboardEventTarget=u.getKeyboardEventTarget(),this._uiOptions.enableKeyboard&&(this._focusedButtonIndex=1),this.selection={start:i.position.start,end:i.position.end};const p=ne(window);p&&this._inputArea===this._inputArea.ownerDocument.body&&Le(window.parent)&&(this._referenceArea=p,this._document=this._referenceArea.ownerDocument,this._renderOutsideIframe=!0,this._onUnload=this._onUnload.bind(this),window.addEventListener("pagehide",this._onUnload,!0)),this._domMeasurement=new K(this._document),this._eventListeners=[],this._renderContainer()}static _cacheMessages(){Ot.MESSAGES={PROVIDED_BY:s.getMessage("synonymsCardProvidedBy"),TAB_CAPTION_WORD:s.getMessage("synonymsCardTabWord"),TAB_CAPTION_SENTENCE:s.getMessage("synonymsCardTabSentence"),LOAD_MORE_ALTERNATIVES:s.getMessage("synonymsCardLoadMoreAlternatives")}}static init(){Ot._isInitialized||(Ot._cacheMessages(),s.addEventListener(n.eventNames.localeChanged,Ot._cacheMessages.bind(Ot)),Ot._isInitialized=!0)}get underlineColor(){switch(this._currentRephraseType){case"word":return i.COLORS.SYNONYMS.UNDERLINE;case"sentence":return i.COLORS.STYLE.UNDERLINE;default:throw new Error(`Unknown RephraseCard type "${this._currentRephraseType}"`)}}get backgroundColor(){switch(this._currentRephraseType){case"word":return"";case"sentence":return i.COLORS.STYLE.BACKGROUND;default:throw new Error(`Unknown RephraseCard type "${this._currentRephraseType}"`)}}updateTargetBoxes(e){this._targetBoxes=e,this._position()}_renderContainer(){if(this._container||this._destroyed)return;this._container=Q(this._document,Ot.CONTAINER_ELEMENT_NAME),this._container.style.display="none",this._container.setAttribute("data-lt-adjust-appearance","true"),this._container.classList.add("lt-rephrase-card"),le(this._inputArea)?this._container.setAttribute("data-lt-force-appearance","dark"):this._container.setAttribute("data-lt-force-appearance","light"),this._eventListeners.push(he(this._keyboardEventTarget,"keydown",this._onKeyDown),he(this._container,"click",(e=>e.stopPropagation())),he(this._container,"mouseup",(e=>e.stopImmediatePropagation())),he(this._container,"pointerdown",(e=>e.stopImmediatePropagation())),he(this._container,"pointerup",(e=>e.stopImmediatePropagation()))),this._innerContainer=this._document.createElement("lt-div"),this._innerContainer.classList.add("lt-card__container"),this._innerContainer.classList.add("lt-card__container--rephrase-card"),this._innerContainer.classList.add("lt-card__container--hidden"),this._innerContainer.classList.add("notranslate"),this._header=this._document.createElement("lt-div"),this._header.classList.add("lt-card__header"),this._innerContainer.appendChild(this._header),this._content=this._document.createElement("lt-div"),this._content.classList.add("lt-card__pane"),this._innerContainer.appendChild(this._content),this._renderHeader(),this._renderTabs(),requestAnimationFrame(this._renderInitialContent),this._container.appendChild(this._innerContainer);("BODY"===this._referenceArea.nodeName?this._document.documentElement:this._document.body).appendChild(this._container),this._position()}_getWordReferenceTargetBoxes(e){const t=e.slice().sort(((e,t)=>e.width>t.width?-1:1)).shift();return void 0!==t?[Object.assign({},t),Object.assign({},t)]:[]}_getSentenceReferenceTargetBoxes(e,t){const[n,s,...i]=e.slice().sort(((e,t)=>e.top>t.top?-1:1));let r=s,o=i.length?i[i.length-1]:s;return(null==n?void 0:n.left)+n.width>t&&(r=n),void 0===r?[]:[Object.assign({},r),Object.assign({},null!=o?o:r)]}_position(){if(!this._innerContainer)return;const e="word"===this._currentRephraseType,[t,n]=e?this._getWordReferenceTargetBoxes(this._targetBoxes):this._getSentenceReferenceTargetBoxes(this._targetBoxes,this._innerContainer.offsetLeft);if(!t||!n)return;this._domMeasurement.clearCache();const s=this._domMeasurement.getDocumentVisibleBox(),i=this._domMeasurement.getBorderBox(this._innerContainer);if(this._renderOutsideIframe){let e=document.createElement("lt-span");e.style.position="absolute",e.style.left=t.left+"px",e.style.top=t.top+"px",document.documentElement.appendChild(e);const n=e.getBoundingClientRect();e.remove(),e=null;const s=new K(this._document).getContentBox(this._referenceArea);t.left=s.left+n.left,t.top=s.top+n.top,t.bottom=s.top+n.top+t.height,t.right=s.left+n.left+t.width}let r=e?Math.min(t.left-1,s.width-i.width-8):this._innerContainer.offsetLeft,o=t.bottom+5;o+i.height>s.bottom&&(o=Math.max(s.top,n.top-i.height-5)),this._innerContainer.style.left=r+"px",this._innerContainer.style.top=o+"px"}_renderHeader(){if(!this._header)return;if(!1!==this._uiOptions.showHeader){const e=this._document.createElement("lt-div");e.classList.add("lt-card__logo-container");const t=this._document.createElement("lt-span");t.classList.add("lt-card__logo","lt-icon__lt--white"),e.appendChild(t);const n=this._document.createElement("lt-span");n.classList.add("lt-card__header__caption"),n.innerHTML=Ot.MESSAGES.PROVIDED_BY.replace(/(<\/?)strong(>)/g,"$1lt-span$2"),e.appendChild(n),this._header.appendChild(e),this._eventListeners.push(he(t,"click",this._onLogoClicked.bind(this)),he(n,"click",this._onLogoClicked.bind(this)))}const e=new rt("close_small--white",null,null,this._header);this._eventListeners.push(he(e.getElement(),"click",this._onCloseClicked.bind(this)))}_renderTabButton(e,t,n,s){const i=this._document.createElement("lt-div"),r=new rt(`${t}--blue`,null,null,i,!1).getElement(),o=new rt(t,null,null,i,!1).getElement();return r.classList.add("lt-card__tab-nav__icon--default"),o.classList.add("lt-card__tab-nav__icon--active"),i.classList.add("lt-card__tab-nav__button",`lt-card__tab-nav__button--${e}`),i.dataset.tabType=e,i.appendChild(this._document.createTextNode(n)),s&&i.appendChild(Object.assign(this._document.createElement("lt-span"),{className:"lt-card__tab-nav__beta-sign",textContent:"Beta"})),i}_renderTabs(){var e,n,s;if(!this._content)return;this._tabNav=this._document.createElement("lt-div"),this._tabNav.classList.add("lt-card__tab-nav"),this._tabNav.dataset.activeType="word",this._content.appendChild(this._tabNav),this._eventListeners.push(he(this._tabNav,"click",this._toggleTabs));const i=this._renderTabButton("sentence","expand",Ot.MESSAGES.TAB_CAPTION_SENTENCE,!1===t.isSafari()),r=this._document.createElement("lt-div");r.classList.add("lt-card__tab-nav__highlight"),null===(e=this._tabNav)||void 0===e||e.appendChild(this._renderTabButton("word","narrow_down",Ot.MESSAGES.TAB_CAPTION_WORD)),null===(n=this._tabNav)||void 0===n||n.appendChild(i),null===(s=this._tabNav)||void 0===s||s.appendChild(r),this._addInteractiveElement(i,(()=>this._toggleTabsViaKeyboard(i)))}_onLogoClicked(e){e.stopImmediatePropagation();const t={rephraseCard:this};de(document,Ot.eventNames.logoClicked,t)}_onCloseClicked(e){e.stopImmediatePropagation(),this.destroy()}_updateSelection(e){this.selection=e}_createLoadMoreButton(e){const t=this._document.createElement("lt-div");t.classList.add("lt-rephrasecard__load-more");const n=this._document.createElement("lt-span");return n.classList.add("lt-rephrasecard__load-more__btn"),n.dataset.testid=`load-more-${e}`,new rt("arrow_down--blue",null,null,n),n.appendChild(this._document.createTextNode(Ot.MESSAGES.LOAD_MORE_ALTERNATIVES)),t.appendChild(n),{wrapper:t,button:n}}_dispatchHighlight(){de(document,Ot.eventNames.highlight,{rephraseCard:this})}_dispatchFlashSentence(e,t){const n={rephraseCard:this,color:i.COLORS.NEW_SENTENCE.BACKGROUND,duration:1500,offset:e,length:t};de(document,Ot.eventNames.flashSentence,n)}_updateFocus(e){for(const e of this._buttons)e.element.classList.remove("lt-card__button-focused");if(void 0===this._focusedButtonIndex||!this._buttons.length||!this._buttons[this._focusedButtonIndex])return;if(void 0!==e){const t=this._buttons.findIndex((({element:t})=>t===e));if(-1===t)return;this._focusedButtonIndex=t}const t=this._buttons[this._focusedButtonIndex].element;t.classList.add("lt-card__button-focused"),t.scrollIntoView({block:"nearest",inline:"nearest"})}_addInteractiveElement(e,t){this._buttons.push({onSelect:t,element:e})}_removeInteractiveElement(e){const t=this._buttons.findIndex((t=>t.element===e));t>-1&&this._buttons.splice(t,1)}_getContentWord(){return this._contentWord||(this._contentWord=new Pt(this._content,this._wordContext,this._language,this._motherLanguage,this._getHostObject("word"))),this._contentWord}_getContentSentence(){if(!this._contentSentence){const e=this._motherLanguage||this._preferredLanguages[0]||"";this._contentSentence=new wt(this._uniqueId,this._content,this._editorText,this._language,e,this._preferredLanguages,this._dpaLevel,this._confirmedGPT3,this._uiOptions.geoIpCountry,this._uiOptions.hasSubscription,this.selection,this._getHostObject("sentence"),this._hasGrammarMistakes,this._hasSpellingMistakes,this._getSentenceRanges,this._hasValidSentenceRanges.bind(this),this._updateGPT3Confirmation),this._contentSentence.render()}return this._contentSentence}_getHostObject(e){return{position:this._position.bind(this),updateFocus:this._updateFocus.bind(this),updateSelection:this._updateSelection.bind(this),createLoadMoreButton:this._createLoadMoreButton.bind(this),dispatchHighlight:this._dispatchHighlight.bind(this),dispatchFlashSentence:this._dispatchFlashSentence.bind(this),dispatchRephraseClick:t=>this._dispatchRephraseClick(e,t),addEventListener:(...e)=>this._eventListeners.push(...e),addInteractiveElement:this._addInteractiveElement.bind(this),clearDomMeasurementCache:()=>this._domMeasurement.clearCache()}}_hasValidSentenceRanges(){var e,t;return null!==(t=null===(e=this._getSentenceRanges())||void 0===e?void 0:e.some((e=>{const{start:t,end:n}=this._wordContext.position;return e.start<=n&&e.end>=t})))&&void 0!==t&&t}_onUnload(){this.destroy()}destroy(){var e,t;this._destroyed=!0,null===(e=this._contentWord)||void 0===e||e.destroy(),null===(t=this._contentSentence)||void 0===t||t.destroy(),this._container&&(this._container.remove(),this._container=null);const n={rephraseCard:this};de(document,Ot.eventNames.destroyed,n),window.removeEventListener("pagehide",this._onUnload,!0),this._eventListeners.forEach((e=>{e.destroy()})),this._eventListeners=[]}}Ot.CONTAINER_ELEMENT_NAME="lt-card",Ot.BLOCK_ID="rephrase-card",Ot.eventNames={synonymSelected:"lt-rephraseCard.synonymSelected",phraseSelected:"lt-rephraseCard.phraseSelected",logoClicked:"lt-rephraseCard.logoClicked",destroyed:"lt-rephraseCard.destroyed",highlight:"lt-rephraseCard.highlight",flashSentence:"lt-rephraseCard.flashSentence"},Ot._isInitialized=!1;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Dt{constructor(e,t,n=null,s={checkStatus:qe.IN_PROGRESS,errorsCount:0,premiumErrorsCount:0,isIncompleteResult:!1,checkErrorMessage:"",showNotification:!1}){this._currentStyles=null,this._renderOutsideIframe=!1,this._inputArea=e,this._targetElement=e,this._document=e.ownerDocument,this._appearance=t,this._mirror=n;const r=ne(window);r&&this._inputArea===this._inputArea.ownerDocument.body&&Le(window.parent)&&(this._targetElement=r,this._document=this._targetElement.ownerDocument,this._renderOutsideIframe=!0,this._onUnload=this._onUnload.bind(this),window.addEventListener("pagehide",this._onUnload,!0)),this._controls={container:null,wrapper:null,statusIcon:null,premiumIcon:null},this._visible=!1,this._sizeDecreased=!1,this._hasNotifiedAboutPremiumIcon=!1,this._domMeasurement=new K(this._document),this._eventListeners=[],this.updateState(s,!0);const o=this._appearance.isPerformanceCritical();this._renderInterval=X((()=>this._updateDisplaying(!0)),o?2*i.RENDER_INTERVAL:i.RENDER_INTERVAL),o||(this._decreaseSizeInterval=X((()=>this._decreaseSizeIfNeeded()),i.TOOLBAR_DECREASE_SIZE_INTERVAL)),this._scrollObserver=function(e,t){const n=new K(e.ownerDocument),s=function(e){const t=[];let s=e.parentElement;for(;s&&s!==document.body&&s!==document.documentElement;){const e=n.getStyles(s,["overflow-x","overflow-y"]),i=e["overflow-x"],r=e["overflow-y"];"auto"!==r&&"scroll"!==r&&"auto"!==i&&"scroll"!==i||t.push(s),s=s.parentElement}return t}(e);let i=!1;const r=()=>{i||(i=!0,window.requestAnimationFrame((()=>{i=!1,t()})))};return s.forEach((e=>{e.addEventListener("scroll",r)})),{destroy(){s.forEach((e=>{e.removeEventListener("scroll",r)})),i=!0}}}(this._targetElement,(()=>this._updateDisplaying(!1)))}static _cacheMessages(){Dt.MESSAGES={STATUS_ICON_RELOAD_MESSAGE:s.getMessage("statusIconReload"),STATUS_ICON_TOOLTIP:s.getMessage("statusIconToolTip"),STATUS_ICON_PERMISSION_REQUIRED:s.getMessage("statusIconPermissionRequired"),STATUS_ICON_TEXT_TOO_LONG:s.getMessage("textTooLong"),STATUS_ICON_DISABLED:s.getMessage("statusIconEnableLT"),STATUS_ICON_FAIL:s.getMessage("statusIconError"),STATUS_ICON_MORE_ERRORS:s.getMessage("statusIconMoreErrors"),STATUS_ICON_LANGUAGE_UNSUPPORTED:s.getMessage("dialogUnsupportedLanguageHeadline")}}static init(){Dt._isInitialized||(Dt._cacheMessages(),s.addEventListener(n.eventNames.localeChanged,Dt._cacheMessages.bind(Dt)),Dt._isInitialized=!0)}_render(){if(this._destroyed)return;const e=["lt-toolbar__status-icon"],t=["lt-toolbar__premium-icon"];let n=Dt.MESSAGES.STATUS_ICON_TOOLTIP,s="";if(!this._controls.container){this._parent=this._appearance.getParent(this._document),this._parentElement=this._parent instanceof ShadowRoot?this._parent.host:this._parent,this._controls.container=Q(this._document,Dt.CONTAINER_ELEMENT_NAME),this._controls.container.style.display="none",Ue(this._inputArea)&&this._controls.container.setAttribute("data-cke-temp","1"),this._controls.wrapper=this._document.createElement("lt-div"),this._controls.wrapper.classList.add("lt-toolbar__wrapper"),le(this._inputArea)?this._controls.container.setAttribute("data-lt-force-appearance","dark"):this._controls.container.setAttribute("data-lt-force-appearance","light");const e=this._appearance.getClassName();e&&this._controls.wrapper.classList.add(e),this._controls.statusIcon=this._document.createElement("lt-div"),this._controls.premiumIcon=this._document.createElement("lt-div");const t=[this._controls.statusIcon,this._controls.premiumIcon];this._eventListeners.push(he(this._controls.wrapper,"click",this._onClick.bind(this))),this._controls.wrapper.appendChild(this._controls.premiumIcon),this._controls.wrapper.appendChild(this._controls.statusIcon),this._controls.container.appendChild(this._controls.wrapper),t.forEach((e=>{this._eventListeners.push(he(e,"mousedown",(e=>{e.stopImmediatePropagation(),e.preventDefault()})),he(e,"mouseup",(e=>{e.stopImmediatePropagation()})),he(e,"pointerdown",(e=>{e.stopImmediatePropagation()})),he(e,"pointerup",(e=>{e.stopImmediatePropagation()})))})),this._visible=!0}switch(clearTimeout(this._premiumIconTimeout),this._state.checkStatus){case qe.IN_PROGRESS:e.push("lt-toolbar__status-icon-in-progress");break;case qe.COMPLETED:case qe.TEXT_TOO_SHORT:0===this._state.errorsCount?e.push("lt-toolbar__status-icon-has-no-errors"):(e.push("lt-toolbar__status-icon-has-errors"),this._state.isIncompleteResult?(e.push("lt-toolbar__status-icon-has-more-errors"),n=Dt.MESSAGES.STATUS_ICON_MORE_ERRORS):this._state.errorsCount>9?e.push("lt-toolbar__status-icon-has-9plus-errors"):e.push(`lt-toolbar__status-icon-has-${this._state.errorsCount}-errors`)),this._state.premiumErrorsCount>0&&(t.push("lt-toolbar__premium-icon--visible"),this._premiumIconTimeout=window.setTimeout((()=>this._notifyAboutPremiumIcon()),3e3),this._state.premiumErrorsCount<9?t.push(`lt-toolbar__premium-icon-has-${this._state.premiumErrorsCount}-errors`):t.push("lt-toolbar__premium-icon-has-9plus-errors"),0===this._state.errorsCount&&t.push("lt-toolbar__premium-icon--prominent")),this._state.showNotification&&0===this._state.premiumErrorsCount&&e.push("lt-toolbar__status-icon-has-notification");break;case qe.PERMISSION_REQUIRED:e.push("lt-toolbar__status-icon--permission-required"),n=Dt.MESSAGES.STATUS_ICON_PERMISSION_REQUIRED;break;case qe.DISABLED:e.push("lt-toolbar__status-icon-disabled","lt-illustration__disabled"),n=Dt.MESSAGES.STATUS_ICON_DISABLED;break;case qe.TEXT_TOO_LONG:e.push("lt-toolbar__status-icon-text-too-long","lt-illustration__text_too_long"),n=Dt.MESSAGES.STATUS_ICON_TEXT_TOO_LONG;break;case qe.UNSUPPORTED_LANGUAGE:e.push("lt-toolbar__status-icon--language-unsupported","t-illustration__language_not_supported"),n=Dt.MESSAGES.STATUS_ICON_LANGUAGE_UNSUPPORTED;break;case qe.FAILED:e.push("lt-toolbar__status-icon--failed","wp-exclude-emoji"),n=this._state.checkErrorMessage||Dt.MESSAGES.STATUS_ICON_FAIL,s="✖";break;case qe.DISCONNECTED:e.push("lt-toolbar__status-icon-disconnected","wp-exclude-emoji"),n=Dt.MESSAGES.STATUS_ICON_RELOAD_MESSAGE,s="✖";break;case qe.NEEDS_LANGUAGE_HINT:e.push("lt-toolbar__status-icon-needs-language-hint")}var i,r,o;this._controls.statusIcon.className=e.join(" "),this._controls.statusIcon.title=n,this._controls.statusIcon.textContent=s,this._controls.premiumIcon.className=t.join(" "),!this._parent||this._parent.contains(this._controls.container)&&"before"!==(i=this._controls.container,r=this._inputArea,4&(o=r.compareDocumentPosition(i))?"after":2&o?"before":null)||this._parent.children[this._parent.children.length-1]===this._controls.container||this._parent.appendChild(this._controls.container)}_updateDisplaying(e=!1){if(this._destroyed)return;if(!this._controls.wrapper)return;if(this._renderOutsideIframe&&!fe(this._targetElement))return void this._hide();this._domMeasurement.clearCache();if(!this._appearance.isVisible(this._targetElement,this._domMeasurement))return void this._hide();const t=this._domMeasurement.isRTL(this._targetElement),n=this._appearance.getPosition(this._targetElement,this._parentElement,this._domMeasurement,t,Dt.TOOLBAR_SIZE);if(!n)return void this._hide();const s={left:n.left};n.fixed?(s.position="fixed !important",n.top?(s.top=`${n.top} !important`,s.bottom="auto !important"):(s.top="auto !important",s.bottom="12px !important")):(s.position="absolute !important",s.top=`${n.top} !important`,s.bottom="auto !important"),e&&(s["z-index"]=(this._appearance.getZIndex(this._targetElement,this._parentElement,this._domMeasurement)||"auto").toString()),A(this._currentStyles,s)?this._show():(this._currentStyles=s,this._domMeasurement.setStyles(this._controls.wrapper,s))}_hide(){this._controls.wrapper&&this._visible&&(this._visible=!1,this._controls.wrapper.classList.add("lt-toolbar__wrapper-hide"))}_show(){this._controls.wrapper&&(this._visible||(this._visible=!0,this._controls.wrapper.classList.remove("lt-toolbar__wrapper-hide")))}_decreaseSizeIfNeeded(){if(!this._controls.wrapper)return;if(!this._visible)return;if(this._destroyed)return;let e=this._domMeasurement.getBorderBox(this._controls.wrapper,!1);if(this._renderOutsideIframe){const i=this._domMeasurement.getContentBox(this._targetElement,!1);t=e,n=-i.left,s=-i.top,e=Object.assign({},t,{top:t.top+s,right:t.right+n,bottom:t.bottom+s,left:t.left+n})}var t,n,s;if(e.top<0||e.bottom>window.innerHeight)return;const i={left:e.left-6,top:e.top,right:e.right,bottom:e.bottom-2},r={x:e.left,y:Math.round(e.top)},o={x:Math.round(e.left+e.width/2),y:Math.round(e.top+e.height/2)},a={x:e.left,y:Math.round(e.bottom)};this.disableRangeMeasurements(),this._mirror&&this._mirror.enableRangeMeasurements();const l=ge(r);let c=ge(o),d=ge(a);this.enableRangeMeasurements(),this._mirror&&this._mirror.disableRangeMeasurements();let h=null;c&&c.startOffset>0&&(h=new Range,h.setStart(c.startContainer,c.startOffset-1),h.setEnd(c.startContainer,c.startOffset-1));const _=this._mirror?this._mirror.getCloneElement():this._inputArea;if(l&&ee(_,l.startContainer)){if(Z(l.getBoundingClientRect(),i))return void this._decreaseSize()}if(me(c,l)&&(c=null),c&&ee(_,c.startContainer)){if(Z(c.getBoundingClientRect(),i))return void this._decreaseSize()}if((me(d,l)||me(d,c))&&(d=null),d&&ee(_,d.startContainer)){if(Z(d.getBoundingClientRect(),i))return void this._decreaseSize()}if((me(h,l)||me(h,c)||me(h,d))&&(h=null),h&&ee(_,h.startContainer)){if(Z(h.getBoundingClientRect(),i))return void this._decreaseSize()}this._increaseSize()}_decreaseSize(){this._controls.wrapper&&(this._sizeDecreased||(this._sizeDecreased=!0,this._controls.wrapper.classList.add("lt-toolbar-small")))}_increaseSize(){this._controls.wrapper&&this._sizeDecreased&&(this._sizeDecreased=!1,this._controls.wrapper.classList.remove("lt-toolbar-small"))}_notifyAboutPremiumIcon(){if(this._hasNotifiedAboutPremiumIcon)return;this._hasNotifiedAboutPremiumIcon=!0;const e={toolbar:this};de(document,Dt.eventNames.notifyAboutPremiumIcon,e)}_onUnload(){this.destroy()}_onClick(e){const t=ce(e);if(![this._controls.wrapper,this._controls.statusIcon,this._controls.premiumIcon].includes(t))return;e.stopImmediatePropagation();const n={toolbar:this};this._state.checkStatus===qe.PERMISSION_REQUIRED?de(document,Dt.eventNames.permissionRequiredIconClicked,n):de(document,Dt.eventNames.toggleDialog,n)}updateState(e,t=!1){if(A(this._stateForComparison,e))return;this._stateForComparison=e;const n=void 0===e.checkStatus?this._state.checkStatus:e.checkStatus;let s=0,i=0;n===qe.COMPLETED&&(s=void 0===e.errorsCount?this._state.errorsCount:e.errorsCount,i=void 0===e.errorsCount?this._state.premiumErrorsCount:e.premiumErrorsCount);let r=void 0===e.isIncompleteResult?this._state.isIncompleteResult:e.isIncompleteResult,o="";n===qe.FAILED&&(o=void 0===e.checkErrorMessage?this._state.checkErrorMessage:e.checkErrorMessage),this._state={checkStatus:n,errorsCount:s,premiumErrorsCount:i,isIncompleteResult:r,checkErrorMessage:o,showNotification:e.showNotification},this._animationFrame=window.requestAnimationFrame((()=>{this._render(),this._updateDisplaying(t)}))}enableRangeMeasurements(){this._controls.wrapper&&(this._renderOutsideIframe||this._controls.wrapper.classList.remove("lt-toolbar-disable-range-measurement"))}disableRangeMeasurements(){this._controls.wrapper&&(this._renderOutsideIframe||this._controls.wrapper.classList.add("lt-toolbar-disable-range-measurement"))}getState(){return this._state}getContainer(){return this._controls.wrapper}destroy(){this._destroyed=!0,this._eventListeners.forEach((e=>{e.destroy()})),this._eventListeners=[];for(const e in this._controls)this._controls[e]&&(this._controls[e].remove(),this._controls[e]=null);this._domMeasurement.clearCache(),this._renderInterval&&this._renderInterval.destroy(),this._decreaseSizeInterval&&this._decreaseSizeInterval.destroy(),window.removeEventListener("pagehide",this._onUnload,!0),cancelAnimationFrame(this._animationFrame),clearTimeout(this._premiumIconTimeout),this._scrollObserver&&this._scrollObserver.destroy()}}Dt.CONTAINER_ELEMENT_NAME="lt-toolbar",Dt.TOOLBAR_SIZE={width:20,height:20},Dt.eventNames={permissionRequiredIconClicked:"lt-toolbar.permissionRequiredIconClicked",toggleDialog:"lt-toolbar.toggleDialog",notifyAboutPremiumIcon:"lt-toolbar.notifyAboutPremiumIcon"},Dt._isInitialized=!1;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
var Ut=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const Bt=function(e,t){try{const n=function(e){if(e.startsWith("user:"))return BigInt(e.substr(5));if(e.includes(":")){const t=e.indexOf(":"),n=BigInt(e.substring(0,t)),s=BigInt(e.substr(t+1));return n*BigInt(92233720368546)+s}return BigInt(e)}(e);return Number(n%BigInt(100))<t?"test":"control"}catch(e){return 100*Math.random()<t?"test":"control"}};class Gt{constructor(n={},r=Ct.DEFAULT_SITE_TWEAKS){this._spellcheckingAttributesData=new Map,this._editors=[],this._messages=[],this._checkExtensionRuntimeHealthIntervalId=void 0,this._fixTinyMCEIntervalId=void 0,this._initElementTimeouts=new Map,this._init=()=>{"string"==typeof this._options.apiServerUrl&&this._storageController.updateSettings({apiServerUrl:this._options.apiServerUrl}),"boolean"==typeof this._options.enableSynonyms&&this._storageController.updateSettings({hasSynonymsEnabled:this._options.enableSynonyms}),"boolean"==typeof this._options.enablePickyModeGlobally&&this._storageController.updateSettings({hasPickyModeEnabledGlobally:this._options.enablePickyModeGlobally}),this._options.dev&&this._storageController.updateUIState({showRuleId:!0}),this.updateLanguageOptions({motherTongue:this._options.motherTongue,preferredLanguages:this._options.preferredLanguages,preferredVariants:this._options.preferredVariants}),this._options.user&&this.updateUser({email:this._options.user.email,token:this._options.user.token,premium:this._options.user.premium,apiServerUrl:this._options.apiServerUrl}),this._onPageLoaded();if(this._tweaks.isSupported()&&this._storageController.isDomainSupported(k())){if(this._isRemoteCheckAllowed=this._storageController.getPrivacySettings().allowRemoteCheck,this._checkExtensionRuntimeHealthIntervalId=window.setInterval(this._checkExtensionRuntimeHealth,i.EXTENSION_HEALTH_RECHECK_INTERVAL),this._options.initElements){const e=Array.isArray(this._options.initElements)?this._options.initElements:[this._options.initElements];for(const t of e)this._initElement(t)}if(!this._options.ignoreFocus){const e=function(){let e=document.querySelector(":focus");for(;e&&e.shadowRoot;)e=e.shadowRoot.querySelector(":focus");return e}();e&&this._initElement(e,!0),document.body&&ie(document.body)&&this._initElement(document.body,!0)}window.__ltLastActiveElement&&(this._initElement(window.__ltLastActiveElement),window.__ltLastActiveElement=null),this._tweaks.onNewElement(((e,t)=>{this._initElement(e,t)})),t.isChromium()&&window.innerHeight>14&&(this._fixTinyMCEIntervalId=window.setInterval((()=>{this._fixIframeWithoutContentScripts()}),i.IFRAME_INITILIZATION_RECHECK_INTERVAL)),window.addEventListener("pageshow",this._onPageLoaded),window.addEventListener("pagehide",this._onPageHide),document.addEventListener("focus",this._onDocumentFocus,!0),document.addEventListener("mousemove",this._onDocumentMousemove,!0),document.addEventListener("focusout",this._onDocumentFocusout,!0),document.addEventListener(this._tweaks.getClickEvent(),this._onDocumentClick,!0),window.frameElement&&window.frameElement.ownerDocument&&window.frameElement.ownerDocument.addEventListener("click",this._onDocumentClick,!0),document.addEventListener(st.eventNames.scroll,this._onInputScroll),document.addEventListener(st.eventNames.paste,this._onInputPaste),document.addEventListener(st.eventNames.textChanged,this._onInputTextChanged),document.addEventListener(st.eventNames.dblclick,this._onInputDblClick),document.addEventListener(st.eventNames.dblPress,this._onInputDblPress),document.addEventListener(yt.eventNames.blockClicked,this._onHiglighterBlockClicked),document.addEventListener(Dt.eventNames.permissionRequiredIconClicked,this._onToolbarPermissionRequiredIconClicked),document.addEventListener(Dt.eventNames.toggleDialog,this._onToolbarToggleDialog),document.addEventListener(Dt.eventNames.notifyAboutPremiumIcon,this._onToolbarNotifyAboutPremiumIcon),document.addEventListener(gt.eventNames.positionChangeClicked,this._onPositionChangeClicked),document.addEventListener(gt.eventNames.enableHere,this._onDialogEnableHere),document.addEventListener(gt.eventNames.togglePickyMode,this._onPickyModeToggle),document.addEventListener(gt.eventNames.enableEverywhere,this._onDialogEnableEverywhere),document.addEventListener(gt.eventNames.languageChanged,this._onDialogLanguageChanged),document.addEventListener(gt.eventNames.countChanged,this._onDialogCountChanged),document.addEventListener(gt.eventNames.errorSelected,this._onDialogErrorSelected),document.addEventListener(gt.eventNames.errorHighlighted,this._onDialogErrorHighlighted),document.addEventListener(gt.eventNames.addToDictionaryClicked,this._onAddToDictionary),document.addEventListener(gt.eventNames.ignoreRuleClicked,this._onIgnoreRule),document.addEventListener(gt.eventNames.temporarilyIgnoreWordClicked,this._onTemporarilyIgnoreWord),document.addEventListener(gt.eventNames.temporarilyIgnoreRuleClicked,this._onTemporarilyIgnoreRule),document.addEventListener(gt.eventNames.moreDetailsClicked,this._onMoreDetailsClicked),document.addEventListener(gt.eventNames.fixSelected,this._onFixSelected),document.addEventListener(gt.eventNames.openOptions,this._onDialogOpenOptions),document.addEventListener(gt.eventNames.showFeedbackForm,this._onDialogShowFeedbackForm),document.addEventListener(gt.eventNames.destroyed,this._onDialogDestroyed),document.addEventListener(gt.eventNames.badgeClicked,this._onBadgeClicked),document.addEventListener(gt.eventNames.turnOff,this._onTurnOffClicked),document.addEventListener(gt.eventNames.pauseChecking,this._onPauseCheckingClicked),document.addEventListener(gt.eventNames.premiumTeaserClicked,this._onDialogPremiumTeaserClicked),document.addEventListener(gt.eventNames.correctAll,this._onCorrectAll),document.addEventListener(mt.eventNames.addToDictionaryClicked,this._onAddToDictionary),document.addEventListener(mt.eventNames.ignoreRuleClicked,this._onIgnoreRule),document.addEventListener(mt.eventNames.temporarilyIgnoreWordClicked,this._onTemporarilyIgnoreWord),document.addEventListener(mt.eventNames.temporarilyIgnoreRuleClicked,this._onTemporarilyIgnoreRule),document.addEventListener(mt.eventNames.moreDetailsClicked,this._onMoreDetailsClicked),document.addEventListener(mt.eventNames.fixSelected,this._onFixSelected),document.addEventListener(mt.eventNames.badgeClicked,this._onBadgeClicked),document.addEventListener(mt.eventNames.logoClicked,this._onErrorCardLogoClicked),document.addEventListener(mt.eventNames.languageChanged,this._onErrorCardLanguageChanged),document.addEventListener(mt.eventNames.turnOffPickyModeClicked,this._onErrorCardPickyModeTurnedOff),document.addEventListener(mt.eventNames.premiumTeaserClicked,this._onErrorCardPremiumTeaserClicked),document.addEventListener(mt.eventNames.destroyed,this._onErrorCardDestroyed),document.addEventListener(mt.eventNames.correctAll,this._onCorrectAll),document.addEventListener(Ot.eventNames.synonymSelected,this._onSynonymSelected),document.addEventListener(Ot.eventNames.phraseSelected,this._onPhraseSelected),document.addEventListener(Ot.eventNames.logoClicked,this._onRephraseCardLogoClicked),document.addEventListener(Ot.eventNames.destroyed,this._onRephraseCardDestroyed),document.addEventListener(Ot.eventNames.highlight,this._onRephraseCardHighlight),document.addEventListener(Ot.eventNames.flashSentence,this._onRephraseCardFlashSentence),document.addEventListener(Tt.eventNames.destroyed,this._onMessagePopupDestroyed),document.addEventListener(Tt.eventNames.turnOn,this._onTurnOnClicked),this._storageController.addEventListener(F.eventNames.settingsChanged,this._onSettingsChanged),this._storageController.addEventListener(F.eventNames.privacySettingsChanged,this._onPrivacySettingsChanged),this._storageController.addEventListener(F.eventNames.uiStateChanged,this._onUiStateChanged),this._options.onInit&&this._options.onInit(this)}},this._checkExtensionRuntimeHealth=()=>{e.isRuntimeConnected()||this._handleUnhealthyExtensionRuntime()},this._onPageLoaded=()=>{let t=!0;const n=this._tweaks.isBeta();let i=!0,r=!0,o="";if(this._tweaks.isSupported())if(this._storageController.isDomainSupported(k())){const e=this._getCheckSettings();t=!e.isDomainDisabled&&!e.isEditorGroupDisabled,i=e.shouldCapitalizationBeChecked}else r=!1,o=s.getMessage("siteCannotBeSupported");else r=!1,o=this._tweaks.unsupportedMessage();e.pageLoaded(t,i,r,n,o)},this._onPageHide=()=>{this._editors.forEach((e=>{this._savePremiumErrorCount(e),this._trackEditor(e)}))},this._onDocumentFocus=e=>{if(this._options.ignoreFocus)return;const t=ce(e);t instanceof HTMLElement?this._initElement(t,!0):e.target===document&&document.body&&ie(document.body)&&this._initElement(document.body,!0)},this._onDocumentMousemove=e=>{const t=this._editors.find((e=>e.isUserTyping));t&&this._endTypingModeAndUpdateState(t)},this._onDocumentFocusout=e=>{const t=this._editors.find((e=>e.isUserTyping));t&&this._endTypingModeAndUpdateState(t)},this._onDocumentClick=e=>{if(this._tweaks.isClickEventIgnored(e))return;const t=te(e.target,mt.CONTAINER_ELEMENT_NAME);t||this._hideAllErrorCards();const n=te(e.target,Ot.CONTAINER_ELEMENT_NAME);n||this._hideAllRephraseCards();const s=te(e.target,`${gt.CONTAINER_ELEMENT_NAME}, ${Dt.CONTAINER_ELEMENT_NAME}`);s||this._hideAllDialogs();te(e.target,`${Tt.CONTAINER_ELEMENT_NAME}`)||this._hideAllMessagePopups(),s||n||t||this._editors.forEach((e=>this._unselectError(e)))},this._onInputDblClick=e=>{const{hasSynonymsEnabled:t}=this._storageController.getSettings();if(!t||this._storageController.hasCustomServer())return;const n=this._editors.find((t=>t.inputAreaWrapper===e.detail.inputAreaWrapper));if(!n)return;const s=e.detail.selection,i=p(n.inputAreaWrapper.getText(),s.start,s.end||s.start);i&&this._showRephraseCard(n,e.detail.clickedRectangles,i)},this._onInputTextChanged=e=>{this._hideAllErrorCards(),requestAnimationFrame((()=>this._hideAllRephraseCards()));const t=this._editors.find((t=>t.inputAreaWrapper===e.detail.inputAreaWrapper));if(t){if(this._startTypingMode(t),t.dialog&&t.dialog.setInsignificantChangeMode(!this._isSignificantTextChange(e.detail.previousText,e.detail.text)),this._checkEditor(t,e.detail.text,!0))this._endTypingMode(t),this._updateDisplayedErrors(t);else{const n=e.detail.text,s=E(n,t.inputAreaTweaks.getReplacedParts(n)),i=bt.migrateErrorsBetweenTexts(t.errors,t.checkedText.originalText,n),r=bt.migrateErrorsBetweenTexts(t.premiumErrors,t.checkedText.originalText,n);this._updateDisplayedErrors(t,s,i,r)}this._highlight(t),this._updateState(t)}},this._onInputPaste=e=>{this._hideAllErrorCards(),this._hideAllRephraseCards();const t=this._editors.find((t=>t.inputAreaWrapper===e.detail.inputAreaWrapper));t&&t.dialog&&t.dialog.setInsignificantChangeMode(!e.detail.isSignificantTextChange)},this._onInputScroll=()=>{window.requestAnimationFrame((()=>{this._hideAllErrorCards(),this._hideAllRephraseCards()}))},this._onInputDblPress=e=>{var t;const{hasSynonymsEnabled:n,openCardHotkey:s}=this._storageController.getSettings();if((null===(t=e.detail)||void 0===t?void 0:t.key)!==s)return;const i=this._editors.find((t=>t.inputAreaWrapper===e.detail.inputAreaWrapper));if(!i)return;const r=i.inputAreaWrapper.getSelection();if(!r||r.start!==r.end)return;const o=i.displayedErrors.find((e=>e.start<=r.start&&r.start<=e.end));if(o){if(o.id===i.selectedErrorId)return;const e=i.highlighter.getTextBoxes(o.id);e.length&&(this._hideAllErrorCards(),this._hideAllRephraseCards(),i.selectedErrorId=o.id,this._highlight(i,!0),this._showErrorCard(i,o,e[0],!0))}else{if(!n||this._storageController.hasCustomServer())return;const e=p(i.inputAreaWrapper.getText(),r.start);if(e){if(i.rephraseCard&&i.rephraseCard.selection.start===e.position.start&&i.rephraseCard.selection.end===e.position.end)return;this._hideAllErrorCards(),this._hideAllRephraseCards();const t=e.position.start,n=e.position.end-t,s=i.inputAreaWrapper.getTextBoxes(t,n);this._showRephraseCard(i,s,e,!0)}}},this._onHiglighterBlockClicked=t=>{if(t.detail.blockId===Ot.BLOCK_ID)return void t.preventDefault();this._hideAllErrorCards(),this._hideAllRephraseCards(),this._hideAllDialogs();const n=this._editors.find((e=>e.highlighter===t.detail.highlighter));if(!n)return void t.preventDefault();const s=n.displayedErrors.find((e=>e.id===t.detail.blockId))||n.displayedPremiumErrors.find((e=>e.id===t.detail.blockId));if(!s)return void t.preventDefault();if(n.temporaryDisabledErrorId===s.id)return void t.preventDefault();if(!e.isRuntimeConnected())return void t.preventDefault();if(pe().trim())return void t.preventDefault();n.selectedErrorId=s.id;let i=!1;n.callbacks.onErrorClick&&(i=n.callbacks.onErrorClick(s)),i||this._showErrorCard(n,s,t.detail.clickedBox),this._highlight(n)},this._onToolbarPermissionRequiredIconClicked=()=>{e.openWindow(i.INSTALL_URL),V.trackEvent("Action","toolbar:open_install_url")},this._onToolbarToggleDialog=e=>{const t=this._editors.find((t=>t.toolbar===e.detail.toolbar));if(!t)return;let n=t.checkStatus;n===qe.COMPLETED&&t.displayedErrors.length>0?n="HAS_ERRORS":n===qe.COMPLETED&&t.premiumErrors.length>0&&(n="HAS_ONLY_PREMIUM_ERRORS"),V.trackEvent("Action","dialog:opened",n);const s=!t.dialog;this._hideAllErrorCards(),this._hideAllRephraseCards(),this._hideAllDialogs(!0),s&&this._showDialog(t)},this._onToolbarNotifyAboutPremiumIcon=e=>{const t=this._editors.find((t=>t.toolbar===e.detail.toolbar));t&&t.language&&(t.tracking.sawPremiumIcon=!0)},this._onTurnOffClicked=t=>{const n=this._editors.find((e=>e.dialog===t.detail.dialog));if(!n)return;const s=M();if(this._storageController.disableDomain(s),e.ltAssistantStatusChanged({enabled:!1}),V.trackEvent("Action","check_trigger:turn_off"),!this._storageController.getUIState().hasSeenTurnOnMessagePopup&&n.inputAreaTweaks.getMessagePopupAppearance().isVisible()){const e={className:"enable-spelling",hasPrimaryButton:!0,hasSecondaryButton:!0,isClosable:!0,destroysAutomatically:!0},t=new Tt(document,n.inputAreaTweaks.getMessagePopupAppearance(),e);this._messages.push(t)}},this._onPauseCheckingClicked=e=>{const t=this._editors.find((t=>t.dialog===e.detail.dialog));if(!t)return;const n=t.groupId;Array.from(this._editors).forEach((e=>{e.groupId===n&&this._destroyEditor(e)})),this._temporaryDisabledEditorGroups.push(t.groupId),V.trackEvent("Action","check_trigger:pause")},this._onTurnOnClicked=t=>{const n=M(),s=this._tweaks.getEditorGroupId(N());this._storageController.enableDomainAndEditorGroup(n,s),e.ltAssistantStatusChanged({enabled:!0});const i=Ee();i instanceof HTMLElement&&this._initElement(i,!0),V.trackEvent("Action","check_trigger:turn_on")},this._onPositionChangeClicked=e=>{this._storageController.updateUIState({dialogPosition:e.detail.newPosition})},this._onDialogEnableHere=e=>{const t=this._editors.find((t=>t.dialog===e.detail.dialog));t&&(this._enableEditor(t),V.trackEvent("Action","check_trigger:manually_triggered"))},this._onPickyModeToggle=e=>{const t=this._editors.find((t=>t.dialog===e.detail.dialog));t&&this._togglePickyMode(t,e.detail.isEnabled)},this._onDialogEnableEverywhere=e=>{this._storageController.updateSettings({autoCheck:!0,ignoreCheckOnDomains:[]}),V.trackEvent("Action","enable_everywhere")},this._onDialogLanguageChanged=e=>{const t=this._editors.find((t=>t.dialog===e.detail.dialog));t&&this._setLanguage(t,e.detail.language)},this._onDialogCountChanged=e=>{const t=this._editors.find((t=>t.dialog===e.detail.dialog));if(t&&t.dialog){t.countMode=e.detail.countMode,this._storageController.updateUIState({countMode:e.detail.countMode});let n=this._getCountOptions(t);t.dialog.setCountOptions(n)}},this._onErrorCardLanguageChanged=e=>{const t=this._editors.find((t=>t.errorCard===e.detail.errorCard));t&&(this._setLanguage(t,e.detail.language),V.trackEvent("Action","check_trigger:switch_language_variant"))},this._onErrorCardPickyModeTurnedOff=e=>{const t=this._editors.find((t=>t.errorCard===e.detail.errorCard));t&&this._togglePickyMode(t,!1)},this._onDialogErrorHighlighted=e=>{const t=this._editors.find((t=>t.dialog===e.detail.dialog));if(!t)return;const n=t.displayedErrors.find((t=>t.id===e.detail.errorId));n&&(t.selectedErrorId=n.id,this._highlight(t))},this._onDialogErrorSelected=e=>{const t=this._editors.find((t=>t.dialog===e.detail.dialog));if(!t)return;const n=t.displayedErrors.find((t=>t.id===e.detail.errorId));n&&this._scrollToError(t,n,"auto",!0)},this._onAddToDictionary=e=>{let t;if("errorCard"in e.detail){const n=e.detail.errorCard;t=this._editors.find((e=>e.errorCard===n))}else if("dialog"in e.detail){const n=e.detail.dialog;t=this._editors.find((e=>e.dialog===n))}if(this._hideAllErrorCards(),!t)return;const n=e.detail.error,s=n.originalPhrase;t.selectErrorAfter=e.detail.selectNextError?n.start:null,this._addToDictionary(t,s);const i=H.getPrimaryLanguageCode(n.language.code);(i.startsWith("de")||i.startsWith("en"))&&("de"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: de: ${n.contextPhrase}`):"del"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: del: ${n.contextPhrase}`):"air"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: air: ${n.contextPhrase}`):"click"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: click: ${n.contextPhrase}`):"school"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: school: ${n.contextPhrase}`):"un"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: un: ${n.contextPhrase}`):"eco"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: eco: ${n.contextPhrase}`):"geo"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: geo: ${n.contextPhrase}`):"et"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: et: ${n.contextPhrase}`):"and"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: and: ${n.contextPhrase}`):"el"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: el: ${n.contextPhrase}`):"of"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: of: ${n.contextPhrase}`):"for"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: for: ${n.contextPhrase}`):"the"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: the: ${n.contextPhrase}`):"pre"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: pre: ${n.contextPhrase}`):"black"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: black: ${n.contextPhrase}`):"connect"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: connect: ${n.contextPhrase}`):"day"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: day: ${n.contextPhrase}`):"advanced"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: advanced: ${n.contextPhrase}`):"social"===n.originalPhrase.toLowerCase()?V.trackEvent("Debug",`${i}: social: ${n.contextPhrase}`):"big"===n.originalPhrase.toLowerCase()&&V.trackEvent("Debug",`${i}: big: ${n.contextPhrase}`)),V.trackDictionaryEvent(i,n.originalPhrase,!1),V.trackEvent("Action",`${i}:add_word_to_dict`)},this._onIgnoreRule=e=>{let t;if("errorCard"in e.detail){const n=e.detail.errorCard;t=this._editors.find((e=>e.errorCard===n))}else if("dialog"in e.detail){const n=e.detail.dialog;t=this._editors.find((e=>e.dialog===n))}if(this._hideAllErrorCards(),!t)return;const n=e.detail.error,s=H.getPrimaryLanguageCode(n.language.code),i={id:n.rule.id,language:s,description:n.rule.description,turnOffDate:new Date};let r=!1;if(this._options.onRuleIgnore&&(r=this._options.onRuleIgnore(i,t.inputArea,n)),t.callbacks.onRuleIgnore&&(r=t.callbacks.onRuleIgnore(i,n)),!r){const e=this._storageController.getSettings().ignoredRules;e.push(i),this._storageController.updateSettings({ignoredRules:e})}t.selectErrorAfter=e.detail.selectNextError?n.start:null,V.trackDisabledRule(s,n.rule.id,`[${n.rule.subId||"0"}] ${n.contextPhrase}`,n.rule.isPremium),"errorCard"in e.detail&&V.trackEvent("Action",`${s}:disable_rule`,n.rule.id)},this._onTemporarilyIgnoreWord=e=>{let t;if("errorCard"in e.detail){const n=e.detail.errorCard;t=this._editors.find((e=>e.errorCard===n))}else if("dialog"in e.detail){const n=e.detail.dialog;t=this._editors.find((e=>e.dialog===n))}if(this._hideAllErrorCards(),!t)return;const n=e.detail.error,s=H.getPrimaryLanguageCode(n.language.code);if(t.callbacks.onTemporaryIgnore){const e={id:n.rule.id,phrase:n.originalPhrase,language:s};t.callbacks.onTemporaryIgnore(e,n)}this._temporarilyIgnoreWord(t,n.originalPhrase),t.selectErrorAfter=e.detail.selectNextError?n.start:null,V.trackDictionaryEvent(s,n.originalPhrase,!0),V.trackEvent("Action",`${s}:temp_ignore_word`)},this._onTemporarilyIgnoreRule=e=>{let t;if("errorCard"in e.detail){const n=e.detail.errorCard;t=this._editors.find((e=>e.errorCard===n))}else if("dialog"in e.detail){const n=e.detail.dialog;t=this._editors.find((e=>e.dialog===n))}if(this._hideAllErrorCards(),!t)return;const n=e.detail.error,s=t.groupId,i=H.getPrimaryLanguageCode(n.language.code),r={id:n.rule.id,language:i};if(n.rule.id.includes("PASSIVE_VOICE")||n.rule.id.includes("TOO_LONG_SENTENCE")||n.rule.id.includes("EN_QUOTES")||n.rule.id.includes("DASH_RULE")||n.rule.id.includes("TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN")||!(n.originalPhrase.length<1e3)||(r.phrase=n.originalPhrase),this._tweaks.persistTemporarySettings()){const e=`ignored:${s}`,t=Qe.get(e)||{words:[],rules:[]};t.rules.push(r),Qe.set(e,t)}const o=this._editors.filter((e=>e.groupId===s));t.callbacks.onTemporaryIgnore&&t.callbacks.onTemporaryIgnore(r,n),t.selectErrorAfter=e.detail.selectNextError?n.start:null,o.forEach((e=>this._temporarilyIgnoreRule(e,r))),"HIDDEN_RULE"!==n.rule.id&&(V.trackDisabledRule(i,n.rule.id,`[${n.rule.subId||"0"}] ${n.contextPhrase}`,n.rule.isPremium),"errorCard"in e.detail&&V.trackEvent("Action",`${i}:temp_disable_rule`,n.rule.id))},this._onMoreDetailsClicked=t=>{let n;if("errorCard"in t.detail){const e=t.detail.errorCard;n=this._editors.find((t=>t.errorCard===e))}n&&(e.openWindow(t.detail.url),V.trackEvent("Action","show_rule_details",t.detail.url))},this._onFixSelected=t=>{if(!t.detail)return void this._hideAllErrorCards();let n;if("errorCard"in t.detail){const e=t.detail.errorCard;n=this._editors.find((t=>t.errorCard===e))}else if("dialog"in t.detail){const e=t.detail.dialog;n=this._editors.find((t=>t.dialog===e))}if(this._hideAllErrorCards(),!n)return;const s=t.detail.error;n.selectErrorAfter=t.detail.selectNextError?s.start:null,this._applyFix(n,s,t.detail.fixIndex);const i=H.getPrimaryLanguageCode(s.language.code);"errorCard"in t.detail&&["en","de","es","ca","fr","nl","pt","it","pl"].includes(i)&&(s.isSpellingError?(Math.random()<.1&&V.trackEvent("Action",`${i}:apply_spell_suggestion:10perc`,s.rule.id),"de"===i&&t.detail.fixIndex>3&&Math.random()<.2&&V.trackEvent("Stat","de:apply:last",s.originalPhrase+":"+s.fixes[t.detail.fixIndex].value)):V.trackEvent("Action",`${i}:apply_rule`,s.rule.id)),"Translation"===s.fixes[t.detail.fixIndex].type&&V.trackEvent("Stat",`${i}:apply_translation`),Math.random()<.1&&s.rule.id&&s.isSpellingError&&(s.rule.id.startsWith("AI_SPELLING_RULE_EN_")||s.rule.id.startsWith("MORFOLOGIK_RULE_EN_"))&&V.trackEvent("Action",`${i}:apply_spell_suggestion_index:${t.detail.fixIndex}`,s.rule.id);const r=["en","de"].includes(i),o="standalone"===e.getType()||Math.random()<.1,a=n.id&&s.rule.id&&t.detail&&"number"==typeof t.detail.fixIndex;if(r&&o&&a){const{hasPaidSubscription:e}=this._storageController.getUIState(),r=e?"premium":"free",o=Bt(n.id,50),a=`${i}:apply_suggestion_index`,l=`${r}:${s.rule.id}:${t.detail.fixIndex}:${s.fixes.length}:${o}`;V.trackEvent("Action",a,l)}},this._onDialogOpenOptions=t=>{e.openOptionsPage(t.detail.target,t.detail.ref)},this._onDialogShowFeedbackForm=t=>{const n=this._editors.find((e=>e.dialog===t.detail.dialog));if(!n)return;const s=n.inputArea.cloneNode(!1);try{s.innerText=`${n.inputAreaWrapper.getText().length} chars, ${n.language?n.language.code:"unknown lang"}`}catch(t){}e.openFeedbackForm(N(),"",s.outerHTML||"")},this._onDialogDestroyed=e=>{const t=this._editors.find((t=>t.dialog===e.detail.dialog));t&&(t.dialog=null,null===t.errorCard&&this._unselectError(t))},this._onBadgeClicked=()=>{this._hideAllErrorCards(),this._hideAllRephraseCards();let t=!1;this._options.onPremiumTeaserClick&&(t=this._options.onPremiumTeaserClick()),t||e.openOptionsPage(void 0,"errorcard"),V.trackEvent("Action","check_trigger:badge:clicked",String(`premium:${this._storageController.getUIState().hasPaidSubscription}`))},this._onDialogPremiumTeaserClicked=e=>{const t=this._editors.find((t=>t.dialog===e.detail.dialog));if(!t)return;let n=!1;this._options.onPremiumTeaserClick&&(n=this._options.onPremiumTeaserClick()),n||this._openPremiumPage(t,e.detail.campaign)},this._onErrorCardPremiumTeaserClicked=e=>{const t=this._editors.find((t=>t.errorCard===e.detail.errorCard));if(!t)return;let n=!1;this._options.onPremiumTeaserClick&&(n=this._options.onPremiumTeaserClick()),n||this._openPremiumPage(t,e.detail.campaign)},this._onErrorCardLogoClicked=()=>{this._onLogoClicked("errorcard-logo")},this._onRephraseCardLogoClicked=()=>{this._onLogoClicked("synonyms-header")},this._onMessagePopupDestroyed=e=>{const t=this._messages.indexOf(e.detail.message);-1!==t&&this._messages.splice(t,1)},this._onErrorCardDestroyed=e=>{var t;const n=this._editors.find((t=>t.errorCard===e.detail.errorCard));n&&(n.errorCard=null,null===(t=n.dialog)||void 0===t||t.fadeIn(),n.selectedErrorId===e.detail.error.id&&(n.temporaryDisabledErrorId=n.selectedErrorId,window.setTimeout((()=>n.temporaryDisabledErrorId=null),500),this._unselectError(n)))},this._onCorrectAll=e=>{let t;if("errorCard"in e.detail){const n=e.detail.errorCard;t=this._editors.find((e=>e.errorCard===n))}else if("dialog"in e.detail){const n=e.detail.dialog;t=this._editors.find((e=>e.dialog===n))}if(this._hideAllErrorCards(),!t)return;console.log(e.detail);const n=e.detail.config,s=t.displayedErrors.filter((e=>e.rule.id===n.ruleId&&e.fixes.some((e=>n.suggestion.match.test(e.value))))),i=s.indexOf(e.detail.selectedError),r=s.splice(i,Number.MAX_SAFE_INTEGER);for(let e=0;e<i;e++)r.push(s[e]);this._correctMultipleErrors(t,r,n),V.trackEvent("Action","apply_multiple_at_once",n.ruleId)},this._onSynonymSelected=e=>{var t;const n=this._editors.find((t=>t.rephraseCard===e.detail.rephraseCard));if(this._hideAllRephraseCards(),!n)return;const s=e.detail.word,i=s.replace(s.trim(),e.detail.synonym),r=e.detail.selection.end||e.detail.selection.start;n.inputAreaTweaks.applyFix({offset:e.detail.selection.start,length:r-e.detail.selection.start,replacementText:i,editor:n}),this._temporarilyIgnoreWord(n,e.detail.synonym),z(100).then((()=>n.checkDebounce.callImmediately()));const{appliedSynonyms:o}=this._storageController.getStatistics();this._storageController.updateStatistics({appliedSynonyms:o+1}),V.trackEvent("Action","synonyms:applied",H.getPrimaryLanguageCode((null===(t=n.language)||void 0===t?void 0:t.code)||"unknown"))},this._onPhraseSelected=e=>{const t=this._editors.find((t=>t.rephraseCard===e.detail.rephraseCard));if(!t)return;const{selection:n,phrase:i}=e.detail,r=t.checkedText.text.slice(n.start,n.end);t.inputAreaTweaks.applyFix({offset:n.start,length:n.end-n.start,replacementText:i,editor:t}),z(100).then((()=>t.checkDebounce.callImmediately())),z(500).then((()=>{var e,o;return vt.create({language:null!==(o=null===(e=t.language)||void 0===e?void 0:e.code)&&void 0!==o?o:"en",parentElement:document.body,label:s.getMessage("notificationUndoLabel"),description:s.getMessage("notificationUndoDescription"),lifetime:4e3,undo:()=>{t.inputAreaTweaks.applyFix({offset:n.start,length:i.length,replacementText:r,editor:t}),V.trackEvent("Action","rephrasesV2:undo",H.getPrimaryLanguageCode(t.language?t.language.code:"unknown"))}}).show()}))},this._onRephraseCardDestroyed=e=>{const t=this._editors.find((t=>t.rephraseCard===e.detail.rephraseCard));t&&(t.rephraseCard=null,this._highlight(t))},this._onSettingsChanged=e=>{if(e.dictionary){const e=Je.get();for(const t of this._editors)t.errors=t.errors.filter((t=>!P(t,e))),this._updateDisplayedErrors(t),this._highlight(t),this._updateState(t)}if(e.ignoredRules)for(const e of this._editors)this._updateDisplayedErrors(e),this._highlight(e),this._updateState(e);if(e.disabledDomainsCapitalization&&this._editors.forEach((e=>{this._resetEditor(e),this._endTypingMode(e),this._checkEditor(e),this._highlight(e),this._updateState(e)})),e.hasPickyModeEnabledGlobally&&this._editors.forEach((e=>{this._resetEditor(e),this._endTypingMode(e),this._checkEditor(e),this._highlight(e),this._setCheckLevel(e,this._storageController.getSettings().hasPickyModeEnabledGlobally?"picky":"hidden-picky"),this._updateState(e)})),e.autoCheck||e.autoCheckOnDomains||e.disabledDomains||e.ignoreCheckOnDomains||e.disabledEditorGroups){const e=this._getCheckSettings();if(e.isDomainDisabled||e.isEditorGroupDisabled){Array.from(this._editors).forEach((e=>this._destroyEditor(e)))}else e.isAutoCheckEnabled?this._editors.filter((e=>!e.isAutoCheckEnabled)).forEach((e=>this._enableEditor(e))):e.isAutoCheckEnabled||(this._hideAllDialogs(),this._editors.forEach((e=>this._disableEditor(e))))}},this._onPrivacySettingsChanged=e=>{e.allowRemoteCheck&&e.allowRemoteCheck.newValue&&(this._isRemoteCheckAllowed=!0,this._editors.forEach((e=>{this._checkEditor(e),this._updateState(e)})))},this._onUiStateChanged=e=>{e.hasPaidSubscription&&this._editors.forEach((e=>{this._resetEditor(e),this._checkEditor(e),this._updateState(e)}))},this._onRephraseCardHighlight=e=>{var t;const n=this._editors.find((t=>t.rephraseCard===e.detail.rephraseCard));n&&(this._highlight(n),null===(t=n.rephraseCard)||void 0===t||t.updateTargetBoxes(n.highlighter.getTextBoxes(Ot.BLOCK_ID)))},this._onRephraseCardFlashSentence=e=>{const t=this._editors.find((t=>t.rephraseCard===e.detail.rephraseCard));t&&this._flashHighlight({offset:e.detail.offset,length:e.detail.length,duration:e.detail.duration,color:e.detail.color,editor:t})},this._onDestroy=t=>{var n,s;null===(n=(s=t).detail instanceof Object?s.detail:null)||void 0===n||n.type,e.getType(),this.destroy()},document.documentElement&&"HTML"===document.documentElement.nodeName&&(this._options=Object.assign({},n),"string"==typeof this._options.localeCode&&s.setLocale(this._options.localeCode),document.addEventListener(Gt.events.DESTROY,this._onDestroy),this._tweaks=r,this._tweaks.init(),this._isConnected=!0,this._temporaryDisabledEditorGroups=[],this._storageController=W.create(),this._storageController.onReady(this._init),Je.init(this._storageController,this._options.dictionary))}static _isPendingError(e,t){if(0===e.contextForSureMatch)return!1;const n=t.substr(e.end,100).split("\n")[0],s=Gt.COMPLETED_SENTENCE_REGEXP.test(n)||Gt.PUNCTIUATION_CHAR_REGEXP.test(e.originalPhrase);if(-1===e.contextForSureMatch&&!s)return!0;if(!s){if(n.split(/\s+/).length-1<=e.contextForSureMatch)return!0}return!1}static _isErrorSelected(e,t){return!(!t||t.start!==e.start&&t.end!==e.end)}static _getChangedParagraphs(e,t){return C(e,t).filter((e=>e.oldText!==e.newText&&null!==e.newText)).map((e=>({text:e.newText,offset:e.newOffset})))}_isSignificantTextChange(e,t){return Math.abs(t.length-e.length)>200}_getCheckSettings(){const e=M();return this._storageController.getCheckSettings(e,this._tweaks.getEditorGroupId(N()))}_fixIframeWithoutContentScripts(){return Ut(this,void 0,void 0,(function*(){if(!document.activeElement||"IFRAME"!==document.activeElement.nodeName)return;const t=document.activeElement.contentWindow;let n=!1;try{n=!!t.location.href}catch(e){}n&&"complete"===t.document.readyState&&t.document.documentElement&&(t.__ltJsLoaded||(Le(t)?t.__ltJsLoaded=!0:t.document.body&&De(t.document.body)&&(t.__ltJsLoaded=!0,yield e.loadContentScripts(t,"js"),e.initializeLTAssistant(t,this._options))),t.__ltCssLoaded||(!function(e){const t=e.document.createElement("div");t.className="lt-test-element",e.document.documentElement.appendChild(t);const n="absolute"===e.getComputedStyle(t).position;return t.remove(),n}(t)?t.document.body&&(t.__ltCssLoaded=!0,e.loadContentScripts(t,"css")):t.__ltCssLoaded=!0))}))}_initElement(t,n=!1){if(!t.parentElement)return;const s=this._tweaks.getInitElements(t);for(const i of s){if(this._editors.some((e=>e.inputArea===i)))continue;if(!this._tweaks.isElementCompatible(i))continue;const s=this._tweaks.getEditorGroupId(N());if(this._temporaryDisabledEditorGroups.includes(s))continue;const r=this._getCheckSettings();if(r.isDomainDisabled||r.isEditorGroupDisabled)continue;let o=null;"extension"===e.getType()&&(o=Ce(t))&&!Ie(o)&&Ne(o),window.clearTimeout(this._initElementTimeouts.get(i)),r.isAutoCheckEnabled&&this._disableOtherSpellCheckers(i);const a=()=>{i.removeEventListener("blur",l);const e=this._initElementTimeouts.get(i);window.clearTimeout(e),this._initElementTimeouts.delete(i)},l=()=>{a(),this._enableOtherSpellCheckers(i)};i.addEventListener("blur",l),this._initElementTimeouts.set(i,window.setTimeout((()=>{a(),!n||this._tweaks.hasFocus(i)?this.initElement(i):this._enableOtherSpellCheckers(i)}),150))}}initElement(e,t){if(this._editors.some((t=>t.inputArea===e)))throw"LanguageTool is already initialized on this element.";if(!this._storageController.isReady())throw"LTAssistant is not ready initialized yet.";const n=N(),s=String(t&&t.id||this._tweaks.getEditorId(n)),r=this._tweaks.getEditorGroupId(n),o=Ct.getInputAreaTweaks(n,e),a=o.getMirror(),l=o.getMaxTextLength(this._storageController,null==t?void 0:t.maxTextLengthBasic),c=o.getInputAreaWrapper(a,l),d=a?a.getCloneElement():null,h=new yt(e,c,d||e,!!a,o.getHighlighterTweaks(d||e,!!a),this._tweaks.getClickEvent());let _=null;"false"!==e.getAttribute("data-lt-toolbar")&&(_=new Dt(e,o.getToolbarAppearance(),a)),o.init();let u={words:t&&t.dictionary||[],rules:t&&t.ignoredRules||[]};this._tweaks.persistTemporarySettings()&&(u=Qe.get(`ignored:${r}`)||u);let g=this._storageController.getSettings().hasPickyModeEnabledGlobally?"picky":"hidden-picky";this._tweaks.persistTemporarySettings()&&(g=Qe.get(`checkLevel:${r}`)||g);let m=null,p=!1;if(this._tweaks.persistTemporarySettings()){const e=Qe.get(`forcedLanguage:${s}`);if(e){const t=H.LANGUAGES.find((t=>t.code===e));t&&(m=t,p=!0)}}const E={id:s,groupId:r,checkLevel:t&&t.checkLevel||g,showHiddenMatchesInplace:t&&t.showHiddenMatchesInplace||!1,makePickyPremium:t&&t.makePickyPremium||!1,inputArea:e,inputAreaTweaks:o,countMode:this._storageController.getUIState().countMode,mirror:a,inputAreaWrapper:c,highlighter:h,toolbar:_,dialog:null,errorCard:null,rephraseCard:null,ignoredRules:u.rules||[],ignoredWords:u.words||[],checkDebounce:new At(this._sendCheckRequest.bind(this),i.CHECK_DELAY,i.CHECK_MAX_DELAY),checkStatus:qe.COMPLETED,language:m,forceLanguage:p,isLanguageSupported:!0,isAutoCheckEnabled:this._getCheckSettings().isAutoCheckEnabled,isUserTyping:!1,isChecking:!1,isTextTooShort:!1,isTextTooLong:!1,needsLanguageHintFromUser:!1,checkError:null,lastCheckTimestamp:0,checkedText:{text:"",originalText:"",usedParts:[{start:0,end:0,originalStart:0,originalEnd:0,posDiff:0,length:0,text:""}],ignoredParts:[]},isIncompleteResult:!1,errors:[],pickyErrors:[],premiumErrors:[],premiumPickyErrors:[],pendingErrors:[],displayedErrors:[],displayedPremiumErrors:[],displayedHiddenErrorCount:0,selectedErrorId:null,selectErrorAfter:null,temporaryDisabledErrorId:null,typingTimeoutId:void 0,maxTextLengthBasic:null==t?void 0:t.maxTextLengthBasic,sentenceRanges:void 0,callbacks:{onDictionaryAdd:t&&t.onDictionaryAdd,onRuleIgnore:t&&t.onRuleIgnore,onTemporaryIgnore:t&&t.onTemporaryIgnore,onUpdate:t&&t.onUpdate,onErrorClick:t&&t.onErrorClick,onBeforeErrorCorrect:t&&t.onBeforeErrorCorrect},tracking:{hasTracked:!1,hasEnoughText:!1,sawPremiumIcon:!1,languageCode:null,maxTextLength:0}},f=(t&&t.language||"").toLowerCase();if(f){const e=H.LANGUAGES.find((e=>e.code===f));e&&(E.language=e,E.forceLanguage=!0)}return this._editors.push(E),this._checkEditor(E),this._updateState(E),o.onDestroy((()=>this._destroyEditor(E))),{addWord:e=>this._temporarilyIgnoreWord(E,e),addToDictionary:e=>this._addToDictionary(E,e),ignoreRule:e=>this._temporarilyIgnoreRule(E,e),clearIgnoredRules:()=>this._clearTemporarilyIgnoredRules(E),clearWords:()=>this._clearWords(E),getText:()=>E.inputAreaWrapper.getText(),getLanguage:()=>E.language,setLanguage:e=>this._setLanguage(E,e.toLowerCase()),setCheckLevel:e=>this._setCheckLevel(E,e),getCheckLevel:()=>E.checkLevel,getElement:()=>E.inputArea,getDisplayedErrors:()=>E.displayedErrors,getDisplayedPremiumErrors:()=>E.premiumErrors,getStatus:()=>E.checkStatus,getSelection:()=>E.inputAreaWrapper.getSelection(),setSelection:e=>E.inputAreaWrapper.setSelection(e),getTextBoxes:e=>E.highlighter.getTextBoxes(e.id),applyFix:(e,t)=>this._applyFix(E,e,t),scrollToError:(e,t=!1,n="nearest")=>this._scrollToError(E,e,n,t),destroy:()=>this._destroyEditor(E)}}highlightSuggestion(e,t){return je(e,t)}updateLanguageOptions(e){if(Array.isArray(e.preferredVariants)){const t={};for(const n of e.preferredVariants){const e=H.getPrimaryLanguageCode(n);"en"===e?t.enVariant=n:"de"===e?t.deVariant=n:"pt"===e?t.ptVariant=n:"ca"===e&&(t.caVariant=n)}this._storageController.updateSettings(t)}this._options.motherTongue&&this._storageController.updateSettings({motherTongue:e.motherTongue}),this._options.preferredLanguages&&this._storageController.updateSettings({geoIpLanguages:e.preferredLanguages,preferredLanguages:e.preferredLanguages})}updateUser(e){this._storageController.updateSettings({username:e.email,token:e.token,apiServerUrl:e.apiServerUrl||i.PREMIUM_SERVER_URL}),e.premium&&this._storageController.updateUIState({hasPaidSubscription:!0})}setLocale(e){s.setLocale(e)}_disableOtherSpellCheckers(e){if(!this._tweaks.shouldDisableOtherSpellCheckers(e))return;if(this._spellcheckingAttributesData.get(e))return;const t={spellcheck:e.getAttribute("spellcheck"),"data-gramm":e.getAttribute("data-gramm")},n="lt-"+Math.round(999999*Math.random());e.setAttribute(Gt.TMP_ID_ATTRIBUTE_NAME,String(n)),e.setAttribute("spellcheck","false"),e.setAttribute("data-gramm","false");let s=0;const i=new MutationObserver((()=>{if("false"!==e.getAttribute("spellcheck")||"false"!==e.getAttribute("data-gramm")){if(++s>2)return;e.setAttribute("spellcheck","false"),e.setAttribute("data-gramm","false")}}));i.observe(e,{attributes:!0,attributeFilter:["spellcheck","data-gramm"]}),this._spellcheckingAttributesData.set(e,{originalValues:t,mutationObserver:i})}_enableOtherSpellCheckers(e){const t=this._spellcheckingAttributesData.get(e);if(!t)return;t.mutationObserver.disconnect();const n=e.getAttribute(Gt.TMP_ID_ATTRIBUTE_NAME),s=Array.from(e.ownerDocument.querySelectorAll(`[${Gt.TMP_ID_ATTRIBUTE_NAME}="${n}"]`));s.includes(e)||s.push(e);for(const e in t.originalValues){const n=t.originalValues[e];t.originalValues[e]?s.forEach((t=>{t.setAttribute(e,n)})):s.forEach((t=>{t.removeAttribute(e)}))}s.forEach((e=>{e.removeAttribute(Gt.TMP_ID_ATTRIBUTE_NAME)})),this._spellcheckingAttributesData.delete(e)}_updateState(e){let t=qe.COMPLETED;const n=e.language?e.language.code:"";let s="";this._isConnected?this._isRemoteCheckAllowed?e.isAutoCheckEnabled?e.isUserTyping||e.isChecking?t=qe.IN_PROGRESS:e.checkError?(t=qe.FAILED,s=this._getCheckErrorMessage(e.checkError)):e.isTextTooShort?t=qe.TEXT_TOO_SHORT:e.isTextTooLong?t=qe.TEXT_TOO_LONG:e.isLanguageSupported?e.needsLanguageHintFromUser&&!e.forceLanguage&&(t=qe.NEEDS_LANGUAGE_HINT):t=qe.UNSUPPORTED_LANGUAGE:t=qe.DISABLED:t=qe.PERMISSION_REQUIRED:t=qe.DISCONNECTED,e.checkStatus=t;const i={checkStatus:t,errorsCount:e.displayedErrors.length,premiumErrorsCount:e.displayedPremiumErrors.length,isIncompleteResult:e.isIncompleteResult,checkErrorMessage:s,showNotification:this._storageController.canStartChangelogCoupon()};if(e.toolbar&&e.toolbar.updateState(i),e.dialog){const n=new et(e.checkedText.originalText,e.sentenceRanges||[]),i=(new Ze).calculateTextScore(n.getAllWords().length,e.errors,e.premiumErrors,e.pickyErrors),r={checkStatus:t,errors:e.errors,pickyErrors:e.pickyErrors,displayedPremiumErrors:e.displayedPremiumErrors,displayedErrors:e.displayedErrors,isIncompleteResult:e.isIncompleteResult,ignoredErrorsStats:this._getIgnoredErrorsStats(e.errors),checkErrorMessage:s,textScore:i,countOptions:this._getCountOptions(e),isPickyModeEnabled:"picky"===e.checkLevel};e.dialog.updateState(r)}if(e.displayedHiddenErrorCount=Math.max(e.displayedHiddenErrorCount,e.premiumErrors.length),e.callbacks.onUpdate||location.href.includes("validator/validator.html")){const i={checkStatus:t,languageCode:n,errors:e.errors,pickyErrors:e.pickyErrors,premiumErrors:e.premiumErrors,premiumPickyErrors:e.premiumPickyErrors,displayedErrors:e.displayedErrors,displayedPremiumErrors:e.displayedPremiumErrors,isIncompleteResult:e.isIncompleteResult,errorMessage:s,checkedText:e.checkedText,currentText:e.inputAreaWrapper.getText()};de(e.inputArea,Gt.events.UPDATE,i),e.callbacks.onUpdate&&e.callbacks.onUpdate(i)}}_getCheckErrorMessage(e){const t=(e.url||"<unknown>").replace(/\?.*/,"");switch(e.reason){case"ConnectionError":return s.getMessage("connectionProblem",t)+" (#1, code="+e.status+")";case"TimeoutError":return s.getMessage("connectionProblem",t)+" (#1, timeout)";case"TooManyErrors":return s.getMessage("tooManyErrors");case"TextTooLong":return s.getMessage("textTooLong");case"TooManyRequests":return s.getMessage("tooManyRequests");case"InvalidCredentials":return s.getMessage("invalidUsernameOrPassword");case"AccessDenied":return s.getMessage("accessDeniedError2");default:return s.getMessage("unknownError")+" ("+e.status+")"}}_getCountOptions(e){const t=new et(e.checkedText.originalText,e.sentenceRanges||[]);return{mode:e.countMode,counts:{characters:e.checkedText.originalText.length,sentences:t.getAllSentences().length,words:t.getAllWords().length}}}_togglePickyMode(e,t){const n=t?"picky":"hidden-picky",s=e.groupId,i=this._editors.filter((e=>e.groupId===s));if(i.forEach((e=>{this._setCheckLevel(e,n),this._updateState(e)})),this._tweaks.persistTemporarySettings()){const e=`checkLevel:${s}`;Qe.set(e,n)}}_setLanguage(e,t){var n;const s=e.language;let r=null;if("auto"===t)e.language=null,e.forceLanguage=!1,this._tweaks.persistTemporarySettings()&&Qe.remove(`forcedLanguage:${e.id}`);else{if(r=H.LANGUAGES.find((e=>e.code===t))||null,!r)throw new Error(`LTAssistant: Language '${t}' is not supported.`);e.language=r,e.forceLanguage=!0,this._tweaks.persistTemporarySettings()&&Qe.set(`forcedLanguage:${e.id}`,r.code)}if(r&&"NEEDS_LANGUAGE_HINT"===e.checkStatus){const{preferredLanguages:e}=this._storageController.getSettings(),t=H.getPrimaryLanguageCode(r.code);e.includes(t)||(e.push(H.getPrimaryLanguageCode(r.code)),this._storageController.updateSettings({preferredLanguages:e}),V.trackEvent("Action","dialog:set_language_from_hint",t))}if(this._resetEditor(e),this._endTypingMode(e),this._checkEditor(e,!0,!1),this._highlight(e),this._updateState(e),s&&s.code){if(e.checkedText.text.length>=i.SHORT_TEXT_MAX_LENGTH?V.trackEvent("Action","switch_language:long_text",`${s.code} -> ${t}`):V.trackEvent("Action","switch_language:"+((null===(n=null==s?void 0:s.detectedLanguage)||void 0===n?void 0:n.source)||"unknown"),`${s.code} -> ${t}`),r&&H.isLanguageVariant(s)&&H.isLanguageVariant(r)){const e=H.getPrimaryLanguageCode(s.code),t=H.getPrimaryLanguageCode(r.code);if(e===t&&s.code!==r.code){const e=H.formatLanguageCode(r.code);"en"===t?this._storageController.updateSettings({enVariant:e}):"de"===t?this._storageController.updateSettings({deVariant:e}):"pt"===t?this._storageController.updateSettings({ptVariant:e}):"ca"===t&&this._storageController.updateSettings({caVariant:e})}}}else V.trackEvent("Action","switch_language",`unknown -> ${t}`)}_setCheckLevel(e,t){this._resetEditor(e),e.checkLevel=t,this._checkEditor(e),V.trackEvent("Action","set_check_level",t)}_resetEditor(e){e.isChecking=!1,e.isTextTooShort=!1,e.isTextTooLong=!1,e.checkError=null,e.lastCheckTimestamp=0,e.checkedText={text:"",originalText:"",usedParts:[{start:0,end:0,originalStart:0,originalEnd:0,posDiff:0,length:0,text:""}],ignoredParts:[]},e.isIncompleteResult=!1,e.errors=[],e.pickyErrors=[],e.premiumErrors=[],e.pendingErrors=[],e.displayedErrors=[],e.displayedPremiumErrors=[],e.selectedErrorId=null,e.selectErrorAfter=null,e.errorCard&&e.errorCard.destroy(),e.rephraseCard&&e.rephraseCard.destroy()}_checkEditor(e,t,n){let s,r=!1;if(void 0===t&&void 0===n?(s=e.inputAreaWrapper.getText(),n=!1):"boolean"==typeof t&&void 0===n?(s=e.inputAreaWrapper.getText(),n=t):"string"==typeof t&&"boolean"==typeof n?s=t:(s=e.inputAreaWrapper.getText(),r=t),!this._isConnected)return!0;if(!this._isRemoteCheckAllowed||!e.isAutoCheckEnabled)return!0;const o=s.trim();if(o.length<i.MIN_TEXT_LENGTH||Gt.NO_LETTERS_REGEXP.test(o))return e.forceLanguage||(e.language=null,e.isLanguageSupported=!0),this._resetEditor(e),e.isTextTooShort=!0,e.checkDebounce.cancelCall(),!0;if(s.length>e.inputAreaTweaks.getMaxTextLength(this._storageController,e.maxTextLengthBasic)){const{hasPaidSubscription:t}=this._storageController.getUIState();if(!t&&!this._storageController.hasCustomServer())return e.forceLanguage||(e.language=null,e.isLanguageSupported=!0),this._resetEditor(e),e.isTextTooLong=!0,e.checkDebounce.cancelCall(),!0}return!e.forceLanguage&&function(e,t){const n=e.split("\n"),s=t.split("\n");for(const e of n)if(s.some((t=>t===e)))return!1;return!0}(e.checkedText.originalText,s)&&(e.language=null,e.isLanguageSupported=!0),e.isLanguageSupported||(e.isLanguageSupported=!0,e.forceLanguage||(e.language=null)),e.isChecking=!0,e.isTextTooShort=!1,e.isTextTooLong=!1,e.checkDebounce.call(e,s,r),n||e.checkDebounce.callImmediately(),!1}_sendCheckRequest(t,n,s){return Ut(this,void 0,void 0,(function*(){const i=t.inputAreaTweaks.getReplacedParts(n),r=E(n,i);if(r.text===t.checkedText.text)return void this._onCheckAborted(t,t.checkedText,r);const o=Gt._getChangedParagraphs(t.checkedText.text,r.text),a=N(),l=yield t.inputAreaTweaks.getRecipientInfo(),c=t.inputAreaTweaks.shouldUseParagraphLevelCaching(t),d={instanceId:t.id,pageUrl:a,checkLevel:t.checkLevel,elementLanguage:t.inputArea instanceof HTMLElement?t.inputArea.lang:"",recipientInfo:l,ignoreCapitalizationErrorsAtLineStart:!Te(t.inputArea),useParagraphLevelCaching:c},h=t.inputAreaTweaks.getCheckOptions(t,n),_=Date.now();try{const n=yield e.check(t,r.text,o,d,h,s);if(!n)return;n.isSuccessful?this._onCheckCompleted(n,r,_):this._onCheckFailed(n)}catch(e){t.isChecking=!1,console.error(e),V.trackError("message",e.message,"CHECK_TEXT"),e.message&&((u=e.message).startsWith("Invocation of form runtime.connect(null, ) doesn't match definition runtime.connect")||u.startsWith("Extension context invalidated"))?this._handleUnhealthyExtensionRuntime():(t.checkError={reason:"UnknownError",status:0},this._updateState(t))}var u}))}_onCheckCompleted(e,t,n){const s=this._editors.find((t=>t.id===e.instanceId));if(!s)return;if(!s.isAutoCheckEnabled)return;if(n<s.lastCheckTimestamp)return;const r=s.needsLanguageHintFromUser;if(s.checkError=null,s.isChecking=!1,s.lastCheckTimestamp=n,e.isUnsupportedLanguage)return this._resetEditor(s),this._endTypingMode(s),s.language=null,s.isLanguageSupported=!1,s.checkedText=t,this._highlight(s),void this._updateState(s);if(e.language&&!s.language&&(s.language=e.language),t.originalText.length>i.MIN_TEXT_LENGTH&&(s.tracking.languageCode=e.language?e.language.code:null,s.tracking.hasEnoughText=!0),s.tracking.maxTextLength=Math.max(t.originalText.length,s.tracking.maxTextLength),e.language&&s.dialog&&s.dialog.setCurrentLanguage(e.language.code),e.language&&e.language.code.toLowerCase()!==s.language.code.toLowerCase())return this._resetEditor(s),s.language=e.language,this._checkEditor(s),this._highlight(s),void this._updateState(s);let{errors:o,pickyErrors:a,premiumErrors:l,premiumPickyErrors:c,sentenceRanges:d}=bt.merge({existing:{errors:s.errors,pickyErrors:s.pickyErrors,premiumErrors:s.premiumErrors,premiumPickyErrors:s.premiumPickyErrors,sentenceRanges:s.sentenceRanges},new:{textLevel:{errors:e.textLevelErrors,pickyErrors:e.textLevelPickyErrors,premiumErrors:e.textLevelPremiumErrors,premiumPickyErrors:e.textLevelPremiumPickyErrors},paragraphLevel:{errors:e.paragraphLevelErrors,pickyErrors:e.paragraphLevelPickyErrors,premiumErrors:e.paragraphLevelPremiumErrors,premiumPickyErrors:e.paragraphLevelPremiumPickyErrors,sentenceRanges:e.paragraphLevelSentenceRanges}},existingCheckedText:s.checkedText,newCheckedText:t},s.makePickyPremium&&!this._storageController.getUIState().hasPaidSubscription);s.checkedText=t,s.errors=o,s.pickyErrors=a,s.premiumErrors=l,s.premiumPickyErrors=c,s.isIncompleteResult=e.isIncompleteResult,s.needsLanguageHintFromUser=!1===s.forceLanguage&&this._needsLanguageHintFromUser(o,t.text),s.sentenceRanges=d,o=bt.migrateErrorsToValuableText(o,t.usedParts);const h=s.inputAreaWrapper.getText(),_=E(h,s.inputAreaTweaks.getReplacedParts(h));o=bt.migrateErrorsBetweenTexts(o,t.text,_.text),o=bt.migrateErrorsToOriginalText(o,_.usedParts),this._updateDisplayedErrors(s,_,o,l),0===s.pendingErrors.length&&this._endTypingMode(s);const u=!1===r&&!0===s.needsLanguageHintFromUser,g=!0===r&&!1===s.needsLanguageHintFromUser;u?s.highlighter.disableHighlighting():g&&s.highlighter.enableHighlighting(),this._highlight(s),this._updateState(s)}_needsLanguageHintFromUser(t,n){if("extension"!==e.getType())return!1;const s=t.filter((e=>{if(e.isSpellingError){const t=e.originalPhrase.toLowerCase();if(e.fixes.some((e=>t===e.value.toLowerCase())))return!1;const n=D(e.originalPhrase.toLowerCase());return!e.fixes.some((e=>n===D(e.value.toLowerCase())))}return!1}));if(s.length<3||n.length>i.SHORT_TEXT_MAX_LENGTH)return!1;return s.reduce(((e,{length:t})=>e+t),0)/n.length>.4}_onCheckAborted(e,t,n){e.isChecking=!1,e.pendingErrors=[],this._endTypingMode(e),e.errors=bt.migrateErrorsBetweenSameOriginalTexts(e.errors,t,n),e.pickyErrors=bt.migrateErrorsBetweenSameOriginalTexts(e.pickyErrors,t,n),e.premiumErrors=bt.migrateErrorsBetweenSameOriginalTexts(e.premiumErrors,t,n),e.checkedText=n,e.lastCheckTimestamp=Date.now(),this._updateDisplayedErrors(e),this._highlight(e),this._updateState(e)}_onCheckFailed(e){const t=this._editors.find((t=>t.id===e.instanceId));t&&(this._resetEditor(t),t.checkError=e.error,e&&e.error&&e.error.response&&void 0!==e.error.status?e.error.response.includes("too many errors")?V.trackError("http",`${e.error.status}: Too many errors`):e.error.response.includes("Client request limit")?V.trackError("http",`${e.error.status}: Client Request Limit`):e.error.response.includes("Client request size limit")?V.trackError("http",`${e.error.status}: Client Request Size Limit`):e.error.response.includes("oo many recent timeouts")?V.trackError("http",`${e.error.status}: Too Many Recent Timeouts`):e.error.response.match(/(application|page|site|request) blocked/i)||e.error.response.match(/has been blocked|cannot be accessed/)||e.error.response.match(/blocked by parental control/i)?V.trackError("http",`${e.error.status}: Application blocked by proxy`):V.trackError("http",`${e.error.status}: ${e.error.response}`):V.trackError("http","unknown"),this._highlight(t),this._updateState(t))}_startTypingMode(e){e.isUserTyping=!0,window.clearTimeout(e.typingTimeoutId),e.typingTimeoutId=window.setTimeout((()=>this._endTypingModeAndUpdateState(e)),i.STOPPED_TYPING_TIMEOUT)}_endTypingModeAndUpdateState(e){this._endTypingMode(e);const t=e.inputAreaWrapper.getText(),n=E(t,e.inputAreaTweaks.getReplacedParts(t)),s=bt.migrateErrorsBetweenTexts(e.errors,e.checkedText.originalText,t),i=bt.migrateErrorsBetweenTexts(e.premiumErrors,e.checkedText.originalText,t);this._updateDisplayedErrors(e,n,s,i),this._highlight(e),this._updateState(e)}_endTypingMode(e){e.isUserTyping=!1,window.clearTimeout(e.typingTimeoutId)}_updateDisplayedErrors(e,t=e.checkedText,n=e.errors,s=e.premiumErrors){n=(n=e.inputAreaTweaks.filterErrors(e,t,n)).filter(((t,s)=>{if(["DOUBLES_ESPACES","DOPPELTES_LEERZEICHEN","CONSECUTIVE_SPACES","DOBLE_ESPACIO","DUBBELE_SPATIE"].includes(t.rule.id))return 2===t.length&&t.originalPhrase.length===t.length&&(Te(e.inputArea)||e.inputArea.classList.contains("kix-canvas-tile-content")||/^(\u00A0 | \u00A0)$/.test(t.originalPhrase));if(["COMMA_PARENTHESIS_WHITESPACE"].includes(t.rule.id))return t.originalPhrase.length===t.length;if("UNPAIRED_BRACKETS"===t.rule.id){const e=n[s+1],i=n[s-1];if(e&&0===t.fixes.length&&"„"===t.originalPhrase&&["UNPAIRED_BRACKETS","FALSCHES_ANFUEHRUNGSZEICHEN"].includes(e.rule.id)&&"”"===e.originalPhrase)return!1;if(e&&0===t.fixes.length&&"„"===t.originalPhrase&&["UNPAIRED_BRACKETS","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_CH"].includes(e.rule.id)&&'"'===e.originalPhrase)return!1;if(i&&0===t.fixes.length&&"“"===t.originalPhrase&&["UNPAIRED_BRACKETS","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_CH"].includes(i.rule.id)&&'"'===i.originalPhrase)return!1}return!0})),e.showHiddenMatchesInplace&&(n=n.concat(s),bt.sortErrorsByOffset(n));let{ignoredRules:i}=this._storageController.getSettings();const r=e.inputAreaWrapper.getSelection(),o=e.displayedErrors;e.displayedErrors=[],e.pendingErrors=[],e.displayedPremiumErrors=[];for(const t of n){if(!(P(t,e.ignoredWords)||O(t,i)||O(t,e.ignoredRules))){if(e.isUserTyping&&(Gt._isPendingError(t,e.checkedText.originalText)||Gt._isErrorSelected(t,r))){if(!o.some((e=>e.start===t.start&&e.end===t.end||e.id===t.id&&e.originalPhrase===t.originalPhrase))){e.pendingErrors.push(t);continue}}e.displayedErrors.push(t)}}if(e.displayedPremiumErrors=[...s],null!==e.selectErrorAfter){const t=this._getErrorAfter(e,e.selectErrorAfter);e.selectErrorAfter=null,null!==t&&this._scrollToError(e,t,"auto",!0,!0)}}_flashHighlight(e){e.editor.flashHighlight={id:"FLASH",offset:e.offset,length:e.length,isEmphasized:!0,backgroundColor:e.color,isUnderlined:!1,underlineColor:""},this._highlight(e.editor,!0),window.setTimeout((()=>{e.editor.flashHighlight=null,this._highlight(e.editor)}),e.duration)}_highlight(e,t=!1){const n=e.displayedErrors.map((t=>{let n=i.COLORS.GRAMMAR.UNDERLINE,s=i.COLORS.GRAMMAR.BACKGROUND,r=i.COLORS.GRAMMAR.EMPHASIZE;return"HIDDEN_RULE"===t.rule.id&&"test2"===e.showHiddenMatchesInplace?(n=i.COLORS.HIDDEN_MATCH.UNDERLINE,s=i.COLORS.HIDDEN_MATCH.BACKGROUND,r=i.COLORS.HIDDEN_MATCH.EMPHASIZE):t.rule.id.startsWith("TOO_LONG_SENTENCE")?(n=i.COLORS.LONG_SENTENCE.UNDERLINE,s=i.COLORS.LONG_SENTENCE.BACKGROUND,r=i.COLORS.LONG_SENTENCE.EMPHASIZE):"IGNORED_RANGE"===t.rule.id?(n=i.COLORS.IGNORED_RANGE.UNDERLINE,s=i.COLORS.IGNORED_RANGE.BACKGROUND,r=i.COLORS.IGNORED_RANGE.EMPHASIZE):t.isSpellingError?(n=i.COLORS.SPELLING.UNDERLINE,s=i.COLORS.SPELLING.BACKGROUND,r=i.COLORS.SPELLING.EMPHASIZE):(t.isStyleError||t.isCustomError)&&(n=i.COLORS.STYLE.UNDERLINE,s=i.COLORS.STYLE.BACKGROUND,r=i.COLORS.STYLE.EMPHASIZE),{id:t.id,offset:t.start,length:t.length,isEmphasized:t.id===e.selectedErrorId||!!this._options.emphasizeErrors,backgroundColor:t.id===e.selectedErrorId?s:r,isUnderlined:!0,underlineColor:n}}));if(e.rephraseCard){const t=e.rephraseCard.selection,s=e.rephraseCard.underlineColor,i=e.rephraseCard.backgroundColor;n.push({id:Ot.BLOCK_ID,offset:t.start,length:t.end-t.start,isEmphasized:""!==i,isUnderlined:!1,simulateSelection:!0,backgroundColor:i,underlineColor:s})}e.flashHighlight&&n.push(e.flashHighlight),e.highlighter.highlight(n,t)}_enableEditor(e){e.isAutoCheckEnabled=!0,this._disableOtherSpellCheckers(e.inputArea),e.inputAreaWrapper.resetText(),this._resetEditor(e),this._checkEditor(e),this._updateState(e)}_disableEditor(e){e.isAutoCheckEnabled=!1,this._enableOtherSpellCheckers(e.inputArea),e.inputAreaWrapper.resetText(),this._resetEditor(e),this._endTypingMode(e),this._highlight(e),this._updateState(e)}_trackEditor(t){(e.isRuntimeConnected()||t.tracking.hasTracked)&&(t.tracking.hasTracked=!0,Math.random()<.1&&t.tracking.hasEnoughText&&e.trackEvent(`saw_premium_icon_10perc:${t.tracking.sawPremiumIcon}`,t.tracking.languageCode),Math.random()<.01&&e.trackTextLength(t.tracking.maxTextLength))}_destroyEditor(e){const t=this._editors.indexOf(e);if(-1===t)return;this._editors.splice(t,1),e.inputAreaWrapper.destroy(),e.highlighter.destroy(),e.inputAreaTweaks.destroy(),e.toolbar&&e.toolbar.destroy(),window.clearTimeout(e.typingTimeoutId),e.mirror&&e.mirror.destroy(),e.errorCard&&e.errorCard.destroy(),e.rephraseCard&&e.rephraseCard.destroy(),e.dialog&&e.dialog.destroy();const n=this._initElementTimeouts.get(e.inputArea);n&&(this._initElementTimeouts.delete(e.inputArea),clearTimeout(n)),this._enableOtherSpellCheckers(e.inputArea),this._savePremiumErrorCount(e),this._trackEditor(e)}_getErrorAfter(e,t){let n=null;const s=e.displayedErrors.concat(e.displayedPremiumErrors);bt.sortErrorsByOffset(s);for(const e of s)e.start<=t||(null===n||e.start<n.start)&&(n=e);return null===n&&s.length>0&&(n=s[0]),n}_showErrorCard(e,t,n,s=!1){const i=this._storageController.getManagedSettings(),r=void 0!==this._options.disableRuleIgnore?this._options.disableRuleIgnore:i.disableIgnoredRules,o=void 0!==this._options.disableDictionaryAdd?this._options.disableDictionaryAdd:i.disablePersonalDictionary,a=e.inputAreaTweaks.getErrorCardTweaks(),l={disableIgnoringRule:r,disableAddingWord:o,isPremiumAccount:this._storageController.getUIState().hasPaidSubscription,geoIpCountry:this._storageController.getSettings().geoIpCountry,showFooter:!this._options.disablePremiumTeaser,showHiddenMatchesInplace:e.showHiddenMatchesInplace,enableKeyboard:s,canCorrectMultipleAtOnce:e.inputAreaTweaks.canCorrectMultipleErrorsAtOnce(e)&&Ve(e.displayedErrors,t)};e.errorCard=new mt(e.inputArea,n,t,a,l),this._fadeAllDialogs();const c=H.getPrimaryLanguageCode(t.language.code);t.isSpellingError?Math.random()<.1&&V.trackEvent("Action",`${c}:open_spell_suggestion:10perc`,t.rule.id):V.trackEvent("Action",`${c}:open_rule`,t.rule.id),t.language.code.startsWith("de")&&t.fixes.length&&t.fixes[0].value.match(/\(.+\)/)&&!["HALLE_STADT","EINHEITEN_METRISCH","NEUKIRCHEN_STADT","UG_HAFTUNGSBESCHRÄNKT"].includes(t.rule.id)&&V.trackError("other","broken_fix",c+":"+t.rule.id+": "+t.contextPhrase)}_hideAllErrorCards(){this._editors.forEach((e=>{var t;e.errorCard&&e.errorCard.destroy(),null===(t=e.dialog)||void 0===t||t.fadeIn()}))}_showRephraseCard(t,n,s,i=!1){e.isRuntimeConnected()&&function(e,t=400,n=15){return new Promise(((s,i)=>{let r=0;const o=()=>{const t=e();null!=t&&(clearInterval(a),s(t)),++r>=n&&(clearInterval(a),i())},a=setInterval(o,t);o()}))}((()=>t.language?t.language.code:t.isTextTooShort?H.getUserLanguageCodes()[0]||"en":t.errors[0]?t.errors[0].language.code:void 0)).then((e=>{var r;const{username:o,motherTongue:a,geoIpCountry:l,preferredLanguages:c,dpaLevel:d,confirmedGPT3:h}=this._storageController.getSettings();t.rephraseCard=new Ot(this._storageController.getUniqueId(),t.inputArea,t.inputAreaWrapper.getText(),n,s,e,a,c,d,h,function(e){return e.displayedErrors.concat(e.displayedPremiumErrors).some((e=>!1===e.isPunctuationError&&!1===e.isSpellingError&&!1===e.isStyleError&&!1===e.isCustomError))}(t),function(e){return e.displayedErrors.concat(e.displayedPremiumErrors).some((e=>e.isSpellingError))}(t),{hasSubscription:this._storageController.getUIState().hasPaidSubscription,showHeader:!this._options.disablePremiumTeaser,email:o,geoIpCountry:l,enableKeyboard:i},t.inputAreaTweaks.getErrorCardTweaks(),(()=>t.sentenceRanges),(e=>{this._storageController.updateSettings({confirmedGPT3:e})})),V.trackEvent("Action","synonyms:open",H.getPrimaryLanguageCode((null===(r=t.language)||void 0===r?void 0:r.code)||"unknown"))})).catch((e=>{V.trackEvent("Other-Error","synonyms:no_language",e&&e.message)}))}_hideAllRephraseCards(){this._editors.forEach((e=>{var t;e.rephraseCard&&(e.rephraseCard.destroy(),this._highlight(e)),null===(t=e.dialog)||void 0===t||t.fadeIn()}))}_hideAllMessagePopups(){this._messages.forEach((e=>{e&&e.destroy()}))}_showDialog(t){if(!t.toolbar)return;const n=t.language&&t.language.code,s=new et(t.checkedText.originalText,t.sentenceRanges||[]),i=(new Ze).calculateTextScore(s.getAllWords().length,t.errors,t.premiumErrors,t.pickyErrors),r={checkStatus:t.checkStatus,displayedErrors:t.displayedErrors,errors:t.errors,pickyErrors:t.pickyErrors,displayedPremiumErrors:t.displayedPremiumErrors,isIncompleteResult:t.isIncompleteResult,ignoredErrorsStats:this._getIgnoredErrorsStats(t.errors),checkErrorMessage:t.checkError?this._getCheckErrorMessage(t.checkError):"",textScore:i,countOptions:this._getCountOptions(t),isPickyModeEnabled:"picky"===t.checkLevel},o=this._storageController.getManagedSettings(),a=void 0!==this._options.disableRuleIgnore?this._options.disableRuleIgnore:o.disableIgnoredRules,l=void 0!==this._options.disableDictionaryAdd?this._options.disableDictionaryAdd:o.disablePersonalDictionary,c={disableOptionsPage:!e.isOptionsPageSupported(),disableSaveDocument:!0,disableTurnOff:!1,disableFeedbackForm:!e.isFeedbackFormSupported(),disableHelpCenter:!1,disableRatingTeaser:this._storageController.getUIState().hasRated||this._storageController.canStartChangelogCoupon()||this._storageController.isChangelogCouponRunning(),disableIgnoringRule:a,disableAddingWord:l,dialogPosition:this._storageController.getUIState().dialogPosition,isPremiumAccount:this._storageController.getUIState().hasPaidSubscription,canCorrectMultipleErrorsAtOnce:t.inputAreaTweaks.canCorrectMultipleErrorsAtOnce(t)};t.dialog=new gt(t.toolbar.getContainer(),t.inputAreaTweaks.getDialogAppearance(),n,r,c)}_hideAllDialogs(t=!1){this._editors.forEach((n=>{if(!n.dialog)return;n.dialog.setApplyFixMode(!1),n.dialog.closeAllMenus();"default"!==n.dialog.getCurrentPosition()&&e.isRuntimeConnected()&&!t||n.dialog.destroy()}))}_fadeAllDialogs(){this._editors.forEach((e=>{e.dialog&&e.dialog.fadeOut()}))}_savePremiumErrorCount(t){if(!t.displayedHiddenErrorCount||!e.isRuntimeConnected())return;const n=(new Date).toDateString(),{hiddenErrors:s}=this._storageController.getStatistics();s[0]&&s[0].day===n?s[0].count+=t.displayedHiddenErrorCount:s.unshift({day:n,count:t.displayedHiddenErrorCount}),s.length=Math.min(s.length,62),this._storageController.updateStatistics({hiddenErrors:s})}_getIgnoredErrorsStats(e){const{ignoredRules:t}=this._storageController.getSettings(),n=Je.get(),s=[],i=[];return e.forEach((e=>{e.isSpellingError&&P(e,n)&&!s.includes(e.originalPhrase)&&s.push(e.originalPhrase),e.isSpellingError||!O(e,t)||i.includes(e.rule.id)||i.push(e.rule.id)})),{byDictionary:s.length,byRules:i.length}}_handleUnhealthyExtensionRuntime(){this._isConnected=!1,this._hideAllErrorCards(),this._editors.forEach((e=>{e.highlighter&&e.highlighter.destroy(),this._updateState(e)})),window.clearInterval(this._checkExtensionRuntimeHealthIntervalId)}destroy(){Array.from(this._editors).forEach((e=>this._destroyEditor(e))),this._spellcheckingAttributesData.forEach(((e,t)=>this._enableOtherSpellCheckers(t))),this._tweaks&&document.removeEventListener(this._tweaks.getClickEvent(),this._onDocumentClick,!0),document.removeEventListener("focus",this._onDocumentFocus,!0),document.removeEventListener("mousemove",this._onDocumentMousemove,!0),document.removeEventListener("focusout",this._onDocumentFocusout,!0),window.frameElement&&window.frameElement.ownerDocument&&window.frameElement.ownerDocument.removeEventListener("click",this._onDocumentClick,!0),document.removeEventListener(st.eventNames.scroll,this._onInputScroll),document.removeEventListener(st.eventNames.paste,this._onInputPaste),document.removeEventListener(st.eventNames.textChanged,this._onInputTextChanged),document.removeEventListener(st.eventNames.dblclick,this._onInputDblClick),document.removeEventListener(st.eventNames.dblPress,this._onInputDblPress),document.removeEventListener(yt.eventNames.blockClicked,this._onHiglighterBlockClicked),document.removeEventListener(Dt.eventNames.permissionRequiredIconClicked,this._onToolbarPermissionRequiredIconClicked),document.removeEventListener(Dt.eventNames.toggleDialog,this._onToolbarToggleDialog),document.removeEventListener(Dt.eventNames.notifyAboutPremiumIcon,this._onToolbarNotifyAboutPremiumIcon),document.removeEventListener(gt.eventNames.enableHere,this._onDialogEnableHere),document.removeEventListener(gt.eventNames.positionChangeClicked,this._onPositionChangeClicked),document.removeEventListener(gt.eventNames.togglePickyMode,this._onPickyModeToggle),document.removeEventListener(gt.eventNames.enableEverywhere,this._onDialogEnableEverywhere),document.removeEventListener(gt.eventNames.languageChanged,this._onDialogLanguageChanged),document.removeEventListener(gt.eventNames.countChanged,this._onDialogCountChanged),document.removeEventListener(gt.eventNames.errorSelected,this._onDialogErrorSelected),document.removeEventListener(gt.eventNames.errorHighlighted,this._onDialogErrorHighlighted),document.removeEventListener(gt.eventNames.addToDictionaryClicked,this._onAddToDictionary),document.removeEventListener(gt.eventNames.ignoreRuleClicked,this._onIgnoreRule),document.removeEventListener(gt.eventNames.temporarilyIgnoreWordClicked,this._onTemporarilyIgnoreWord),document.removeEventListener(gt.eventNames.temporarilyIgnoreRuleClicked,this._onTemporarilyIgnoreRule),document.removeEventListener(gt.eventNames.moreDetailsClicked,this._onMoreDetailsClicked),document.removeEventListener(gt.eventNames.fixSelected,this._onFixSelected),document.removeEventListener(gt.eventNames.openOptions,this._onDialogOpenOptions),document.removeEventListener(gt.eventNames.showFeedbackForm,this._onDialogShowFeedbackForm),document.removeEventListener(gt.eventNames.destroyed,this._onDialogDestroyed),document.removeEventListener(gt.eventNames.badgeClicked,this._onBadgeClicked),document.removeEventListener(gt.eventNames.turnOff,this._onTurnOffClicked),document.removeEventListener(gt.eventNames.pauseChecking,this._onPauseCheckingClicked),document.removeEventListener(gt.eventNames.premiumTeaserClicked,this._onDialogPremiumTeaserClicked),document.removeEventListener(gt.eventNames.correctAll,this._onCorrectAll),document.removeEventListener(mt.eventNames.addToDictionaryClicked,this._onAddToDictionary),document.removeEventListener(mt.eventNames.ignoreRuleClicked,this._onIgnoreRule),document.removeEventListener(mt.eventNames.temporarilyIgnoreWordClicked,this._onTemporarilyIgnoreWord),document.removeEventListener(mt.eventNames.temporarilyIgnoreRuleClicked,this._onTemporarilyIgnoreRule),document.removeEventListener(mt.eventNames.moreDetailsClicked,this._onMoreDetailsClicked),document.removeEventListener(mt.eventNames.fixSelected,this._onFixSelected),document.removeEventListener(mt.eventNames.badgeClicked,this._onBadgeClicked),document.removeEventListener(mt.eventNames.logoClicked,this._onErrorCardLogoClicked),document.removeEventListener(mt.eventNames.languageChanged,this._onErrorCardLanguageChanged),document.removeEventListener(mt.eventNames.turnOffPickyModeClicked,this._onErrorCardPickyModeTurnedOff),document.removeEventListener(mt.eventNames.premiumTeaserClicked,this._onErrorCardPremiumTeaserClicked),document.removeEventListener(mt.eventNames.destroyed,this._onErrorCardDestroyed),document.removeEventListener(mt.eventNames.correctAll,this._onCorrectAll),document.removeEventListener(Ot.eventNames.synonymSelected,this._onSynonymSelected),document.removeEventListener(Ot.eventNames.phraseSelected,this._onPhraseSelected),document.removeEventListener(Ot.eventNames.logoClicked,this._onRephraseCardLogoClicked),document.removeEventListener(Ot.eventNames.destroyed,this._onRephraseCardDestroyed),document.removeEventListener(Ot.eventNames.highlight,this._onRephraseCardHighlight),document.removeEventListener(Tt.eventNames.destroyed,this._onMessagePopupDestroyed),document.removeEventListener(Tt.eventNames.turnOn,this._onTurnOnClicked),document.removeEventListener(Gt.events.DESTROY,this._onDestroy),window.removeEventListener("pageshow",this._onPageLoaded),window.removeEventListener("pagehide",this._onPageHide),this._storageController&&this._storageController.destroy(),this._tweaks&&this._tweaks.destroy(),window.clearInterval(this._checkExtensionRuntimeHealthIntervalId),window.clearInterval(this._fixTinyMCEIntervalId),this._editors.forEach((e=>{e.checkDebounce.cancelCall()})),this._options&&this._options.onDestroy&&this._options.onDestroy()}_scrollToError(e,t,n,s,i){let r="nearest",o=!1,a=!1;if("string"==typeof n&&(r=n),"boolean"==typeof s&&(o=s),"boolean"==typeof i&&(a=i),this._hideAllDialogs(),"auto"===r){const t=e.inputArea.ownerDocument.documentElement.clientHeight;r=t<400?"nearest":"center"}return new Promise((n=>{e.inputAreaWrapper.scrollToText(t.start,t.length,"smooth",r,(()=>{e.selectedErrorId=t.id,this._highlight(e,!0);const s=e.inputAreaWrapper.getTextBoxes(t.start,t.length);o&&s.length&&this._showErrorCard(e,t,s[0],a),n(s)}))}))}_unselectError(e){null!==e.selectedErrorId&&(e.selectedErrorId=null,this._highlight(e))}_addToDictionary(e,t){let n=!1;this._options.onDictionaryAdd&&(n=this._options.onDictionaryAdd(t,e.inputArea)),e.callbacks.onDictionaryAdd&&(n=e.callbacks.onDictionaryAdd(t)),n||Je.add(t)}_temporarilyIgnoreWord(e,t){const n=e.groupId;if(this._tweaks.persistTemporarySettings()){const e=`ignored:${n}`,s=Qe.get(e)||{words:[],rules:[]};s.words.push(t),Qe.set(e,s)}const s=this._editors.filter((e=>e.groupId===n));s.forEach((e=>{e.ignoredWords.push(t),this._updateDisplayedErrors(e),this._highlight(e),this._updateState(e)}))}_temporarilyIgnoreRule(e,t){e.ignoredRules.push(t),this._updateDisplayedErrors(e),this._highlight(e),this._updateState(e)}_clearTemporarilyIgnoredRules(e){e.ignoredRules=[],this._updateDisplayedErrors(e),this._highlight(e),this._updateState(e)}_clearWords(e){e.ignoredWords=[],this._updateDisplayedErrors(e),this._highlight(e),this._updateState(e)}_applyFix(e,t,n,s=!1){const i=t.fixes[n].value,r={offset:t.start,length:t.length,replacementText:i,editor:e};e.callbacks.onBeforeErrorCorrect&&e.callbacks.onBeforeErrorCorrect(t);const o=e.inputAreaTweaks.applyFix(r);return s||this._afterApplyFix(e),o}_afterApplyFix(e){z(300).then((()=>this._checkEditor(e)));const{appliedSuggestions:t}=this._storageController.getStatistics();this._storageController.updateStatistics({appliedSuggestions:t+1})}_openPremiumPage(t,n){const s=t.displayedPremiumErrors.filter((e=>!e.isStyleError&&!e.isPunctuationError)).length,i=t.displayedPremiumErrors.filter((e=>e.isPunctuationError)).length,r=t.displayedPremiumErrors.filter((e=>e.isStyleError)).length,o=t.language&&t.language.code||void 0;e.openPremiumPage(n,s,r,i,"",o)}_onLogoClicked(n){this._hideAllErrorCards(),this._hideAllRephraseCards();let s=`https://languagetool.org/?pk_campaign=addon2-${n}`;t.isSafari()&&(s+="&hidePremium=true"),e.openWindow(s),V.trackEvent("Action","check_trigger:logo:clicked",String(`premium:${this._storageController.getUIState().hasPaidSubscription}`))}_correctMultipleErrors(e,t,n){let s=!1;const i=e=>{e.isTrusted&&!s&&(s=!0,r())},r=()=>{e.inputArea.removeEventListener("keydown",i),this._afterApplyFix(e)};e.inputArea.addEventListener("keydown",i);const o=(i=!1)=>{if(s)return;const a=t.shift();if(!a)return this._afterApplyFix(e),void r();let l=Promise.resolve();i||(l=l.then((()=>z(150))).then((()=>s?Promise.reject():this._scrollToError(e,a,"center")))),l=l.then((()=>{if(s)return Promise.reject();const t=a.fixes.findIndex((e=>n.suggestion.match.test(e.value)));return-1===t?Promise.resolve():this._applyFix(e,a,t,!0)})).then((()=>o())).catch((()=>r()))};o(!0)}}Gt.events={UPDATE:"_lt-state-updated",DESTROY:"_lt-destroy"},Gt.PUNCTIUATION_CHAR_REGEXP=/^[.!?]$/,Gt.COMPLETED_SENTENCE_REGEXP=/^[^\n]*?[.!?]($|\s)/,Gt.NO_LETTERS_REGEXP=/^[0-9,\.\-\:\;\+\*\/\\\%#\=\_]+$/,Gt.TMP_ID_ATTRIBUTE_NAME="data-lt-tmp-id",
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
s.init(new
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class extends n{addEventListener(e,t){}setLocale(e){}getMessage(e,t){return browser.i18n.getMessage(e,t)}}),W.init((()=>new $)),e.init(new
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class extends
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class{}{constructor(){super(...arguments),this._isProductionEnvironmentCached=null}isProductionEnvironment(){if(null===this._isProductionEnvironmentCached){if(t.isSafari())return!0;t.isFirefox()||t.isThunderbird()?this._isProductionEnvironmentCached=!browser.runtime.id.match("languagetool.dev"):this._isProductionEnvironmentCached="update_url"in browser.runtime.getManifest()}return this._isProductionEnvironmentCached}isRuntimeConnected(){try{return browser.runtime.getManifest(),!0}catch(e){return!1}}getVersion(){if(this.isRuntimeConnected()){const e=browser.runtime.getManifest();return e&&e.version?e.version:"unknown"}return"unknown"}getTrackingId(){return t.isSafari()?"13":t.isThunderbird()?"22":"12"}shouldTrack(){return"1"!==navigator.doNotTrack}getType(){return"extension"}getURL(e){return browser.runtime.getURL(e)}getUILanguageCode(){return browser.i18n.getUILanguage()}openWindow(e){browser.runtime.sendMessage({command:"OPEN_URL",url:e})}loadContentScripts(e,t){return this.isRuntimeConnected()?(browser.runtime.getManifest().content_scripts.forEach((n=>{if("js"===t&&n.js){const t=n.js.map((e=>{const t=this.getURL(e);return fetch(t).then((e=>e.text()))}));return Promise.all(t).then((t=>{const n=t.join("\n");e.eval(n)}))}if("css"===t&&n.css){const t=n.css.map((e=>{const t=this.getURL(e);return fetch(t).then((e=>e.text()))}));return Promise.all(t).then((t=>{t.forEach((t=>{const n=e.document.createElement("style");n.textContent=t,(e.document.head||e.document.documentElement).appendChild(n)}))}))}})),Promise.resolve()):Promise.reject()}initializeLTAssistant(e,t={}){return Promise.resolve()}getPreferredLanguages(){return browser.runtime.sendMessage({command:"GET_PREFERRED_LANGUAGES"})}startDictionarySync(){return browser.runtime.sendMessage({command:"START_DICTIONARY_SYNC"})}updateDictionary(){return browser.runtime.sendMessage({command:"UPDATE_DICTIONARY"})}addWordToDictionary(e){const t={command:"ADD_WORD_TO_DICTIONARY",word:e};return browser.runtime.sendMessage(t)}addWordsToDictionary(e){const t={command:"BATCH_ADD_WORDS_TO_DICTIONARY",words:e};return browser.runtime.sendMessage(t)}removeWordFromDictionary(e){const t={command:"REMOVE_WORD_FROM_DICTIONARY",word:e};return browser.runtime.sendMessage(t)}clearDictionary(){return browser.runtime.sendMessage({command:"CLEAR_DICTIONARY"})}loadSynonyms(e,t,n){const s={command:"LOAD_SYNONYMS",wordContext:e,language:t,motherLanguage:n};return browser.runtime.sendMessage(s)}loadPhrases(e,t,n,s){const i={command:"LOAD_PHRASES",uuid:e,phrase:t,language:n,inhouseOnly:s};return browser.runtime.sendMessage(i)}reportPhrase(e,t){const n={command:"REPORT_PHRASE",uuid:e,report:t};return browser.runtime.sendMessage(n)}trackEvent(e,t){const n={command:"TRACK_EVENT",action:e,label:t};return browser.runtime.sendMessage(n)}trackTextLength(e){const t={command:"TRACK_TEXT_LENGTH",textLength:e};return browser.runtime.sendMessage(t)}pageLoaded(e,t,n,s,i){const r={command:"PAGE_LOADED",enabled:e,capitalization:t,supported:n,beta:s,unsupportedMessage:i};return browser.runtime.sendMessage(r)}ltAssistantStatusChanged(e,t){const n="object"==typeof e?e:t,s={command:"LTASSISTANT_STATUS_CHANGED",tabId:"number"==typeof e?e:void 0,enabled:n.enabled,capitalization:n.capitalization};return browser.runtime.sendMessage(s)}check(e,t,n,s,i,r){const o={command:"CHECK_TEXT",text:t,changedParagraphs:n,language:e.language,forceLanguage:e.forceLanguage,hasUserChangedLanguage:r,metaData:s,options:i};return browser.runtime.sendMessage(o)}isOptionsPageSupported(){return!0}openOptionsPage(e,t){const n={command:"OPEN_OPTIONS",target:e,ref:t};return browser.runtime.sendMessage(n)}isFeedbackFormSupported(){return!0}openFeedbackForm(e,t="",n=""){const s={command:"OPEN_FEEDBACK_FORM",url:e,title:t,html:n};return browser.runtime.sendMessage(s)}openPremiumPage(e,t=0,n=0,s=0,i="",r){const o={command:"OPEN_PREMIUM_PAGE",campaign:e,hiddenGrammarMatches:t,hiddenStyleMatches:n,hiddenPunctuationMatches:s,historicMatches:i,textLanguage:r||void 0};return browser.runtime.sendMessage(o)}}),V.init();const Ht=document.getElementById("status-box"),Ft=document.getElementById("status-headline"),Wt=document.getElementById("status-text"),$t=document.getElementById("status-button"),Vt=document.getElementById("text-field"),Kt=document.getElementById("current-year");let zt=!1,Xt=null;const Yt=W.create();var jt;Yt.onReady((()=>{Yt.getUIState().hasPaidSubscription||Yt.hasCustomServer()||document.getElementById("sidebar").classList.remove("validator__sidebar--collapsed"),Yt.startChangelogCoupon();const e=Yt.getActiveCoupon();e&&(document.querySelector("#validator-upgrade-button").textContent=s.getMessage("upgradeTeaserDiscount",[e.percent])),function(){const e=new URL(window.location.href).searchParams.get("id");if(e){const t={command:"GET_VALIDATOR_DATA",id:e};browser.runtime.sendMessage(t).then((e=>{e&&function(e){return"GET_VALIDATOR_DATA"===e.initialCommand&&e.isSuccessful}(e)&&(e.text&&(Vt.innerText=e.text),history.replaceState({},"",location.pathname))})).catch((()=>{V.trackError("js","validator_failed","promise")})).then((()=>{V.trackPageView()}))}else Vt.innerText=localStorage.getItem("validator-text")||"",V.trackPageView()}()})),jt=document.documentElement,Array.from(jt.querySelectorAll("[data-t]")).forEach((e=>{Y(e,e.getAttribute("data-t"))})),Array.from(jt.querySelectorAll("[data-t-placeholder]")).forEach((e=>{Y(e,{key:e.getAttribute("data-t-placeholder"),attr:"placeholder"})})),Array.from(jt.querySelectorAll("[data-t-html]")).forEach((e=>{Y(e,{key:e.getAttribute("data-t-html"),isHTML:!0})})),Array.from(jt.querySelectorAll("[data-t-title]")).forEach((e=>{Y(e,{key:e.getAttribute("data-t-title"),attr:"title"})})),Array.from(jt.querySelectorAll("[data-t-attr]")).forEach((e=>{const[t,n]=(e=>{const t=String(e.getAttribute("data-t-attr"));try{const e=JSON.parse(t);if((e=>Array.isArray(e)&&"string"==typeof e[0]&&"string"==typeof e[1]&&2===e.length)(e))return e;throw Error()}catch(e){return["",""]}})(e);t&&n&&Y(e,{key:n,attr:t})})),Vt.addEventListener(Gt.events.UPDATE,(function(e){zt||(zt=!0,Ht.setAttribute("data-initialized","true"));const t=e.detail;if(JSON.stringify(t)===JSON.stringify(Xt))return;const{hasPaidSubscription:n}=Yt.getUIState();Xt=t;const i=t.checkStatus;Ht.className="validator__status-box",i===qe.TEXT_TOO_SHORT?(Ht.classList.add("validator__status-box--no-errors"),Ft.textContent=s.getMessage("validatorNoTextStatus"),Wt.textContent=""):i===qe.TEXT_TOO_LONG?(n?(Ht.classList.add("validator__status-box--has-exception"),Wt.textContent=""):(Ht.classList.add("validator__status-box--has-premium-errors"),Wt.textContent=s.getMessage("dialogTextTooLongText")),Ft.textContent=s.getMessage("validatorTextTooLongStatus")):i===qe.IN_PROGRESS?(Ht.classList.add("validator__status-box--in-progress"),Ft.textContent=s.getMessage("validatorLoadingHint"),Wt.textContent=""):i===qe.COMPLETED?t.displayedErrors&&t.displayedErrors.length?(Ht.classList.add("validator__status-box--has-errors"),Ft.textContent=1===t.displayedErrors.length?s.getMessage("validatorHasMistakesHeadlineSingular"):s.getMessage("validatorHasMistakesHeadlinePlural",[t.displayedErrors.length]),Wt.textContent=s.getMessage("validatorHasMistakesText")):t.premiumErrors&&t.premiumErrors.length?(Ht.classList.add("validator__status-box--has-premium-errors"),Ft.textContent=1===t.premiumErrors.length?s.getMessage("validatorHasPremiumErrorsHeadlineSingular"):s.getMessage("validatorHasPremiumErrorsHeadlinePlural",[t.premiumErrors.length]),Wt.textContent=s.getMessage("validatorHasPremiumErrorsText")):(Ht.classList.add("validator__status-box--no-errors"),Ft.textContent=s.getMessage("validatorNoMistakesHeadline"),Wt.textContent=""):i===qe.UNSUPPORTED_LANGUAGE?(Ht.classList.add("validator__status-box--has-exception"),Ft.textContent=s.getMessage("dialogUnsupportedLanguageHeadline"),Wt.textContent=s.getMessage("dialogUnsupportedLanguageText")):i===qe.FAILED&&t.errorMessage?(Wt.textContent="",Ft.textContent=t.errorMessage,Ht.classList.add("validator__status-box--has-exception")):(Wt.textContent="",Ft.textContent=s.getMessage("statusIconError"),Ht.classList.add("validator__status-box--has-exception"))})),$t.addEventListener("click",(function(){if(!Xt)return;let e="https://languagetool.org/premium?pk_campaign=addon2-validator-premium-errors";e+=`&grammarMatches=${Xt.premiumErrors.filter((e=>!e.isStyleError)).length}`,e+=`&styleMatches=${Xt.premiumErrors.filter((e=>e.isStyleError)).length}`,window.open(e,"_target")})),window.addEventListener("beforeunload",(function(){localStorage.setItem("validator-text",Vt.innerText)})),Kt.textContent=(new Date).getFullYear().toString(),Vt.focus()})();